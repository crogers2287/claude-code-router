"use strict";var _y=Object.create;var as=Object.defineProperty;var Cy=Object.getOwnPropertyDescriptor;var by=Object.getOwnPropertyNames;var Ey=Object.getPrototypeOf,Ay=Object.prototype.hasOwnProperty;var Ne=(r,e)=>()=>(r&&(e=r(r=0)),e);var W=(r,e)=>()=>(e||r((e={exports:{}}).exports,e),e.exports),wa=(r,e)=>{for(var t in e)as(r,t,{get:e[t],enumerable:!0})},sf=(r,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of by(e))!Ay.call(r,s)&&s!==t&&as(r,s,{get:()=>e[s],enumerable:!(n=Cy(e,s))||n.enumerable});return r};var Ie=(r,e,t)=>(t=r!=null?_y(Ey(r)):{},sf(e||!r||!r.__esModule?as(t,"default",{value:r,enumerable:!0}):t,r)),wy=r=>sf(as({},"__esModule",{value:!0}),r);var af=W((aA,us)=>{us.exports.Space_Separator=/[\u1680\u2000-\u200A\u202F\u205F\u3000]/;us.exports.ID_Start=/[\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u05D0-\u05EA\u05F0-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u0860-\u086A\u08A0-\u08B4\u08B6-\u08BD\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u09FC\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C60\u0C61\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D54-\u0D56\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1877\u1880-\u1884\u1887-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1C80-\u1C88\u1CE9-\u1CEC\u1CEE-\u1CF1\u1CF5\u1CF6\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2E2F\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303C\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312E\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FEA\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6EF\uA717-\uA71F\uA722-\uA788\uA78B-\uA7AE\uA7B0-\uA7B7\uA7F7-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB65\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD40-\uDD74\uDE80-\uDE9C\uDEA0-\uDED0\uDF00-\uDF1F\uDF2D-\uDF4A\uDF50-\uDF75\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDCB0-\uDCD3\uDCD8-\uDCFB\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00\uDE10-\uDE13\uDE15-\uDE17\uDE19-\uDE33\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE4\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2]|\uD804[\uDC03-\uDC37\uDC83-\uDCAF\uDCD0-\uDCE8\uDD03-\uDD26\uDD50-\uDD72\uDD76\uDD83-\uDDB2\uDDC1-\uDDC4\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE2B\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEDE\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3D\uDF50\uDF5D-\uDF61]|\uD805[\uDC00-\uDC34\uDC47-\uDC4A\uDC80-\uDCAF\uDCC4\uDCC5\uDCC7\uDD80-\uDDAE\uDDD8-\uDDDB\uDE00-\uDE2F\uDE44\uDE80-\uDEAA\uDF00-\uDF19]|\uD806[\uDCA0-\uDCDF\uDCFF\uDE00\uDE0B-\uDE32\uDE3A\uDE50\uDE5C-\uDE83\uDE86-\uDE89\uDEC0-\uDEF8]|\uD807[\uDC00-\uDC08\uDC0A-\uDC2E\uDC40\uDC72-\uDC8F\uDD00-\uDD06\uDD08\uDD09\uDD0B-\uDD30\uDD46]|\uD808[\uDC00-\uDF99]|\uD809[\uDC00-\uDC6E\uDC80-\uDD43]|[\uD80C\uD81C-\uD820\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872\uD874-\uD879][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDED0-\uDEED\uDF00-\uDF2F\uDF40-\uDF43\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDF00-\uDF44\uDF50\uDF93-\uDF9F\uDFE0\uDFE1]|\uD821[\uDC00-\uDFEC]|\uD822[\uDC00-\uDEF2]|\uD82C[\uDC00-\uDD1E\uDD70-\uDEFB]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB]|\uD83A[\uDC00-\uDCC4\uDD00-\uDD43]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDED6\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0]|\uD87E[\uDC00-\uDE1D]/;us.exports.ID_Continue=/[\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0300-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u0483-\u0487\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u05D0-\u05EA\u05F0-\u05F2\u0610-\u061A\u0620-\u0669\u066E-\u06D3\u06D5-\u06DC\u06DF-\u06E8\u06EA-\u06FC\u06FF\u0710-\u074A\u074D-\u07B1\u07C0-\u07F5\u07FA\u0800-\u082D\u0840-\u085B\u0860-\u086A\u08A0-\u08B4\u08B6-\u08BD\u08D4-\u08E1\u08E3-\u0963\u0966-\u096F\u0971-\u0983\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BC-\u09C4\u09C7\u09C8\u09CB-\u09CE\u09D7\u09DC\u09DD\u09DF-\u09E3\u09E6-\u09F1\u09FC\u0A01-\u0A03\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A59-\u0A5C\u0A5E\u0A66-\u0A75\u0A81-\u0A83\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABC-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AD0\u0AE0-\u0AE3\u0AE6-\u0AEF\u0AF9-\u0AFF\u0B01-\u0B03\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3C-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B56\u0B57\u0B5C\u0B5D\u0B5F-\u0B63\u0B66-\u0B6F\u0B71\u0B82\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD0\u0BD7\u0BE6-\u0BEF\u0C00-\u0C03\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C58-\u0C5A\u0C60-\u0C63\u0C66-\u0C6F\u0C80-\u0C83\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBC-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CDE\u0CE0-\u0CE3\u0CE6-\u0CEF\u0CF1\u0CF2\u0D00-\u0D03\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D44\u0D46-\u0D48\u0D4A-\u0D4E\u0D54-\u0D57\u0D5F-\u0D63\u0D66-\u0D6F\u0D7A-\u0D7F\u0D82\u0D83\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DE6-\u0DEF\u0DF2\u0DF3\u0E01-\u0E3A\u0E40-\u0E4E\u0E50-\u0E59\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB9\u0EBB-\u0EBD\u0EC0-\u0EC4\u0EC6\u0EC8-\u0ECD\u0ED0-\u0ED9\u0EDC-\u0EDF\u0F00\u0F18\u0F19\u0F20-\u0F29\u0F35\u0F37\u0F39\u0F3E-\u0F47\u0F49-\u0F6C\u0F71-\u0F84\u0F86-\u0F97\u0F99-\u0FBC\u0FC6\u1000-\u1049\u1050-\u109D\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u135D-\u135F\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1714\u1720-\u1734\u1740-\u1753\u1760-\u176C\u176E-\u1770\u1772\u1773\u1780-\u17D3\u17D7\u17DC\u17DD\u17E0-\u17E9\u180B-\u180D\u1810-\u1819\u1820-\u1877\u1880-\u18AA\u18B0-\u18F5\u1900-\u191E\u1920-\u192B\u1930-\u193B\u1946-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u19D0-\u19D9\u1A00-\u1A1B\u1A20-\u1A5E\u1A60-\u1A7C\u1A7F-\u1A89\u1A90-\u1A99\u1AA7\u1AB0-\u1ABD\u1B00-\u1B4B\u1B50-\u1B59\u1B6B-\u1B73\u1B80-\u1BF3\u1C00-\u1C37\u1C40-\u1C49\u1C4D-\u1C7D\u1C80-\u1C88\u1CD0-\u1CD2\u1CD4-\u1CF9\u1D00-\u1DF9\u1DFB-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u203F\u2040\u2054\u2071\u207F\u2090-\u209C\u20D0-\u20DC\u20E1\u20E5-\u20F0\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D7F-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2DE0-\u2DFF\u2E2F\u3005-\u3007\u3021-\u302F\u3031-\u3035\u3038-\u303C\u3041-\u3096\u3099\u309A\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312E\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FEA\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA62B\uA640-\uA66F\uA674-\uA67D\uA67F-\uA6F1\uA717-\uA71F\uA722-\uA788\uA78B-\uA7AE\uA7B0-\uA7B7\uA7F7-\uA827\uA840-\uA873\uA880-\uA8C5\uA8D0-\uA8D9\uA8E0-\uA8F7\uA8FB\uA8FD\uA900-\uA92D\uA930-\uA953\uA960-\uA97C\uA980-\uA9C0\uA9CF-\uA9D9\uA9E0-\uA9FE\uAA00-\uAA36\uAA40-\uAA4D\uAA50-\uAA59\uAA60-\uAA76\uAA7A-\uAAC2\uAADB-\uAADD\uAAE0-\uAAEF\uAAF2-\uAAF6\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB65\uAB70-\uABEA\uABEC\uABED\uABF0-\uABF9\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE00-\uFE0F\uFE20-\uFE2F\uFE33\uFE34\uFE4D-\uFE4F\uFE70-\uFE74\uFE76-\uFEFC\uFF10-\uFF19\uFF21-\uFF3A\uFF3F\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD40-\uDD74\uDDFD\uDE80-\uDE9C\uDEA0-\uDED0\uDEE0\uDF00-\uDF1F\uDF2D-\uDF4A\uDF50-\uDF7A\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDCA0-\uDCA9\uDCB0-\uDCD3\uDCD8-\uDCFB\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00-\uDE03\uDE05\uDE06\uDE0C-\uDE13\uDE15-\uDE17\uDE19-\uDE33\uDE38-\uDE3A\uDE3F\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE6\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2]|\uD804[\uDC00-\uDC46\uDC66-\uDC6F\uDC7F-\uDCBA\uDCD0-\uDCE8\uDCF0-\uDCF9\uDD00-\uDD34\uDD36-\uDD3F\uDD50-\uDD73\uDD76\uDD80-\uDDC4\uDDCA-\uDDCC\uDDD0-\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE37\uDE3E\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEEA\uDEF0-\uDEF9\uDF00-\uDF03\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3C-\uDF44\uDF47\uDF48\uDF4B-\uDF4D\uDF50\uDF57\uDF5D-\uDF63\uDF66-\uDF6C\uDF70-\uDF74]|\uD805[\uDC00-\uDC4A\uDC50-\uDC59\uDC80-\uDCC5\uDCC7\uDCD0-\uDCD9\uDD80-\uDDB5\uDDB8-\uDDC0\uDDD8-\uDDDD\uDE00-\uDE40\uDE44\uDE50-\uDE59\uDE80-\uDEB7\uDEC0-\uDEC9\uDF00-\uDF19\uDF1D-\uDF2B\uDF30-\uDF39]|\uD806[\uDCA0-\uDCE9\uDCFF\uDE00-\uDE3E\uDE47\uDE50-\uDE83\uDE86-\uDE99\uDEC0-\uDEF8]|\uD807[\uDC00-\uDC08\uDC0A-\uDC36\uDC38-\uDC40\uDC50-\uDC59\uDC72-\uDC8F\uDC92-\uDCA7\uDCA9-\uDCB6\uDD00-\uDD06\uDD08\uDD09\uDD0B-\uDD36\uDD3A\uDD3C\uDD3D\uDD3F-\uDD47\uDD50-\uDD59]|\uD808[\uDC00-\uDF99]|\uD809[\uDC00-\uDC6E\uDC80-\uDD43]|[\uD80C\uD81C-\uD820\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872\uD874-\uD879][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDE60-\uDE69\uDED0-\uDEED\uDEF0-\uDEF4\uDF00-\uDF36\uDF40-\uDF43\uDF50-\uDF59\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDF00-\uDF44\uDF50-\uDF7E\uDF8F-\uDF9F\uDFE0\uDFE1]|\uD821[\uDC00-\uDFEC]|\uD822[\uDC00-\uDEF2]|\uD82C[\uDC00-\uDD1E\uDD70-\uDEFB]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99\uDC9D\uDC9E]|\uD834[\uDD65-\uDD69\uDD6D-\uDD72\uDD7B-\uDD82\uDD85-\uDD8B\uDDAA-\uDDAD\uDE42-\uDE44]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB\uDFCE-\uDFFF]|\uD836[\uDE00-\uDE36\uDE3B-\uDE6C\uDE75\uDE84\uDE9B-\uDE9F\uDEA1-\uDEAF]|\uD838[\uDC00-\uDC06\uDC08-\uDC18\uDC1B-\uDC21\uDC23\uDC24\uDC26-\uDC2A]|\uD83A[\uDC00-\uDCC4\uDCD0-\uDCD6\uDD00-\uDD4A\uDD50-\uDD59]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDED6\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0]|\uD87E[\uDC00-\uDE1D]|\uDB40[\uDD00-\uDDEF]/});var Sa=W((uA,uf)=>{var Da=af();uf.exports={isSpaceSeparator(r){return typeof r=="string"&&Da.Space_Separator.test(r)},isIdStartChar(r){return typeof r=="string"&&(r>="a"&&r<="z"||r>="A"&&r<="Z"||r==="$"||r==="_"||Da.ID_Start.test(r))},isIdContinueChar(r){return typeof r=="string"&&(r>="a"&&r<="z"||r>="A"&&r<="Z"||r>="0"&&r<="9"||r==="$"||r==="_"||r==="\u200C"||r==="\u200D"||Da.ID_Continue.test(r))},isDigit(r){return typeof r=="string"&&/[0-9]/.test(r)},isHexDigit(r){return typeof r=="string"&&/[0-9A-Fa-f]/.test(r)}}});var hf=W((cA,df)=>{var qe=Sa(),Ta,Xe,cr,ls,vr,Pt,je,ka,to;df.exports=function(e,t){Ta=String(e),Xe="start",cr=[],ls=0,vr=1,Pt=0,je=void 0,ka=void 0,to=void 0;do je=Dy(),Ty[Xe]();while(je.type!=="eof");return typeof t=="function"?Ra({"":to},"",t):to};function Ra(r,e,t){let n=r[e];if(n!=null&&typeof n=="object")if(Array.isArray(n))for(let s=0;s<n.length;s++){let a=String(s),c=Ra(n,a,t);c===void 0?delete n[a]:Object.defineProperty(n,a,{value:c,writable:!0,enumerable:!0,configurable:!0})}else for(let s in n){let a=Ra(n,s,t);a===void 0?delete n[s]:Object.defineProperty(n,s,{value:a,writable:!0,enumerable:!0,configurable:!0})}return t.call(r,e,n)}var ce,ue,eo,ur,pe;function Dy(){for(ce="default",ue="",eo=!1,ur=1;;){pe=lr();let r=lf[ce]();if(r)return r}}function lr(){if(Ta[ls])return String.fromCodePoint(Ta.codePointAt(ls))}function $(){let r=lr();return r===`
`?(vr++,Pt=0):r?Pt+=r.length:Pt++,r&&(ls+=r.length),r}var lf={default(){switch(pe){case"	":case"\v":case"\f":case" ":case"\xA0":case"\uFEFF":case`
`:case"\r":case"\u2028":case"\u2029":$();return;case"/":$(),ce="comment";return;case void 0:return $(),Te("eof")}if(qe.isSpaceSeparator(pe)){$();return}return lf[Xe]()},comment(){switch(pe){case"*":$(),ce="multiLineComment";return;case"/":$(),ce="singleLineComment";return}throw Re($())},multiLineComment(){switch(pe){case"*":$(),ce="multiLineCommentAsterisk";return;case void 0:throw Re($())}$()},multiLineCommentAsterisk(){switch(pe){case"*":$();return;case"/":$(),ce="default";return;case void 0:throw Re($())}$(),ce="multiLineComment"},singleLineComment(){switch(pe){case`
`:case"\r":case"\u2028":case"\u2029":$(),ce="default";return;case void 0:return $(),Te("eof")}$()},value(){switch(pe){case"{":case"[":return Te("punctuator",$());case"n":return $(),Gr("ull"),Te("null",null);case"t":return $(),Gr("rue"),Te("boolean",!0);case"f":return $(),Gr("alse"),Te("boolean",!1);case"-":case"+":$()==="-"&&(ur=-1),ce="sign";return;case".":ue=$(),ce="decimalPointLeading";return;case"0":ue=$(),ce="zero";return;case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":ue=$(),ce="decimalInteger";return;case"I":return $(),Gr("nfinity"),Te("numeric",1/0);case"N":return $(),Gr("aN"),Te("numeric",NaN);case'"':case"'":eo=$()==='"',ue="",ce="string";return}throw Re($())},identifierNameStartEscape(){if(pe!=="u")throw Re($());$();let r=Fa();switch(r){case"$":case"_":break;default:if(!qe.isIdStartChar(r))throw cf();break}ue+=r,ce="identifierName"},identifierName(){switch(pe){case"$":case"_":case"\u200C":case"\u200D":ue+=$();return;case"\\":$(),ce="identifierNameEscape";return}if(qe.isIdContinueChar(pe)){ue+=$();return}return Te("identifier",ue)},identifierNameEscape(){if(pe!=="u")throw Re($());$();let r=Fa();switch(r){case"$":case"_":case"\u200C":case"\u200D":break;default:if(!qe.isIdContinueChar(r))throw cf();break}ue+=r,ce="identifierName"},sign(){switch(pe){case".":ue=$(),ce="decimalPointLeading";return;case"0":ue=$(),ce="zero";return;case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":ue=$(),ce="decimalInteger";return;case"I":return $(),Gr("nfinity"),Te("numeric",ur*(1/0));case"N":return $(),Gr("aN"),Te("numeric",NaN)}throw Re($())},zero(){switch(pe){case".":ue+=$(),ce="decimalPoint";return;case"e":case"E":ue+=$(),ce="decimalExponent";return;case"x":case"X":ue+=$(),ce="hexadecimal";return}return Te("numeric",ur*0)},decimalInteger(){switch(pe){case".":ue+=$(),ce="decimalPoint";return;case"e":case"E":ue+=$(),ce="decimalExponent";return}if(qe.isDigit(pe)){ue+=$();return}return Te("numeric",ur*Number(ue))},decimalPointLeading(){if(qe.isDigit(pe)){ue+=$(),ce="decimalFraction";return}throw Re($())},decimalPoint(){switch(pe){case"e":case"E":ue+=$(),ce="decimalExponent";return}if(qe.isDigit(pe)){ue+=$(),ce="decimalFraction";return}return Te("numeric",ur*Number(ue))},decimalFraction(){switch(pe){case"e":case"E":ue+=$(),ce="decimalExponent";return}if(qe.isDigit(pe)){ue+=$();return}return Te("numeric",ur*Number(ue))},decimalExponent(){switch(pe){case"+":case"-":ue+=$(),ce="decimalExponentSign";return}if(qe.isDigit(pe)){ue+=$(),ce="decimalExponentInteger";return}throw Re($())},decimalExponentSign(){if(qe.isDigit(pe)){ue+=$(),ce="decimalExponentInteger";return}throw Re($())},decimalExponentInteger(){if(qe.isDigit(pe)){ue+=$();return}return Te("numeric",ur*Number(ue))},hexadecimal(){if(qe.isHexDigit(pe)){ue+=$(),ce="hexadecimalInteger";return}throw Re($())},hexadecimalInteger(){if(qe.isHexDigit(pe)){ue+=$();return}return Te("numeric",ur*Number(ue))},string(){switch(pe){case"\\":$(),ue+=Sy();return;case'"':if(eo)return $(),Te("string",ue);ue+=$();return;case"'":if(!eo)return $(),Te("string",ue);ue+=$();return;case`
`:case"\r":throw Re($());case"\u2028":case"\u2029":Ry(pe);break;case void 0:throw Re($())}ue+=$()},start(){switch(pe){case"{":case"[":return Te("punctuator",$())}ce="value"},beforePropertyName(){switch(pe){case"$":case"_":ue=$(),ce="identifierName";return;case"\\":$(),ce="identifierNameStartEscape";return;case"}":return Te("punctuator",$());case'"':case"'":eo=$()==='"',ce="string";return}if(qe.isIdStartChar(pe)){ue+=$(),ce="identifierName";return}throw Re($())},afterPropertyName(){if(pe===":")return Te("punctuator",$());throw Re($())},beforePropertyValue(){ce="value"},afterPropertyValue(){switch(pe){case",":case"}":return Te("punctuator",$())}throw Re($())},beforeArrayValue(){if(pe==="]")return Te("punctuator",$());ce="value"},afterArrayValue(){switch(pe){case",":case"]":return Te("punctuator",$())}throw Re($())},end(){throw Re($())}};function Te(r,e){return{type:r,value:e,line:vr,column:Pt}}function Gr(r){for(let e of r){if(lr()!==e)throw Re($());$()}}function Sy(){switch(lr()){case"b":return $(),"\b";case"f":return $(),"\f";case"n":return $(),`
`;case"r":return $(),"\r";case"t":return $(),"	";case"v":return $(),"\v";case"0":if($(),qe.isDigit(lr()))throw Re($());return"\0";case"x":return $(),vy();case"u":return $(),Fa();case`
`:case"\u2028":case"\u2029":return $(),"";case"\r":return $(),lr()===`
`&&$(),"";case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":throw Re($());case void 0:throw Re($())}return $()}function vy(){let r="",e=lr();if(!qe.isHexDigit(e)||(r+=$(),e=lr(),!qe.isHexDigit(e)))throw Re($());return r+=$(),String.fromCodePoint(parseInt(r,16))}function Fa(){let r="",e=4;for(;e-- >0;){let t=lr();if(!qe.isHexDigit(t))throw Re($());r+=$()}return String.fromCodePoint(parseInt(r,16))}var Ty={start(){if(je.type==="eof")throw Wr();va()},beforePropertyName(){switch(je.type){case"identifier":case"string":ka=je.value,Xe="afterPropertyName";return;case"punctuator":cs();return;case"eof":throw Wr()}},afterPropertyName(){if(je.type==="eof")throw Wr();Xe="beforePropertyValue"},beforePropertyValue(){if(je.type==="eof")throw Wr();va()},beforeArrayValue(){if(je.type==="eof")throw Wr();if(je.type==="punctuator"&&je.value==="]"){cs();return}va()},afterPropertyValue(){if(je.type==="eof")throw Wr();switch(je.value){case",":Xe="beforePropertyName";return;case"}":cs()}},afterArrayValue(){if(je.type==="eof")throw Wr();switch(je.value){case",":Xe="beforeArrayValue";return;case"]":cs()}},end(){}};function va(){let r;switch(je.type){case"punctuator":switch(je.value){case"{":r={};break;case"[":r=[];break}break;case"null":case"boolean":case"numeric":case"string":r=je.value;break}if(to===void 0)to=r;else{let e=cr[cr.length-1];Array.isArray(e)?e.push(r):Object.defineProperty(e,ka,{value:r,writable:!0,enumerable:!0,configurable:!0})}if(r!==null&&typeof r=="object")cr.push(r),Array.isArray(r)?Xe="beforeArrayValue":Xe="beforePropertyName";else{let e=cr[cr.length-1];e==null?Xe="end":Array.isArray(e)?Xe="afterArrayValue":Xe="afterPropertyValue"}}function cs(){cr.pop();let r=cr[cr.length-1];r==null?Xe="end":Array.isArray(r)?Xe="afterArrayValue":Xe="afterPropertyValue"}function Re(r){return fs(r===void 0?`JSON5: invalid end of input at ${vr}:${Pt}`:`JSON5: invalid character '${ff(r)}' at ${vr}:${Pt}`)}function Wr(){return fs(`JSON5: invalid end of input at ${vr}:${Pt}`)}function cf(){return Pt-=5,fs(`JSON5: invalid identifier character at ${vr}:${Pt}`)}function Ry(r){console.warn(`JSON5: '${ff(r)}' in strings is not valid ECMAScript; consider escaping`)}function ff(r){let e={"'":"\\'",'"':'\\"',"\\":"\\\\","\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","	":"\\t","\v":"\\v","\0":"\\0","\u2028":"\\u2028","\u2029":"\\u2029"};if(e[r])return e[r];if(r<" "){let t=r.charCodeAt(0).toString(16);return"\\x"+("00"+t).substring(t.length)}return r}function fs(r){let e=new SyntaxError(r);return e.lineNumber=vr,e.columnNumber=Pt,e}});var mf=W((lA,pf)=>{var Oa=Sa();pf.exports=function(e,t,n){let s=[],a="",c,f,l="",d;if(t!=null&&typeof t=="object"&&!Array.isArray(t)&&(n=t.space,d=t.quote,t=t.replacer),typeof t=="function")f=t;else if(Array.isArray(t)){c=[];for(let y of t){let C;typeof y=="string"?C=y:(typeof y=="number"||y instanceof String||y instanceof Number)&&(C=String(y)),C!==void 0&&c.indexOf(C)<0&&c.push(C)}}return n instanceof Number?n=Number(n):n instanceof String&&(n=String(n)),typeof n=="number"?n>0&&(n=Math.min(10,Math.floor(n)),l="          ".substr(0,n)):typeof n=="string"&&(l=n.substr(0,10)),h("",{"":e});function h(y,C){let _=C[y];switch(_!=null&&(typeof _.toJSON5=="function"?_=_.toJSON5(y):typeof _.toJSON=="function"&&(_=_.toJSON(y))),f&&(_=f.call(C,y,_)),_ instanceof Number?_=Number(_):_ instanceof String?_=String(_):_ instanceof Boolean&&(_=_.valueOf()),_){case null:return"null";case!0:return"true";case!1:return"false"}if(typeof _=="string")return b(_,!1);if(typeof _=="number")return String(_);if(typeof _=="object")return Array.isArray(_)?S(_):A(_)}function b(y){let C={"'":.1,'"':.2},_={"'":"\\'",'"':'\\"',"\\":"\\\\","\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","	":"\\t","\v":"\\v","\0":"\\0","\u2028":"\\u2028","\u2029":"\\u2029"},F="";for(let U=0;U<y.length;U++){let B=y[U];switch(B){case"'":case'"':C[B]++,F+=B;continue;case"\0":if(Oa.isDigit(y[U+1])){F+="\\x00";continue}}if(_[B]){F+=_[B];continue}if(B<" "){let j=B.charCodeAt(0).toString(16);F+="\\x"+("00"+j).substring(j.length);continue}F+=B}let k=d||Object.keys(C).reduce((U,B)=>C[U]<C[B]?U:B);return F=F.replace(new RegExp(k,"g"),_[k]),k+F+k}function A(y){if(s.indexOf(y)>=0)throw TypeError("Converting circular structure to JSON5");s.push(y);let C=a;a=a+l;let _=c||Object.keys(y),F=[];for(let U of _){let B=h(U,y);if(B!==void 0){let j=O(U)+":";l!==""&&(j+=" "),j+=B,F.push(j)}}let k;if(F.length===0)k="{}";else{let U;if(l==="")U=F.join(","),k="{"+U+"}";else{let B=`,
`+a;U=F.join(B),k=`{
`+a+U+`,
`+C+"}"}}return s.pop(),a=C,k}function O(y){if(y.length===0)return b(y,!0);let C=String.fromCodePoint(y.codePointAt(0));if(!Oa.isIdStartChar(C))return b(y,!0);for(let _=C.length;_<y.length;_++)if(!Oa.isIdContinueChar(String.fromCodePoint(y.codePointAt(_))))return b(y,!0);return y}function S(y){if(s.indexOf(y)>=0)throw TypeError("Converting circular structure to JSON5");s.push(y);let C=a;a=a+l;let _=[];for(let k=0;k<y.length;k++){let U=h(String(k),y);_.push(U!==void 0?U:"null")}let F;if(_.length===0)F="[]";else if(l==="")F="["+_.join(",")+"]";else{let k=`,
`+a,U=_.join(k);F=`[
`+a+U+`,
`+C+"]"}return s.pop(),a=C,F}}});var Pa=W((fA,gf)=>{var Fy=hf(),ky=mf(),Oy={parse:Fy,stringify:ky};gf.exports=Oy});var qa=W((UA,Bf)=>{"use strict";var As=Object.prototype.hasOwnProperty,xf=Object.prototype.toString,Tf=Object.defineProperty,Rf=Object.getOwnPropertyDescriptor,Ff=function(e){return typeof Array.isArray=="function"?Array.isArray(e):xf.call(e)==="[object Array]"},kf=function(e){if(!e||xf.call(e)!=="[object Object]")return!1;var t=As.call(e,"constructor"),n=e.constructor&&e.constructor.prototype&&As.call(e.constructor.prototype,"isPrototypeOf");if(e.constructor&&!t&&!n)return!1;var s;for(s in e);return typeof s>"u"||As.call(e,s)},Of=function(e,t){Tf&&t.name==="__proto__"?Tf(e,t.name,{enumerable:!0,configurable:!0,value:t.newValue,writable:!0}):e[t.name]=t.newValue},Pf=function(e,t){if(t==="__proto__")if(As.call(e,t)){if(Rf)return Rf(e,t).value}else return;return e[t]};Bf.exports=function r(){var e,t,n,s,a,c,f=arguments[0],l=1,d=arguments.length,h=!1;for(typeof f=="boolean"&&(h=f,f=arguments[1]||{},l=2),(f==null||typeof f!="object"&&typeof f!="function")&&(f={});l<d;++l)if(e=arguments[l],e!=null)for(t in e)n=Pf(f,t),s=Pf(e,t),f!==s&&(h&&s&&(kf(s)||(a=Ff(s)))?(a?(a=!1,c=n&&Ff(n)?n:[]):c=n&&kf(n)?n:{},Of(f,{name:t,newValue:r(h,c,s)})):typeof s<"u"&&Of(f,{name:t,newValue:s}));return f}});var If=W((MA,By)=>{By.exports={name:"gaxios",version:"7.1.1",description:"A simple common HTTP client specifically for Google APIs and services.",main:"build/cjs/src/index.js",types:"build/cjs/src/index.d.ts",files:["build/"],exports:{".":{import:{types:"./build/esm/src/index.d.ts",default:"./build/esm/src/index.js"},require:{types:"./build/cjs/src/index.d.ts",default:"./build/cjs/src/index.js"}}},scripts:{lint:"gts check --no-inline-config",test:"c8 mocha build/esm/test","presystem-test":"npm run compile","system-test":"mocha build/esm/system-test --timeout 80000",compile:"tsc -b ./tsconfig.json ./tsconfig.cjs.json && node utils/enable-esm.mjs",fix:"gts fix",prepare:"npm run compile",pretest:"npm run compile",webpack:"webpack","prebrowser-test":"npm run compile","browser-test":"node build/browser-test/browser-test-runner.js",docs:"jsdoc -c .jsdoc.js","docs-test":"linkinator docs","predocs-test":"npm run docs","samples-test":"cd samples/ && npm link ../ && npm test && cd ../",prelint:"cd samples; npm link ../; npm install",clean:"gts clean"},repository:"googleapis/gaxios",keywords:["google"],engines:{node:">=18"},author:"Google, LLC",license:"Apache-2.0",devDependencies:{"@babel/plugin-proposal-private-methods":"^7.18.6","@types/cors":"^2.8.6","@types/express":"^5.0.0","@types/extend":"^3.0.1","@types/mocha":"^10.0.10","@types/multiparty":"4.2.1","@types/mv":"^2.1.0","@types/ncp":"^2.0.1","@types/node":"^22.0.0","@types/sinon":"^17.0.0","@types/tmp":"0.2.6",assert:"^2.0.0",browserify:"^17.0.0",c8:"^10.0.0",cors:"^2.8.5",express:"^5.0.0",gts:"^6.0.0","is-docker":"^3.0.0",jsdoc:"^4.0.0","jsdoc-fresh":"^4.0.0","jsdoc-region-tag":"^3.0.0",karma:"^6.0.0","karma-chrome-launcher":"^3.0.0","karma-coverage":"^2.0.0","karma-firefox-launcher":"^2.0.0","karma-mocha":"^2.0.0","karma-remap-coverage":"^0.1.5","karma-sourcemap-loader":"^0.4.0","karma-webpack":"^5.0.1",linkinator:"^6.1.2",mocha:"^11.1.0",multiparty:"^4.2.1",mv:"^2.1.1",ncp:"^2.0.0",nock:"^14.0.0-beta.13","null-loader":"^4.0.0","pack-n-play":"^3.0.0",puppeteer:"^24.0.0",sinon:"^20.0.0","stream-browserify":"^3.0.0",tmp:"0.2.3","ts-loader":"^9.5.2",typescript:"^5.8.3",webpack:"^5.35.0","webpack-cli":"^6.0.1"},dependencies:{extend:"^3.0.2","https-proxy-agent":"^7.0.1","node-fetch":"^3.3.2"}}});var qf=W(($A,Nf)=>{"use strict";var Iy=If();Nf.exports={pkg:Iy}});var Ua=W(At=>{"use strict";var Lf=At&&At.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(At,"__esModule",{value:!0});At.GaxiosError=At.GAXIOS_ERROR_SYMBOL=void 0;At.defaultErrorRedactor=Uf;var jf=Lf(qa()),Ny=Lf(qf()),ja=Ny.default.pkg;At.GAXIOS_ERROR_SYMBOL=Symbol.for(`${ja.name}-gaxios-error`);var La=class r extends Error{config;response;code;status;error;[At.GAXIOS_ERROR_SYMBOL]=ja.version;static[Symbol.hasInstance](e){return e&&typeof e=="object"&&At.GAXIOS_ERROR_SYMBOL in e&&e[At.GAXIOS_ERROR_SYMBOL]===ja.version?!0:Function.prototype[Symbol.hasInstance].call(r,e)}constructor(e,t,n,s){if(super(e,{cause:s}),this.config=t,this.response=n,this.error=s instanceof Error?s:void 0,this.config=(0,jf.default)(!0,{},t),this.response&&(this.response.config=(0,jf.default)(!0,{},this.response.config)),this.response){try{this.response.data=qy(this.config.responseType,this.response?.bodyUsed?this.response?.data:void 0)}catch{}this.status=this.response.status}s instanceof DOMException?this.code=s.name:s&&typeof s=="object"&&"code"in s&&(typeof s.code=="string"||typeof s.code=="number")&&(this.code=s.code)}static extractAPIErrorFromResponse(e,t="The request failed"){let n=t;if(typeof e.data=="string"&&(n=e.data),e.data&&typeof e.data=="object"&&"error"in e.data&&e.data.error&&!e.ok){if(typeof e.data.error=="string")return{message:e.data.error,code:e.status,status:e.statusText};if(typeof e.data.error=="object"){n="message"in e.data.error&&typeof e.data.error.message=="string"?e.data.error.message:n;let s="status"in e.data.error&&typeof e.data.error.status=="string"?e.data.error.status:e.statusText,a="code"in e.data.error&&typeof e.data.error.code=="number"?e.data.error.code:e.status;if("errors"in e.data.error&&Array.isArray(e.data.error.errors)){let c=[];for(let f of e.data.error.errors)typeof f=="object"&&"message"in f&&typeof f.message=="string"&&c.push(f.message);return Object.assign({message:c.join(`
`)||n,code:a,status:s},e.data.error)}return Object.assign({message:n,code:a,status:s},e.data.error)}}return{message:n,code:e.status,status:e.statusText}}};At.GaxiosError=La;function qy(r,e){switch(r){case"stream":return e;case"json":return JSON.parse(JSON.stringify(e));case"arraybuffer":return JSON.parse(Buffer.from(e).toString("utf8"));case"blob":return JSON.parse(e.text());default:return e}}function Uf(r){let e="<<REDACTED> - See `errorRedactor` option in `gaxios` for configuration>.";function t(a){a&&a.forEach((c,f)=>{(/^authentication$/i.test(f)||/^authorization$/i.test(f)||/secret/i.test(f))&&a.set(f,e)})}function n(a,c){if(typeof a=="object"&&a!==null&&typeof a[c]=="string"){let f=a[c];(/grant_type=/i.test(f)||/assertion=/i.test(f)||/secret/i.test(f))&&(a[c]=e)}}function s(a){!a||typeof a!="object"||(a instanceof FormData||a instanceof URLSearchParams||"forEach"in a&&"set"in a?a.forEach((c,f)=>{(["grant_type","assertion"].includes(f)||/secret/.test(f))&&a.set(f,e)}):("grant_type"in a&&(a.grant_type=e),"assertion"in a&&(a.assertion=e),"client_secret"in a&&(a.client_secret=e)))}return r.config&&(t(r.config.headers),n(r.config,"data"),s(r.config.data),n(r.config,"body"),s(r.config.body),r.config.url.searchParams.has("token")&&r.config.url.searchParams.set("token",e),r.config.url.searchParams.has("client_secret")&&r.config.url.searchParams.set("client_secret",e)),r.response&&(Uf({config:r.response.config}),t(r.response.headers),r.response.bodyUsed&&(n(r.response,"data"),s(r.response.data))),r}});var $f=W(Ma=>{"use strict";Object.defineProperty(Ma,"__esModule",{value:!0});Ma.getRetryConfig=jy;async function jy(r){let e=Mf(r);if(!r||!r.config||!e&&!r.config.retry)return{shouldRetry:!1};e=e||{},e.currentRetryAttempt=e.currentRetryAttempt||0,e.retry=e.retry===void 0||e.retry===null?3:e.retry,e.httpMethodsToRetry=e.httpMethodsToRetry||["GET","HEAD","PUT","OPTIONS","DELETE"],e.noResponseRetries=e.noResponseRetries===void 0||e.noResponseRetries===null?2:e.noResponseRetries,e.retryDelayMultiplier=e.retryDelayMultiplier?e.retryDelayMultiplier:2,e.timeOfFirstRequest=e.timeOfFirstRequest?e.timeOfFirstRequest:Date.now(),e.totalTimeout=e.totalTimeout?e.totalTimeout:Number.MAX_SAFE_INTEGER,e.maxRetryDelay=e.maxRetryDelay?e.maxRetryDelay:Number.MAX_SAFE_INTEGER;let t=[[100,199],[408,408],[429,429],[500,599]];if(e.statusCodesToRetry=e.statusCodesToRetry||t,r.config.retryConfig=e,!await(e.shouldRetry||Ly)(r))return{shouldRetry:!1,config:r.config};let s=Uy(e);r.config.retryConfig.currentRetryAttempt+=1;let a=e.retryBackoff?e.retryBackoff(r,s):new Promise(c=>{setTimeout(c,s)});return e.onRetryAttempt&&await e.onRetryAttempt(r),await a,{shouldRetry:!0,config:r.config}}function Ly(r){let e=Mf(r);if(r.config.signal?.aborted&&r.code!=="TimeoutError"||r.code==="AbortError"||!e||e.retry===0||!r.response&&(e.currentRetryAttempt||0)>=e.noResponseRetries||!e.httpMethodsToRetry||!e.httpMethodsToRetry.includes(r.config.method?.toUpperCase()||"GET"))return!1;if(r.response&&r.response.status){let t=!1;for(let[n,s]of e.statusCodesToRetry){let a=r.response.status;if(a>=n&&a<=s){t=!0;break}}if(!t)return!1}return e.currentRetryAttempt=e.currentRetryAttempt||0,!(e.currentRetryAttempt>=e.retry)}function Mf(r){if(r&&r.config&&r.config.retryConfig)return r.config.retryConfig}function Uy(r){let t=(r.currentRetryAttempt?0:r.retryDelay??100)+(Math.pow(r.retryDelayMultiplier,r.currentRetryAttempt)-1)/2*1e3,n=r.totalTimeout-(Date.now()-r.timeOfFirstRequest);return Math.min(t,n,r.maxRetryDelay)}});var Ha=W(ws=>{"use strict";Object.defineProperty(ws,"__esModule",{value:!0});ws.GaxiosInterceptorManager=void 0;var $a=class extends Set{};ws.GaxiosInterceptorManager=$a});var Gf=W((zA,Hf)=>{var _n=1e3,Cn=_n*60,bn=Cn*60,zr=bn*24,My=zr*7,$y=zr*365.25;Hf.exports=function(r,e){e=e||{};var t=typeof r;if(t==="string"&&r.length>0)return Hy(r);if(t==="number"&&isFinite(r))return e.long?Wy(r):Gy(r);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(r))};function Hy(r){if(r=String(r),!(r.length>100)){var e=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(r);if(e){var t=parseFloat(e[1]),n=(e[2]||"ms").toLowerCase();switch(n){case"years":case"year":case"yrs":case"yr":case"y":return t*$y;case"weeks":case"week":case"w":return t*My;case"days":case"day":case"d":return t*zr;case"hours":case"hour":case"hrs":case"hr":case"h":return t*bn;case"minutes":case"minute":case"mins":case"min":case"m":return t*Cn;case"seconds":case"second":case"secs":case"sec":case"s":return t*_n;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return t;default:return}}}}function Gy(r){var e=Math.abs(r);return e>=zr?Math.round(r/zr)+"d":e>=bn?Math.round(r/bn)+"h":e>=Cn?Math.round(r/Cn)+"m":e>=_n?Math.round(r/_n)+"s":r+"ms"}function Wy(r){var e=Math.abs(r);return e>=zr?Ds(r,e,zr,"day"):e>=bn?Ds(r,e,bn,"hour"):e>=Cn?Ds(r,e,Cn,"minute"):e>=_n?Ds(r,e,_n,"second"):r+" ms"}function Ds(r,e,t,n){var s=e>=t*1.5;return Math.round(r/t)+" "+n+(s?"s":"")}});var Ga=W((JA,Wf)=>{function zy(r){t.debug=t,t.default=t,t.coerce=l,t.disable=c,t.enable=s,t.enabled=f,t.humanize=Gf(),t.destroy=d,Object.keys(r).forEach(h=>{t[h]=r[h]}),t.names=[],t.skips=[],t.formatters={};function e(h){let b=0;for(let A=0;A<h.length;A++)b=(b<<5)-b+h.charCodeAt(A),b|=0;return t.colors[Math.abs(b)%t.colors.length]}t.selectColor=e;function t(h){let b,A=null,O,S;function y(...C){if(!y.enabled)return;let _=y,F=Number(new Date),k=F-(b||F);_.diff=k,_.prev=b,_.curr=F,b=F,C[0]=t.coerce(C[0]),typeof C[0]!="string"&&C.unshift("%O");let U=0;C[0]=C[0].replace(/%([a-zA-Z%])/g,(j,H)=>{if(j==="%%")return"%";U++;let Z=t.formatters[H];if(typeof Z=="function"){let z=C[U];j=Z.call(_,z),C.splice(U,1),U--}return j}),t.formatArgs.call(_,C),(_.log||t.log).apply(_,C)}return y.namespace=h,y.useColors=t.useColors(),y.color=t.selectColor(h),y.extend=n,y.destroy=t.destroy,Object.defineProperty(y,"enabled",{enumerable:!0,configurable:!1,get:()=>A!==null?A:(O!==t.namespaces&&(O=t.namespaces,S=t.enabled(h)),S),set:C=>{A=C}}),typeof t.init=="function"&&t.init(y),y}function n(h,b){let A=t(this.namespace+(typeof b>"u"?":":b)+h);return A.log=this.log,A}function s(h){t.save(h),t.namespaces=h,t.names=[],t.skips=[];let b=(typeof h=="string"?h:"").trim().replace(/\s+/g,",").split(",").filter(Boolean);for(let A of b)A[0]==="-"?t.skips.push(A.slice(1)):t.names.push(A)}function a(h,b){let A=0,O=0,S=-1,y=0;for(;A<h.length;)if(O<b.length&&(b[O]===h[A]||b[O]==="*"))b[O]==="*"?(S=O,y=A,O++):(A++,O++);else if(S!==-1)O=S+1,y++,A=y;else return!1;for(;O<b.length&&b[O]==="*";)O++;return O===b.length}function c(){let h=[...t.names,...t.skips.map(b=>"-"+b)].join(",");return t.enable(""),h}function f(h){for(let b of t.skips)if(a(h,b))return!1;for(let b of t.names)if(a(h,b))return!0;return!1}function l(h){return h instanceof Error?h.stack||h.message:h}function d(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return t.enable(t.load()),t}Wf.exports=zy});var zf=W((rt,Ss)=>{rt.formatArgs=Vy;rt.save=Ky;rt.load=Yy;rt.useColors=Jy;rt.storage=Xy();rt.destroy=(()=>{let r=!1;return()=>{r||(r=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})();rt.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function Jy(){if(typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs))return!0;if(typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;let r;return typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&(r=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(r[1],10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function Vy(r){if(r[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+r[0]+(this.useColors?"%c ":" ")+"+"+Ss.exports.humanize(this.diff),!this.useColors)return;let e="color: "+this.color;r.splice(1,0,e,"color: inherit");let t=0,n=0;r[0].replace(/%[a-zA-Z%]/g,s=>{s!=="%%"&&(t++,s==="%c"&&(n=t))}),r.splice(n,0,e)}rt.log=console.debug||console.log||(()=>{});function Ky(r){try{r?rt.storage.setItem("debug",r):rt.storage.removeItem("debug")}catch{}}function Yy(){let r;try{r=rt.storage.getItem("debug")||rt.storage.getItem("DEBUG")}catch{}return!r&&typeof process<"u"&&"env"in process&&(r=process.env.DEBUG),r}function Xy(){try{return localStorage}catch{}}Ss.exports=Ga()(rt);var{formatters:Qy}=Ss.exports;Qy.j=function(r){try{return JSON.stringify(r)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}});var Vf=W((VA,Jf)=>{"use strict";Jf.exports=(r,e)=>{e=e||process.argv;let t=r.startsWith("-")?"":r.length===1?"-":"--",n=e.indexOf(t+r),s=e.indexOf("--");return n!==-1&&(s===-1?!0:n<s)}});var Yf=W((KA,Kf)=>{"use strict";var Zy=require("os"),xt=Vf(),ze=process.env,En;xt("no-color")||xt("no-colors")||xt("color=false")?En=!1:(xt("color")||xt("colors")||xt("color=true")||xt("color=always"))&&(En=!0);"FORCE_COLOR"in ze&&(En=ze.FORCE_COLOR.length===0||parseInt(ze.FORCE_COLOR,10)!==0);function e0(r){return r===0?!1:{level:r,hasBasic:!0,has256:r>=2,has16m:r>=3}}function t0(r){if(En===!1)return 0;if(xt("color=16m")||xt("color=full")||xt("color=truecolor"))return 3;if(xt("color=256"))return 2;if(r&&!r.isTTY&&En!==!0)return 0;let e=En?1:0;if(process.platform==="win32"){let t=Zy.release().split(".");return Number(process.versions.node.split(".")[0])>=8&&Number(t[0])>=10&&Number(t[2])>=10586?Number(t[2])>=14931?3:2:1}if("CI"in ze)return["TRAVIS","CIRCLECI","APPVEYOR","GITLAB_CI"].some(t=>t in ze)||ze.CI_NAME==="codeship"?1:e;if("TEAMCITY_VERSION"in ze)return/^(9\.(0*[1-9]\d*)\.|\d{2,}\.)/.test(ze.TEAMCITY_VERSION)?1:0;if(ze.COLORTERM==="truecolor")return 3;if("TERM_PROGRAM"in ze){let t=parseInt((ze.TERM_PROGRAM_VERSION||"").split(".")[0],10);switch(ze.TERM_PROGRAM){case"iTerm.app":return t>=3?3:2;case"Apple_Terminal":return 2}}return/-256(color)?$/i.test(ze.TERM)?2:/^screen|^xterm|^vt100|^vt220|^rxvt|color|ansi|cygwin|linux/i.test(ze.TERM)||"COLORTERM"in ze?1:(ze.TERM==="dumb",e)}function Wa(r){let e=t0(r);return e0(e)}Kf.exports={supportsColor:Wa,stdout:Wa(process.stdout),stderr:Wa(process.stderr)}});var Qf=W((Le,Ts)=>{var r0=require("tty"),vs=require("util");Le.init=c0;Le.log=i0;Le.formatArgs=o0;Le.save=a0;Le.load=u0;Le.useColors=n0;Le.destroy=vs.deprecate(()=>{},"Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.");Le.colors=[6,2,3,4,5,1];try{let r=Yf();r&&(r.stderr||r).level>=2&&(Le.colors=[20,21,26,27,32,33,38,39,40,41,42,43,44,45,56,57,62,63,68,69,74,75,76,77,78,79,80,81,92,93,98,99,112,113,128,129,134,135,148,149,160,161,162,163,164,165,166,167,168,169,170,171,172,173,178,179,184,185,196,197,198,199,200,201,202,203,204,205,206,207,208,209,214,215,220,221])}catch{}Le.inspectOpts=Object.keys(process.env).filter(r=>/^debug_/i.test(r)).reduce((r,e)=>{let t=e.substring(6).toLowerCase().replace(/_([a-z])/g,(s,a)=>a.toUpperCase()),n=process.env[e];return/^(yes|on|true|enabled)$/i.test(n)?n=!0:/^(no|off|false|disabled)$/i.test(n)?n=!1:n==="null"?n=null:n=Number(n),r[t]=n,r},{});function n0(){return"colors"in Le.inspectOpts?!!Le.inspectOpts.colors:r0.isatty(process.stderr.fd)}function o0(r){let{namespace:e,useColors:t}=this;if(t){let n=this.color,s="\x1B[3"+(n<8?n:"8;5;"+n),a=`  ${s};1m${e} \x1B[0m`;r[0]=a+r[0].split(`
`).join(`
`+a),r.push(s+"m+"+Ts.exports.humanize(this.diff)+"\x1B[0m")}else r[0]=s0()+e+" "+r[0]}function s0(){return Le.inspectOpts.hideDate?"":new Date().toISOString()+" "}function i0(...r){return process.stderr.write(vs.formatWithOptions(Le.inspectOpts,...r)+`
`)}function a0(r){r?process.env.DEBUG=r:delete process.env.DEBUG}function u0(){return process.env.DEBUG}function c0(r){r.inspectOpts={};let e=Object.keys(Le.inspectOpts);for(let t=0;t<e.length;t++)r.inspectOpts[e[t]]=Le.inspectOpts[e[t]]}Ts.exports=Ga()(Le);var{formatters:Xf}=Ts.exports;Xf.o=function(r){return this.inspectOpts.colors=this.useColors,vs.inspect(r,this.inspectOpts).split(`
`).map(e=>e.trim()).join(" ")};Xf.O=function(r){return this.inspectOpts.colors=this.useColors,vs.inspect(r,this.inspectOpts)}});var Ja=W((YA,za)=>{typeof process>"u"||process.type==="renderer"||process.browser===!0||process.__nwjs?za.exports=zf():za.exports=Qf()});var td=W(nt=>{"use strict";var l0=nt&&nt.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t);var s=Object.getOwnPropertyDescriptor(e,t);(!s||("get"in s?!e.__esModule:s.writable||s.configurable))&&(s={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(r,n,s)}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),f0=nt&&nt.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),Zf=nt&&nt.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&l0(e,r,t);return f0(e,r),e};Object.defineProperty(nt,"__esModule",{value:!0});nt.req=nt.json=nt.toBuffer=void 0;var d0=Zf(require("http")),h0=Zf(require("https"));async function ed(r){let e=0,t=[];for await(let n of r)e+=n.length,t.push(n);return Buffer.concat(t,e)}nt.toBuffer=ed;async function p0(r){let t=(await ed(r)).toString("utf8");try{return JSON.parse(t)}catch(n){let s=n;throw s.message+=` (input: ${t})`,s}}nt.json=p0;function m0(r,e={}){let n=((typeof r=="string"?r:r.href).startsWith("https:")?h0:d0).request(r,e),s=new Promise((a,c)=>{n.once("response",a).once("error",c).end()});return n.then=s.then.bind(s),n}nt.req=m0});var sd=W(ut=>{"use strict";var nd=ut&&ut.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t);var s=Object.getOwnPropertyDescriptor(e,t);(!s||("get"in s?!e.__esModule:s.writable||s.configurable))&&(s={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(r,n,s)}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),g0=ut&&ut.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),od=ut&&ut.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&nd(e,r,t);return g0(e,r),e},y0=ut&&ut.__exportStar||function(r,e){for(var t in r)t!=="default"&&!Object.prototype.hasOwnProperty.call(e,t)&&nd(e,r,t)};Object.defineProperty(ut,"__esModule",{value:!0});ut.Agent=void 0;var _0=od(require("net")),rd=od(require("http")),C0=require("https");y0(td(),ut);var Gt=Symbol("AgentBaseInternalState"),Va=class extends rd.Agent{constructor(e){super(e),this[Gt]={}}isSecureEndpoint(e){if(e){if(typeof e.secureEndpoint=="boolean")return e.secureEndpoint;if(typeof e.protocol=="string")return e.protocol==="https:"}let{stack:t}=new Error;return typeof t!="string"?!1:t.split(`
`).some(n=>n.indexOf("(https.js:")!==-1||n.indexOf("node:https:")!==-1)}incrementSockets(e){if(this.maxSockets===1/0&&this.maxTotalSockets===1/0)return null;this.sockets[e]||(this.sockets[e]=[]);let t=new _0.Socket({writable:!1});return this.sockets[e].push(t),this.totalSocketCount++,t}decrementSockets(e,t){if(!this.sockets[e]||t===null)return;let n=this.sockets[e],s=n.indexOf(t);s!==-1&&(n.splice(s,1),this.totalSocketCount--,n.length===0&&delete this.sockets[e])}getName(e){return this.isSecureEndpoint(e)?C0.Agent.prototype.getName.call(this,e):super.getName(e)}createSocket(e,t,n){let s={...t,secureEndpoint:this.isSecureEndpoint(t)},a=this.getName(s),c=this.incrementSockets(a);Promise.resolve().then(()=>this.connect(e,s)).then(f=>{if(this.decrementSockets(a,c),f instanceof rd.Agent)try{return f.addRequest(e,s)}catch(l){return n(l)}this[Gt].currentSocket=f,super.createSocket(e,t,n)},f=>{this.decrementSockets(a,c),n(f)})}createConnection(){let e=this[Gt].currentSocket;if(this[Gt].currentSocket=void 0,!e)throw new Error("No socket was returned in the `connect()` function");return e}get defaultPort(){return this[Gt].defaultPort??(this.protocol==="https:"?443:80)}set defaultPort(e){this[Gt]&&(this[Gt].defaultPort=e)}get protocol(){return this[Gt].protocol??(this.isSecureEndpoint()?"https:":"http:")}set protocol(e){this[Gt]&&(this[Gt].protocol=e)}};ut.Agent=Va});var ad=W(An=>{"use strict";var b0=An&&An.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(An,"__esModule",{value:!0});An.parseProxyResponse=void 0;var E0=b0(Ja()),Rs=(0,E0.default)("https-proxy-agent:parse-proxy-response");function A0(r){return new Promise((e,t)=>{let n=0,s=[];function a(){let h=r.read();h?d(h):r.once("readable",a)}function c(){r.removeListener("end",f),r.removeListener("error",l),r.removeListener("readable",a)}function f(){c(),Rs("onend"),t(new Error("Proxy connection ended before receiving CONNECT response"))}function l(h){c(),Rs("onerror %o",h),t(h)}function d(h){s.push(h),n+=h.length;let b=Buffer.concat(s,n),A=b.indexOf(`\r
\r
`);if(A===-1){Rs("have not received end of HTTP headers yet..."),a();return}let O=b.slice(0,A).toString("ascii").split(`\r
`),S=O.shift();if(!S)return r.destroy(),t(new Error("No header received from proxy CONNECT response"));let y=S.split(" "),C=+y[1],_=y.slice(2).join(" "),F={};for(let k of O){if(!k)continue;let U=k.indexOf(":");if(U===-1)return r.destroy(),t(new Error(`Invalid header from proxy CONNECT response: "${k}"`));let B=k.slice(0,U).toLowerCase(),j=k.slice(U+1).trimStart(),H=F[B];typeof H=="string"?F[B]=[H,j]:Array.isArray(H)?H.push(j):F[B]=j}Rs("got proxy server response: %o %o",S,F),c(),e({connect:{statusCode:C,statusText:_,headers:F},buffered:b})}r.on("error",l),r.on("end",f),a()})}An.parseProxyResponse=A0});var hd=W(wt=>{"use strict";var w0=wt&&wt.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t);var s=Object.getOwnPropertyDescriptor(e,t);(!s||("get"in s?!e.__esModule:s.writable||s.configurable))&&(s={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(r,n,s)}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),D0=wt&&wt.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),fd=wt&&wt.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&w0(e,r,t);return D0(e,r),e},dd=wt&&wt.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(wt,"__esModule",{value:!0});wt.HttpsProxyAgent=void 0;var Fs=fd(require("net")),ud=fd(require("tls")),S0=dd(require("assert")),v0=dd(Ja()),T0=sd(),R0=require("url"),F0=ad(),no=(0,v0.default)("https-proxy-agent"),cd=r=>r.servername===void 0&&r.host&&!Fs.isIP(r.host)?{...r,servername:r.host}:r,ks=class extends T0.Agent{constructor(e,t){super(t),this.options={path:void 0},this.proxy=typeof e=="string"?new R0.URL(e):e,this.proxyHeaders=t?.headers??{},no("Creating new HttpsProxyAgent instance: %o",this.proxy.href);let n=(this.proxy.hostname||this.proxy.host).replace(/^\[|\]$/g,""),s=this.proxy.port?parseInt(this.proxy.port,10):this.proxy.protocol==="https:"?443:80;this.connectOpts={ALPNProtocols:["http/1.1"],...t?ld(t,"headers"):null,host:n,port:s}}async connect(e,t){let{proxy:n}=this;if(!t.host)throw new TypeError('No "host" provided');let s;n.protocol==="https:"?(no("Creating `tls.Socket`: %o",this.connectOpts),s=ud.connect(cd(this.connectOpts))):(no("Creating `net.Socket`: %o",this.connectOpts),s=Fs.connect(this.connectOpts));let a=typeof this.proxyHeaders=="function"?this.proxyHeaders():{...this.proxyHeaders},c=Fs.isIPv6(t.host)?`[${t.host}]`:t.host,f=`CONNECT ${c}:${t.port} HTTP/1.1\r
`;if(n.username||n.password){let A=`${decodeURIComponent(n.username)}:${decodeURIComponent(n.password)}`;a["Proxy-Authorization"]=`Basic ${Buffer.from(A).toString("base64")}`}a.Host=`${c}:${t.port}`,a["Proxy-Connection"]||(a["Proxy-Connection"]=this.keepAlive?"Keep-Alive":"close");for(let A of Object.keys(a))f+=`${A}: ${a[A]}\r
`;let l=(0,F0.parseProxyResponse)(s);s.write(`${f}\r
`);let{connect:d,buffered:h}=await l;if(e.emit("proxyConnect",d),this.emit("proxyConnect",d,e),d.statusCode===200)return e.once("socket",k0),t.secureEndpoint?(no("Upgrading socket connection to TLS"),ud.connect({...ld(cd(t),"host","path","port"),socket:s})):s;s.destroy();let b=new Fs.Socket({writable:!1});return b.readable=!0,e.once("socket",A=>{no("Replaying proxy buffer for failed request"),(0,S0.default)(A.listenerCount("data")>0),A.push(h),A.push(null)}),b}};ks.protocols=["http","https"];wt.HttpsProxyAgent=ks;function k0(r){r.resume()}function ld(r,...e){let t={},n;for(n in r)e.includes(n)||(t[n]=r[n]);return t}});function O0(r){if(!/^data:/i.test(r))throw new TypeError('`uri` does not appear to be a Data URI (must begin with "data:")');r=r.replace(/\r?\n/g,"");let e=r.indexOf(",");if(e===-1||e<=4)throw new TypeError("malformed data: URI");let t=r.substring(5,e).split(";"),n="",s=!1,a=t[0]||"text/plain",c=a;for(let h=1;h<t.length;h++)t[h]==="base64"?s=!0:t[h]&&(c+=`;${t[h]}`,t[h].indexOf("charset=")===0&&(n=t[h].substring(8)));!t[0]&&!n.length&&(c+=";charset=US-ASCII",n="US-ASCII");let f=s?"base64":"ascii",l=unescape(r.substring(e+1)),d=Buffer.from(l,f);return d.type=a,d.typeFull=c,d.charset=n,d}var pd,md=Ne(()=>{pd=O0});var yd=W((Os,gd)=>{(function(r,e){typeof Os=="object"&&typeof gd<"u"?e(Os):typeof define=="function"&&define.amd?define(["exports"],e):(r=typeof globalThis<"u"?globalThis:r||self,e(r.WebStreamsPolyfill={}))})(Os,function(r){"use strict";function e(){}function t(o){return typeof o=="object"&&o!==null||typeof o=="function"}let n=e;function s(o,i){try{Object.defineProperty(o,"name",{value:i,configurable:!0})}catch{}}let a=Promise,c=Promise.prototype.then,f=Promise.reject.bind(a);function l(o){return new a(o)}function d(o){return l(i=>i(o))}function h(o){return f(o)}function b(o,i,u){return c.call(o,i,u)}function A(o,i,u){b(b(o,i,u),void 0,n)}function O(o,i){A(o,i)}function S(o,i){A(o,void 0,i)}function y(o,i,u){return b(o,i,u)}function C(o){b(o,void 0,n)}let _=o=>{if(typeof queueMicrotask=="function")_=queueMicrotask;else{let i=d(void 0);_=u=>b(i,u)}return _(o)};function F(o,i,u){if(typeof o!="function")throw new TypeError("Argument is not a function");return Function.prototype.apply.call(o,i,u)}function k(o,i,u){try{return d(F(o,i,u))}catch(m){return h(m)}}let U=16384;class B{constructor(){this._cursor=0,this._size=0,this._front={_elements:[],_next:void 0},this._back=this._front,this._cursor=0,this._size=0}get length(){return this._size}push(i){let u=this._back,m=u;u._elements.length===U-1&&(m={_elements:[],_next:void 0}),u._elements.push(i),m!==u&&(this._back=m,u._next=m),++this._size}shift(){let i=this._front,u=i,m=this._cursor,w=m+1,N=i._elements,L=N[m];return w===U&&(u=i._next,w=0),--this._size,this._cursor=w,i!==u&&(this._front=u),N[m]=void 0,L}forEach(i){let u=this._cursor,m=this._front,w=m._elements;for(;(u!==w.length||m._next!==void 0)&&!(u===w.length&&(m=m._next,w=m._elements,u=0,w.length===0));)i(w[u]),++u}peek(){let i=this._front,u=this._cursor;return i._elements[u]}}let j=Symbol("[[AbortSteps]]"),H=Symbol("[[ErrorSteps]]"),Z=Symbol("[[CancelSteps]]"),z=Symbol("[[PullSteps]]"),_e=Symbol("[[ReleaseSteps]]");function de(o,i){o._ownerReadableStream=i,i._reader=o,i._state==="readable"?ie(o):i._state==="closed"?De(o):le(o,i._storedError)}function re(o,i){let u=o._ownerReadableStream;return kt(u,i)}function se(o){let i=o._ownerReadableStream;i._state==="readable"?Se(o,new TypeError("Reader was released and can no longer be used to monitor the stream's closedness")):Fe(o,new TypeError("Reader was released and can no longer be used to monitor the stream's closedness")),i._readableStreamController[_e](),i._reader=void 0,o._ownerReadableStream=void 0}function Q(o){return new TypeError("Cannot "+o+" a stream using a released reader")}function ie(o){o._closedPromise=l((i,u)=>{o._closedPromise_resolve=i,o._closedPromise_reject=u})}function le(o,i){ie(o),Se(o,i)}function De(o){ie(o),Ct(o)}function Se(o,i){o._closedPromise_reject!==void 0&&(C(o._closedPromise),o._closedPromise_reject(i),o._closedPromise_resolve=void 0,o._closedPromise_reject=void 0)}function Fe(o,i){le(o,i)}function Ct(o){o._closedPromise_resolve!==void 0&&(o._closedPromise_resolve(void 0),o._closedPromise_resolve=void 0,o._closedPromise_reject=void 0)}let He=Number.isFinite||function(o){return typeof o=="number"&&isFinite(o)},er=Math.trunc||function(o){return o<0?Math.ceil(o):Math.floor(o)};function G(o){return typeof o=="object"||typeof o=="function"}function et(o,i){if(o!==void 0&&!G(o))throw new TypeError(`${i} is not an object.`)}function Ve(o,i){if(typeof o!="function")throw new TypeError(`${i} is not a function.`)}function Wn(o){return typeof o=="object"&&o!==null||typeof o=="function"}function Ke(o,i){if(!Wn(o))throw new TypeError(`${i} is not an object.`)}function Pe(o,i,u){if(o===void 0)throw new TypeError(`Parameter ${i} is required in '${u}'.`)}function p(o,i,u){if(o===void 0)throw new TypeError(`${i} is required in '${u}'.`)}function g(o){return Number(o)}function E(o){return o===0?0:o}function x(o){return E(er(o))}function v(o,i){let m=Number.MAX_SAFE_INTEGER,w=Number(o);if(w=E(w),!He(w))throw new TypeError(`${i} is not a finite number`);if(w=x(w),w<0||w>m)throw new TypeError(`${i} is outside the accepted range of 0 to ${m}, inclusive`);return!He(w)||w===0?0:w}function R(o,i){if(!Ar(o))throw new TypeError(`${i} is not a ReadableStream.`)}function q(o){return new M(o)}function D(o,i){o._reader._readRequests.push(i)}function T(o,i,u){let w=o._reader._readRequests.shift();u?w._closeSteps():w._chunkSteps(i)}function I(o){return o._reader._readRequests.length}function P(o){let i=o._reader;return!(i===void 0||!V(i))}class M{constructor(i){if(Pe(i,1,"ReadableStreamDefaultReader"),R(i,"First parameter"),wr(i))throw new TypeError("This stream has already been locked for exclusive reading by another reader");de(this,i),this._readRequests=new B}get closed(){return V(this)?this._closedPromise:h(ke("closed"))}cancel(i=void 0){return V(this)?this._ownerReadableStream===void 0?h(Q("cancel")):re(this,i):h(ke("cancel"))}read(){if(!V(this))return h(ke("read"));if(this._ownerReadableStream===void 0)return h(Q("read from"));let i,u,m=l((N,L)=>{i=N,u=L});return K(this,{_chunkSteps:N=>i({value:N,done:!1}),_closeSteps:()=>i({value:void 0,done:!0}),_errorSteps:N=>u(N)}),m}releaseLock(){if(!V(this))throw ke("releaseLock");this._ownerReadableStream!==void 0&&ge(this)}}Object.defineProperties(M.prototype,{cancel:{enumerable:!0},read:{enumerable:!0},releaseLock:{enumerable:!0},closed:{enumerable:!0}}),s(M.prototype.cancel,"cancel"),s(M.prototype.read,"read"),s(M.prototype.releaseLock,"releaseLock"),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(M.prototype,Symbol.toStringTag,{value:"ReadableStreamDefaultReader",configurable:!0});function V(o){return!t(o)||!Object.prototype.hasOwnProperty.call(o,"_readRequests")?!1:o instanceof M}function K(o,i){let u=o._ownerReadableStream;u._disturbed=!0,u._state==="closed"?i._closeSteps():u._state==="errored"?i._errorSteps(u._storedError):u._readableStreamController[z](i)}function ge(o){se(o);let i=new TypeError("Reader was released");ve(o,i)}function ve(o,i){let u=o._readRequests;o._readRequests=new B,u.forEach(m=>{m._errorSteps(i)})}function ke(o){return new TypeError(`ReadableStreamDefaultReader.prototype.${o} can only be used on a ReadableStreamDefaultReader`)}let me=Object.getPrototypeOf(Object.getPrototypeOf(async function*(){}).prototype);class ye{constructor(i,u){this._ongoingPromise=void 0,this._isFinished=!1,this._reader=i,this._preventCancel=u}next(){let i=()=>this._nextSteps();return this._ongoingPromise=this._ongoingPromise?y(this._ongoingPromise,i,i):i(),this._ongoingPromise}return(i){let u=()=>this._returnSteps(i);return this._ongoingPromise?y(this._ongoingPromise,u,u):u()}_nextSteps(){if(this._isFinished)return Promise.resolve({value:void 0,done:!0});let i=this._reader,u,m,w=l((L,J)=>{u=L,m=J});return K(i,{_chunkSteps:L=>{this._ongoingPromise=void 0,_(()=>u({value:L,done:!1}))},_closeSteps:()=>{this._ongoingPromise=void 0,this._isFinished=!0,se(i),u({value:void 0,done:!0})},_errorSteps:L=>{this._ongoingPromise=void 0,this._isFinished=!0,se(i),m(L)}}),w}_returnSteps(i){if(this._isFinished)return Promise.resolve({value:i,done:!0});this._isFinished=!0;let u=this._reader;if(!this._preventCancel){let m=re(u,i);return se(u),y(m,()=>({value:i,done:!0}))}return se(u),d({value:i,done:!0})}}let xe={next(){return on(this)?this._asyncIteratorImpl.next():h(sn("next"))},return(o){return on(this)?this._asyncIteratorImpl.return(o):h(sn("return"))}};Object.setPrototypeOf(xe,me);function nn(o,i){let u=q(o),m=new ye(u,i),w=Object.create(xe);return w._asyncIteratorImpl=m,w}function on(o){if(!t(o)||!Object.prototype.hasOwnProperty.call(o,"_asyncIteratorImpl"))return!1;try{return o._asyncIteratorImpl instanceof ye}catch{return!1}}function sn(o){return new TypeError(`ReadableStreamAsyncIterator.${o} can only be used on a ReadableSteamAsyncIterator`)}let it=Number.isNaN||function(o){return o!==o};var tr,Ge,Be;function Ce(o){return o.slice()}function nl(o,i,u,m,w){new Uint8Array(o).set(new Uint8Array(u,m,w),i)}let rr=o=>(typeof o.transfer=="function"?rr=i=>i.transfer():typeof structuredClone=="function"?rr=i=>structuredClone(i,{transfer:[i]}):rr=i=>i,rr(o)),_r=o=>(typeof o.detached=="boolean"?_r=i=>i.detached:_r=i=>i.byteLength===0,_r(o));function ol(o,i,u){if(o.slice)return o.slice(i,u);let m=u-i,w=new ArrayBuffer(m);return nl(w,0,o,i,m),w}function Bo(o,i){let u=o[i];if(u!=null){if(typeof u!="function")throw new TypeError(`${String(i)} is not a function`);return u}}function qm(o){let i={[Symbol.iterator]:()=>o.iterator},u=async function*(){return yield*i}(),m=u.next;return{iterator:u,nextMethod:m,done:!1}}let Yi=(Be=(tr=Symbol.asyncIterator)!==null&&tr!==void 0?tr:(Ge=Symbol.for)===null||Ge===void 0?void 0:Ge.call(Symbol,"Symbol.asyncIterator"))!==null&&Be!==void 0?Be:"@@asyncIterator";function sl(o,i="sync",u){if(u===void 0)if(i==="async"){if(u=Bo(o,Yi),u===void 0){let N=Bo(o,Symbol.iterator),L=sl(o,"sync",N);return qm(L)}}else u=Bo(o,Symbol.iterator);if(u===void 0)throw new TypeError("The object is not iterable");let m=F(u,o,[]);if(!t(m))throw new TypeError("The iterator method must return an object");let w=m.next;return{iterator:m,nextMethod:w,done:!1}}function jm(o){let i=F(o.nextMethod,o.iterator,[]);if(!t(i))throw new TypeError("The iterator.next() method must return an object");return i}function Lm(o){return!!o.done}function Um(o){return o.value}function Mm(o){return!(typeof o!="number"||it(o)||o<0)}function il(o){let i=ol(o.buffer,o.byteOffset,o.byteOffset+o.byteLength);return new Uint8Array(i)}function Xi(o){let i=o._queue.shift();return o._queueTotalSize-=i.size,o._queueTotalSize<0&&(o._queueTotalSize=0),i.value}function Qi(o,i,u){if(!Mm(u)||u===1/0)throw new RangeError("Size must be a finite, non-NaN, non-negative number.");o._queue.push({value:i,size:u}),o._queueTotalSize+=u}function $m(o){return o._queue.peek().value}function Cr(o){o._queue=new B,o._queueTotalSize=0}function al(o){return o===DataView}function Hm(o){return al(o.constructor)}function Gm(o){return al(o)?1:o.BYTES_PER_ELEMENT}class Nr{constructor(){throw new TypeError("Illegal constructor")}get view(){if(!Zi(this))throw oa("view");return this._view}respond(i){if(!Zi(this))throw oa("respond");if(Pe(i,1,"respond"),i=v(i,"First parameter"),this._associatedReadableByteStreamController===void 0)throw new TypeError("This BYOB request has been invalidated");if(_r(this._view.buffer))throw new TypeError("The BYOB request's buffer has been detached and so cannot be used as a response");jo(this._associatedReadableByteStreamController,i)}respondWithNewView(i){if(!Zi(this))throw oa("respondWithNewView");if(Pe(i,1,"respondWithNewView"),!ArrayBuffer.isView(i))throw new TypeError("You can only respond with array buffer views");if(this._associatedReadableByteStreamController===void 0)throw new TypeError("This BYOB request has been invalidated");if(_r(i.buffer))throw new TypeError("The given view's buffer has been detached and so cannot be used as a response");Lo(this._associatedReadableByteStreamController,i)}}Object.defineProperties(Nr.prototype,{respond:{enumerable:!0},respondWithNewView:{enumerable:!0},view:{enumerable:!0}}),s(Nr.prototype.respond,"respond"),s(Nr.prototype.respondWithNewView,"respondWithNewView"),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(Nr.prototype,Symbol.toStringTag,{value:"ReadableStreamBYOBRequest",configurable:!0});class nr{constructor(){throw new TypeError("Illegal constructor")}get byobRequest(){if(!qr(this))throw Jn("byobRequest");return na(this)}get desiredSize(){if(!qr(this))throw Jn("desiredSize");return yl(this)}close(){if(!qr(this))throw Jn("close");if(this._closeRequested)throw new TypeError("The stream has already been closed; do not close it again!");let i=this._controlledReadableByteStream._state;if(i!=="readable")throw new TypeError(`The stream (in ${i} state) is not in the readable state and cannot be closed`);zn(this)}enqueue(i){if(!qr(this))throw Jn("enqueue");if(Pe(i,1,"enqueue"),!ArrayBuffer.isView(i))throw new TypeError("chunk must be an array buffer view");if(i.byteLength===0)throw new TypeError("chunk must have non-zero byteLength");if(i.buffer.byteLength===0)throw new TypeError("chunk's buffer must have non-zero byteLength");if(this._closeRequested)throw new TypeError("stream is closed or draining");let u=this._controlledReadableByteStream._state;if(u!=="readable")throw new TypeError(`The stream (in ${u} state) is not in the readable state and cannot be enqueued to`);qo(this,i)}error(i=void 0){if(!qr(this))throw Jn("error");bt(this,i)}[Z](i){ul(this),Cr(this);let u=this._cancelAlgorithm(i);return No(this),u}[z](i){let u=this._controlledReadableByteStream;if(this._queueTotalSize>0){gl(this,i);return}let m=this._autoAllocateChunkSize;if(m!==void 0){let w;try{w=new ArrayBuffer(m)}catch(L){i._errorSteps(L);return}let N={buffer:w,bufferByteLength:m,byteOffset:0,byteLength:m,bytesFilled:0,minimumFill:1,elementSize:1,viewConstructor:Uint8Array,readerType:"default"};this._pendingPullIntos.push(N)}D(u,i),jr(this)}[_e](){if(this._pendingPullIntos.length>0){let i=this._pendingPullIntos.peek();i.readerType="none",this._pendingPullIntos=new B,this._pendingPullIntos.push(i)}}}Object.defineProperties(nr.prototype,{close:{enumerable:!0},enqueue:{enumerable:!0},error:{enumerable:!0},byobRequest:{enumerable:!0},desiredSize:{enumerable:!0}}),s(nr.prototype.close,"close"),s(nr.prototype.enqueue,"enqueue"),s(nr.prototype.error,"error"),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(nr.prototype,Symbol.toStringTag,{value:"ReadableByteStreamController",configurable:!0});function qr(o){return!t(o)||!Object.prototype.hasOwnProperty.call(o,"_controlledReadableByteStream")?!1:o instanceof nr}function Zi(o){return!t(o)||!Object.prototype.hasOwnProperty.call(o,"_associatedReadableByteStreamController")?!1:o instanceof Nr}function jr(o){if(!Km(o))return;if(o._pulling){o._pullAgain=!0;return}o._pulling=!0;let u=o._pullAlgorithm();A(u,()=>(o._pulling=!1,o._pullAgain&&(o._pullAgain=!1,jr(o)),null),m=>(bt(o,m),null))}function ul(o){ta(o),o._pendingPullIntos=new B}function ea(o,i){let u=!1;o._state==="closed"&&(u=!0);let m=cl(i);i.readerType==="default"?T(o,m,u):tg(o,m,u)}function cl(o){let i=o.bytesFilled,u=o.elementSize;return new o.viewConstructor(o.buffer,o.byteOffset,i/u)}function Io(o,i,u,m){o._queue.push({buffer:i,byteOffset:u,byteLength:m}),o._queueTotalSize+=m}function ll(o,i,u,m){let w;try{w=ol(i,u,u+m)}catch(N){throw bt(o,N),N}Io(o,w,0,m)}function fl(o,i){i.bytesFilled>0&&ll(o,i.buffer,i.byteOffset,i.bytesFilled),an(o)}function dl(o,i){let u=Math.min(o._queueTotalSize,i.byteLength-i.bytesFilled),m=i.bytesFilled+u,w=u,N=!1,L=m%i.elementSize,J=m-L;J>=i.minimumFill&&(w=J-i.bytesFilled,N=!0);let ne=o._queue;for(;w>0;){let X=ne.peek(),ae=Math.min(w,X.byteLength),fe=i.byteOffset+i.bytesFilled;nl(i.buffer,fe,X.buffer,X.byteOffset,ae),X.byteLength===ae?ne.shift():(X.byteOffset+=ae,X.byteLength-=ae),o._queueTotalSize-=ae,hl(o,ae,i),w-=ae}return N}function hl(o,i,u){u.bytesFilled+=i}function pl(o){o._queueTotalSize===0&&o._closeRequested?(No(o),Zn(o._controlledReadableByteStream)):jr(o)}function ta(o){o._byobRequest!==null&&(o._byobRequest._associatedReadableByteStreamController=void 0,o._byobRequest._view=null,o._byobRequest=null)}function ra(o){for(;o._pendingPullIntos.length>0;){if(o._queueTotalSize===0)return;let i=o._pendingPullIntos.peek();dl(o,i)&&(an(o),ea(o._controlledReadableByteStream,i))}}function Wm(o){let i=o._controlledReadableByteStream._reader;for(;i._readRequests.length>0;){if(o._queueTotalSize===0)return;let u=i._readRequests.shift();gl(o,u)}}function zm(o,i,u,m){let w=o._controlledReadableByteStream,N=i.constructor,L=Gm(N),{byteOffset:J,byteLength:ne}=i,X=u*L,ae;try{ae=rr(i.buffer)}catch(Ee){m._errorSteps(Ee);return}let fe={buffer:ae,bufferByteLength:ae.byteLength,byteOffset:J,byteLength:ne,bytesFilled:0,minimumFill:X,elementSize:L,viewConstructor:N,readerType:"byob"};if(o._pendingPullIntos.length>0){o._pendingPullIntos.push(fe),bl(w,m);return}if(w._state==="closed"){let Ee=new N(fe.buffer,fe.byteOffset,0);m._closeSteps(Ee);return}if(o._queueTotalSize>0){if(dl(o,fe)){let Ee=cl(fe);pl(o),m._chunkSteps(Ee);return}if(o._closeRequested){let Ee=new TypeError("Insufficient bytes to fill elements in the given buffer");bt(o,Ee),m._errorSteps(Ee);return}}o._pendingPullIntos.push(fe),bl(w,m),jr(o)}function Jm(o,i){i.readerType==="none"&&an(o);let u=o._controlledReadableByteStream;if(sa(u))for(;El(u)>0;){let m=an(o);ea(u,m)}}function Vm(o,i,u){if(hl(o,i,u),u.readerType==="none"){fl(o,u),ra(o);return}if(u.bytesFilled<u.minimumFill)return;an(o);let m=u.bytesFilled%u.elementSize;if(m>0){let w=u.byteOffset+u.bytesFilled;ll(o,u.buffer,w-m,m)}u.bytesFilled-=m,ea(o._controlledReadableByteStream,u),ra(o)}function ml(o,i){let u=o._pendingPullIntos.peek();ta(o),o._controlledReadableByteStream._state==="closed"?Jm(o,u):Vm(o,i,u),jr(o)}function an(o){return o._pendingPullIntos.shift()}function Km(o){let i=o._controlledReadableByteStream;return i._state!=="readable"||o._closeRequested||!o._started?!1:!!(P(i)&&I(i)>0||sa(i)&&El(i)>0||yl(o)>0)}function No(o){o._pullAlgorithm=void 0,o._cancelAlgorithm=void 0}function zn(o){let i=o._controlledReadableByteStream;if(!(o._closeRequested||i._state!=="readable")){if(o._queueTotalSize>0){o._closeRequested=!0;return}if(o._pendingPullIntos.length>0){let u=o._pendingPullIntos.peek();if(u.bytesFilled%u.elementSize!==0){let m=new TypeError("Insufficient bytes to fill elements in the given buffer");throw bt(o,m),m}}No(o),Zn(i)}}function qo(o,i){let u=o._controlledReadableByteStream;if(o._closeRequested||u._state!=="readable")return;let{buffer:m,byteOffset:w,byteLength:N}=i;if(_r(m))throw new TypeError("chunk's buffer is detached and so cannot be enqueued");let L=rr(m);if(o._pendingPullIntos.length>0){let J=o._pendingPullIntos.peek();if(_r(J.buffer))throw new TypeError("The BYOB request's buffer has been detached and so cannot be filled with an enqueued chunk");ta(o),J.buffer=rr(J.buffer),J.readerType==="none"&&fl(o,J)}if(P(u))if(Wm(o),I(u)===0)Io(o,L,w,N);else{o._pendingPullIntos.length>0&&an(o);let J=new Uint8Array(L,w,N);T(u,J,!1)}else sa(u)?(Io(o,L,w,N),ra(o)):Io(o,L,w,N);jr(o)}function bt(o,i){let u=o._controlledReadableByteStream;u._state==="readable"&&(ul(o),Cr(o),No(o),Wl(u,i))}function gl(o,i){let u=o._queue.shift();o._queueTotalSize-=u.byteLength,pl(o);let m=new Uint8Array(u.buffer,u.byteOffset,u.byteLength);i._chunkSteps(m)}function na(o){if(o._byobRequest===null&&o._pendingPullIntos.length>0){let i=o._pendingPullIntos.peek(),u=new Uint8Array(i.buffer,i.byteOffset+i.bytesFilled,i.byteLength-i.bytesFilled),m=Object.create(Nr.prototype);Xm(m,o,u),o._byobRequest=m}return o._byobRequest}function yl(o){let i=o._controlledReadableByteStream._state;return i==="errored"?null:i==="closed"?0:o._strategyHWM-o._queueTotalSize}function jo(o,i){let u=o._pendingPullIntos.peek();if(o._controlledReadableByteStream._state==="closed"){if(i!==0)throw new TypeError("bytesWritten must be 0 when calling respond() on a closed stream")}else{if(i===0)throw new TypeError("bytesWritten must be greater than 0 when calling respond() on a readable stream");if(u.bytesFilled+i>u.byteLength)throw new RangeError("bytesWritten out of range")}u.buffer=rr(u.buffer),ml(o,i)}function Lo(o,i){let u=o._pendingPullIntos.peek();if(o._controlledReadableByteStream._state==="closed"){if(i.byteLength!==0)throw new TypeError("The view's length must be 0 when calling respondWithNewView() on a closed stream")}else if(i.byteLength===0)throw new TypeError("The view's length must be greater than 0 when calling respondWithNewView() on a readable stream");if(u.byteOffset+u.bytesFilled!==i.byteOffset)throw new RangeError("The region specified by view does not match byobRequest");if(u.bufferByteLength!==i.buffer.byteLength)throw new RangeError("The buffer of view has different capacity than byobRequest");if(u.bytesFilled+i.byteLength>u.byteLength)throw new RangeError("The region specified by view is larger than byobRequest");let w=i.byteLength;u.buffer=rr(i.buffer),ml(o,w)}function _l(o,i,u,m,w,N,L){i._controlledReadableByteStream=o,i._pullAgain=!1,i._pulling=!1,i._byobRequest=null,i._queue=i._queueTotalSize=void 0,Cr(i),i._closeRequested=!1,i._started=!1,i._strategyHWM=N,i._pullAlgorithm=m,i._cancelAlgorithm=w,i._autoAllocateChunkSize=L,i._pendingPullIntos=new B,o._readableStreamController=i;let J=u();A(d(J),()=>(i._started=!0,jr(i),null),ne=>(bt(i,ne),null))}function Ym(o,i,u){let m=Object.create(nr.prototype),w,N,L;i.start!==void 0?w=()=>i.start(m):w=()=>{},i.pull!==void 0?N=()=>i.pull(m):N=()=>d(void 0),i.cancel!==void 0?L=ne=>i.cancel(ne):L=()=>d(void 0);let J=i.autoAllocateChunkSize;if(J===0)throw new TypeError("autoAllocateChunkSize must be greater than 0");_l(o,m,w,N,L,u,J)}function Xm(o,i,u){o._associatedReadableByteStreamController=i,o._view=u}function oa(o){return new TypeError(`ReadableStreamBYOBRequest.prototype.${o} can only be used on a ReadableStreamBYOBRequest`)}function Jn(o){return new TypeError(`ReadableByteStreamController.prototype.${o} can only be used on a ReadableByteStreamController`)}function Qm(o,i){et(o,i);let u=o?.mode;return{mode:u===void 0?void 0:Zm(u,`${i} has member 'mode' that`)}}function Zm(o,i){if(o=`${o}`,o!=="byob")throw new TypeError(`${i} '${o}' is not a valid enumeration value for ReadableStreamReaderMode`);return o}function eg(o,i){var u;et(o,i);let m=(u=o?.min)!==null&&u!==void 0?u:1;return{min:v(m,`${i} has member 'min' that`)}}function Cl(o){return new br(o)}function bl(o,i){o._reader._readIntoRequests.push(i)}function tg(o,i,u){let w=o._reader._readIntoRequests.shift();u?w._closeSteps(i):w._chunkSteps(i)}function El(o){return o._reader._readIntoRequests.length}function sa(o){let i=o._reader;return!(i===void 0||!Lr(i))}class br{constructor(i){if(Pe(i,1,"ReadableStreamBYOBReader"),R(i,"First parameter"),wr(i))throw new TypeError("This stream has already been locked for exclusive reading by another reader");if(!qr(i._readableStreamController))throw new TypeError("Cannot construct a ReadableStreamBYOBReader for a stream not constructed with a byte source");de(this,i),this._readIntoRequests=new B}get closed(){return Lr(this)?this._closedPromise:h(Uo("closed"))}cancel(i=void 0){return Lr(this)?this._ownerReadableStream===void 0?h(Q("cancel")):re(this,i):h(Uo("cancel"))}read(i,u={}){if(!Lr(this))return h(Uo("read"));if(!ArrayBuffer.isView(i))return h(new TypeError("view must be an array buffer view"));if(i.byteLength===0)return h(new TypeError("view must have non-zero byteLength"));if(i.buffer.byteLength===0)return h(new TypeError("view's buffer must have non-zero byteLength"));if(_r(i.buffer))return h(new TypeError("view's buffer has been detached"));let m;try{m=eg(u,"options")}catch(X){return h(X)}let w=m.min;if(w===0)return h(new TypeError("options.min must be greater than 0"));if(Hm(i)){if(w>i.byteLength)return h(new RangeError("options.min must be less than or equal to view's byteLength"))}else if(w>i.length)return h(new RangeError("options.min must be less than or equal to view's length"));if(this._ownerReadableStream===void 0)return h(Q("read from"));let N,L,J=l((X,ae)=>{N=X,L=ae});return Al(this,i,w,{_chunkSteps:X=>N({value:X,done:!1}),_closeSteps:X=>N({value:X,done:!0}),_errorSteps:X=>L(X)}),J}releaseLock(){if(!Lr(this))throw Uo("releaseLock");this._ownerReadableStream!==void 0&&rg(this)}}Object.defineProperties(br.prototype,{cancel:{enumerable:!0},read:{enumerable:!0},releaseLock:{enumerable:!0},closed:{enumerable:!0}}),s(br.prototype.cancel,"cancel"),s(br.prototype.read,"read"),s(br.prototype.releaseLock,"releaseLock"),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(br.prototype,Symbol.toStringTag,{value:"ReadableStreamBYOBReader",configurable:!0});function Lr(o){return!t(o)||!Object.prototype.hasOwnProperty.call(o,"_readIntoRequests")?!1:o instanceof br}function Al(o,i,u,m){let w=o._ownerReadableStream;w._disturbed=!0,w._state==="errored"?m._errorSteps(w._storedError):zm(w._readableStreamController,i,u,m)}function rg(o){se(o);let i=new TypeError("Reader was released");wl(o,i)}function wl(o,i){let u=o._readIntoRequests;o._readIntoRequests=new B,u.forEach(m=>{m._errorSteps(i)})}function Uo(o){return new TypeError(`ReadableStreamBYOBReader.prototype.${o} can only be used on a ReadableStreamBYOBReader`)}function Vn(o,i){let{highWaterMark:u}=o;if(u===void 0)return i;if(it(u)||u<0)throw new RangeError("Invalid highWaterMark");return u}function Mo(o){let{size:i}=o;return i||(()=>1)}function $o(o,i){et(o,i);let u=o?.highWaterMark,m=o?.size;return{highWaterMark:u===void 0?void 0:g(u),size:m===void 0?void 0:ng(m,`${i} has member 'size' that`)}}function ng(o,i){return Ve(o,i),u=>g(o(u))}function og(o,i){et(o,i);let u=o?.abort,m=o?.close,w=o?.start,N=o?.type,L=o?.write;return{abort:u===void 0?void 0:sg(u,o,`${i} has member 'abort' that`),close:m===void 0?void 0:ig(m,o,`${i} has member 'close' that`),start:w===void 0?void 0:ag(w,o,`${i} has member 'start' that`),write:L===void 0?void 0:ug(L,o,`${i} has member 'write' that`),type:N}}function sg(o,i,u){return Ve(o,u),m=>k(o,i,[m])}function ig(o,i,u){return Ve(o,u),()=>k(o,i,[])}function ag(o,i,u){return Ve(o,u),m=>F(o,i,[m])}function ug(o,i,u){return Ve(o,u),(m,w)=>k(o,i,[m,w])}function Dl(o,i){if(!un(o))throw new TypeError(`${i} is not a WritableStream.`)}function cg(o){if(typeof o!="object"||o===null)return!1;try{return typeof o.aborted=="boolean"}catch{return!1}}let lg=typeof AbortController=="function";function fg(){if(lg)return new AbortController}class Er{constructor(i={},u={}){i===void 0?i=null:Ke(i,"First parameter");let m=$o(u,"Second parameter"),w=og(i,"First parameter");if(vl(this),w.type!==void 0)throw new RangeError("Invalid type is specified");let L=Mo(m),J=Vn(m,1);Sg(this,w,J,L)}get locked(){if(!un(this))throw Jo("locked");return cn(this)}abort(i=void 0){return un(this)?cn(this)?h(new TypeError("Cannot abort a stream that already has a writer")):Ho(this,i):h(Jo("abort"))}close(){return un(this)?cn(this)?h(new TypeError("Cannot close a stream that already has a writer")):Ht(this)?h(new TypeError("Cannot close an already-closing stream")):Tl(this):h(Jo("close"))}getWriter(){if(!un(this))throw Jo("getWriter");return Sl(this)}}Object.defineProperties(Er.prototype,{abort:{enumerable:!0},close:{enumerable:!0},getWriter:{enumerable:!0},locked:{enumerable:!0}}),s(Er.prototype.abort,"abort"),s(Er.prototype.close,"close"),s(Er.prototype.getWriter,"getWriter"),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(Er.prototype,Symbol.toStringTag,{value:"WritableStream",configurable:!0});function Sl(o){return new or(o)}function dg(o,i,u,m,w=1,N=()=>1){let L=Object.create(Er.prototype);vl(L);let J=Object.create(ln.prototype);return xl(L,J,o,i,u,m,w,N),L}function vl(o){o._state="writable",o._storedError=void 0,o._writer=void 0,o._writableStreamController=void 0,o._writeRequests=new B,o._inFlightWriteRequest=void 0,o._closeRequest=void 0,o._inFlightCloseRequest=void 0,o._pendingAbortRequest=void 0,o._backpressure=!1}function un(o){return!t(o)||!Object.prototype.hasOwnProperty.call(o,"_writableStreamController")?!1:o instanceof Er}function cn(o){return o._writer!==void 0}function Ho(o,i){var u;if(o._state==="closed"||o._state==="errored")return d(void 0);o._writableStreamController._abortReason=i,(u=o._writableStreamController._abortController)===null||u===void 0||u.abort(i);let m=o._state;if(m==="closed"||m==="errored")return d(void 0);if(o._pendingAbortRequest!==void 0)return o._pendingAbortRequest._promise;let w=!1;m==="erroring"&&(w=!0,i=void 0);let N=l((L,J)=>{o._pendingAbortRequest={_promise:void 0,_resolve:L,_reject:J,_reason:i,_wasAlreadyErroring:w}});return o._pendingAbortRequest._promise=N,w||aa(o,i),N}function Tl(o){let i=o._state;if(i==="closed"||i==="errored")return h(new TypeError(`The stream (in ${i} state) is not in the writable state and cannot be closed`));let u=l((w,N)=>{let L={_resolve:w,_reject:N};o._closeRequest=L}),m=o._writer;return m!==void 0&&o._backpressure&&i==="writable"&&ma(m),vg(o._writableStreamController),u}function hg(o){return l((u,m)=>{let w={_resolve:u,_reject:m};o._writeRequests.push(w)})}function ia(o,i){if(o._state==="writable"){aa(o,i);return}ua(o)}function aa(o,i){let u=o._writableStreamController;o._state="erroring",o._storedError=i;let m=o._writer;m!==void 0&&Fl(m,i),!_g(o)&&u._started&&ua(o)}function ua(o){o._state="errored",o._writableStreamController[H]();let i=o._storedError;if(o._writeRequests.forEach(w=>{w._reject(i)}),o._writeRequests=new B,o._pendingAbortRequest===void 0){Go(o);return}let u=o._pendingAbortRequest;if(o._pendingAbortRequest=void 0,u._wasAlreadyErroring){u._reject(i),Go(o);return}let m=o._writableStreamController[j](u._reason);A(m,()=>(u._resolve(),Go(o),null),w=>(u._reject(w),Go(o),null))}function pg(o){o._inFlightWriteRequest._resolve(void 0),o._inFlightWriteRequest=void 0}function mg(o,i){o._inFlightWriteRequest._reject(i),o._inFlightWriteRequest=void 0,ia(o,i)}function gg(o){o._inFlightCloseRequest._resolve(void 0),o._inFlightCloseRequest=void 0,o._state==="erroring"&&(o._storedError=void 0,o._pendingAbortRequest!==void 0&&(o._pendingAbortRequest._resolve(),o._pendingAbortRequest=void 0)),o._state="closed";let u=o._writer;u!==void 0&&ql(u)}function yg(o,i){o._inFlightCloseRequest._reject(i),o._inFlightCloseRequest=void 0,o._pendingAbortRequest!==void 0&&(o._pendingAbortRequest._reject(i),o._pendingAbortRequest=void 0),ia(o,i)}function Ht(o){return!(o._closeRequest===void 0&&o._inFlightCloseRequest===void 0)}function _g(o){return!(o._inFlightWriteRequest===void 0&&o._inFlightCloseRequest===void 0)}function Cg(o){o._inFlightCloseRequest=o._closeRequest,o._closeRequest=void 0}function bg(o){o._inFlightWriteRequest=o._writeRequests.shift()}function Go(o){o._closeRequest!==void 0&&(o._closeRequest._reject(o._storedError),o._closeRequest=void 0);let i=o._writer;i!==void 0&&ha(i,o._storedError)}function ca(o,i){let u=o._writer;u!==void 0&&i!==o._backpressure&&(i?xg(u):ma(u)),o._backpressure=i}class or{constructor(i){if(Pe(i,1,"WritableStreamDefaultWriter"),Dl(i,"First parameter"),cn(i))throw new TypeError("This stream has already been locked for exclusive writing by another writer");this._ownerWritableStream=i,i._writer=this;let u=i._state;if(u==="writable")!Ht(i)&&i._backpressure?Ko(this):jl(this),Vo(this);else if(u==="erroring")pa(this,i._storedError),Vo(this);else if(u==="closed")jl(this),Og(this);else{let m=i._storedError;pa(this,m),Nl(this,m)}}get closed(){return Ur(this)?this._closedPromise:h(Mr("closed"))}get desiredSize(){if(!Ur(this))throw Mr("desiredSize");if(this._ownerWritableStream===void 0)throw Yn("desiredSize");return Dg(this)}get ready(){return Ur(this)?this._readyPromise:h(Mr("ready"))}abort(i=void 0){return Ur(this)?this._ownerWritableStream===void 0?h(Yn("abort")):Eg(this,i):h(Mr("abort"))}close(){if(!Ur(this))return h(Mr("close"));let i=this._ownerWritableStream;return i===void 0?h(Yn("close")):Ht(i)?h(new TypeError("Cannot close an already-closing stream")):Rl(this)}releaseLock(){if(!Ur(this))throw Mr("releaseLock");this._ownerWritableStream!==void 0&&kl(this)}write(i=void 0){return Ur(this)?this._ownerWritableStream===void 0?h(Yn("write to")):Ol(this,i):h(Mr("write"))}}Object.defineProperties(or.prototype,{abort:{enumerable:!0},close:{enumerable:!0},releaseLock:{enumerable:!0},write:{enumerable:!0},closed:{enumerable:!0},desiredSize:{enumerable:!0},ready:{enumerable:!0}}),s(or.prototype.abort,"abort"),s(or.prototype.close,"close"),s(or.prototype.releaseLock,"releaseLock"),s(or.prototype.write,"write"),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(or.prototype,Symbol.toStringTag,{value:"WritableStreamDefaultWriter",configurable:!0});function Ur(o){return!t(o)||!Object.prototype.hasOwnProperty.call(o,"_ownerWritableStream")?!1:o instanceof or}function Eg(o,i){let u=o._ownerWritableStream;return Ho(u,i)}function Rl(o){let i=o._ownerWritableStream;return Tl(i)}function Ag(o){let i=o._ownerWritableStream,u=i._state;return Ht(i)||u==="closed"?d(void 0):u==="errored"?h(i._storedError):Rl(o)}function wg(o,i){o._closedPromiseState==="pending"?ha(o,i):Pg(o,i)}function Fl(o,i){o._readyPromiseState==="pending"?Ll(o,i):Bg(o,i)}function Dg(o){let i=o._ownerWritableStream,u=i._state;return u==="errored"||u==="erroring"?null:u==="closed"?0:Bl(i._writableStreamController)}function kl(o){let i=o._ownerWritableStream,u=new TypeError("Writer was released and can no longer be used to monitor the stream's closedness");Fl(o,u),wg(o,u),i._writer=void 0,o._ownerWritableStream=void 0}function Ol(o,i){let u=o._ownerWritableStream,m=u._writableStreamController,w=Tg(m,i);if(u!==o._ownerWritableStream)return h(Yn("write to"));let N=u._state;if(N==="errored")return h(u._storedError);if(Ht(u)||N==="closed")return h(new TypeError("The stream is closing or closed and cannot be written to"));if(N==="erroring")return h(u._storedError);let L=hg(u);return Rg(m,i,w),L}let Pl={};class ln{constructor(){throw new TypeError("Illegal constructor")}get abortReason(){if(!la(this))throw da("abortReason");return this._abortReason}get signal(){if(!la(this))throw da("signal");if(this._abortController===void 0)throw new TypeError("WritableStreamDefaultController.prototype.signal is not supported");return this._abortController.signal}error(i=void 0){if(!la(this))throw da("error");this._controlledWritableStream._state==="writable"&&Il(this,i)}[j](i){let u=this._abortAlgorithm(i);return Wo(this),u}[H](){Cr(this)}}Object.defineProperties(ln.prototype,{abortReason:{enumerable:!0},signal:{enumerable:!0},error:{enumerable:!0}}),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(ln.prototype,Symbol.toStringTag,{value:"WritableStreamDefaultController",configurable:!0});function la(o){return!t(o)||!Object.prototype.hasOwnProperty.call(o,"_controlledWritableStream")?!1:o instanceof ln}function xl(o,i,u,m,w,N,L,J){i._controlledWritableStream=o,o._writableStreamController=i,i._queue=void 0,i._queueTotalSize=void 0,Cr(i),i._abortReason=void 0,i._abortController=fg(),i._started=!1,i._strategySizeAlgorithm=J,i._strategyHWM=L,i._writeAlgorithm=m,i._closeAlgorithm=w,i._abortAlgorithm=N;let ne=fa(i);ca(o,ne);let X=u(),ae=d(X);A(ae,()=>(i._started=!0,zo(i),null),fe=>(i._started=!0,ia(o,fe),null))}function Sg(o,i,u,m){let w=Object.create(ln.prototype),N,L,J,ne;i.start!==void 0?N=()=>i.start(w):N=()=>{},i.write!==void 0?L=X=>i.write(X,w):L=()=>d(void 0),i.close!==void 0?J=()=>i.close():J=()=>d(void 0),i.abort!==void 0?ne=X=>i.abort(X):ne=()=>d(void 0),xl(o,w,N,L,J,ne,u,m)}function Wo(o){o._writeAlgorithm=void 0,o._closeAlgorithm=void 0,o._abortAlgorithm=void 0,o._strategySizeAlgorithm=void 0}function vg(o){Qi(o,Pl,0),zo(o)}function Tg(o,i){try{return o._strategySizeAlgorithm(i)}catch(u){return Kn(o,u),1}}function Bl(o){return o._strategyHWM-o._queueTotalSize}function Rg(o,i,u){try{Qi(o,i,u)}catch(w){Kn(o,w);return}let m=o._controlledWritableStream;if(!Ht(m)&&m._state==="writable"){let w=fa(o);ca(m,w)}zo(o)}function zo(o){let i=o._controlledWritableStream;if(!o._started||i._inFlightWriteRequest!==void 0)return;if(i._state==="erroring"){ua(i);return}if(o._queue.length===0)return;let m=$m(o);m===Pl?Fg(o):kg(o,m)}function Kn(o,i){o._controlledWritableStream._state==="writable"&&Il(o,i)}function Fg(o){let i=o._controlledWritableStream;Cg(i),Xi(o);let u=o._closeAlgorithm();Wo(o),A(u,()=>(gg(i),null),m=>(yg(i,m),null))}function kg(o,i){let u=o._controlledWritableStream;bg(u);let m=o._writeAlgorithm(i);A(m,()=>{pg(u);let w=u._state;if(Xi(o),!Ht(u)&&w==="writable"){let N=fa(o);ca(u,N)}return zo(o),null},w=>(u._state==="writable"&&Wo(o),mg(u,w),null))}function fa(o){return Bl(o)<=0}function Il(o,i){let u=o._controlledWritableStream;Wo(o),aa(u,i)}function Jo(o){return new TypeError(`WritableStream.prototype.${o} can only be used on a WritableStream`)}function da(o){return new TypeError(`WritableStreamDefaultController.prototype.${o} can only be used on a WritableStreamDefaultController`)}function Mr(o){return new TypeError(`WritableStreamDefaultWriter.prototype.${o} can only be used on a WritableStreamDefaultWriter`)}function Yn(o){return new TypeError("Cannot "+o+" a stream using a released writer")}function Vo(o){o._closedPromise=l((i,u)=>{o._closedPromise_resolve=i,o._closedPromise_reject=u,o._closedPromiseState="pending"})}function Nl(o,i){Vo(o),ha(o,i)}function Og(o){Vo(o),ql(o)}function ha(o,i){o._closedPromise_reject!==void 0&&(C(o._closedPromise),o._closedPromise_reject(i),o._closedPromise_resolve=void 0,o._closedPromise_reject=void 0,o._closedPromiseState="rejected")}function Pg(o,i){Nl(o,i)}function ql(o){o._closedPromise_resolve!==void 0&&(o._closedPromise_resolve(void 0),o._closedPromise_resolve=void 0,o._closedPromise_reject=void 0,o._closedPromiseState="resolved")}function Ko(o){o._readyPromise=l((i,u)=>{o._readyPromise_resolve=i,o._readyPromise_reject=u}),o._readyPromiseState="pending"}function pa(o,i){Ko(o),Ll(o,i)}function jl(o){Ko(o),ma(o)}function Ll(o,i){o._readyPromise_reject!==void 0&&(C(o._readyPromise),o._readyPromise_reject(i),o._readyPromise_resolve=void 0,o._readyPromise_reject=void 0,o._readyPromiseState="rejected")}function xg(o){Ko(o)}function Bg(o,i){pa(o,i)}function ma(o){o._readyPromise_resolve!==void 0&&(o._readyPromise_resolve(void 0),o._readyPromise_resolve=void 0,o._readyPromise_reject=void 0,o._readyPromiseState="fulfilled")}function Ig(){if(typeof globalThis<"u")return globalThis;if(typeof self<"u")return self;if(typeof global<"u")return global}let ga=Ig();function Ng(o){if(!(typeof o=="function"||typeof o=="object")||o.name!=="DOMException")return!1;try{return new o,!0}catch{return!1}}function qg(){let o=ga?.DOMException;return Ng(o)?o:void 0}function jg(){let o=function(u,m){this.message=u||"",this.name=m||"Error",Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)};return s(o,"DOMException"),o.prototype=Object.create(Error.prototype),Object.defineProperty(o.prototype,"constructor",{value:o,writable:!0,configurable:!0}),o}let Lg=qg()||jg();function Ul(o,i,u,m,w,N){let L=q(o),J=Sl(i);o._disturbed=!0;let ne=!1,X=d(void 0);return l((ae,fe)=>{let Ee;if(N!==void 0){if(Ee=()=>{let ee=N.reason!==void 0?N.reason:new Lg("Aborted","AbortError"),he=[];m||he.push(()=>i._state==="writable"?Ho(i,ee):d(void 0)),w||he.push(()=>o._state==="readable"?kt(o,ee):d(void 0)),tt(()=>Promise.all(he.map(Ae=>Ae())),!0,ee)},N.aborted){Ee();return}N.addEventListener("abort",Ee)}function Ot(){return l((ee,he)=>{function Ae(at){at?ee():b(pn(),Ae,he)}Ae(!1)})}function pn(){return ne?d(!0):b(J._readyPromise,()=>l((ee,he)=>{K(L,{_chunkSteps:Ae=>{X=b(Ol(J,Ae),void 0,e),ee(!1)},_closeSteps:()=>ee(!0),_errorSteps:he})}))}if(ir(o,L._closedPromise,ee=>(m?Et(!0,ee):tt(()=>Ho(i,ee),!0,ee),null)),ir(i,J._closedPromise,ee=>(w?Et(!0,ee):tt(()=>kt(o,ee),!0,ee),null)),Ye(o,L._closedPromise,()=>(u?Et():tt(()=>Ag(J)),null)),Ht(i)||i._state==="closed"){let ee=new TypeError("the destination writable stream closed before all data could be piped to it");w?Et(!0,ee):tt(()=>kt(o,ee),!0,ee)}C(Ot());function Sr(){let ee=X;return b(X,()=>ee!==X?Sr():void 0)}function ir(ee,he,Ae){ee._state==="errored"?Ae(ee._storedError):S(he,Ae)}function Ye(ee,he,Ae){ee._state==="closed"?Ae():O(he,Ae)}function tt(ee,he,Ae){if(ne)return;ne=!0,i._state==="writable"&&!Ht(i)?O(Sr(),at):at();function at(){return A(ee(),()=>ar(he,Ae),mn=>ar(!0,mn)),null}}function Et(ee,he){ne||(ne=!0,i._state==="writable"&&!Ht(i)?O(Sr(),()=>ar(ee,he)):ar(ee,he))}function ar(ee,he){return kl(J),se(L),N!==void 0&&N.removeEventListener("abort",Ee),ee?fe(he):ae(void 0),null}})}class sr{constructor(){throw new TypeError("Illegal constructor")}get desiredSize(){if(!Yo(this))throw Qo("desiredSize");return ya(this)}close(){if(!Yo(this))throw Qo("close");if(!dn(this))throw new TypeError("The stream is not in a state that permits close");$r(this)}enqueue(i=void 0){if(!Yo(this))throw Qo("enqueue");if(!dn(this))throw new TypeError("The stream is not in a state that permits enqueue");return fn(this,i)}error(i=void 0){if(!Yo(this))throw Qo("error");Ft(this,i)}[Z](i){Cr(this);let u=this._cancelAlgorithm(i);return Xo(this),u}[z](i){let u=this._controlledReadableStream;if(this._queue.length>0){let m=Xi(this);this._closeRequested&&this._queue.length===0?(Xo(this),Zn(u)):Xn(this),i._chunkSteps(m)}else D(u,i),Xn(this)}[_e](){}}Object.defineProperties(sr.prototype,{close:{enumerable:!0},enqueue:{enumerable:!0},error:{enumerable:!0},desiredSize:{enumerable:!0}}),s(sr.prototype.close,"close"),s(sr.prototype.enqueue,"enqueue"),s(sr.prototype.error,"error"),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(sr.prototype,Symbol.toStringTag,{value:"ReadableStreamDefaultController",configurable:!0});function Yo(o){return!t(o)||!Object.prototype.hasOwnProperty.call(o,"_controlledReadableStream")?!1:o instanceof sr}function Xn(o){if(!Ml(o))return;if(o._pulling){o._pullAgain=!0;return}o._pulling=!0;let u=o._pullAlgorithm();A(u,()=>(o._pulling=!1,o._pullAgain&&(o._pullAgain=!1,Xn(o)),null),m=>(Ft(o,m),null))}function Ml(o){let i=o._controlledReadableStream;return!dn(o)||!o._started?!1:!!(wr(i)&&I(i)>0||ya(o)>0)}function Xo(o){o._pullAlgorithm=void 0,o._cancelAlgorithm=void 0,o._strategySizeAlgorithm=void 0}function $r(o){if(!dn(o))return;let i=o._controlledReadableStream;o._closeRequested=!0,o._queue.length===0&&(Xo(o),Zn(i))}function fn(o,i){if(!dn(o))return;let u=o._controlledReadableStream;if(wr(u)&&I(u)>0)T(u,i,!1);else{let m;try{m=o._strategySizeAlgorithm(i)}catch(w){throw Ft(o,w),w}try{Qi(o,i,m)}catch(w){throw Ft(o,w),w}}Xn(o)}function Ft(o,i){let u=o._controlledReadableStream;u._state==="readable"&&(Cr(o),Xo(o),Wl(u,i))}function ya(o){let i=o._controlledReadableStream._state;return i==="errored"?null:i==="closed"?0:o._strategyHWM-o._queueTotalSize}function Ug(o){return!Ml(o)}function dn(o){let i=o._controlledReadableStream._state;return!o._closeRequested&&i==="readable"}function $l(o,i,u,m,w,N,L){i._controlledReadableStream=o,i._queue=void 0,i._queueTotalSize=void 0,Cr(i),i._started=!1,i._closeRequested=!1,i._pullAgain=!1,i._pulling=!1,i._strategySizeAlgorithm=L,i._strategyHWM=N,i._pullAlgorithm=m,i._cancelAlgorithm=w,o._readableStreamController=i;let J=u();A(d(J),()=>(i._started=!0,Xn(i),null),ne=>(Ft(i,ne),null))}function Mg(o,i,u,m){let w=Object.create(sr.prototype),N,L,J;i.start!==void 0?N=()=>i.start(w):N=()=>{},i.pull!==void 0?L=()=>i.pull(w):L=()=>d(void 0),i.cancel!==void 0?J=ne=>i.cancel(ne):J=()=>d(void 0),$l(o,w,N,L,J,u,m)}function Qo(o){return new TypeError(`ReadableStreamDefaultController.prototype.${o} can only be used on a ReadableStreamDefaultController`)}function $g(o,i){return qr(o._readableStreamController)?Gg(o):Hg(o)}function Hg(o,i){let u=q(o),m=!1,w=!1,N=!1,L=!1,J,ne,X,ae,fe,Ee=l(Ye=>{fe=Ye});function Ot(){return m?(w=!0,d(void 0)):(m=!0,K(u,{_chunkSteps:tt=>{_(()=>{w=!1;let Et=tt,ar=tt;N||fn(X._readableStreamController,Et),L||fn(ae._readableStreamController,ar),m=!1,w&&Ot()})},_closeSteps:()=>{m=!1,N||$r(X._readableStreamController),L||$r(ae._readableStreamController),(!N||!L)&&fe(void 0)},_errorSteps:()=>{m=!1}}),d(void 0))}function pn(Ye){if(N=!0,J=Ye,L){let tt=Ce([J,ne]),Et=kt(o,tt);fe(Et)}return Ee}function Sr(Ye){if(L=!0,ne=Ye,N){let tt=Ce([J,ne]),Et=kt(o,tt);fe(Et)}return Ee}function ir(){}return X=Qn(ir,Ot,pn),ae=Qn(ir,Ot,Sr),S(u._closedPromise,Ye=>(Ft(X._readableStreamController,Ye),Ft(ae._readableStreamController,Ye),(!N||!L)&&fe(void 0),null)),[X,ae]}function Gg(o){let i=q(o),u=!1,m=!1,w=!1,N=!1,L=!1,J,ne,X,ae,fe,Ee=l(ee=>{fe=ee});function Ot(ee){S(ee._closedPromise,he=>(ee!==i||(bt(X._readableStreamController,he),bt(ae._readableStreamController,he),(!N||!L)&&fe(void 0)),null))}function pn(){Lr(i)&&(se(i),i=q(o),Ot(i)),K(i,{_chunkSteps:he=>{_(()=>{m=!1,w=!1;let Ae=he,at=he;if(!N&&!L)try{at=il(he)}catch(mn){bt(X._readableStreamController,mn),bt(ae._readableStreamController,mn),fe(kt(o,mn));return}N||qo(X._readableStreamController,Ae),L||qo(ae._readableStreamController,at),u=!1,m?ir():w&&Ye()})},_closeSteps:()=>{u=!1,N||zn(X._readableStreamController),L||zn(ae._readableStreamController),X._readableStreamController._pendingPullIntos.length>0&&jo(X._readableStreamController,0),ae._readableStreamController._pendingPullIntos.length>0&&jo(ae._readableStreamController,0),(!N||!L)&&fe(void 0)},_errorSteps:()=>{u=!1}})}function Sr(ee,he){V(i)&&(se(i),i=Cl(o),Ot(i));let Ae=he?ae:X,at=he?X:ae;Al(i,ee,1,{_chunkSteps:gn=>{_(()=>{m=!1,w=!1;let yn=he?L:N;if(he?N:L)yn||Lo(Ae._readableStreamController,gn);else{let of;try{of=il(gn)}catch(Aa){bt(Ae._readableStreamController,Aa),bt(at._readableStreamController,Aa),fe(kt(o,Aa));return}yn||Lo(Ae._readableStreamController,gn),qo(at._readableStreamController,of)}u=!1,m?ir():w&&Ye()})},_closeSteps:gn=>{u=!1;let yn=he?L:N,is=he?N:L;yn||zn(Ae._readableStreamController),is||zn(at._readableStreamController),gn!==void 0&&(yn||Lo(Ae._readableStreamController,gn),!is&&at._readableStreamController._pendingPullIntos.length>0&&jo(at._readableStreamController,0)),(!yn||!is)&&fe(void 0)},_errorSteps:()=>{u=!1}})}function ir(){if(u)return m=!0,d(void 0);u=!0;let ee=na(X._readableStreamController);return ee===null?pn():Sr(ee._view,!1),d(void 0)}function Ye(){if(u)return w=!0,d(void 0);u=!0;let ee=na(ae._readableStreamController);return ee===null?pn():Sr(ee._view,!0),d(void 0)}function tt(ee){if(N=!0,J=ee,L){let he=Ce([J,ne]),Ae=kt(o,he);fe(Ae)}return Ee}function Et(ee){if(L=!0,ne=ee,N){let he=Ce([J,ne]),Ae=kt(o,he);fe(Ae)}return Ee}function ar(){}return X=Gl(ar,ir,tt),ae=Gl(ar,Ye,Et),Ot(i),[X,ae]}function Wg(o){return t(o)&&typeof o.getReader<"u"}function zg(o){return Wg(o)?Vg(o.getReader()):Jg(o)}function Jg(o){let i,u=sl(o,"async"),m=e;function w(){let L;try{L=jm(u)}catch(ne){return h(ne)}let J=d(L);return y(J,ne=>{if(!t(ne))throw new TypeError("The promise returned by the iterator.next() method must fulfill with an object");if(Lm(ne))$r(i._readableStreamController);else{let ae=Um(ne);fn(i._readableStreamController,ae)}})}function N(L){let J=u.iterator,ne;try{ne=Bo(J,"return")}catch(fe){return h(fe)}if(ne===void 0)return d(void 0);let X;try{X=F(ne,J,[L])}catch(fe){return h(fe)}let ae=d(X);return y(ae,fe=>{if(!t(fe))throw new TypeError("The promise returned by the iterator.return() method must fulfill with an object")})}return i=Qn(m,w,N,0),i}function Vg(o){let i,u=e;function m(){let N;try{N=o.read()}catch(L){return h(L)}return y(N,L=>{if(!t(L))throw new TypeError("The promise returned by the reader.read() method must fulfill with an object");if(L.done)$r(i._readableStreamController);else{let J=L.value;fn(i._readableStreamController,J)}})}function w(N){try{return d(o.cancel(N))}catch(L){return h(L)}}return i=Qn(u,m,w,0),i}function Kg(o,i){et(o,i);let u=o,m=u?.autoAllocateChunkSize,w=u?.cancel,N=u?.pull,L=u?.start,J=u?.type;return{autoAllocateChunkSize:m===void 0?void 0:v(m,`${i} has member 'autoAllocateChunkSize' that`),cancel:w===void 0?void 0:Yg(w,u,`${i} has member 'cancel' that`),pull:N===void 0?void 0:Xg(N,u,`${i} has member 'pull' that`),start:L===void 0?void 0:Qg(L,u,`${i} has member 'start' that`),type:J===void 0?void 0:Zg(J,`${i} has member 'type' that`)}}function Yg(o,i,u){return Ve(o,u),m=>k(o,i,[m])}function Xg(o,i,u){return Ve(o,u),m=>k(o,i,[m])}function Qg(o,i,u){return Ve(o,u),m=>F(o,i,[m])}function Zg(o,i){if(o=`${o}`,o!=="bytes")throw new TypeError(`${i} '${o}' is not a valid enumeration value for ReadableStreamType`);return o}function ey(o,i){return et(o,i),{preventCancel:!!o?.preventCancel}}function Hl(o,i){et(o,i);let u=o?.preventAbort,m=o?.preventCancel,w=o?.preventClose,N=o?.signal;return N!==void 0&&ty(N,`${i} has member 'signal' that`),{preventAbort:!!u,preventCancel:!!m,preventClose:!!w,signal:N}}function ty(o,i){if(!cg(o))throw new TypeError(`${i} is not an AbortSignal.`)}function ry(o,i){et(o,i);let u=o?.readable;p(u,"readable","ReadableWritablePair"),R(u,`${i} has member 'readable' that`);let m=o?.writable;return p(m,"writable","ReadableWritablePair"),Dl(m,`${i} has member 'writable' that`),{readable:u,writable:m}}class We{constructor(i={},u={}){i===void 0?i=null:Ke(i,"First parameter");let m=$o(u,"Second parameter"),w=Kg(i,"First parameter");if(_a(this),w.type==="bytes"){if(m.size!==void 0)throw new RangeError("The strategy for a byte stream cannot have a size function");let N=Vn(m,0);Ym(this,w,N)}else{let N=Mo(m),L=Vn(m,1);Mg(this,w,L,N)}}get locked(){if(!Ar(this))throw Hr("locked");return wr(this)}cancel(i=void 0){return Ar(this)?wr(this)?h(new TypeError("Cannot cancel a stream that already has a reader")):kt(this,i):h(Hr("cancel"))}getReader(i=void 0){if(!Ar(this))throw Hr("getReader");return Qm(i,"First parameter").mode===void 0?q(this):Cl(this)}pipeThrough(i,u={}){if(!Ar(this))throw Hr("pipeThrough");Pe(i,1,"pipeThrough");let m=ry(i,"First parameter"),w=Hl(u,"Second parameter");if(wr(this))throw new TypeError("ReadableStream.prototype.pipeThrough cannot be used on a locked ReadableStream");if(cn(m.writable))throw new TypeError("ReadableStream.prototype.pipeThrough cannot be used on a locked WritableStream");let N=Ul(this,m.writable,w.preventClose,w.preventAbort,w.preventCancel,w.signal);return C(N),m.readable}pipeTo(i,u={}){if(!Ar(this))return h(Hr("pipeTo"));if(i===void 0)return h("Parameter 1 is required in 'pipeTo'.");if(!un(i))return h(new TypeError("ReadableStream.prototype.pipeTo's first argument must be a WritableStream"));let m;try{m=Hl(u,"Second parameter")}catch(w){return h(w)}return wr(this)?h(new TypeError("ReadableStream.prototype.pipeTo cannot be used on a locked ReadableStream")):cn(i)?h(new TypeError("ReadableStream.prototype.pipeTo cannot be used on a locked WritableStream")):Ul(this,i,m.preventClose,m.preventAbort,m.preventCancel,m.signal)}tee(){if(!Ar(this))throw Hr("tee");let i=$g(this);return Ce(i)}values(i=void 0){if(!Ar(this))throw Hr("values");let u=ey(i,"First parameter");return nn(this,u.preventCancel)}[Yi](i){return this.values(i)}static from(i){return zg(i)}}Object.defineProperties(We,{from:{enumerable:!0}}),Object.defineProperties(We.prototype,{cancel:{enumerable:!0},getReader:{enumerable:!0},pipeThrough:{enumerable:!0},pipeTo:{enumerable:!0},tee:{enumerable:!0},values:{enumerable:!0},locked:{enumerable:!0}}),s(We.from,"from"),s(We.prototype.cancel,"cancel"),s(We.prototype.getReader,"getReader"),s(We.prototype.pipeThrough,"pipeThrough"),s(We.prototype.pipeTo,"pipeTo"),s(We.prototype.tee,"tee"),s(We.prototype.values,"values"),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(We.prototype,Symbol.toStringTag,{value:"ReadableStream",configurable:!0}),Object.defineProperty(We.prototype,Yi,{value:We.prototype.values,writable:!0,configurable:!0});function Qn(o,i,u,m=1,w=()=>1){let N=Object.create(We.prototype);_a(N);let L=Object.create(sr.prototype);return $l(N,L,o,i,u,m,w),N}function Gl(o,i,u){let m=Object.create(We.prototype);_a(m);let w=Object.create(nr.prototype);return _l(m,w,o,i,u,0,void 0),m}function _a(o){o._state="readable",o._reader=void 0,o._storedError=void 0,o._disturbed=!1}function Ar(o){return!t(o)||!Object.prototype.hasOwnProperty.call(o,"_readableStreamController")?!1:o instanceof We}function wr(o){return o._reader!==void 0}function kt(o,i){if(o._disturbed=!0,o._state==="closed")return d(void 0);if(o._state==="errored")return h(o._storedError);Zn(o);let u=o._reader;if(u!==void 0&&Lr(u)){let w=u._readIntoRequests;u._readIntoRequests=new B,w.forEach(N=>{N._closeSteps(void 0)})}let m=o._readableStreamController[Z](i);return y(m,e)}function Zn(o){o._state="closed";let i=o._reader;if(i!==void 0&&(Ct(i),V(i))){let u=i._readRequests;i._readRequests=new B,u.forEach(m=>{m._closeSteps()})}}function Wl(o,i){o._state="errored",o._storedError=i;let u=o._reader;u!==void 0&&(Se(u,i),V(u)?ve(u,i):wl(u,i))}function Hr(o){return new TypeError(`ReadableStream.prototype.${o} can only be used on a ReadableStream`)}function zl(o,i){et(o,i);let u=o?.highWaterMark;return p(u,"highWaterMark","QueuingStrategyInit"),{highWaterMark:g(u)}}let Jl=o=>o.byteLength;s(Jl,"size");class Zo{constructor(i){Pe(i,1,"ByteLengthQueuingStrategy"),i=zl(i,"First parameter"),this._byteLengthQueuingStrategyHighWaterMark=i.highWaterMark}get highWaterMark(){if(!Kl(this))throw Vl("highWaterMark");return this._byteLengthQueuingStrategyHighWaterMark}get size(){if(!Kl(this))throw Vl("size");return Jl}}Object.defineProperties(Zo.prototype,{highWaterMark:{enumerable:!0},size:{enumerable:!0}}),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(Zo.prototype,Symbol.toStringTag,{value:"ByteLengthQueuingStrategy",configurable:!0});function Vl(o){return new TypeError(`ByteLengthQueuingStrategy.prototype.${o} can only be used on a ByteLengthQueuingStrategy`)}function Kl(o){return!t(o)||!Object.prototype.hasOwnProperty.call(o,"_byteLengthQueuingStrategyHighWaterMark")?!1:o instanceof Zo}let Yl=()=>1;s(Yl,"size");class es{constructor(i){Pe(i,1,"CountQueuingStrategy"),i=zl(i,"First parameter"),this._countQueuingStrategyHighWaterMark=i.highWaterMark}get highWaterMark(){if(!Ql(this))throw Xl("highWaterMark");return this._countQueuingStrategyHighWaterMark}get size(){if(!Ql(this))throw Xl("size");return Yl}}Object.defineProperties(es.prototype,{highWaterMark:{enumerable:!0},size:{enumerable:!0}}),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(es.prototype,Symbol.toStringTag,{value:"CountQueuingStrategy",configurable:!0});function Xl(o){return new TypeError(`CountQueuingStrategy.prototype.${o} can only be used on a CountQueuingStrategy`)}function Ql(o){return!t(o)||!Object.prototype.hasOwnProperty.call(o,"_countQueuingStrategyHighWaterMark")?!1:o instanceof es}function ny(o,i){et(o,i);let u=o?.cancel,m=o?.flush,w=o?.readableType,N=o?.start,L=o?.transform,J=o?.writableType;return{cancel:u===void 0?void 0:ay(u,o,`${i} has member 'cancel' that`),flush:m===void 0?void 0:oy(m,o,`${i} has member 'flush' that`),readableType:w,start:N===void 0?void 0:sy(N,o,`${i} has member 'start' that`),transform:L===void 0?void 0:iy(L,o,`${i} has member 'transform' that`),writableType:J}}function oy(o,i,u){return Ve(o,u),m=>k(o,i,[m])}function sy(o,i,u){return Ve(o,u),m=>F(o,i,[m])}function iy(o,i,u){return Ve(o,u),(m,w)=>k(o,i,[m,w])}function ay(o,i,u){return Ve(o,u),m=>k(o,i,[m])}class ts{constructor(i={},u={},m={}){i===void 0&&(i=null);let w=$o(u,"Second parameter"),N=$o(m,"Third parameter"),L=ny(i,"First parameter");if(L.readableType!==void 0)throw new RangeError("Invalid readableType specified");if(L.writableType!==void 0)throw new RangeError("Invalid writableType specified");let J=Vn(N,0),ne=Mo(N),X=Vn(w,1),ae=Mo(w),fe,Ee=l(Ot=>{fe=Ot});uy(this,Ee,X,ae,J,ne),ly(this,L),L.start!==void 0?fe(L.start(this._transformStreamController)):fe(void 0)}get readable(){if(!Zl(this))throw nf("readable");return this._readable}get writable(){if(!Zl(this))throw nf("writable");return this._writable}}Object.defineProperties(ts.prototype,{readable:{enumerable:!0},writable:{enumerable:!0}}),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(ts.prototype,Symbol.toStringTag,{value:"TransformStream",configurable:!0});function uy(o,i,u,m,w,N){function L(){return i}function J(Ee){return hy(o,Ee)}function ne(Ee){return py(o,Ee)}function X(){return my(o)}o._writable=dg(L,J,X,ne,u,m);function ae(){return gy(o)}function fe(Ee){return yy(o,Ee)}o._readable=Qn(L,ae,fe,w,N),o._backpressure=void 0,o._backpressureChangePromise=void 0,o._backpressureChangePromise_resolve=void 0,rs(o,!0),o._transformStreamController=void 0}function Zl(o){return!t(o)||!Object.prototype.hasOwnProperty.call(o,"_transformStreamController")?!1:o instanceof ts}function ef(o,i){Ft(o._readable._readableStreamController,i),Ca(o,i)}function Ca(o,i){os(o._transformStreamController),Kn(o._writable._writableStreamController,i),ba(o)}function ba(o){o._backpressure&&rs(o,!1)}function rs(o,i){o._backpressureChangePromise!==void 0&&o._backpressureChangePromise_resolve(),o._backpressureChangePromise=l(u=>{o._backpressureChangePromise_resolve=u}),o._backpressure=i}class Dr{constructor(){throw new TypeError("Illegal constructor")}get desiredSize(){if(!ns(this))throw ss("desiredSize");let i=this._controlledTransformStream._readable._readableStreamController;return ya(i)}enqueue(i=void 0){if(!ns(this))throw ss("enqueue");tf(this,i)}error(i=void 0){if(!ns(this))throw ss("error");fy(this,i)}terminate(){if(!ns(this))throw ss("terminate");dy(this)}}Object.defineProperties(Dr.prototype,{enqueue:{enumerable:!0},error:{enumerable:!0},terminate:{enumerable:!0},desiredSize:{enumerable:!0}}),s(Dr.prototype.enqueue,"enqueue"),s(Dr.prototype.error,"error"),s(Dr.prototype.terminate,"terminate"),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(Dr.prototype,Symbol.toStringTag,{value:"TransformStreamDefaultController",configurable:!0});function ns(o){return!t(o)||!Object.prototype.hasOwnProperty.call(o,"_controlledTransformStream")?!1:o instanceof Dr}function cy(o,i,u,m,w){i._controlledTransformStream=o,o._transformStreamController=i,i._transformAlgorithm=u,i._flushAlgorithm=m,i._cancelAlgorithm=w,i._finishPromise=void 0,i._finishPromise_resolve=void 0,i._finishPromise_reject=void 0}function ly(o,i){let u=Object.create(Dr.prototype),m,w,N;i.transform!==void 0?m=L=>i.transform(L,u):m=L=>{try{return tf(u,L),d(void 0)}catch(J){return h(J)}},i.flush!==void 0?w=()=>i.flush(u):w=()=>d(void 0),i.cancel!==void 0?N=L=>i.cancel(L):N=()=>d(void 0),cy(o,u,m,w,N)}function os(o){o._transformAlgorithm=void 0,o._flushAlgorithm=void 0,o._cancelAlgorithm=void 0}function tf(o,i){let u=o._controlledTransformStream,m=u._readable._readableStreamController;if(!dn(m))throw new TypeError("Readable side is not in a state that permits enqueue");try{fn(m,i)}catch(N){throw Ca(u,N),u._readable._storedError}Ug(m)!==u._backpressure&&rs(u,!0)}function fy(o,i){ef(o._controlledTransformStream,i)}function rf(o,i){let u=o._transformAlgorithm(i);return y(u,void 0,m=>{throw ef(o._controlledTransformStream,m),m})}function dy(o){let i=o._controlledTransformStream,u=i._readable._readableStreamController;$r(u);let m=new TypeError("TransformStream terminated");Ca(i,m)}function hy(o,i){let u=o._transformStreamController;if(o._backpressure){let m=o._backpressureChangePromise;return y(m,()=>{let w=o._writable;if(w._state==="erroring")throw w._storedError;return rf(u,i)})}return rf(u,i)}function py(o,i){let u=o._transformStreamController;if(u._finishPromise!==void 0)return u._finishPromise;let m=o._readable;u._finishPromise=l((N,L)=>{u._finishPromise_resolve=N,u._finishPromise_reject=L});let w=u._cancelAlgorithm(i);return os(u),A(w,()=>(m._state==="errored"?hn(u,m._storedError):(Ft(m._readableStreamController,i),Ea(u)),null),N=>(Ft(m._readableStreamController,N),hn(u,N),null)),u._finishPromise}function my(o){let i=o._transformStreamController;if(i._finishPromise!==void 0)return i._finishPromise;let u=o._readable;i._finishPromise=l((w,N)=>{i._finishPromise_resolve=w,i._finishPromise_reject=N});let m=i._flushAlgorithm();return os(i),A(m,()=>(u._state==="errored"?hn(i,u._storedError):($r(u._readableStreamController),Ea(i)),null),w=>(Ft(u._readableStreamController,w),hn(i,w),null)),i._finishPromise}function gy(o){return rs(o,!1),o._backpressureChangePromise}function yy(o,i){let u=o._transformStreamController;if(u._finishPromise!==void 0)return u._finishPromise;let m=o._writable;u._finishPromise=l((N,L)=>{u._finishPromise_resolve=N,u._finishPromise_reject=L});let w=u._cancelAlgorithm(i);return os(u),A(w,()=>(m._state==="errored"?hn(u,m._storedError):(Kn(m._writableStreamController,i),ba(o),Ea(u)),null),N=>(Kn(m._writableStreamController,N),ba(o),hn(u,N),null)),u._finishPromise}function ss(o){return new TypeError(`TransformStreamDefaultController.prototype.${o} can only be used on a TransformStreamDefaultController`)}function Ea(o){o._finishPromise_resolve!==void 0&&(o._finishPromise_resolve(),o._finishPromise_resolve=void 0,o._finishPromise_reject=void 0)}function hn(o,i){o._finishPromise_reject!==void 0&&(C(o._finishPromise),o._finishPromise_reject(i),o._finishPromise_resolve=void 0,o._finishPromise_reject=void 0)}function nf(o){return new TypeError(`TransformStream.prototype.${o} can only be used on a TransformStream`)}r.ByteLengthQueuingStrategy=Zo,r.CountQueuingStrategy=es,r.ReadableByteStreamController=nr,r.ReadableStream=We,r.ReadableStreamBYOBReader=br,r.ReadableStreamBYOBRequest=Nr,r.ReadableStreamDefaultController=sr,r.ReadableStreamDefaultReader=M,r.TransformStream=ts,r.TransformStreamDefaultController=Dr,r.WritableStream=Er,r.WritableStreamDefaultController=ln,r.WritableStreamDefaultWriter=or})});var _d=W(()=>{if(!globalThis.ReadableStream)try{let r=require("node:process"),{emitWarning:e}=r;try{r.emitWarning=()=>{},Object.assign(globalThis,require("node:stream/web")),r.emitWarning=e}catch(t){throw r.emitWarning=e,t}}catch{Object.assign(globalThis,yd())}try{let{Blob:r}=require("buffer");r&&!r.prototype.stream&&(r.prototype.stream=function(t){let n=0,s=this;return new ReadableStream({type:"bytes",async pull(a){let f=await s.slice(n,Math.min(s.size,n+65536)).arrayBuffer();n+=f.byteLength,a.enqueue(new Uint8Array(f)),n===s.size&&a.close()}})})}catch{}});async function*Ka(r,e=!0){for(let t of r)if("stream"in t)yield*t.stream();else if(ArrayBuffer.isView(t))if(e){let n=t.byteOffset,s=t.byteOffset+t.byteLength;for(;n!==s;){let a=Math.min(s-n,Cd),c=t.buffer.slice(n,n+a);n+=c.byteLength,yield new Uint8Array(c)}}else yield t;else{let n=0,s=t;for(;n!==s.size;){let c=await s.slice(n,Math.min(s.size,n+Cd)).arrayBuffer();n+=c.byteLength,yield new Uint8Array(c)}}}var ow,Cd,bd,P0,Bt,oo=Ne(()=>{ow=Ie(_d(),1);Cd=65536;bd=class Ya{#e=[];#t="";#r=0;#n="transparent";constructor(e=[],t={}){if(typeof e!="object"||e===null)throw new TypeError("Failed to construct 'Blob': The provided value cannot be converted to a sequence.");if(typeof e[Symbol.iterator]!="function")throw new TypeError("Failed to construct 'Blob': The object must have a callable @@iterator property.");if(typeof t!="object"&&typeof t!="function")throw new TypeError("Failed to construct 'Blob': parameter 2 cannot convert to dictionary.");t===null&&(t={});let n=new TextEncoder;for(let a of e){let c;ArrayBuffer.isView(a)?c=new Uint8Array(a.buffer.slice(a.byteOffset,a.byteOffset+a.byteLength)):a instanceof ArrayBuffer?c=new Uint8Array(a.slice(0)):a instanceof Ya?c=a:c=n.encode(`${a}`),this.#r+=ArrayBuffer.isView(c)?c.byteLength:c.size,this.#e.push(c)}this.#n=`${t.endings===void 0?"transparent":t.endings}`;let s=t.type===void 0?"":String(t.type);this.#t=/^[\x20-\x7E]*$/.test(s)?s:""}get size(){return this.#r}get type(){return this.#t}async text(){let e=new TextDecoder,t="";for await(let n of Ka(this.#e,!1))t+=e.decode(n,{stream:!0});return t+=e.decode(),t}async arrayBuffer(){let e=new Uint8Array(this.size),t=0;for await(let n of Ka(this.#e,!1))e.set(n,t),t+=n.length;return e.buffer}stream(){let e=Ka(this.#e,!0);return new globalThis.ReadableStream({type:"bytes",async pull(t){let n=await e.next();n.done?t.close():t.enqueue(n.value)},async cancel(){await e.return()}})}slice(e=0,t=this.size,n=""){let{size:s}=this,a=e<0?Math.max(s+e,0):Math.min(e,s),c=t<0?Math.max(s+t,0):Math.min(t,s),f=Math.max(c-a,0),l=this.#e,d=[],h=0;for(let A of l){if(h>=f)break;let O=ArrayBuffer.isView(A)?A.byteLength:A.size;if(a&&O<=a)a-=O,c-=O;else{let S;ArrayBuffer.isView(A)?(S=A.subarray(a,Math.min(O,c)),h+=S.byteLength):(S=A.slice(a,Math.min(O,c)),h+=S.size),c-=O,d.push(S),a=0}}let b=new Ya([],{type:String(n).toLowerCase()});return b.#r=f,b.#e=d,b}get[Symbol.toStringTag](){return"Blob"}static[Symbol.hasInstance](e){return e&&typeof e=="object"&&typeof e.constructor=="function"&&(typeof e.stream=="function"||typeof e.arrayBuffer=="function")&&/^(Blob|File)$/.test(e[Symbol.toStringTag])}};Object.defineProperties(bd.prototype,{size:{enumerable:!0},type:{enumerable:!0},slice:{enumerable:!0}});P0=bd,Bt=P0});var x0,B0,Fr,Xa=Ne(()=>{oo();x0=class extends Bt{#e=0;#t="";constructor(e,t,n={}){if(arguments.length<2)throw new TypeError(`Failed to construct 'File': 2 arguments required, but only ${arguments.length} present.`);super(e,n),n===null&&(n={});let s=n.lastModified===void 0?Date.now():Number(n.lastModified);Number.isNaN(s)||(this.#e=s),this.#t=String(t)}get name(){return this.#t}get lastModified(){return this.#e}get[Symbol.toStringTag](){return"File"}static[Symbol.hasInstance](e){return!!e&&e instanceof Bt&&/^(File)$/.test(e[Symbol.toStringTag])}},B0=x0,Fr=B0});function wd(r,e=Bt){var t=`${Ed()}${Ed()}`.replace(/\./g,"").slice(-28).padStart(32,"-"),n=[],s=`--${t}\r
Content-Disposition: form-data; name="`;return r.forEach((a,c)=>typeof a=="string"?n.push(s+Qa(c)+`"\r
\r
${a.replace(/\r(?!\n)|(?<!\r)\n/g,`\r
`)}\r
`):n.push(s+Qa(c)+`"; filename="${Qa(a.name,1)}"\r
Content-Type: ${a.type||"application/octet-stream"}\r
\r
`,a,`\r
`)),n.push(`--${t}--`),new e(n,{type:"multipart/form-data; boundary="+t})}var so,I0,N0,Ed,q0,Ad,Qa,Jr,kr,Ps=Ne(()=>{oo();Xa();({toStringTag:so,iterator:I0,hasInstance:N0}=Symbol),Ed=Math.random,q0="append,set,get,getAll,delete,keys,values,entries,forEach,constructor".split(","),Ad=(r,e,t)=>(r+="",/^(Blob|File)$/.test(e&&e[so])?[(t=t!==void 0?t+"":e[so]=="File"?e.name:"blob",r),e.name!==t||e[so]=="blob"?new Fr([e],t,e):e]:[r,e+""]),Qa=(r,e)=>(e?r:r.replace(/\r?\n|\r/g,`\r
`)).replace(/\n/g,"%0A").replace(/\r/g,"%0D").replace(/"/g,"%22"),Jr=(r,e,t)=>{if(e.length<t)throw new TypeError(`Failed to execute '${r}' on 'FormData': ${t} arguments required, but only ${e.length} present.`)},kr=class{#e=[];constructor(...e){if(e.length)throw new TypeError("Failed to construct 'FormData': parameter 1 is not of type 'HTMLFormElement'.")}get[so](){return"FormData"}[I0](){return this.entries()}static[N0](e){return e&&typeof e=="object"&&e[so]==="FormData"&&!q0.some(t=>typeof e[t]!="function")}append(...e){Jr("append",arguments,2),this.#e.push(Ad(...e))}delete(e){Jr("delete",arguments,1),e+="",this.#e=this.#e.filter(([t])=>t!==e)}get(e){Jr("get",arguments,1),e+="";for(var t=this.#e,n=t.length,s=0;s<n;s++)if(t[s][0]===e)return t[s][1];return null}getAll(e,t){return Jr("getAll",arguments,1),t=[],e+="",this.#e.forEach(n=>n[0]===e&&t.push(n[1])),t}has(e){return Jr("has",arguments,1),e+="",this.#e.some(t=>t[0]===e)}forEach(e,t){Jr("forEach",arguments,1);for(var[n,s]of this)e.call(t,s,n,this)}set(...e){Jr("set",arguments,2);var t=[],n=!0;e=Ad(...e),this.#e.forEach(s=>{s[0]===e[0]?n&&(n=!t.push(e)):t.push(s)}),n&&t.push(e),this.#e=t}*entries(){yield*this.#e}*keys(){for(var[e]of this)yield e}*values(){for(var[,e]of this)yield e}}});var fr,xs=Ne(()=>{fr=class extends Error{constructor(e,t){super(e),Error.captureStackTrace(this,this.constructor),this.type=t}get name(){return this.constructor.name}get[Symbol.toStringTag](){return this.constructor.name}}});var Qe,Za=Ne(()=>{xs();Qe=class extends fr{constructor(e,t,n){super(e,t),n&&(this.code=this.errno=n.code,this.erroredSysCall=n.syscall)}}});var Bs,eu,io,Dd,Sd,vd,Is=Ne(()=>{Bs=Symbol.toStringTag,eu=r=>typeof r=="object"&&typeof r.append=="function"&&typeof r.delete=="function"&&typeof r.get=="function"&&typeof r.getAll=="function"&&typeof r.has=="function"&&typeof r.set=="function"&&typeof r.sort=="function"&&r[Bs]==="URLSearchParams",io=r=>r&&typeof r=="object"&&typeof r.arrayBuffer=="function"&&typeof r.type=="string"&&typeof r.stream=="function"&&typeof r.constructor=="function"&&/^(Blob|File)$/.test(r[Bs]),Dd=r=>typeof r=="object"&&(r[Bs]==="AbortSignal"||r[Bs]==="EventTarget"),Sd=(r,e)=>{let t=new URL(e).hostname,n=new URL(r).hostname;return t===n||t.endsWith(`.${n}`)},vd=(r,e)=>{let t=new URL(e).protocol,n=new URL(r).protocol;return t===n}});var Rd=W((yw,Td)=>{if(!globalThis.DOMException)try{let{MessageChannel:r}=require("worker_threads"),e=new r().port1,t=new ArrayBuffer;e.postMessage(t,[t,t])}catch(r){r.constructor.name==="DOMException"&&(globalThis.DOMException=r.constructor)}Td.exports=globalThis.DOMException});var Vr,Fd,kd,tu,Od,Pd,xd,Bd,Id,Nd,Ns,ru=Ne(()=>{Vr=require("node:fs"),Fd=require("node:path"),kd=Ie(Rd(),1);Xa();oo();({stat:tu}=Vr.promises),Od=(r,e)=>Id((0,Vr.statSync)(r),r,e),Pd=(r,e)=>tu(r).then(t=>Id(t,r,e)),xd=(r,e)=>tu(r).then(t=>Nd(t,r,e)),Bd=(r,e)=>Nd((0,Vr.statSync)(r),r,e),Id=(r,e,t="")=>new Bt([new Ns({path:e,size:r.size,lastModified:r.mtimeMs,start:0})],{type:t}),Nd=(r,e,t="")=>new Fr([new Ns({path:e,size:r.size,lastModified:r.mtimeMs,start:0})],(0,Fd.basename)(e),{type:t,lastModified:r.mtimeMs}),Ns=class r{#e;#t;constructor(e){this.#e=e.path,this.#t=e.start,this.size=e.size,this.lastModified=e.lastModified}slice(e,t){return new r({path:this.#e,lastModified:this.lastModified,size:t-e,start:this.#t+e})}async*stream(){let{mtimeMs:e}=await tu(this.#e);if(e>this.lastModified)throw new kd.default("The requested file could not be read, typically due to permission problems that have occurred after a reference to a file was acquired.","NotReadableError");yield*(0,Vr.createReadStream)(this.#e,{start:this.#t,end:this.#t+this.size-1})}get[Symbol.toStringTag](){return"Blob"}}});var jd={};wa(jd,{toFormData:()=>G0});function H0(r){let e=r.match(/\bfilename=("(.*?)"|([^()<>@,;:\\"/[\]?={}\s\t]+))($|;\s)/i);if(!e)return;let t=e[2]||e[3]||"",n=t.slice(t.lastIndexOf("\\")+1);return n=n.replace(/%22/g,'"'),n=n.replace(/&#(\d{4});/g,(s,a)=>String.fromCharCode(a)),n}async function G0(r,e){if(!/multipart/i.test(e))throw new TypeError("Failed to fetch");let t=e.match(/boundary=(?:"([^"]+)"|([^;]+))/i);if(!t)throw new TypeError("no or bad content-type header, no multipart boundary");let n=new nu(t[1]||t[2]),s,a,c,f,l,d,h=[],b=new kr,A=_=>{c+=C.decode(_,{stream:!0})},O=_=>{h.push(_)},S=()=>{let _=new Fr(h,d,{type:l});b.append(f,_)},y=()=>{b.append(f,c)},C=new TextDecoder("utf-8");C.decode(),n.onPartBegin=function(){n.onPartData=A,n.onPartEnd=y,s="",a="",c="",f="",l="",d=null,h.length=0},n.onHeaderField=function(_){s+=C.decode(_,{stream:!0})},n.onHeaderValue=function(_){a+=C.decode(_,{stream:!0})},n.onHeaderEnd=function(){if(a+=C.decode(),s=s.toLowerCase(),s==="content-disposition"){let _=a.match(/\bname=("([^"]*)"|([^()<>@,;:\\"/[\]?={}\s\t]+))/i);_&&(f=_[2]||_[3]||""),d=H0(a),d&&(n.onPartData=O,n.onPartEnd=S)}else s==="content-type"&&(l=a);a="",s=""};for await(let _ of r)n.write(_);return n.end(),b}var Wt,we,qd,Or,qs,js,j0,ao,L0,U0,M0,$0,Kr,nu,Ld=Ne(()=>{ru();Ps();Wt=0,we={START_BOUNDARY:Wt++,HEADER_FIELD_START:Wt++,HEADER_FIELD:Wt++,HEADER_VALUE_START:Wt++,HEADER_VALUE:Wt++,HEADER_VALUE_ALMOST_DONE:Wt++,HEADERS_ALMOST_DONE:Wt++,PART_DATA_START:Wt++,PART_DATA:Wt++,END:Wt++},qd=1,Or={PART_BOUNDARY:qd,LAST_BOUNDARY:qd*=2},qs=10,js=13,j0=32,ao=45,L0=58,U0=97,M0=122,$0=r=>r|32,Kr=()=>{},nu=class{constructor(e){this.index=0,this.flags=0,this.onHeaderEnd=Kr,this.onHeaderField=Kr,this.onHeadersEnd=Kr,this.onHeaderValue=Kr,this.onPartBegin=Kr,this.onPartData=Kr,this.onPartEnd=Kr,this.boundaryChars={},e=`\r
--`+e;let t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n),this.boundaryChars[t[n]]=!0;this.boundary=t,this.lookbehind=new Uint8Array(this.boundary.length+8),this.state=we.START_BOUNDARY}write(e){let t=0,n=e.length,s=this.index,{lookbehind:a,boundary:c,boundaryChars:f,index:l,state:d,flags:h}=this,b=this.boundary.length,A=b-1,O=e.length,S,y,C=U=>{this[U+"Mark"]=t},_=U=>{delete this[U+"Mark"]},F=(U,B,j,H)=>{(B===void 0||B!==j)&&this[U](H&&H.subarray(B,j))},k=(U,B)=>{let j=U+"Mark";j in this&&(B?(F(U,this[j],t,e),delete this[j]):(F(U,this[j],e.length,e),this[j]=0))};for(t=0;t<n;t++)switch(S=e[t],d){case we.START_BOUNDARY:if(l===c.length-2){if(S===ao)h|=Or.LAST_BOUNDARY;else if(S!==js)return;l++;break}else if(l-1===c.length-2){if(h&Or.LAST_BOUNDARY&&S===ao)d=we.END,h=0;else if(!(h&Or.LAST_BOUNDARY)&&S===qs)l=0,F("onPartBegin"),d=we.HEADER_FIELD_START;else return;break}S!==c[l+2]&&(l=-2),S===c[l+2]&&l++;break;case we.HEADER_FIELD_START:d=we.HEADER_FIELD,C("onHeaderField"),l=0;case we.HEADER_FIELD:if(S===js){_("onHeaderField"),d=we.HEADERS_ALMOST_DONE;break}if(l++,S===ao)break;if(S===L0){if(l===1)return;k("onHeaderField",!0),d=we.HEADER_VALUE_START;break}if(y=$0(S),y<U0||y>M0)return;break;case we.HEADER_VALUE_START:if(S===j0)break;C("onHeaderValue"),d=we.HEADER_VALUE;case we.HEADER_VALUE:S===js&&(k("onHeaderValue",!0),F("onHeaderEnd"),d=we.HEADER_VALUE_ALMOST_DONE);break;case we.HEADER_VALUE_ALMOST_DONE:if(S!==qs)return;d=we.HEADER_FIELD_START;break;case we.HEADERS_ALMOST_DONE:if(S!==qs)return;F("onHeadersEnd"),d=we.PART_DATA_START;break;case we.PART_DATA_START:d=we.PART_DATA,C("onPartData");case we.PART_DATA:if(s=l,l===0){for(t+=A;t<O&&!(e[t]in f);)t+=b;t-=A,S=e[t]}if(l<c.length)c[l]===S?(l===0&&k("onPartData",!0),l++):l=0;else if(l===c.length)l++,S===js?h|=Or.PART_BOUNDARY:S===ao?h|=Or.LAST_BOUNDARY:l=0;else if(l-1===c.length)if(h&Or.PART_BOUNDARY){if(l=0,S===qs){h&=~Or.PART_BOUNDARY,F("onPartEnd"),F("onPartBegin"),d=we.HEADER_FIELD_START;break}}else h&Or.LAST_BOUNDARY&&S===ao?(F("onPartEnd"),d=we.END,h=0):l=0;if(l>0)a[l-1]=S;else if(s>0){let U=new Uint8Array(a.buffer,a.byteOffset,a.byteLength);F("onPartData",0,s,U),s=0,C("onPartData"),t--}break;case we.END:break;default:throw new Error(`Unexpected state entered: ${d}`)}k("onHeaderField"),k("onHeaderValue"),k("onPartData"),this.index=l,this.state=d,this.flags=h}end(){if(this.state===we.HEADER_FIELD_START&&this.index===0||this.state===we.PART_DATA&&this.index===this.boundary.length)this.onPartEnd();else if(this.state!==we.END)throw new Error("MultipartParser.end(): stream ended unexpectedly")}}});async function ou(r){if(r[ot].disturbed)throw new TypeError(`body used already for: ${r.url}`);if(r[ot].disturbed=!0,r[ot].error)throw r[ot].error;let{body:e}=r;if(e===null)return ct.Buffer.alloc(0);if(!(e instanceof Dt.default))return ct.Buffer.alloc(0);let t=[],n=0;try{for await(let s of e){if(r.size>0&&n+s.length>r.size){let a=new Qe(`content size at ${r.url} over limit: ${r.size}`,"max-size");throw e.destroy(a),a}n+=s.length,t.push(s)}}catch(s){throw s instanceof fr?s:new Qe(`Invalid response body while trying to fetch ${r.url}: ${s.message}`,"system",s)}if(e.readableEnded===!0||e._readableState.ended===!0)try{return t.every(s=>typeof s=="string")?ct.Buffer.from(t.join("")):ct.Buffer.concat(t,n)}catch(s){throw new Qe(`Could not create Buffer from response body for ${r.url}: ${s.message}`,"system",s)}else throw new Qe(`Premature close of server response while trying to fetch ${r.url}`)}var Dt,dr,ct,W0,ot,zt,wn,z0,Ls,Ud,Md,Us=Ne(()=>{Dt=Ie(require("node:stream"),1),dr=require("node:util"),ct=require("node:buffer");oo();Ps();Za();xs();Is();W0=(0,dr.promisify)(Dt.default.pipeline),ot=Symbol("Body internals"),zt=class{constructor(e,{size:t=0}={}){let n=null;e===null?e=null:eu(e)?e=ct.Buffer.from(e.toString()):io(e)||ct.Buffer.isBuffer(e)||(dr.types.isAnyArrayBuffer(e)?e=ct.Buffer.from(e):ArrayBuffer.isView(e)?e=ct.Buffer.from(e.buffer,e.byteOffset,e.byteLength):e instanceof Dt.default||(e instanceof kr?(e=wd(e),n=e.type.split("=")[1]):e=ct.Buffer.from(String(e))));let s=e;ct.Buffer.isBuffer(e)?s=Dt.default.Readable.from(e):io(e)&&(s=Dt.default.Readable.from(e.stream())),this[ot]={body:e,stream:s,boundary:n,disturbed:!1,error:null},this.size=t,e instanceof Dt.default&&e.on("error",a=>{let c=a instanceof fr?a:new Qe(`Invalid response body while trying to fetch ${this.url}: ${a.message}`,"system",a);this[ot].error=c})}get body(){return this[ot].stream}get bodyUsed(){return this[ot].disturbed}async arrayBuffer(){let{buffer:e,byteOffset:t,byteLength:n}=await ou(this);return e.slice(t,t+n)}async formData(){let e=this.headers.get("content-type");if(e.startsWith("application/x-www-form-urlencoded")){let n=new kr,s=new URLSearchParams(await this.text());for(let[a,c]of s)n.append(a,c);return n}let{toFormData:t}=await Promise.resolve().then(()=>(Ld(),jd));return t(this.body,e)}async blob(){let e=this.headers&&this.headers.get("content-type")||this[ot].body&&this[ot].body.type||"",t=await this.arrayBuffer();return new Bt([t],{type:e})}async json(){let e=await this.text();return JSON.parse(e)}async text(){let e=await ou(this);return new TextDecoder().decode(e)}buffer(){return ou(this)}};zt.prototype.buffer=(0,dr.deprecate)(zt.prototype.buffer,"Please use 'response.arrayBuffer()' instead of 'response.buffer()'","node-fetch#buffer");Object.defineProperties(zt.prototype,{body:{enumerable:!0},bodyUsed:{enumerable:!0},arrayBuffer:{enumerable:!0},blob:{enumerable:!0},json:{enumerable:!0},text:{enumerable:!0},data:{get:(0,dr.deprecate)(()=>{},"data doesn't exist, use json(), text(), arrayBuffer(), or body instead","https://github.com/node-fetch/node-fetch/issues/1000 (response)")}});wn=(r,e)=>{let t,n,{body:s}=r[ot];if(r.bodyUsed)throw new Error("cannot clone body after it is used");return s instanceof Dt.default&&typeof s.getBoundary!="function"&&(t=new Dt.PassThrough({highWaterMark:e}),n=new Dt.PassThrough({highWaterMark:e}),s.pipe(t),s.pipe(n),r[ot].stream=t,s=n),s},z0=(0,dr.deprecate)(r=>r.getBoundary(),"form-data doesn't follow the spec and requires special treatment. Use alternative package","https://github.com/node-fetch/node-fetch/issues/1167"),Ls=(r,e)=>r===null?null:typeof r=="string"?"text/plain;charset=UTF-8":eu(r)?"application/x-www-form-urlencoded;charset=UTF-8":io(r)?r.type||null:ct.Buffer.isBuffer(r)||dr.types.isAnyArrayBuffer(r)||ArrayBuffer.isView(r)?null:r instanceof kr?`multipart/form-data; boundary=${e[ot].boundary}`:r&&typeof r.getBoundary=="function"?`multipart/form-data;boundary=${z0(r)}`:r instanceof Dt.default?null:"text/plain;charset=UTF-8",Ud=r=>{let{body:e}=r[ot];return e===null?0:io(e)?e.size:ct.Buffer.isBuffer(e)?e.length:e&&typeof e.getLengthSync=="function"&&e.hasKnownLength&&e.hasKnownLength()?e.getLengthSync():null},Md=async(r,{body:e})=>{e===null?r.end():await W0(e,r)}});function $d(r=[]){return new st(r.reduce((e,t,n,s)=>(n%2===0&&e.push(s.slice(n,n+2)),e),[]).filter(([e,t])=>{try{return Ms(e),iu(e,String(t)),!0}catch{return!1}}))}var su,uo,Ms,iu,st,$s=Ne(()=>{su=require("node:util"),uo=Ie(require("node:http"),1),Ms=typeof uo.default.validateHeaderName=="function"?uo.default.validateHeaderName:r=>{if(!/^[\^`\-\w!#$%&'*+.|~]+$/.test(r)){let e=new TypeError(`Header name must be a valid HTTP token [${r}]`);throw Object.defineProperty(e,"code",{value:"ERR_INVALID_HTTP_TOKEN"}),e}},iu=typeof uo.default.validateHeaderValue=="function"?uo.default.validateHeaderValue:(r,e)=>{if(/[^\t\u0020-\u007E\u0080-\u00FF]/.test(e)){let t=new TypeError(`Invalid character in header content ["${r}"]`);throw Object.defineProperty(t,"code",{value:"ERR_INVALID_CHAR"}),t}},st=class r extends URLSearchParams{constructor(e){let t=[];if(e instanceof r){let n=e.raw();for(let[s,a]of Object.entries(n))t.push(...a.map(c=>[s,c]))}else if(e!=null)if(typeof e=="object"&&!su.types.isBoxedPrimitive(e)){let n=e[Symbol.iterator];if(n==null)t.push(...Object.entries(e));else{if(typeof n!="function")throw new TypeError("Header pairs must be iterable");t=[...e].map(s=>{if(typeof s!="object"||su.types.isBoxedPrimitive(s))throw new TypeError("Each header pair must be an iterable object");return[...s]}).map(s=>{if(s.length!==2)throw new TypeError("Each header pair must be a name/value tuple");return[...s]})}}else throw new TypeError("Failed to construct 'Headers': The provided value is not of type '(sequence<sequence<ByteString>> or record<ByteString, ByteString>)");return t=t.length>0?t.map(([n,s])=>(Ms(n),iu(n,String(s)),[String(n).toLowerCase(),String(s)])):void 0,super(t),new Proxy(this,{get(n,s,a){switch(s){case"append":case"set":return(c,f)=>(Ms(c),iu(c,String(f)),URLSearchParams.prototype[s].call(n,String(c).toLowerCase(),String(f)));case"delete":case"has":case"getAll":return c=>(Ms(c),URLSearchParams.prototype[s].call(n,String(c).toLowerCase()));case"keys":return()=>(n.sort(),new Set(URLSearchParams.prototype.keys.call(n)).keys());default:return Reflect.get(n,s,a)}}})}get[Symbol.toStringTag](){return this.constructor.name}toString(){return Object.prototype.toString.call(this)}get(e){let t=this.getAll(e);if(t.length===0)return null;let n=t.join(", ");return/^content-encoding$/i.test(e)&&(n=n.toLowerCase()),n}forEach(e,t=void 0){for(let n of this.keys())Reflect.apply(e,t,[this.get(n),n,this])}*values(){for(let e of this.keys())yield this.get(e)}*entries(){for(let e of this.keys())yield[e,this.get(e)]}[Symbol.iterator](){return this.entries()}raw(){return[...this.keys()].reduce((e,t)=>(e[t]=this.getAll(t),e),{})}[Symbol.for("nodejs.util.inspect.custom")](){return[...this.keys()].reduce((e,t)=>{let n=this.getAll(t);return t==="host"?e[t]=n[0]:e[t]=n.length>1?n:n[0],e},{})}};Object.defineProperties(st.prototype,["get","entries","forEach","values"].reduce((r,e)=>(r[e]={enumerable:!0},r),{}))});var J0,co,au=Ne(()=>{J0=new Set([301,302,303,307,308]),co=r=>J0.has(r)});var It,lt,Hd=Ne(()=>{$s();Us();au();It=Symbol("Response internals"),lt=class r extends zt{constructor(e=null,t={}){super(e,t);let n=t.status!=null?t.status:200,s=new st(t.headers);if(e!==null&&!s.has("Content-Type")){let a=Ls(e,this);a&&s.append("Content-Type",a)}this[It]={type:"default",url:t.url,status:n,statusText:t.statusText||"",headers:s,counter:t.counter,highWaterMark:t.highWaterMark}}get type(){return this[It].type}get url(){return this[It].url||""}get status(){return this[It].status}get ok(){return this[It].status>=200&&this[It].status<300}get redirected(){return this[It].counter>0}get statusText(){return this[It].statusText}get headers(){return this[It].headers}get highWaterMark(){return this[It].highWaterMark}clone(){return new r(wn(this,this.highWaterMark),{type:this.type,url:this.url,status:this.status,statusText:this.statusText,headers:this.headers,ok:this.ok,redirected:this.redirected,size:this.size,highWaterMark:this.highWaterMark})}static redirect(e,t=302){if(!co(t))throw new RangeError('Failed to execute "redirect" on "response": Invalid status code');return new r(null,{headers:{location:new URL(e).toString()},status:t})}static error(){let e=new r(null,{status:0,statusText:""});return e[It].type="error",e}static json(e=void 0,t={}){let n=JSON.stringify(e);if(n===void 0)throw new TypeError("data is not JSON serializable");let s=new st(t&&t.headers);return s.has("content-type")||s.set("content-type","application/json"),new r(n,{...t,headers:s})}get[Symbol.toStringTag](){return"Response"}};Object.defineProperties(lt.prototype,{type:{enumerable:!0},url:{enumerable:!0},status:{enumerable:!0},ok:{enumerable:!0},redirected:{enumerable:!0},statusText:{enumerable:!0},headers:{enumerable:!0},clone:{enumerable:!0}})});var Gd,Wd=Ne(()=>{Gd=r=>{if(r.search)return r.search;let e=r.href.length-1,t=r.hash||(r.href[e]==="#"?"#":"");return r.href[e-t.length]==="?"?"?":""}});function zd(r,e=!1){return r==null||(r=new URL(r),/^(about|blob|data):$/.test(r.protocol))?"no-referrer":(r.username="",r.password="",r.hash="",e&&(r.pathname="",r.search=""),r)}function Yd(r){if(!Vd.has(r))throw new TypeError(`Invalid referrerPolicy: ${r}`);return r}function V0(r){if(/^(http|ws)s:$/.test(r.protocol))return!0;let e=r.host.replace(/(^\[)|(]$)/g,""),t=(0,Jd.isIP)(e);return t===4&&/^127\./.test(e)||t===6&&/^(((0+:){7})|(::(0+:){0,6}))0*1$/.test(e)?!0:r.host==="localhost"||r.host.endsWith(".localhost")?!1:r.protocol==="file:"}function Dn(r){return/^about:(blank|srcdoc)$/.test(r)||r.protocol==="data:"||/^(blob|filesystem):$/.test(r.protocol)?!0:V0(r)}function Xd(r,{referrerURLCallback:e,referrerOriginCallback:t}={}){if(r.referrer==="no-referrer"||r.referrerPolicy==="")return null;let n=r.referrerPolicy;if(r.referrer==="about:client")return"no-referrer";let s=r.referrer,a=zd(s),c=zd(s,!0);a.toString().length>4096&&(a=c),e&&(a=e(a)),t&&(c=t(c));let f=new URL(r.url);switch(n){case"no-referrer":return"no-referrer";case"origin":return c;case"unsafe-url":return a;case"strict-origin":return Dn(a)&&!Dn(f)?"no-referrer":c.toString();case"strict-origin-when-cross-origin":return a.origin===f.origin?a:Dn(a)&&!Dn(f)?"no-referrer":c;case"same-origin":return a.origin===f.origin?a:"no-referrer";case"origin-when-cross-origin":return a.origin===f.origin?a:c;case"no-referrer-when-downgrade":return Dn(a)&&!Dn(f)?"no-referrer":a;default:throw new TypeError(`Invalid referrerPolicy: ${n}`)}}function Qd(r){let e=(r.get("referrer-policy")||"").split(/[,\s]+/),t="";for(let n of e)n&&Vd.has(n)&&(t=n);return t}var Jd,Vd,Kd,uu=Ne(()=>{Jd=require("node:net");Vd=new Set(["","no-referrer","no-referrer-when-downgrade","same-origin","origin","strict-origin","origin-when-cross-origin","strict-origin-when-cross-origin","unsafe-url"]),Kd="strict-origin-when-cross-origin"});var Zd,eh,Ue,lo,K0,Pr,th,rh=Ne(()=>{Zd=require("node:url"),eh=require("node:util");$s();Us();Is();Wd();uu();Ue=Symbol("Request internals"),lo=r=>typeof r=="object"&&typeof r[Ue]=="object",K0=(0,eh.deprecate)(()=>{},".data is not a valid RequestInit property, use .body instead","https://github.com/node-fetch/node-fetch/issues/1000 (request)"),Pr=class r extends zt{constructor(e,t={}){let n;if(lo(e)?n=new URL(e.url):(n=new URL(e),e={}),n.username!==""||n.password!=="")throw new TypeError(`${n} is an url with embedded credentials.`);let s=t.method||e.method||"GET";if(/^(delete|get|head|options|post|put)$/i.test(s)&&(s=s.toUpperCase()),!lo(t)&&"data"in t&&K0(),(t.body!=null||lo(e)&&e.body!==null)&&(s==="GET"||s==="HEAD"))throw new TypeError("Request with GET/HEAD method cannot have body");let a=t.body?t.body:lo(e)&&e.body!==null?wn(e):null;super(a,{size:t.size||e.size||0});let c=new st(t.headers||e.headers||{});if(a!==null&&!c.has("Content-Type")){let d=Ls(a,this);d&&c.set("Content-Type",d)}let f=lo(e)?e.signal:null;if("signal"in t&&(f=t.signal),f!=null&&!Dd(f))throw new TypeError("Expected signal to be an instanceof AbortSignal or EventTarget");let l=t.referrer==null?e.referrer:t.referrer;if(l==="")l="no-referrer";else if(l){let d=new URL(l);l=/^about:(\/\/)?client$/.test(d)?"client":d}else l=void 0;this[Ue]={method:s,redirect:t.redirect||e.redirect||"follow",headers:c,parsedURL:n,signal:f,referrer:l},this.follow=t.follow===void 0?e.follow===void 0?20:e.follow:t.follow,this.compress=t.compress===void 0?e.compress===void 0?!0:e.compress:t.compress,this.counter=t.counter||e.counter||0,this.agent=t.agent||e.agent,this.highWaterMark=t.highWaterMark||e.highWaterMark||16384,this.insecureHTTPParser=t.insecureHTTPParser||e.insecureHTTPParser||!1,this.referrerPolicy=t.referrerPolicy||e.referrerPolicy||""}get method(){return this[Ue].method}get url(){return(0,Zd.format)(this[Ue].parsedURL)}get headers(){return this[Ue].headers}get redirect(){return this[Ue].redirect}get signal(){return this[Ue].signal}get referrer(){if(this[Ue].referrer==="no-referrer")return"";if(this[Ue].referrer==="client")return"about:client";if(this[Ue].referrer)return this[Ue].referrer.toString()}get referrerPolicy(){return this[Ue].referrerPolicy}set referrerPolicy(e){this[Ue].referrerPolicy=Yd(e)}clone(){return new r(this)}get[Symbol.toStringTag](){return"Request"}};Object.defineProperties(Pr.prototype,{method:{enumerable:!0},url:{enumerable:!0},headers:{enumerable:!0},redirect:{enumerable:!0},clone:{enumerable:!0},signal:{enumerable:!0},referrer:{enumerable:!0},referrerPolicy:{enumerable:!0}});th=r=>{let{parsedURL:e}=r[Ue],t=new st(r[Ue].headers);t.has("Accept")||t.set("Accept","*/*");let n=null;if(r.body===null&&/^(post|put)$/i.test(r.method)&&(n="0"),r.body!==null){let f=Ud(r);typeof f=="number"&&!Number.isNaN(f)&&(n=String(f))}n&&t.set("Content-Length",n),r.referrerPolicy===""&&(r.referrerPolicy=Kd),r.referrer&&r.referrer!=="no-referrer"?r[Ue].referrer=Xd(r):r[Ue].referrer="no-referrer",r[Ue].referrer instanceof URL&&t.set("Referer",r.referrer),t.has("User-Agent")||t.set("User-Agent","node-fetch"),r.compress&&!t.has("Accept-Encoding")&&t.set("Accept-Encoding","gzip, deflate, br");let{agent:s}=r;typeof s=="function"&&(s=s(e));let a=Gd(e),c={path:e.pathname+a,method:r.method,headers:t[Symbol.for("nodejs.util.inspect.custom")](),insecureHTTPParser:r.insecureHTTPParser,agent:s};return{parsedURL:e,options:c}}});var fo,nh=Ne(()=>{xs();fo=class extends fr{constructor(e,t="aborted"){super(e,t)}}});var ih={};wa(ih,{AbortError:()=>fo,Blob:()=>Bt,FetchError:()=>Qe,File:()=>Fr,FormData:()=>kr,Headers:()=>st,Request:()=>Pr,Response:()=>lt,blobFrom:()=>Pd,blobFromSync:()=>Od,default:()=>cu,fileFrom:()=>xd,fileFromSync:()=>Bd,isRedirect:()=>co});async function cu(r,e){return new Promise((t,n)=>{let s=new Pr(r,e),{parsedURL:a,options:c}=th(s);if(!Y0.has(a.protocol))throw new TypeError(`node-fetch cannot load ${r}. URL scheme "${a.protocol.replace(/:$/,"")}" is not supported.`);if(a.protocol==="data:"){let S=pd(s.url),y=new lt(S,{headers:{"Content-Type":S.typeFull}});t(y);return}let f=(a.protocol==="https:"?sh.default:oh.default).request,{signal:l}=s,d=null,h=()=>{let S=new fo("The operation was aborted.");n(S),s.body&&s.body instanceof ft.default.Readable&&s.body.destroy(S),!(!d||!d.body)&&d.body.emit("error",S)};if(l&&l.aborted){h();return}let b=()=>{h(),O()},A=f(a.toString(),c);l&&l.addEventListener("abort",b);let O=()=>{A.abort(),l&&l.removeEventListener("abort",b)};A.on("error",S=>{n(new Qe(`request to ${s.url} failed, reason: ${S.message}`,"system",S)),O()}),X0(A,S=>{d&&d.body&&d.body.destroy(S)}),process.version<"v14"&&A.on("socket",S=>{let y;S.prependListener("end",()=>{y=S._eventsCount}),S.prependListener("close",C=>{if(d&&y<S._eventsCount&&!C){let _=new Error("Premature close");_.code="ERR_STREAM_PREMATURE_CLOSE",d.body.emit("error",_)}})}),A.on("response",S=>{A.setTimeout(0);let y=$d(S.rawHeaders);if(co(S.statusCode)){let U=y.get("Location"),B=null;try{B=U===null?null:new URL(U,s.url)}catch{if(s.redirect!=="manual"){n(new Qe(`uri requested responds with an invalid redirect URL: ${U}`,"invalid-redirect")),O();return}}switch(s.redirect){case"error":n(new Qe(`uri requested responds with a redirect, redirect mode is set to error: ${s.url}`,"no-redirect")),O();return;case"manual":break;case"follow":{if(B===null)break;if(s.counter>=s.follow){n(new Qe(`maximum redirect reached at: ${s.url}`,"max-redirect")),O();return}let j={headers:new st(s.headers),follow:s.follow,counter:s.counter+1,agent:s.agent,compress:s.compress,method:s.method,body:wn(s),signal:s.signal,size:s.size,referrer:s.referrer,referrerPolicy:s.referrerPolicy};if(!Sd(s.url,B)||!vd(s.url,B))for(let Z of["authorization","www-authenticate","cookie","cookie2"])j.headers.delete(Z);if(S.statusCode!==303&&s.body&&e.body instanceof ft.default.Readable){n(new Qe("Cannot follow redirect with body being a readable stream","unsupported-redirect")),O();return}(S.statusCode===303||(S.statusCode===301||S.statusCode===302)&&s.method==="POST")&&(j.method="GET",j.body=void 0,j.headers.delete("content-length"));let H=Qd(y);H&&(j.referrerPolicy=H),t(cu(new Pr(B,j))),O();return}default:return n(new TypeError(`Redirect option '${s.redirect}' is not a valid value of RequestRedirect`))}}l&&S.once("end",()=>{l.removeEventListener("abort",b)});let C=(0,ft.pipeline)(S,new ft.PassThrough,U=>{U&&n(U)});process.version<"v12.10"&&S.on("aborted",b);let _={url:s.url,status:S.statusCode,statusText:S.statusMessage,headers:y,size:s.size,counter:s.counter,highWaterMark:s.highWaterMark},F=y.get("Content-Encoding");if(!s.compress||s.method==="HEAD"||F===null||S.statusCode===204||S.statusCode===304){d=new lt(C,_),t(d);return}let k={flush:Yr.default.Z_SYNC_FLUSH,finishFlush:Yr.default.Z_SYNC_FLUSH};if(F==="gzip"||F==="x-gzip"){C=(0,ft.pipeline)(C,Yr.default.createGunzip(k),U=>{U&&n(U)}),d=new lt(C,_),t(d);return}if(F==="deflate"||F==="x-deflate"){let U=(0,ft.pipeline)(S,new ft.PassThrough,B=>{B&&n(B)});U.once("data",B=>{(B[0]&15)===8?C=(0,ft.pipeline)(C,Yr.default.createInflate(),j=>{j&&n(j)}):C=(0,ft.pipeline)(C,Yr.default.createInflateRaw(),j=>{j&&n(j)}),d=new lt(C,_),t(d)}),U.once("end",()=>{d||(d=new lt(C,_),t(d))});return}if(F==="br"){C=(0,ft.pipeline)(C,Yr.default.createBrotliDecompress(),U=>{U&&n(U)}),d=new lt(C,_),t(d);return}d=new lt(C,_),t(d)}),Md(A,s).catch(n)})}function X0(r,e){let t=ho.Buffer.from(`0\r
\r
`),n=!1,s=!1,a;r.on("response",c=>{let{headers:f}=c;n=f["transfer-encoding"]==="chunked"&&!f["content-length"]}),r.on("socket",c=>{let f=()=>{if(n&&!s){let d=new Error("Premature close");d.code="ERR_STREAM_PREMATURE_CLOSE",e(d)}},l=d=>{s=ho.Buffer.compare(d.slice(-5),t)===0,!s&&a&&(s=ho.Buffer.compare(a.slice(-3),t.slice(0,3))===0&&ho.Buffer.compare(d.slice(-2),t.slice(3))===0),a=d};c.prependListener("close",f),c.on("data",l),r.on("close",()=>{c.removeListener("close",f),c.removeListener("data",l)})})}var oh,sh,Yr,ft,ho,Y0,ah=Ne(()=>{oh=Ie(require("node:http"),1),sh=Ie(require("node:https"),1),Yr=Ie(require("node:zlib"),1),ft=Ie(require("node:stream"),1),ho=require("node:buffer");md();Us();Hd();$s();rh();Za();nh();au();Ps();Is();uu();ru();Y0=new Set(["data:","http:","https:"])});var lh=W(vn=>{"use strict";var Q0=vn&&vn.__importDefault||function(r){return r&&r.__esModule?r:{default:r}},Sn;Object.defineProperty(vn,"__esModule",{value:!0});vn.Gaxios=void 0;var Z0=Q0(qa()),e_=require("https"),Xr=Ua(),t_=$f(),uh=require("stream"),ch=Ha(),r_=async()=>globalThis.crypto?.randomUUID()||(await import("crypto")).randomUUID(),Hs=class{agentCache=new Map;defaults;interceptors;constructor(e){this.defaults=e||{},this.interceptors={request:new ch.GaxiosInterceptorManager,response:new ch.GaxiosInterceptorManager}}fetch(...e){let t=e[0],n=e[1],s,a=new Headers;return typeof t=="string"?s=new URL(t):t instanceof URL?s=t:t&&t.url&&(s=new URL(t.url)),t&&typeof t=="object"&&"headers"in t&&Sn.mergeHeaders(a,t.headers),n&&Sn.mergeHeaders(a,new Headers(n.headers)),typeof t=="object"&&!(t instanceof URL)?this.request({...n,...t,headers:a,url:s}):this.request({...n,headers:a,url:s})}async request(e={}){let t=await this.#n(e);return t=await this.#t(t),this.#r(this._request(t))}async _defaultAdapter(e){let t=e.fetchImplementation||this.defaults.fetchImplementation||await Sn.#u(),n={...e};delete n.data;let s=await t(e.url,n),a=await this.getResponseData(e,s);return Object.getOwnPropertyDescriptor(s,"data")?.configurable||Object.defineProperties(s,{data:{configurable:!0,writable:!0,enumerable:!0,value:a}}),Object.assign(s,{config:e,data:a})}async _request(e){try{let t;if(e.adapter?t=await e.adapter(e,this._defaultAdapter.bind(this)):t=await this._defaultAdapter(e),!e.validateStatus(t.status)){if(e.responseType==="stream"){let s=[];for await(let a of e.data??[])s.push(a);t.data=s}let n=Xr.GaxiosError.extractAPIErrorFromResponse(t,`Request failed with status code ${t.status}`);throw new Xr.GaxiosError(n?.message,e,t,n)}return t}catch(t){let n;t instanceof Xr.GaxiosError?n=t:t instanceof Error?n=new Xr.GaxiosError(t.message,e,void 0,t):n=new Xr.GaxiosError("Unexpected Gaxios Error",e,void 0,t);let{shouldRetry:s,config:a}=await(0,t_.getRetryConfig)(n);if(s&&a)return n.config.retryConfig.currentRetryAttempt=a.retryConfig.currentRetryAttempt,e.retryConfig=n.config?.retryConfig,this.#o(e),this._request(e);throw e.errorRedactor&&e.errorRedactor(n),n}}async getResponseData(e,t){if(e.maxContentLength&&t.headers.has("content-length")&&e.maxContentLength<Number.parseInt(t.headers?.get("content-length")||""))throw new Xr.GaxiosError("Response's `Content-Length` is over the limit.",e,Object.assign(t,{config:e}));switch(e.responseType){case"stream":return t.body;case"json":return t.json();case"arraybuffer":return t.arrayBuffer();case"blob":return t.blob();case"text":return t.text();default:return this.getResponseDataFromContentType(t)}}#e(e,t=[]){let n=new URL(e),s=[...t],a=(process.env.NO_PROXY??process.env.no_proxy)?.split(",")||[];for(let c of a)s.push(c.trim());for(let c of s)if(c instanceof RegExp){if(c.test(n.toString()))return!1}else if(c instanceof URL){if(c.origin===n.origin)return!1}else if(c.startsWith("*.")||c.startsWith(".")){let f=c.replace(/^\*\./,".");if(n.hostname.endsWith(f))return!1}else if(c===n.origin||c===n.hostname||c===n.href)return!1;return!0}async#t(e){let t=Promise.resolve(e);for(let n of this.interceptors.request.values())n&&(t=t.then(n.resolved,n.rejected));return t}async#r(e){let t=Promise.resolve(e);for(let n of this.interceptors.response.values())n&&(t=t.then(n.resolved,n.rejected));return t}async#n(e){let t=new Headers(this.defaults.headers);Sn.mergeHeaders(t,e.headers);let n=(0,Z0.default)(!0,{},this.defaults,e);if(!n.url)throw new Error("URL is required.");if(n.baseURL&&(n.url=new URL(n.url,n.baseURL)),n.url=new URL(n.url),n.params)if(n.paramsSerializer){let c=n.paramsSerializer(n.params);c.startsWith("?")&&(c=c.slice(1));let f=n.url.toString().includes("?")?"&":"?";n.url=n.url+f+c}else{let c=n.url instanceof URL?n.url:new URL(n.url);for(let[f,l]of new URLSearchParams(n.params))c.searchParams.append(f,l);n.url=c}typeof e.maxContentLength=="number"&&(n.size=e.maxContentLength),typeof e.maxRedirects=="number"&&(n.follow=e.maxRedirects);let s=typeof n.data=="string"||n.data instanceof ArrayBuffer||n.data instanceof Blob||globalThis.File&&n.data instanceof File||n.data instanceof FormData||n.data instanceof uh.Readable||n.data instanceof ReadableStream||n.data instanceof String||n.data instanceof URLSearchParams||ArrayBuffer.isView(n.data)||["Blob","File","FormData"].includes(n.data?.constructor?.name||"");if(n.multipart?.length){let c=await r_();t.set("content-type",`multipart/related; boundary=${c}`),n.body=uh.Readable.from(this.getMultipartRequest(n.multipart,c))}else s?n.body=n.data:typeof n.data=="object"?t.get("Content-Type")==="application/x-www-form-urlencoded"?n.body=n.paramsSerializer?n.paramsSerializer(n.data):new URLSearchParams(n.data):(t.has("content-type")||t.set("content-type","application/json"),n.body=JSON.stringify(n.data)):n.data&&(n.body=n.data);n.validateStatus=n.validateStatus||this.validateStatus,n.responseType=n.responseType||"unknown",!t.has("accept")&&n.responseType==="json"&&t.set("accept","application/json");let a=n.proxy||process?.env?.HTTPS_PROXY||process?.env?.https_proxy||process?.env?.HTTP_PROXY||process?.env?.http_proxy;if(!n.agent)if(a&&this.#e(n.url,n.noProxy)){let c=await Sn.#a();this.agentCache.has(a)?n.agent=this.agentCache.get(a):(n.agent=new c(a,{cert:n.cert,key:n.key}),this.agentCache.set(a,n.agent))}else n.cert&&n.key&&(this.agentCache.has(n.key)?n.agent=this.agentCache.get(n.key):(n.agent=new e_.Agent({cert:n.cert,key:n.key}),this.agentCache.set(n.key,n.agent)));return typeof n.errorRedactor!="function"&&n.errorRedactor!==!1&&(n.errorRedactor=Xr.defaultErrorRedactor),n.body&&!("duplex"in n)&&(n.duplex="half"),this.#o(n),Object.assign(n,{headers:t,url:n.url instanceof URL?n.url:new URL(n.url)})}#o(e){if(e.timeout){let t=AbortSignal.timeout(e.timeout);e.signal&&!e.signal.aborted?e.signal=AbortSignal.any([e.signal,t]):e.signal=t}}validateStatus(e){return e>=200&&e<300}async getResponseDataFromContentType(e){let t=e.headers.get("Content-Type");if(t===null)return e.text();if(t=t.toLowerCase(),t.includes("application/json")){let n=await e.text();try{n=JSON.parse(n)}catch{}return n}else return t.match(/^text\//)?e.text():e.blob()}async*getMultipartRequest(e,t){let n=`--${t}--`;for(let s of e){let a=s.headers.get("Content-Type")||"application/octet-stream";yield`--${t}\r
Content-Type: ${a}\r
\r
`,typeof s.content=="string"?yield s.content:yield*s.content,yield`\r
`}yield n}static#s;static#i;static async#a(){return this.#s||=(await Promise.resolve().then(()=>Ie(hd()))).HttpsProxyAgent,this.#s}static async#u(){let e=typeof window<"u"&&!!window;return this.#i||=e?window.fetch:(await Promise.resolve().then(()=>(ah(),ih))).default,this.#i}static mergeHeaders(e,...t){e=e instanceof Headers?e:new Headers(e);for(let n of t)(n instanceof Headers?n:new Headers(n)).forEach((a,c)=>{c==="set-cookie"?e.append(c,a):e.set(c,a)});return e}};vn.Gaxios=Hs;Sn=Hs});var $e=W(Ze=>{"use strict";var n_=Ze&&Ze.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t);var s=Object.getOwnPropertyDescriptor(e,t);(!s||("get"in s?!e.__esModule:s.writable||s.configurable))&&(s={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(r,n,s)}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),o_=Ze&&Ze.__exportStar||function(r,e){for(var t in r)t!=="default"&&!Object.prototype.hasOwnProperty.call(e,t)&&n_(e,r,t)};Object.defineProperty(Ze,"__esModule",{value:!0});Ze.instance=Ze.Gaxios=Ze.GaxiosError=void 0;Ze.request=i_;var fh=lh();Object.defineProperty(Ze,"Gaxios",{enumerable:!0,get:function(){return fh.Gaxios}});var s_=Ua();Object.defineProperty(Ze,"GaxiosError",{enumerable:!0,get:function(){return s_.GaxiosError}});o_(Ha(),Ze);Ze.instance=new fh.Gaxios;async function i_(r){return Ze.instance.request(r)}});var lu=W((dh,Gs)=>{(function(r){"use strict";var e,t=/^-?(?:\d+(?:\.\d*)?|\.\d+)(?:e[+-]?\d+)?$/i,n=Math.ceil,s=Math.floor,a="[BigNumber Error] ",c=a+"Number primitive has more than 15 significant digits: ",f=1e14,l=14,d=9007199254740991,h=[1,10,100,1e3,1e4,1e5,1e6,1e7,1e8,1e9,1e10,1e11,1e12,1e13],b=1e7,A=1e9;function O(B){var j,H,Z,z=G.prototype={constructor:G,toString:null,valueOf:null},_e=new G(1),de=20,re=4,se=-7,Q=21,ie=-1e7,le=1e7,De=!1,Se=1,Fe=0,Ct={prefix:"",groupSize:3,secondaryGroupSize:0,groupSeparator:",",decimalSeparator:".",fractionGroupSize:0,fractionGroupSeparator:"\xA0",suffix:""},He="0123456789abcdefghijklmnopqrstuvwxyz",er=!0;function G(p,g){var E,x,v,R,q,D,T,I,P=this;if(!(P instanceof G))return new G(p,g);if(g==null){if(p&&p._isBigNumber===!0){P.s=p.s,!p.c||p.e>le?P.c=P.e=null:p.e<ie?P.c=[P.e=0]:(P.e=p.e,P.c=p.c.slice());return}if((D=typeof p=="number")&&p*0==0){if(P.s=1/p<0?(p=-p,-1):1,p===~~p){for(R=0,q=p;q>=10;q/=10,R++);R>le?P.c=P.e=null:(P.e=R,P.c=[p]);return}I=String(p)}else{if(!t.test(I=String(p)))return Z(P,I,D);P.s=I.charCodeAt(0)==45?(I=I.slice(1),-1):1}(R=I.indexOf("."))>-1&&(I=I.replace(".","")),(q=I.search(/e/i))>0?(R<0&&(R=q),R+=+I.slice(q+1),I=I.substring(0,q)):R<0&&(R=I.length)}else{if(_(g,2,He.length,"Base"),g==10&&er)return P=new G(p),Ke(P,de+P.e+1,re);if(I=String(p),D=typeof p=="number"){if(p*0!=0)return Z(P,I,D,g);if(P.s=1/p<0?(I=I.slice(1),-1):1,G.DEBUG&&I.replace(/^0\.0*|\./,"").length>15)throw Error(c+p)}else P.s=I.charCodeAt(0)===45?(I=I.slice(1),-1):1;for(E=He.slice(0,g),R=q=0,T=I.length;q<T;q++)if(E.indexOf(x=I.charAt(q))<0){if(x=="."){if(q>R){R=T;continue}}else if(!v&&(I==I.toUpperCase()&&(I=I.toLowerCase())||I==I.toLowerCase()&&(I=I.toUpperCase()))){v=!0,q=-1,R=0;continue}return Z(P,String(p),D,g)}D=!1,I=H(I,g,10,P.s),(R=I.indexOf("."))>-1?I=I.replace(".",""):R=I.length}for(q=0;I.charCodeAt(q)===48;q++);for(T=I.length;I.charCodeAt(--T)===48;);if(I=I.slice(q,++T)){if(T-=q,D&&G.DEBUG&&T>15&&(p>d||p!==s(p)))throw Error(c+P.s*p);if((R=R-q-1)>le)P.c=P.e=null;else if(R<ie)P.c=[P.e=0];else{if(P.e=R,P.c=[],q=(R+1)%l,R<0&&(q+=l),q<T){for(q&&P.c.push(+I.slice(0,q)),T-=l;q<T;)P.c.push(+I.slice(q,q+=l));q=l-(I=I.slice(q)).length}else q-=T;for(;q--;I+="0");P.c.push(+I)}}else P.c=[P.e=0]}G.clone=O,G.ROUND_UP=0,G.ROUND_DOWN=1,G.ROUND_CEIL=2,G.ROUND_FLOOR=3,G.ROUND_HALF_UP=4,G.ROUND_HALF_DOWN=5,G.ROUND_HALF_EVEN=6,G.ROUND_HALF_CEIL=7,G.ROUND_HALF_FLOOR=8,G.EUCLID=9,G.config=G.set=function(p){var g,E;if(p!=null)if(typeof p=="object"){if(p.hasOwnProperty(g="DECIMAL_PLACES")&&(E=p[g],_(E,0,A,g),de=E),p.hasOwnProperty(g="ROUNDING_MODE")&&(E=p[g],_(E,0,8,g),re=E),p.hasOwnProperty(g="EXPONENTIAL_AT")&&(E=p[g],E&&E.pop?(_(E[0],-A,0,g),_(E[1],0,A,g),se=E[0],Q=E[1]):(_(E,-A,A,g),se=-(Q=E<0?-E:E))),p.hasOwnProperty(g="RANGE"))if(E=p[g],E&&E.pop)_(E[0],-A,-1,g),_(E[1],1,A,g),ie=E[0],le=E[1];else if(_(E,-A,A,g),E)ie=-(le=E<0?-E:E);else throw Error(a+g+" cannot be zero: "+E);if(p.hasOwnProperty(g="CRYPTO"))if(E=p[g],E===!!E)if(E)if(typeof crypto<"u"&&crypto&&(crypto.getRandomValues||crypto.randomBytes))De=E;else throw De=!E,Error(a+"crypto unavailable");else De=E;else throw Error(a+g+" not true or false: "+E);if(p.hasOwnProperty(g="MODULO_MODE")&&(E=p[g],_(E,0,9,g),Se=E),p.hasOwnProperty(g="POW_PRECISION")&&(E=p[g],_(E,0,A,g),Fe=E),p.hasOwnProperty(g="FORMAT"))if(E=p[g],typeof E=="object")Ct=E;else throw Error(a+g+" not an object: "+E);if(p.hasOwnProperty(g="ALPHABET"))if(E=p[g],typeof E=="string"&&!/^.?$|[+\-.\s]|(.).*\1/.test(E))er=E.slice(0,10)=="0123456789",He=E;else throw Error(a+g+" invalid: "+E)}else throw Error(a+"Object expected: "+p);return{DECIMAL_PLACES:de,ROUNDING_MODE:re,EXPONENTIAL_AT:[se,Q],RANGE:[ie,le],CRYPTO:De,MODULO_MODE:Se,POW_PRECISION:Fe,FORMAT:Ct,ALPHABET:He}},G.isBigNumber=function(p){if(!p||p._isBigNumber!==!0)return!1;if(!G.DEBUG)return!0;var g,E,x=p.c,v=p.e,R=p.s;e:if({}.toString.call(x)=="[object Array]"){if((R===1||R===-1)&&v>=-A&&v<=A&&v===s(v)){if(x[0]===0){if(v===0&&x.length===1)return!0;break e}if(g=(v+1)%l,g<1&&(g+=l),String(x[0]).length==g){for(g=0;g<x.length;g++)if(E=x[g],E<0||E>=f||E!==s(E))break e;if(E!==0)return!0}}}else if(x===null&&v===null&&(R===null||R===1||R===-1))return!0;throw Error(a+"Invalid BigNumber: "+p)},G.maximum=G.max=function(){return Ve(arguments,-1)},G.minimum=G.min=function(){return Ve(arguments,1)},G.random=function(){var p=9007199254740992,g=Math.random()*p&2097151?function(){return s(Math.random()*p)}:function(){return(Math.random()*1073741824|0)*8388608+(Math.random()*8388608|0)};return function(E){var x,v,R,q,D,T=0,I=[],P=new G(_e);if(E==null?E=de:_(E,0,A),q=n(E/l),De)if(crypto.getRandomValues){for(x=crypto.getRandomValues(new Uint32Array(q*=2));T<q;)D=x[T]*131072+(x[T+1]>>>11),D>=9e15?(v=crypto.getRandomValues(new Uint32Array(2)),x[T]=v[0],x[T+1]=v[1]):(I.push(D%1e14),T+=2);T=q/2}else if(crypto.randomBytes){for(x=crypto.randomBytes(q*=7);T<q;)D=(x[T]&31)*281474976710656+x[T+1]*1099511627776+x[T+2]*4294967296+x[T+3]*16777216+(x[T+4]<<16)+(x[T+5]<<8)+x[T+6],D>=9e15?crypto.randomBytes(7).copy(x,T):(I.push(D%1e14),T+=7);T=q/7}else throw De=!1,Error(a+"crypto unavailable");if(!De)for(;T<q;)D=g(),D<9e15&&(I[T++]=D%1e14);for(q=I[--T],E%=l,q&&E&&(D=h[l-E],I[T]=s(q/D)*D);I[T]===0;I.pop(),T--);if(T<0)I=[R=0];else{for(R=-1;I[0]===0;I.splice(0,1),R-=l);for(T=1,D=I[0];D>=10;D/=10,T++);T<l&&(R-=l-T)}return P.e=R,P.c=I,P}}(),G.sum=function(){for(var p=1,g=arguments,E=new G(g[0]);p<g.length;)E=E.plus(g[p++]);return E},H=function(){var p="0123456789";function g(E,x,v,R){for(var q,D=[0],T,I=0,P=E.length;I<P;){for(T=D.length;T--;D[T]*=x);for(D[0]+=R.indexOf(E.charAt(I++)),q=0;q<D.length;q++)D[q]>v-1&&(D[q+1]==null&&(D[q+1]=0),D[q+1]+=D[q]/v|0,D[q]%=v)}return D.reverse()}return function(E,x,v,R,q){var D,T,I,P,M,V,K,ge,ve=E.indexOf("."),ke=de,me=re;for(ve>=0&&(P=Fe,Fe=0,E=E.replace(".",""),ge=new G(x),V=ge.pow(E.length-ve),Fe=P,ge.c=g(U(y(V.c),V.e,"0"),10,v,p),ge.e=ge.c.length),K=g(E,x,v,q?(D=He,p):(D=p,He)),I=P=K.length;K[--P]==0;K.pop());if(!K[0])return D.charAt(0);if(ve<0?--I:(V.c=K,V.e=I,V.s=R,V=j(V,ge,ke,me,v),K=V.c,M=V.r,I=V.e),T=I+ke+1,ve=K[T],P=v/2,M=M||T<0||K[T+1]!=null,M=me<4?(ve!=null||M)&&(me==0||me==(V.s<0?3:2)):ve>P||ve==P&&(me==4||M||me==6&&K[T-1]&1||me==(V.s<0?8:7)),T<1||!K[0])E=M?U(D.charAt(1),-ke,D.charAt(0)):D.charAt(0);else{if(K.length=T,M)for(--v;++K[--T]>v;)K[T]=0,T||(++I,K=[1].concat(K));for(P=K.length;!K[--P];);for(ve=0,E="";ve<=P;E+=D.charAt(K[ve++]));E=U(E,I,D.charAt(0))}return E}}(),j=function(){function p(x,v,R){var q,D,T,I,P=0,M=x.length,V=v%b,K=v/b|0;for(x=x.slice();M--;)T=x[M]%b,I=x[M]/b|0,q=K*T+I*V,D=V*T+q%b*b+P,P=(D/R|0)+(q/b|0)+K*I,x[M]=D%R;return P&&(x=[P].concat(x)),x}function g(x,v,R,q){var D,T;if(R!=q)T=R>q?1:-1;else for(D=T=0;D<R;D++)if(x[D]!=v[D]){T=x[D]>v[D]?1:-1;break}return T}function E(x,v,R,q){for(var D=0;R--;)x[R]-=D,D=x[R]<v[R]?1:0,x[R]=D*q+x[R]-v[R];for(;!x[0]&&x.length>1;x.splice(0,1));}return function(x,v,R,q,D){var T,I,P,M,V,K,ge,ve,ke,me,ye,xe,nn,on,sn,it,tr,Ge=x.s==v.s?1:-1,Be=x.c,Ce=v.c;if(!Be||!Be[0]||!Ce||!Ce[0])return new G(!x.s||!v.s||(Be?Ce&&Be[0]==Ce[0]:!Ce)?NaN:Be&&Be[0]==0||!Ce?Ge*0:Ge/0);for(ve=new G(Ge),ke=ve.c=[],I=x.e-v.e,Ge=R+I+1,D||(D=f,I=S(x.e/l)-S(v.e/l),Ge=Ge/l|0),P=0;Ce[P]==(Be[P]||0);P++);if(Ce[P]>(Be[P]||0)&&I--,Ge<0)ke.push(1),M=!0;else{for(on=Be.length,it=Ce.length,P=0,Ge+=2,V=s(D/(Ce[0]+1)),V>1&&(Ce=p(Ce,V,D),Be=p(Be,V,D),it=Ce.length,on=Be.length),nn=it,me=Be.slice(0,it),ye=me.length;ye<it;me[ye++]=0);tr=Ce.slice(),tr=[0].concat(tr),sn=Ce[0],Ce[1]>=D/2&&sn++;do{if(V=0,T=g(Ce,me,it,ye),T<0){if(xe=me[0],it!=ye&&(xe=xe*D+(me[1]||0)),V=s(xe/sn),V>1)for(V>=D&&(V=D-1),K=p(Ce,V,D),ge=K.length,ye=me.length;g(K,me,ge,ye)==1;)V--,E(K,it<ge?tr:Ce,ge,D),ge=K.length,T=1;else V==0&&(T=V=1),K=Ce.slice(),ge=K.length;if(ge<ye&&(K=[0].concat(K)),E(me,K,ye,D),ye=me.length,T==-1)for(;g(Ce,me,it,ye)<1;)V++,E(me,it<ye?tr:Ce,ye,D),ye=me.length}else T===0&&(V++,me=[0]);ke[P++]=V,me[0]?me[ye++]=Be[nn]||0:(me=[Be[nn]],ye=1)}while((nn++<on||me[0]!=null)&&Ge--);M=me[0]!=null,ke[0]||ke.splice(0,1)}if(D==f){for(P=1,Ge=ke[0];Ge>=10;Ge/=10,P++);Ke(ve,R+(ve.e=P+I*l-1)+1,q,M)}else ve.e=I,ve.r=+M;return ve}}();function et(p,g,E,x){var v,R,q,D,T;if(E==null?E=re:_(E,0,8),!p.c)return p.toString();if(v=p.c[0],q=p.e,g==null)T=y(p.c),T=x==1||x==2&&(q<=se||q>=Q)?k(T,q):U(T,q,"0");else if(p=Ke(new G(p),g,E),R=p.e,T=y(p.c),D=T.length,x==1||x==2&&(g<=R||R<=se)){for(;D<g;T+="0",D++);T=k(T,R)}else if(g-=q+(x===2&&R>q),T=U(T,R,"0"),R+1>D){if(--g>0)for(T+=".";g--;T+="0");}else if(g+=R-D,g>0)for(R+1==D&&(T+=".");g--;T+="0");return p.s<0&&v?"-"+T:T}function Ve(p,g){for(var E,x,v=1,R=new G(p[0]);v<p.length;v++)x=new G(p[v]),(!x.s||(E=C(R,x))===g||E===0&&R.s===g)&&(R=x);return R}function Wn(p,g,E){for(var x=1,v=g.length;!g[--v];g.pop());for(v=g[0];v>=10;v/=10,x++);return(E=x+E*l-1)>le?p.c=p.e=null:E<ie?p.c=[p.e=0]:(p.e=E,p.c=g),p}Z=function(){var p=/^(-?)0([xbo])(?=\w[\w.]*$)/i,g=/^([^.]+)\.$/,E=/^\.([^.]+)$/,x=/^-?(Infinity|NaN)$/,v=/^\s*\+(?=[\w.])|^\s+|\s+$/g;return function(R,q,D,T){var I,P=D?q:q.replace(v,"");if(x.test(P))R.s=isNaN(P)?null:P<0?-1:1;else{if(!D&&(P=P.replace(p,function(M,V,K){return I=(K=K.toLowerCase())=="x"?16:K=="b"?2:8,!T||T==I?V:M}),T&&(I=T,P=P.replace(g,"$1").replace(E,"0.$1")),q!=P))return new G(P,I);if(G.DEBUG)throw Error(a+"Not a"+(T?" base "+T:"")+" number: "+q);R.s=null}R.c=R.e=null}}();function Ke(p,g,E,x){var v,R,q,D,T,I,P,M=p.c,V=h;if(M){e:{for(v=1,D=M[0];D>=10;D/=10,v++);if(R=g-v,R<0)R+=l,q=g,T=M[I=0],P=s(T/V[v-q-1]%10);else if(I=n((R+1)/l),I>=M.length)if(x){for(;M.length<=I;M.push(0));T=P=0,v=1,R%=l,q=R-l+1}else break e;else{for(T=D=M[I],v=1;D>=10;D/=10,v++);R%=l,q=R-l+v,P=q<0?0:s(T/V[v-q-1]%10)}if(x=x||g<0||M[I+1]!=null||(q<0?T:T%V[v-q-1]),x=E<4?(P||x)&&(E==0||E==(p.s<0?3:2)):P>5||P==5&&(E==4||x||E==6&&(R>0?q>0?T/V[v-q]:0:M[I-1])%10&1||E==(p.s<0?8:7)),g<1||!M[0])return M.length=0,x?(g-=p.e+1,M[0]=V[(l-g%l)%l],p.e=-g||0):M[0]=p.e=0,p;if(R==0?(M.length=I,D=1,I--):(M.length=I+1,D=V[l-R],M[I]=q>0?s(T/V[v-q]%V[q])*D:0),x)for(;;)if(I==0){for(R=1,q=M[0];q>=10;q/=10,R++);for(q=M[0]+=D,D=1;q>=10;q/=10,D++);R!=D&&(p.e++,M[0]==f&&(M[0]=1));break}else{if(M[I]+=D,M[I]!=f)break;M[I--]=0,D=1}for(R=M.length;M[--R]===0;M.pop());}p.e>le?p.c=p.e=null:p.e<ie&&(p.c=[p.e=0])}return p}function Pe(p){var g,E=p.e;return E===null?p.toString():(g=y(p.c),g=E<=se||E>=Q?k(g,E):U(g,E,"0"),p.s<0?"-"+g:g)}return z.absoluteValue=z.abs=function(){var p=new G(this);return p.s<0&&(p.s=1),p},z.comparedTo=function(p,g){return C(this,new G(p,g))},z.decimalPlaces=z.dp=function(p,g){var E,x,v,R=this;if(p!=null)return _(p,0,A),g==null?g=re:_(g,0,8),Ke(new G(R),p+R.e+1,g);if(!(E=R.c))return null;if(x=((v=E.length-1)-S(this.e/l))*l,v=E[v])for(;v%10==0;v/=10,x--);return x<0&&(x=0),x},z.dividedBy=z.div=function(p,g){return j(this,new G(p,g),de,re)},z.dividedToIntegerBy=z.idiv=function(p,g){return j(this,new G(p,g),0,1)},z.exponentiatedBy=z.pow=function(p,g){var E,x,v,R,q,D,T,I,P,M=this;if(p=new G(p),p.c&&!p.isInteger())throw Error(a+"Exponent not an integer: "+Pe(p));if(g!=null&&(g=new G(g)),D=p.e>14,!M.c||!M.c[0]||M.c[0]==1&&!M.e&&M.c.length==1||!p.c||!p.c[0])return P=new G(Math.pow(+Pe(M),D?p.s*(2-F(p)):+Pe(p))),g?P.mod(g):P;if(T=p.s<0,g){if(g.c?!g.c[0]:!g.s)return new G(NaN);x=!T&&M.isInteger()&&g.isInteger(),x&&(M=M.mod(g))}else{if(p.e>9&&(M.e>0||M.e<-1||(M.e==0?M.c[0]>1||D&&M.c[1]>=24e7:M.c[0]<8e13||D&&M.c[0]<=9999975e7)))return R=M.s<0&&F(p)?-0:0,M.e>-1&&(R=1/R),new G(T?1/R:R);Fe&&(R=n(Fe/l+2))}for(D?(E=new G(.5),T&&(p.s=1),I=F(p)):(v=Math.abs(+Pe(p)),I=v%2),P=new G(_e);;){if(I){if(P=P.times(M),!P.c)break;R?P.c.length>R&&(P.c.length=R):x&&(P=P.mod(g))}if(v){if(v=s(v/2),v===0)break;I=v%2}else if(p=p.times(E),Ke(p,p.e+1,1),p.e>14)I=F(p);else{if(v=+Pe(p),v===0)break;I=v%2}M=M.times(M),R?M.c&&M.c.length>R&&(M.c.length=R):x&&(M=M.mod(g))}return x?P:(T&&(P=_e.div(P)),g?P.mod(g):R?Ke(P,Fe,re,q):P)},z.integerValue=function(p){var g=new G(this);return p==null?p=re:_(p,0,8),Ke(g,g.e+1,p)},z.isEqualTo=z.eq=function(p,g){return C(this,new G(p,g))===0},z.isFinite=function(){return!!this.c},z.isGreaterThan=z.gt=function(p,g){return C(this,new G(p,g))>0},z.isGreaterThanOrEqualTo=z.gte=function(p,g){return(g=C(this,new G(p,g)))===1||g===0},z.isInteger=function(){return!!this.c&&S(this.e/l)>this.c.length-2},z.isLessThan=z.lt=function(p,g){return C(this,new G(p,g))<0},z.isLessThanOrEqualTo=z.lte=function(p,g){return(g=C(this,new G(p,g)))===-1||g===0},z.isNaN=function(){return!this.s},z.isNegative=function(){return this.s<0},z.isPositive=function(){return this.s>0},z.isZero=function(){return!!this.c&&this.c[0]==0},z.minus=function(p,g){var E,x,v,R,q=this,D=q.s;if(p=new G(p,g),g=p.s,!D||!g)return new G(NaN);if(D!=g)return p.s=-g,q.plus(p);var T=q.e/l,I=p.e/l,P=q.c,M=p.c;if(!T||!I){if(!P||!M)return P?(p.s=-g,p):new G(M?q:NaN);if(!P[0]||!M[0])return M[0]?(p.s=-g,p):new G(P[0]?q:re==3?-0:0)}if(T=S(T),I=S(I),P=P.slice(),D=T-I){for((R=D<0)?(D=-D,v=P):(I=T,v=M),v.reverse(),g=D;g--;v.push(0));v.reverse()}else for(x=(R=(D=P.length)<(g=M.length))?D:g,D=g=0;g<x;g++)if(P[g]!=M[g]){R=P[g]<M[g];break}if(R&&(v=P,P=M,M=v,p.s=-p.s),g=(x=M.length)-(E=P.length),g>0)for(;g--;P[E++]=0);for(g=f-1;x>D;){if(P[--x]<M[x]){for(E=x;E&&!P[--E];P[E]=g);--P[E],P[x]+=f}P[x]-=M[x]}for(;P[0]==0;P.splice(0,1),--I);return P[0]?Wn(p,P,I):(p.s=re==3?-1:1,p.c=[p.e=0],p)},z.modulo=z.mod=function(p,g){var E,x,v=this;return p=new G(p,g),!v.c||!p.s||p.c&&!p.c[0]?new G(NaN):!p.c||v.c&&!v.c[0]?new G(v):(Se==9?(x=p.s,p.s=1,E=j(v,p,0,3),p.s=x,E.s*=x):E=j(v,p,0,Se),p=v.minus(E.times(p)),!p.c[0]&&Se==1&&(p.s=v.s),p)},z.multipliedBy=z.times=function(p,g){var E,x,v,R,q,D,T,I,P,M,V,K,ge,ve,ke,me=this,ye=me.c,xe=(p=new G(p,g)).c;if(!ye||!xe||!ye[0]||!xe[0])return!me.s||!p.s||ye&&!ye[0]&&!xe||xe&&!xe[0]&&!ye?p.c=p.e=p.s=null:(p.s*=me.s,!ye||!xe?p.c=p.e=null:(p.c=[0],p.e=0)),p;for(x=S(me.e/l)+S(p.e/l),p.s*=me.s,T=ye.length,M=xe.length,T<M&&(ge=ye,ye=xe,xe=ge,v=T,T=M,M=v),v=T+M,ge=[];v--;ge.push(0));for(ve=f,ke=b,v=M;--v>=0;){for(E=0,V=xe[v]%ke,K=xe[v]/ke|0,q=T,R=v+q;R>v;)I=ye[--q]%ke,P=ye[q]/ke|0,D=K*I+P*V,I=V*I+D%ke*ke+ge[R]+E,E=(I/ve|0)+(D/ke|0)+K*P,ge[R--]=I%ve;ge[R]=E}return E?++x:ge.splice(0,1),Wn(p,ge,x)},z.negated=function(){var p=new G(this);return p.s=-p.s||null,p},z.plus=function(p,g){var E,x=this,v=x.s;if(p=new G(p,g),g=p.s,!v||!g)return new G(NaN);if(v!=g)return p.s=-g,x.minus(p);var R=x.e/l,q=p.e/l,D=x.c,T=p.c;if(!R||!q){if(!D||!T)return new G(v/0);if(!D[0]||!T[0])return T[0]?p:new G(D[0]?x:v*0)}if(R=S(R),q=S(q),D=D.slice(),v=R-q){for(v>0?(q=R,E=T):(v=-v,E=D),E.reverse();v--;E.push(0));E.reverse()}for(v=D.length,g=T.length,v-g<0&&(E=T,T=D,D=E,g=v),v=0;g;)v=(D[--g]=D[g]+T[g]+v)/f|0,D[g]=f===D[g]?0:D[g]%f;return v&&(D=[v].concat(D),++q),Wn(p,D,q)},z.precision=z.sd=function(p,g){var E,x,v,R=this;if(p!=null&&p!==!!p)return _(p,1,A),g==null?g=re:_(g,0,8),Ke(new G(R),p,g);if(!(E=R.c))return null;if(v=E.length-1,x=v*l+1,v=E[v]){for(;v%10==0;v/=10,x--);for(v=E[0];v>=10;v/=10,x++);}return p&&R.e+1>x&&(x=R.e+1),x},z.shiftedBy=function(p){return _(p,-d,d),this.times("1e"+p)},z.squareRoot=z.sqrt=function(){var p,g,E,x,v,R=this,q=R.c,D=R.s,T=R.e,I=de+4,P=new G("0.5");if(D!==1||!q||!q[0])return new G(!D||D<0&&(!q||q[0])?NaN:q?R:1/0);if(D=Math.sqrt(+Pe(R)),D==0||D==1/0?(g=y(q),(g.length+T)%2==0&&(g+="0"),D=Math.sqrt(+g),T=S((T+1)/2)-(T<0||T%2),D==1/0?g="5e"+T:(g=D.toExponential(),g=g.slice(0,g.indexOf("e")+1)+T),E=new G(g)):E=new G(D+""),E.c[0]){for(T=E.e,D=T+I,D<3&&(D=0);;)if(v=E,E=P.times(v.plus(j(R,v,I,1))),y(v.c).slice(0,D)===(g=y(E.c)).slice(0,D))if(E.e<T&&--D,g=g.slice(D-3,D+1),g=="9999"||!x&&g=="4999"){if(!x&&(Ke(v,v.e+de+2,0),v.times(v).eq(R))){E=v;break}I+=4,D+=4,x=1}else{(!+g||!+g.slice(1)&&g.charAt(0)=="5")&&(Ke(E,E.e+de+2,1),p=!E.times(E).eq(R));break}}return Ke(E,E.e+de+1,re,p)},z.toExponential=function(p,g){return p!=null&&(_(p,0,A),p++),et(this,p,g,1)},z.toFixed=function(p,g){return p!=null&&(_(p,0,A),p=p+this.e+1),et(this,p,g)},z.toFormat=function(p,g,E){var x,v=this;if(E==null)p!=null&&g&&typeof g=="object"?(E=g,g=null):p&&typeof p=="object"?(E=p,p=g=null):E=Ct;else if(typeof E!="object")throw Error(a+"Argument not an object: "+E);if(x=v.toFixed(p,g),v.c){var R,q=x.split("."),D=+E.groupSize,T=+E.secondaryGroupSize,I=E.groupSeparator||"",P=q[0],M=q[1],V=v.s<0,K=V?P.slice(1):P,ge=K.length;if(T&&(R=D,D=T,T=R,ge-=R),D>0&&ge>0){for(R=ge%D||D,P=K.substr(0,R);R<ge;R+=D)P+=I+K.substr(R,D);T>0&&(P+=I+K.slice(R)),V&&(P="-"+P)}x=M?P+(E.decimalSeparator||"")+((T=+E.fractionGroupSize)?M.replace(new RegExp("\\d{"+T+"}\\B","g"),"$&"+(E.fractionGroupSeparator||"")):M):P}return(E.prefix||"")+x+(E.suffix||"")},z.toFraction=function(p){var g,E,x,v,R,q,D,T,I,P,M,V,K=this,ge=K.c;if(p!=null&&(D=new G(p),!D.isInteger()&&(D.c||D.s!==1)||D.lt(_e)))throw Error(a+"Argument "+(D.isInteger()?"out of range: ":"not an integer: ")+Pe(D));if(!ge)return new G(K);for(g=new G(_e),I=E=new G(_e),x=T=new G(_e),V=y(ge),R=g.e=V.length-K.e-1,g.c[0]=h[(q=R%l)<0?l+q:q],p=!p||D.comparedTo(g)>0?R>0?g:I:D,q=le,le=1/0,D=new G(V),T.c[0]=0;P=j(D,g,0,1),v=E.plus(P.times(x)),v.comparedTo(p)!=1;)E=x,x=v,I=T.plus(P.times(v=I)),T=v,g=D.minus(P.times(v=g)),D=v;return v=j(p.minus(E),x,0,1),T=T.plus(v.times(I)),E=E.plus(v.times(x)),T.s=I.s=K.s,R=R*2,M=j(I,x,R,re).minus(K).abs().comparedTo(j(T,E,R,re).minus(K).abs())<1?[I,x]:[T,E],le=q,M},z.toNumber=function(){return+Pe(this)},z.toPrecision=function(p,g){return p!=null&&_(p,1,A),et(this,p,g,2)},z.toString=function(p){var g,E=this,x=E.s,v=E.e;return v===null?x?(g="Infinity",x<0&&(g="-"+g)):g="NaN":(p==null?g=v<=se||v>=Q?k(y(E.c),v):U(y(E.c),v,"0"):p===10&&er?(E=Ke(new G(E),de+v+1,re),g=U(y(E.c),E.e,"0")):(_(p,2,He.length,"Base"),g=H(U(y(E.c),v,"0"),10,p,x,!0)),x<0&&E.c[0]&&(g="-"+g)),g},z.valueOf=z.toJSON=function(){return Pe(this)},z._isBigNumber=!0,B!=null&&G.set(B),G}function S(B){var j=B|0;return B>0||B===j?j:j-1}function y(B){for(var j,H,Z=1,z=B.length,_e=B[0]+"";Z<z;){for(j=B[Z++]+"",H=l-j.length;H--;j="0"+j);_e+=j}for(z=_e.length;_e.charCodeAt(--z)===48;);return _e.slice(0,z+1||1)}function C(B,j){var H,Z,z=B.c,_e=j.c,de=B.s,re=j.s,se=B.e,Q=j.e;if(!de||!re)return null;if(H=z&&!z[0],Z=_e&&!_e[0],H||Z)return H?Z?0:-re:de;if(de!=re)return de;if(H=de<0,Z=se==Q,!z||!_e)return Z?0:!z^H?1:-1;if(!Z)return se>Q^H?1:-1;for(re=(se=z.length)<(Q=_e.length)?se:Q,de=0;de<re;de++)if(z[de]!=_e[de])return z[de]>_e[de]^H?1:-1;return se==Q?0:se>Q^H?1:-1}function _(B,j,H,Z){if(B<j||B>H||B!==s(B))throw Error(a+(Z||"Argument")+(typeof B=="number"?B<j||B>H?" out of range: ":" not an integer: ":" not a primitive number: ")+String(B))}function F(B){var j=B.c.length-1;return S(B.e/l)==j&&B.c[j]%2!=0}function k(B,j){return(B.length>1?B.charAt(0)+"."+B.slice(1):B)+(j<0?"e":"e+")+j}function U(B,j,H){var Z,z;if(j<0){for(z=H+".";++j;z+=H);B=z+B}else if(Z=B.length,++j>Z){for(z=H,j-=Z;--j;z+=H);B+=z}else j<Z&&(B=B.slice(0,j)+"."+B.slice(j));return B}e=O(),e.default=e.BigNumber=e,typeof define=="function"&&define.amd?define(function(){return e}):typeof Gs<"u"&&Gs.exports?Gs.exports=e:(r||(r=typeof self<"u"&&self?self:window),r.BigNumber=e)})(dh)});var gh=W((sD,mh)=>{var hh=lu(),ph=mh.exports;(function(){"use strict";function r(d){return d<10?"0"+d:d}var e=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,t=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,n,s,a={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},c;function f(d){return t.lastIndex=0,t.test(d)?'"'+d.replace(t,function(h){var b=a[h];return typeof b=="string"?b:"\\u"+("0000"+h.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+d+'"'}function l(d,h){var b,A,O,S,y=n,C,_=h[d],F=_!=null&&(_ instanceof hh||hh.isBigNumber(_));switch(_&&typeof _=="object"&&typeof _.toJSON=="function"&&(_=_.toJSON(d)),typeof c=="function"&&(_=c.call(h,d,_)),typeof _){case"string":return F?_:f(_);case"number":return isFinite(_)?String(_):"null";case"boolean":case"null":case"bigint":return String(_);case"object":if(!_)return"null";if(n+=s,C=[],Object.prototype.toString.apply(_)==="[object Array]"){for(S=_.length,b=0;b<S;b+=1)C[b]=l(b,_)||"null";return O=C.length===0?"[]":n?`[
`+n+C.join(`,
`+n)+`
`+y+"]":"["+C.join(",")+"]",n=y,O}if(c&&typeof c=="object")for(S=c.length,b=0;b<S;b+=1)typeof c[b]=="string"&&(A=c[b],O=l(A,_),O&&C.push(f(A)+(n?": ":":")+O));else Object.keys(_).forEach(function(k){var U=l(k,_);U&&C.push(f(k)+(n?": ":":")+U)});return O=C.length===0?"{}":n?`{
`+n+C.join(`,
`+n)+`
`+y+"}":"{"+C.join(",")+"}",n=y,O}}typeof ph.stringify!="function"&&(ph.stringify=function(d,h,b){var A;if(n="",s="",typeof b=="number")for(A=0;A<b;A+=1)s+=" ";else typeof b=="string"&&(s=b);if(c=h,h&&typeof h!="function"&&(typeof h!="object"||typeof h.length!="number"))throw new Error("JSON.stringify");return l("",{"":d})})})()});var _h=W((iD,yh)=>{var Ws=null,a_=/(?:_|\\u005[Ff])(?:_|\\u005[Ff])(?:p|\\u0070)(?:r|\\u0072)(?:o|\\u006[Ff])(?:t|\\u0074)(?:o|\\u006[Ff])(?:_|\\u005[Ff])(?:_|\\u005[Ff])/,u_=/(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)/,c_=function(r){"use strict";var e={strict:!1,storeAsString:!1,alwaysParseAsBig:!1,useNativeBigInt:!1,protoAction:"error",constructorAction:"error"};if(r!=null){if(r.strict===!0&&(e.strict=!0),r.storeAsString===!0&&(e.storeAsString=!0),e.alwaysParseAsBig=r.alwaysParseAsBig===!0?r.alwaysParseAsBig:!1,e.useNativeBigInt=r.useNativeBigInt===!0?r.useNativeBigInt:!1,typeof r.constructorAction<"u")if(r.constructorAction==="error"||r.constructorAction==="ignore"||r.constructorAction==="preserve")e.constructorAction=r.constructorAction;else throw new Error(`Incorrect value for constructorAction option, must be "error", "ignore" or undefined but passed ${r.constructorAction}`);if(typeof r.protoAction<"u")if(r.protoAction==="error"||r.protoAction==="ignore"||r.protoAction==="preserve")e.protoAction=r.protoAction;else throw new Error(`Incorrect value for protoAction option, must be "error", "ignore" or undefined but passed ${r.protoAction}`)}var t,n,s={'"':'"',"\\":"\\","/":"/",b:"\b",f:"\f",n:`
`,r:"\r",t:"	"},a,c=function(y){throw{name:"SyntaxError",message:y,at:t,text:a}},f=function(y){return y&&y!==n&&c("Expected '"+y+"' instead of '"+n+"'"),n=a.charAt(t),t+=1,n},l=function(){var y,C="";for(n==="-"&&(C="-",f("-"));n>="0"&&n<="9";)C+=n,f();if(n===".")for(C+=".";f()&&n>="0"&&n<="9";)C+=n;if(n==="e"||n==="E")for(C+=n,f(),(n==="-"||n==="+")&&(C+=n,f());n>="0"&&n<="9";)C+=n,f();if(y=+C,!isFinite(y))c("Bad number");else return Ws==null&&(Ws=lu()),C.length>15?e.storeAsString?C:e.useNativeBigInt?BigInt(C):new Ws(C):e.alwaysParseAsBig?e.useNativeBigInt?BigInt(y):new Ws(y):y},d=function(){var y,C,_="",F;if(n==='"')for(var k=t;f();){if(n==='"')return t-1>k&&(_+=a.substring(k,t-1)),f(),_;if(n==="\\"){if(t-1>k&&(_+=a.substring(k,t-1)),f(),n==="u"){for(F=0,C=0;C<4&&(y=parseInt(f(),16),!!isFinite(y));C+=1)F=F*16+y;_+=String.fromCharCode(F)}else if(typeof s[n]=="string")_+=s[n];else break;k=t}}c("Bad string")},h=function(){for(;n&&n<=" ";)f()},b=function(){switch(n){case"t":return f("t"),f("r"),f("u"),f("e"),!0;case"f":return f("f"),f("a"),f("l"),f("s"),f("e"),!1;case"n":return f("n"),f("u"),f("l"),f("l"),null}c("Unexpected '"+n+"'")},A,O=function(){var y=[];if(n==="["){if(f("["),h(),n==="]")return f("]"),y;for(;n;){if(y.push(A()),h(),n==="]")return f("]"),y;f(","),h()}}c("Bad array")},S=function(){var y,C=Object.create(null);if(n==="{"){if(f("{"),h(),n==="}")return f("}"),C;for(;n;){if(y=d(),h(),f(":"),e.strict===!0&&Object.hasOwnProperty.call(C,y)&&c('Duplicate key "'+y+'"'),a_.test(y)===!0?e.protoAction==="error"?c("Object contains forbidden prototype property"):e.protoAction==="ignore"?A():C[y]=A():u_.test(y)===!0?e.constructorAction==="error"?c("Object contains forbidden constructor property"):e.constructorAction==="ignore"?A():C[y]=A():C[y]=A(),h(),n==="}")return f("}"),C;f(","),h()}}c("Bad object")};return A=function(){switch(h(),n){case"{":return S();case"[":return O();case'"':return d();case"-":return l();default:return n>="0"&&n<="9"?l():b()}},function(y,C){var _;return a=y+"",t=0,n=" ",_=A(),h(),n&&c("Syntax error"),typeof C=="function"?function F(k,U){var B,j,H=k[U];return H&&typeof H=="object"&&Object.keys(H).forEach(function(Z){j=F(H,Z),j!==void 0?H[Z]=j:delete H[Z]}),C.call(k,U,H)}({"":_},""):_}};yh.exports=c_});var Eh=W((aD,zs)=>{var Ch=gh().stringify,bh=_h();zs.exports=function(r){return{parse:bh(r),stringify:Ch}};zs.exports.parse=bh();zs.exports.stringify=Ch});var fu=W(Nt=>{"use strict";Object.defineProperty(Nt,"__esModule",{value:!0});Nt.GCE_LINUX_BIOS_PATHS=void 0;Nt.isGoogleCloudServerless=Dh;Nt.isGoogleComputeEngineLinux=Sh;Nt.isGoogleComputeEngineMACAddress=vh;Nt.isGoogleComputeEngine=Th;Nt.detectGCPResidency=f_;var Ah=require("fs"),wh=require("os");Nt.GCE_LINUX_BIOS_PATHS={BIOS_DATE:"/sys/class/dmi/id/bios_date",BIOS_VENDOR:"/sys/class/dmi/id/bios_vendor"};var l_=/^42:01/;function Dh(){return!!(process.env.CLOUD_RUN_JOB||process.env.FUNCTION_NAME||process.env.K_SERVICE)}function Sh(){if((0,wh.platform)()!=="linux")return!1;try{(0,Ah.statSync)(Nt.GCE_LINUX_BIOS_PATHS.BIOS_DATE);let r=(0,Ah.readFileSync)(Nt.GCE_LINUX_BIOS_PATHS.BIOS_VENDOR,"utf8");return/Google/.test(r)}catch{return!1}}function vh(){let r=(0,wh.networkInterfaces)();for(let e of Object.values(r))if(e){for(let{mac:t}of e)if(l_.test(t))return!0}return!1}function Th(){return Sh()||vh()}function f_(){return Dh()||Th()}});var Rh=W(Js=>{"use strict";Object.defineProperty(Js,"__esModule",{value:!0});Js.Colours=void 0;var Je=class r{static isEnabled(e){return e&&e.isTTY&&(typeof e.getColorDepth=="function"?e.getColorDepth()>2:!0)}static refresh(){r.enabled=r.isEnabled(process==null?void 0:process.stderr),this.enabled?(r.reset="\x1B[0m",r.bright="\x1B[1m",r.dim="\x1B[2m",r.red="\x1B[31m",r.green="\x1B[32m",r.yellow="\x1B[33m",r.blue="\x1B[34m",r.magenta="\x1B[35m",r.cyan="\x1B[36m",r.white="\x1B[37m",r.grey="\x1B[90m"):(r.reset="",r.bright="",r.dim="",r.red="",r.green="",r.yellow="",r.blue="",r.magenta="",r.cyan="",r.white="",r.grey="")}};Js.Colours=Je;Je.enabled=!1;Je.reset="";Je.bright="";Je.dim="";Je.red="";Je.green="";Je.yellow="";Je.blue="";Je.magenta="";Je.cyan="";Je.white="";Je.grey="";Je.refresh()});var Ph=W(be=>{"use strict";var d_=be&&be.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t);var s=Object.getOwnPropertyDescriptor(e,t);(!s||("get"in s?!e.__esModule:s.writable||s.configurable))&&(s={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(r,n,s)}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),h_=be&&be.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),Fh=be&&be.__importStar||function(){var r=function(e){return r=Object.getOwnPropertyNames||function(t){var n=[];for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&(n[n.length]=s);return n},r(e)};return function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var n=r(e),s=0;s<n.length;s++)n[s]!=="default"&&d_(t,e,n[s]);return h_(t,e),t}}();Object.defineProperty(be,"__esModule",{value:!0});be.env=be.DebugLogBackendBase=be.placeholder=be.AdhocDebugLogger=be.LogSeverity=void 0;be.getNodeBackend=hu;be.getDebugBackend=m_;be.getStructuredBackend=g_;be.setBackend=y_;be.log=Oh;var p_=require("events"),po=Fh(require("process")),kh=Fh(require("util")),dt=Rh(),qt;(function(r){r.DEFAULT="DEFAULT",r.DEBUG="DEBUG",r.INFO="INFO",r.WARNING="WARNING",r.ERROR="ERROR"})(qt||(be.LogSeverity=qt={}));var mo=class extends p_.EventEmitter{constructor(e,t){super(),this.namespace=e,this.upstream=t,this.func=Object.assign(this.invoke.bind(this),{instance:this,on:(n,s)=>this.on(n,s)}),this.func.debug=(...n)=>this.invokeSeverity(qt.DEBUG,...n),this.func.info=(...n)=>this.invokeSeverity(qt.INFO,...n),this.func.warn=(...n)=>this.invokeSeverity(qt.WARNING,...n),this.func.error=(...n)=>this.invokeSeverity(qt.ERROR,...n),this.func.sublog=n=>Oh(n,this.func)}invoke(e,...t){if(this.upstream)try{this.upstream(e,...t)}catch{}try{this.emit("log",e,t)}catch{}}invokeSeverity(e,...t){this.invoke({severity:e},...t)}};be.AdhocDebugLogger=mo;be.placeholder=new mo("",()=>{}).func;var Tn=class{constructor(){var e;this.cached=new Map,this.filters=[],this.filtersSet=!1;let t=(e=po.env[be.env.nodeEnables])!==null&&e!==void 0?e:"*";t==="all"&&(t="*"),this.filters=t.split(",")}log(e,t,...n){try{this.filtersSet||(this.setFilters(),this.filtersSet=!0);let s=this.cached.get(e);s||(s=this.makeLogger(e),this.cached.set(e,s)),s(t,...n)}catch(s){console.error(s)}}};be.DebugLogBackendBase=Tn;var du=class extends Tn{constructor(){super(...arguments),this.enabledRegexp=/.*/g}isEnabled(e){return this.enabledRegexp.test(e)}makeLogger(e){return this.enabledRegexp.test(e)?(t,...n)=>{var s;let a=`${dt.Colours.green}${e}${dt.Colours.reset}`,c=`${dt.Colours.yellow}${po.pid}${dt.Colours.reset}`,f;switch(t.severity){case qt.ERROR:f=`${dt.Colours.red}${t.severity}${dt.Colours.reset}`;break;case qt.INFO:f=`${dt.Colours.magenta}${t.severity}${dt.Colours.reset}`;break;case qt.WARNING:f=`${dt.Colours.yellow}${t.severity}${dt.Colours.reset}`;break;default:f=(s=t.severity)!==null&&s!==void 0?s:qt.DEFAULT;break}let l=kh.formatWithOptions({colors:dt.Colours.enabled},...n),d=Object.assign({},t);delete d.severity;let h=Object.getOwnPropertyNames(d).length?JSON.stringify(d):"",b=h?`${dt.Colours.grey}${h}${dt.Colours.reset}`:"";console.error("%s [%s|%s] %s%s",c,a,f,l,h?` ${b}`:"")}:()=>{}}setFilters(){let t=this.filters.join(",").replace(/[|\\{}()[\]^$+?.]/g,"\\$&").replace(/\*/g,".*").replace(/,/g,"$|^");this.enabledRegexp=new RegExp(`^${t}$`,"i")}};function hu(){return new du}var pu=class extends Tn{constructor(e){super(),this.debugPkg=e}makeLogger(e){let t=this.debugPkg(e);return(n,...s)=>{t(s[0],...s.slice(1))}}setFilters(){var e;let t=(e=po.env.NODE_DEBUG)!==null&&e!==void 0?e:"";po.env.NODE_DEBUG=`${t}${t?",":""}${this.filters.join(",")}`}};function m_(r){return new pu(r)}var mu=class extends Tn{constructor(e){var t;super(),this.upstream=(t=e)!==null&&t!==void 0?t:void 0}makeLogger(e){var t;let n=(t=this.upstream)===null||t===void 0?void 0:t.makeLogger(e);return(s,...a)=>{var c;let f=(c=s.severity)!==null&&c!==void 0?c:qt.INFO,l=Object.assign({severity:f,message:kh.format(...a)},s),d=JSON.stringify(l);n?n(s,d):console.log("%s",d)}}setFilters(){var e;(e=this.upstream)===null||e===void 0||e.setFilters()}};function g_(r){return new mu(r)}be.env={nodeEnables:"GOOGLE_SDK_NODE_LOGGING"};var gu=new Map,ht;function y_(r){ht=r,gu.clear()}function Oh(r,e){if(!ht&&!po.env[be.env.nodeEnables]||!r)return be.placeholder;e&&(r=`${e.instance.namespace}:${r}`);let t=gu.get(r);if(t)return t.func;if(ht===null)return be.placeholder;ht===void 0&&(ht=hu());let n=(()=>{let s;return new mo(r,(c,...f)=>{if(s!==ht){if(ht===null)return;ht===void 0&&(ht=hu()),s=ht}ht?.log(r,c,...f)})})();return gu.set(r,n),n.func}});var yu=W(Qr=>{"use strict";var __=Qr&&Qr.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t);var s=Object.getOwnPropertyDescriptor(e,t);(!s||("get"in s?!e.__esModule:s.writable||s.configurable))&&(s={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(r,n,s)}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),C_=Qr&&Qr.__exportStar||function(r,e){for(var t in r)t!=="default"&&!Object.prototype.hasOwnProperty.call(e,t)&&__(e,r,t)};Object.defineProperty(Qr,"__esModule",{value:!0});C_(Ph(),Qr)});var yo=W(te=>{"use strict";var Bh=te&&te.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t);var s=Object.getOwnPropertyDescriptor(e,t);(!s||("get"in s?!e.__esModule:s.writable||s.configurable))&&(s={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(r,n,s)}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),b_=te&&te.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),E_=te&&te.__importStar||function(){var r=function(e){return r=Object.getOwnPropertyNames||function(t){var n=[];for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&(n[n.length]=s);return n},r(e)};return function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var n=r(e),s=0;s<n.length;s++)n[s]!=="default"&&Bh(t,e,n[s]);return b_(t,e),t}}(),A_=te&&te.__exportStar||function(r,e){for(var t in r)t!=="default"&&!Object.prototype.hasOwnProperty.call(e,t)&&Bh(e,r,t)};Object.defineProperty(te,"__esModule",{value:!0});te.gcpResidencyCache=te.METADATA_SERVER_DETECTION=te.HEADERS=te.HEADER_VALUE=te.HEADER_NAME=te.SECONDARY_HOST_ADDRESS=te.HOST_ADDRESS=te.BASE_PATH=void 0;te.instance=R_;te.project=F_;te.universe=k_;te.bulk=O_;te.isAvailable=x_;te.resetIsAvailableCache=B_;te.getGCPResidency=bu;te.setGCPResidency=Ih;te.requestTimeout=Nh;var _u=$e(),w_=Eh(),D_=fu(),S_=E_(yu());te.BASE_PATH="/computeMetadata/v1";te.HOST_ADDRESS="http://169.254.169.254";te.SECONDARY_HOST_ADDRESS="http://metadata.google.internal.";te.HEADER_NAME="Metadata-Flavor";te.HEADER_VALUE="Google";te.HEADERS=Object.freeze({[te.HEADER_NAME]:te.HEADER_VALUE});var xh=S_.log("gcp-metadata");te.METADATA_SERVER_DETECTION=Object.freeze({"assume-present":"don't try to ping the metadata server, but assume it's present",none:"don't try to ping the metadata server, but don't try to use it either","bios-only":"treat the result of a BIOS probe as canonical (don't fall back to pinging)","ping-only":"skip the BIOS probe, and go straight to pinging"});function Cu(r){return r||(r=process.env.GCE_METADATA_IP||process.env.GCE_METADATA_HOST||te.HOST_ADDRESS),/^https?:\/\//.test(r)||(r=`http://${r}`),new URL(te.BASE_PATH,r).href}function v_(r){Object.keys(r).forEach(e=>{switch(e){case"params":case"property":case"headers":break;case"qs":throw new Error("'qs' is not a valid configuration option. Please use 'params' instead.");default:throw new Error(`'${e}' is not a valid configuration option.`)}})}async function go(r,e={},t=3,n=!1){let s=new Headers(te.HEADERS),a="",c={};if(typeof r=="object"){let b=r;new Headers(b.headers).forEach((A,O)=>s.set(O,A)),a=b.metadataKey,c=b.params||c,t=b.noResponseRetries||t,n=b.fastFail||n}else a=r;typeof e=="string"?a+=`/${e}`:(v_(e),e.property&&(a+=`/${e.property}`),new Headers(e.headers).forEach((b,A)=>s.set(A,b)),c=e.params||c);let f=n?T_:_u.request,l={url:`${Cu()}/${a}`,headers:s,retryConfig:{noResponseRetries:t},params:c,responseType:"text",timeout:Nh()};xh.info("instance request %j",l);let d=await f(l);xh.info("instance metadata is %s",d.data);let h=d.headers.get(te.HEADER_NAME);if(h!==te.HEADER_VALUE)throw new RangeError(`Invalid response from metadata service: incorrect ${te.HEADER_NAME} header. Expected '${te.HEADER_VALUE}', got ${h?`'${h}'`:"no header"}`);if(typeof d.data=="string")try{return w_.parse(d.data)}catch{}return d.data}async function T_(r){let e={...r,url:r.url?.toString().replace(Cu(),Cu(te.SECONDARY_HOST_ADDRESS))},t=(0,_u.request)(r),n=(0,_u.request)(e);return Promise.any([t,n])}function R_(r){return go("instance",r)}function F_(r){return go("project",r)}function k_(r){return go("universe",r)}async function O_(r){let e={};return await Promise.all(r.map(t=>(async()=>{let n=await go(t),s=t.metadataKey;e[s]=n})())),e}function P_(){return process.env.DETECT_GCP_RETRIES?Number(process.env.DETECT_GCP_RETRIES):0}var Vs;async function x_(){if(process.env.METADATA_SERVER_DETECTION){let r=process.env.METADATA_SERVER_DETECTION.trim().toLocaleLowerCase();if(!(r in te.METADATA_SERVER_DETECTION))throw new RangeError(`Unknown \`METADATA_SERVER_DETECTION\` env variable. Got \`${r}\`, but it should be \`${Object.keys(te.METADATA_SERVER_DETECTION).join("`, `")}\`, or unset`);switch(r){case"assume-present":return!0;case"none":return!1;case"bios-only":return bu();case"ping-only":}}try{return Vs===void 0&&(Vs=go("instance",void 0,P_(),!(process.env.GCE_METADATA_IP||process.env.GCE_METADATA_HOST))),await Vs,!0}catch(r){let e=r;if(process.env.DEBUG_AUTH&&console.info(e),e.type==="request-timeout"||e.response&&e.response.status===404)return!1;if(!(e.response&&e.response.status===404)&&(!e.code||!["EHOSTDOWN","EHOSTUNREACH","ENETUNREACH","ENOENT","ENOTFOUND","ECONNREFUSED"].includes(e.code.toString()))){let t="UNKNOWN";e.code&&(t=e.code.toString()),process.emitWarning(`received unexpected error = ${e.message} code = ${t}`,"MetadataLookupWarning")}return!1}}function B_(){Vs=void 0}te.gcpResidencyCache=null;function bu(){return te.gcpResidencyCache===null&&Ih(),te.gcpResidencyCache}function Ih(r=null){te.gcpResidencyCache=r!==null?r:(0,D_.detectGCPResidency)()}function Nh(){return bu()?0:3e3}A_(fu(),te)});var Lh=W(Ks=>{"use strict";Ks.byteLength=N_;Ks.toByteArray=j_;Ks.fromByteArray=M_;var Jt=[],St=[],I_=typeof Uint8Array<"u"?Uint8Array:Array,Eu="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(Zr=0,qh=Eu.length;Zr<qh;++Zr)Jt[Zr]=Eu[Zr],St[Eu.charCodeAt(Zr)]=Zr;var Zr,qh;St[45]=62;St[95]=63;function jh(r){var e=r.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var t=r.indexOf("=");t===-1&&(t=e);var n=t===e?0:4-t%4;return[t,n]}function N_(r){var e=jh(r),t=e[0],n=e[1];return(t+n)*3/4-n}function q_(r,e,t){return(e+t)*3/4-t}function j_(r){var e,t=jh(r),n=t[0],s=t[1],a=new I_(q_(r,n,s)),c=0,f=s>0?n-4:n,l;for(l=0;l<f;l+=4)e=St[r.charCodeAt(l)]<<18|St[r.charCodeAt(l+1)]<<12|St[r.charCodeAt(l+2)]<<6|St[r.charCodeAt(l+3)],a[c++]=e>>16&255,a[c++]=e>>8&255,a[c++]=e&255;return s===2&&(e=St[r.charCodeAt(l)]<<2|St[r.charCodeAt(l+1)]>>4,a[c++]=e&255),s===1&&(e=St[r.charCodeAt(l)]<<10|St[r.charCodeAt(l+1)]<<4|St[r.charCodeAt(l+2)]>>2,a[c++]=e>>8&255,a[c++]=e&255),a}function L_(r){return Jt[r>>18&63]+Jt[r>>12&63]+Jt[r>>6&63]+Jt[r&63]}function U_(r,e,t){for(var n,s=[],a=e;a<t;a+=3)n=(r[a]<<16&16711680)+(r[a+1]<<8&65280)+(r[a+2]&255),s.push(L_(n));return s.join("")}function M_(r){for(var e,t=r.length,n=t%3,s=[],a=16383,c=0,f=t-n;c<f;c+=a)s.push(U_(r,c,c+a>f?f:c+a));return n===1?(e=r[t-1],s.push(Jt[e>>2]+Jt[e<<4&63]+"==")):n===2&&(e=(r[t-2]<<8)+r[t-1],s.push(Jt[e>>10]+Jt[e>>4&63]+Jt[e<<2&63]+"=")),s.join("")}});var wu=W(Au=>{"use strict";Object.defineProperty(Au,"__esModule",{value:!0});Au.fromArrayBufferToHex=$_;function $_(r){return Array.from(new Uint8Array(r)).map(t=>t.toString(16).padStart(2,"0")).join("")}});var Uh=W(Ys=>{"use strict";Object.defineProperty(Ys,"__esModule",{value:!0});Ys.BrowserCrypto=void 0;var Rn=Lh(),H_=wu(),Du=class r{constructor(){if(typeof window>"u"||window.crypto===void 0||window.crypto.subtle===void 0)throw new Error("SubtleCrypto not found. Make sure it's an https:// website.")}async sha256DigestBase64(e){let t=new TextEncoder().encode(e),n=await window.crypto.subtle.digest("SHA-256",t);return Rn.fromByteArray(new Uint8Array(n))}randomBytesBase64(e){let t=new Uint8Array(e);return window.crypto.getRandomValues(t),Rn.fromByteArray(t)}static padBase64(e){for(;e.length%4!==0;)e+="=";return e}async verify(e,t,n){let s={name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},a=new TextEncoder().encode(t),c=Rn.toByteArray(r.padBase64(n)),f=await window.crypto.subtle.importKey("jwk",e,s,!0,["verify"]);return await window.crypto.subtle.verify(s,f,c,a)}async sign(e,t){let n={name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},s=new TextEncoder().encode(t),a=await window.crypto.subtle.importKey("jwk",e,n,!0,["sign"]),c=await window.crypto.subtle.sign(n,a,s);return Rn.fromByteArray(new Uint8Array(c))}decodeBase64StringUtf8(e){let t=Rn.toByteArray(r.padBase64(e));return new TextDecoder().decode(t)}encodeBase64StringUtf8(e){let t=new TextEncoder().encode(e);return Rn.fromByteArray(t)}async sha256DigestHex(e){let t=new TextEncoder().encode(e),n=await window.crypto.subtle.digest("SHA-256",t);return(0,H_.fromArrayBufferToHex)(n)}async signWithHmacSha256(e,t){let n=typeof e=="string"?e:String.fromCharCode(...new Uint16Array(e)),s=new TextEncoder,a=await window.crypto.subtle.importKey("raw",s.encode(n),{name:"HMAC",hash:{name:"SHA-256"}},!1,["sign"]);return window.crypto.subtle.sign("HMAC",a,s.encode(t))}};Ys.BrowserCrypto=Du});var Mh=W(Xs=>{"use strict";Object.defineProperty(Xs,"__esModule",{value:!0});Xs.NodeCrypto=void 0;var Fn=require("crypto"),Su=class{async sha256DigestBase64(e){return Fn.createHash("sha256").update(e).digest("base64")}randomBytesBase64(e){return Fn.randomBytes(e).toString("base64")}async verify(e,t,n){let s=Fn.createVerify("RSA-SHA256");return s.update(t),s.end(),s.verify(e,n,"base64")}async sign(e,t){let n=Fn.createSign("RSA-SHA256");return n.update(t),n.end(),n.sign(e,"base64")}decodeBase64StringUtf8(e){return Buffer.from(e,"base64").toString("utf-8")}encodeBase64StringUtf8(e){return Buffer.from(e,"utf-8").toString("base64")}async sha256DigestHex(e){return Fn.createHash("sha256").update(e).digest("hex")}async signWithHmacSha256(e,t){let n=typeof e=="string"?e:W_(e);return G_(Fn.createHmac("sha256",n).update(t).digest())}};Xs.NodeCrypto=Su;function G_(r){return r.buffer.slice(r.byteOffset,r.byteOffset+r.byteLength)}function W_(r){return Buffer.from(r)}});var _o=W(hr=>{"use strict";var z_=hr&&hr.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t);var s=Object.getOwnPropertyDescriptor(e,t);(!s||("get"in s?!e.__esModule:s.writable||s.configurable))&&(s={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(r,n,s)}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),J_=hr&&hr.__exportStar||function(r,e){for(var t in r)t!=="default"&&!Object.prototype.hasOwnProperty.call(e,t)&&z_(e,r,t)};Object.defineProperty(hr,"__esModule",{value:!0});hr.createCrypto=Y_;hr.hasBrowserCrypto=$h;var V_=Uh(),K_=Mh();J_(wu(),hr);function Y_(){return $h()?new V_.BrowserCrypto:new K_.NodeCrypto}function $h(){return typeof window<"u"&&typeof window.crypto<"u"&&typeof window.crypto.subtle<"u"}});var kn=W((vu,Gh)=>{var Qs=require("buffer"),Vt=Qs.Buffer;function Hh(r,e){for(var t in r)e[t]=r[t]}Vt.from&&Vt.alloc&&Vt.allocUnsafe&&Vt.allocUnsafeSlow?Gh.exports=Qs:(Hh(Qs,vu),vu.Buffer=en);function en(r,e,t){return Vt(r,e,t)}en.prototype=Object.create(Vt.prototype);Hh(Vt,en);en.from=function(r,e,t){if(typeof r=="number")throw new TypeError("Argument must not be a number");return Vt(r,e,t)};en.alloc=function(r,e,t){if(typeof r!="number")throw new TypeError("Argument must be a number");var n=Vt(r);return e!==void 0?typeof t=="string"?n.fill(e,t):n.fill(e):n.fill(0),n};en.allocUnsafe=function(r){if(typeof r!="number")throw new TypeError("Argument must be a number");return Vt(r)};en.allocUnsafeSlow=function(r){if(typeof r!="number")throw new TypeError("Argument must be a number");return Qs.SlowBuffer(r)}});var zh=W((_D,Wh)=>{"use strict";function Tu(r){var e=(r/8|0)+(r%8===0?0:1);return e}var X_={ES256:Tu(256),ES384:Tu(384),ES512:Tu(521)};function Q_(r){var e=X_[r];if(e)return e;throw new Error('Unknown algorithm "'+r+'"')}Wh.exports=Q_});var Ru=W((CD,Qh)=>{"use strict";var Zs=kn().Buffer,Vh=zh(),ei=128,Kh=0,Z_=32,eC=16,tC=2,Yh=eC|Z_|Kh<<6,ti=tC|Kh<<6;function rC(r){return r.replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function Xh(r){if(Zs.isBuffer(r))return r;if(typeof r=="string")return Zs.from(r,"base64");throw new TypeError("ECDSA signature must be a Base64 string or a Buffer")}function nC(r,e){r=Xh(r);var t=Vh(e),n=t+1,s=r.length,a=0;if(r[a++]!==Yh)throw new Error('Could not find expected "seq"');var c=r[a++];if(c===(ei|1)&&(c=r[a++]),s-a<c)throw new Error('"seq" specified length of "'+c+'", only "'+(s-a)+'" remaining');if(r[a++]!==ti)throw new Error('Could not find expected "int" for "r"');var f=r[a++];if(s-a-2<f)throw new Error('"r" specified length of "'+f+'", only "'+(s-a-2)+'" available');if(n<f)throw new Error('"r" specified length of "'+f+'", max of "'+n+'" is acceptable');var l=a;if(a+=f,r[a++]!==ti)throw new Error('Could not find expected "int" for "s"');var d=r[a++];if(s-a!==d)throw new Error('"s" specified length of "'+d+'", expected "'+(s-a)+'"');if(n<d)throw new Error('"s" specified length of "'+d+'", max of "'+n+'" is acceptable');var h=a;if(a+=d,a!==s)throw new Error('Expected to consume entire buffer, but "'+(s-a)+'" bytes remain');var b=t-f,A=t-d,O=Zs.allocUnsafe(b+f+A+d);for(a=0;a<b;++a)O[a]=0;r.copy(O,a,l+Math.max(-b,0),l+f),a=t;for(var S=a;a<S+A;++a)O[a]=0;return r.copy(O,a,h+Math.max(-A,0),h+d),O=O.toString("base64"),O=rC(O),O}function Jh(r,e,t){for(var n=0;e+n<t&&r[e+n]===0;)++n;var s=r[e+n]>=ei;return s&&--n,n}function oC(r,e){r=Xh(r);var t=Vh(e),n=r.length;if(n!==t*2)throw new TypeError('"'+e+'" signatures must be "'+t*2+'" bytes, saw "'+n+'"');var s=Jh(r,0,t),a=Jh(r,t,r.length),c=t-s,f=t-a,l=2+c+1+1+f,d=l<ei,h=Zs.allocUnsafe((d?2:3)+l),b=0;return h[b++]=Yh,d?h[b++]=l:(h[b++]=ei|1,h[b++]=l&255),h[b++]=ti,h[b++]=c,s<0?(h[b++]=0,b+=r.copy(h,b,0,t)):b+=r.copy(h,b,s,t),h[b++]=ti,h[b++]=f,a<0?(h[b++]=0,r.copy(h,b,t)):r.copy(h,b,t+a),h}Qh.exports={derToJose:nC,joseToDer:oC}});var jt=W(pr=>{"use strict";Object.defineProperty(pr,"__esModule",{value:!0});pr.LRUCache=void 0;pr.snakeToCamel=ep;pr.originalOrCamelOptions=uC;pr.removeUndefinedValuesInObject=cC;pr.isValidFile=lC;pr.getWellKnownCertificateConfigFileLocation=fC;var sC=require("fs"),iC=require("os"),Fu=require("path"),aC="certificate_config.json",Zh="gcloud";function ep(r){return r.replace(/([_][^_])/g,e=>e.slice(1).toUpperCase())}function uC(r){function e(t){let n=r||{};return n[t]??n[ep(t)]}return{get:e}}var ku=class{capacity;#e=new Map;maxAge;constructor(e){this.capacity=e.capacity,this.maxAge=e.maxAge}#t(e,t){this.#e.delete(e),this.#e.set(e,{value:t,lastAccessed:Date.now()})}set(e,t){this.#t(e,t),this.#r()}get(e){let t=this.#e.get(e);if(t)return this.#t(e,t.value),this.#r(),t.value}#r(){let e=this.maxAge?Date.now()-this.maxAge:0,t=this.#e.entries().next();for(;!t.done&&(this.#e.size>this.capacity||t.value[1].lastAccessed<e);)this.#e.delete(t.value[0]),t=this.#e.entries().next()}};pr.LRUCache=ku;function cC(r){return Object.entries(r).forEach(([e,t])=>{(t===void 0||t==="undefined")&&delete r[e]}),r}async function lC(r){try{return(await sC.promises.lstat(r)).isFile()}catch{return!1}}function fC(){let r=process.env.CLOUDSDK_CONFIG||(dC()?Fu.join(process.env.APPDATA||"",Zh):Fu.join(process.env.HOME||"",".config",Zh));return Fu.join(r,aC)}function dC(){return iC.platform().startsWith("win")}});var tp=W((ED,hC)=>{hC.exports={name:"google-auth-library",version:"10.2.0",author:"Google Inc.",description:"Google APIs Authentication Client Library for Node.js",engines:{node:">=18"},main:"./build/src/index.js",types:"./build/src/index.d.ts",repository:"googleapis/google-auth-library-nodejs.git",keywords:["google","api","google apis","client","client library"],dependencies:{"base64-js":"^1.3.0","ecdsa-sig-formatter":"^1.0.11",gaxios:"^7.0.0","gcp-metadata":"^7.0.0","google-logging-utils":"^1.0.0",gtoken:"^8.0.0",jws:"^4.0.0"},devDependencies:{"@types/base64-js":"^1.2.5","@types/jws":"^3.1.0","@types/mocha":"^10.0.10","@types/mv":"^2.1.0","@types/ncp":"^2.0.1","@types/node":"^22.0.0","@types/sinon":"^17.0.0","assert-rejects":"^1.0.0",c8:"^10.0.0",codecov:"^3.0.2",gts:"^6.0.0","is-docker":"^3.0.0",jsdoc:"^4.0.0","jsdoc-fresh":"^4.0.0","jsdoc-region-tag":"^3.0.0",karma:"^6.0.0","karma-chrome-launcher":"^3.0.0","karma-coverage":"^2.0.0","karma-firefox-launcher":"^2.0.0","karma-mocha":"^2.0.0","karma-sourcemap-loader":"^0.4.0","karma-webpack":"^5.0.1",keypair:"^1.0.4",linkinator:"^6.1.2",mocha:"^11.1.0",mv:"^2.1.1",ncp:"^2.0.0",nock:"^14.0.1","null-loader":"^4.0.0",puppeteer:"^24.0.0",sinon:"^21.0.0","ts-loader":"^8.0.0",typescript:"^5.1.6",webpack:"^5.21.2","webpack-cli":"^4.0.0"},files:["build/src","!build/src/**/*.map"],scripts:{test:"c8 mocha build/test",clean:"gts clean",prepare:"npm run compile",lint:"gts check --no-inline-config",compile:"tsc -p .",fix:"gts fix",pretest:"npm run compile -- --sourceMap",docs:"jsdoc -c .jsdoc.js","samples-setup":"cd samples/ && npm link ../ && npm run setup && cd ../","samples-test":"cd samples/ && npm link ../ && npm test && cd ../","system-test":"mocha build/system-test --timeout 60000","presystem-test":"npm run compile -- --sourceMap",webpack:"webpack","browser-test":"karma start","docs-test":"linkinator docs","predocs-test":"npm run docs",prelint:"cd samples; npm link ../; npm install"},license:"Apache-2.0"}});var Ou=W(xr=>{"use strict";Object.defineProperty(xr,"__esModule",{value:!0});xr.USER_AGENT=xr.PRODUCT_NAME=xr.pkg=void 0;var rp=tp();xr.pkg=rp;var np="google-api-nodejs-client";xr.PRODUCT_NAME=np;var pC=`${np}/${rp.version}`;xr.USER_AGENT=pC});var pt=W(Lt=>{"use strict";Object.defineProperty(Lt,"__esModule",{value:!0});Lt.AuthClient=Lt.DEFAULT_EAGER_REFRESH_THRESHOLD_MILLIS=Lt.DEFAULT_UNIVERSE=void 0;var mC=require("events"),Pu=$e(),gC=jt(),yC=yu(),xu=Ou();Lt.DEFAULT_UNIVERSE="googleapis.com";Lt.DEFAULT_EAGER_REFRESH_THRESHOLD_MILLIS=5*60*1e3;var Bu=class r extends mC.EventEmitter{apiKey;projectId;quotaProjectId;transporter;credentials={};eagerRefreshThresholdMillis=Lt.DEFAULT_EAGER_REFRESH_THRESHOLD_MILLIS;forceRefreshOnFailure=!1;universeDomain=Lt.DEFAULT_UNIVERSE;static RequestMethodNameSymbol=Symbol("request method name");static RequestLogIdSymbol=Symbol("request log id");constructor(e={}){super();let t=(0,gC.originalOrCamelOptions)(e);this.apiKey=e.apiKey,this.projectId=t.get("project_id")??null,this.quotaProjectId=t.get("quota_project_id"),this.credentials=t.get("credentials")??{},this.universeDomain=t.get("universe_domain")??Lt.DEFAULT_UNIVERSE,this.transporter=e.transporter??new Pu.Gaxios(e.transporterOptions),t.get("useAuthRequestParameters")!==!1&&(this.transporter.interceptors.request.add(r.DEFAULT_REQUEST_INTERCEPTOR),this.transporter.interceptors.response.add(r.DEFAULT_RESPONSE_INTERCEPTOR)),e.eagerRefreshThresholdMillis&&(this.eagerRefreshThresholdMillis=e.eagerRefreshThresholdMillis),this.forceRefreshOnFailure=e.forceRefreshOnFailure??!1}fetch(...e){let t=e[0],n=e[1],s,a=new Headers;return typeof t=="string"?s=new URL(t):t instanceof URL?s=t:t&&t.url&&(s=new URL(t.url)),t&&typeof t=="object"&&"headers"in t&&Pu.Gaxios.mergeHeaders(a,t.headers),n&&Pu.Gaxios.mergeHeaders(a,new Headers(n.headers)),typeof t=="object"&&!(t instanceof URL)?this.request({...n,...t,headers:a,url:s}):this.request({...n,headers:a,url:s})}setCredentials(e){this.credentials=e}addSharedMetadataHeaders(e){return!e.has("x-goog-user-project")&&this.quotaProjectId&&e.set("x-goog-user-project",this.quotaProjectId),e}addUserProjectAndAuthHeaders(e,t){let n=t.get("x-goog-user-project"),s=t.get("authorization");return n&&e.set("x-goog-user-project",n),s&&e.set("authorization",s),e}static log=(0,yC.log)("auth");static DEFAULT_REQUEST_INTERCEPTOR={resolved:async e=>{if(!e.headers.has("x-goog-api-client")){let n=process.version.replace(/^v/,"");e.headers.set("x-goog-api-client",`gl-node/${n}`)}let t=e.headers.get("User-Agent");t?t.includes(`${xu.PRODUCT_NAME}/`)||e.headers.set("User-Agent",`${t} ${xu.USER_AGENT}`):e.headers.set("User-Agent",xu.USER_AGENT);try{let n=e,s=n[r.RequestMethodNameSymbol],a=`${Math.floor(Math.random()*1e3)}`;n[r.RequestLogIdSymbol]=a;let c={url:e.url,headers:e.headers};s?r.log.info("%s [%s] request %j",s,a,c):r.log.info("[%s] request %j",a,c)}catch{}return e}};static DEFAULT_RESPONSE_INTERCEPTOR={resolved:async e=>{try{let t=e.config,n=t[r.RequestMethodNameSymbol],s=t[r.RequestLogIdSymbol];n?r.log.info("%s [%s] response %j",n,s,e.data):r.log.info("[%s] response %j",s,e.data)}catch{}return e},rejected:async e=>{try{let t=e.config,n=t[r.RequestMethodNameSymbol],s=t[r.RequestLogIdSymbol];n?r.log.info("%s [%s] error %j",n,s,e.response?.data):r.log.error("[%s] error %j",s,e.response?.data)}catch{}throw e}};static setMethodName(e,t){try{let n=e;n[r.RequestMethodNameSymbol]=t}catch{}}static get RETRY_CONFIG(){return{retry:!0,retryConfig:{httpMethodsToRetry:["GET","PUT","POST","HEAD","OPTIONS","DELETE"]}}}};Lt.AuthClient=Bu});var Nu=W(ri=>{"use strict";Object.defineProperty(ri,"__esModule",{value:!0});ri.LoginTicket=void 0;var Iu=class{envelope;payload;constructor(e,t){this.envelope=e,this.payload=t}getEnvelope(){return this.envelope}getPayload(){return this.payload}getUserId(){let e=this.getPayload();return e&&e.sub?e.sub:null}getAttributes(){return{envelope:this.getEnvelope(),payload:this.getPayload()}}};ri.LoginTicket=Iu});var tn=W(Kt=>{"use strict";Object.defineProperty(Kt,"__esModule",{value:!0});Kt.OAuth2Client=Kt.ClientAuthentication=Kt.CertificateFormat=Kt.CodeChallengeMethod=void 0;var op=$e(),_C=require("querystring"),CC=require("stream"),bC=Ru(),sp=jt(),qu=_o(),On=pt(),EC=Nu(),ip;(function(r){r.Plain="plain",r.S256="S256"})(ip||(Kt.CodeChallengeMethod=ip={}));var mr;(function(r){r.PEM="PEM",r.JWK="JWK"})(mr||(Kt.CertificateFormat=mr={}));var Co;(function(r){r.ClientSecretPost="ClientSecretPost",r.ClientSecretBasic="ClientSecretBasic",r.None="None"})(Co||(Kt.ClientAuthentication=Co={}));var ju=class r extends On.AuthClient{redirectUri;certificateCache={};certificateExpiry=null;certificateCacheFormat=mr.PEM;refreshTokenPromises=new Map;endpoints;issuers;clientAuthentication;_clientId;_clientSecret;refreshHandler;constructor(e={},t,n){super(typeof e=="object"?e:{}),typeof e!="object"&&(e={clientId:e,clientSecret:t,redirectUri:n}),this._clientId=e.clientId||e.client_id,this._clientSecret=e.clientSecret||e.client_secret,this.redirectUri=e.redirectUri||e.redirect_uris?.[0],this.endpoints={tokenInfoUrl:"https://oauth2.googleapis.com/tokeninfo",oauth2AuthBaseUrl:"https://accounts.google.com/o/oauth2/v2/auth",oauth2TokenUrl:"https://oauth2.googleapis.com/token",oauth2RevokeUrl:"https://oauth2.googleapis.com/revoke",oauth2FederatedSignonPemCertsUrl:"https://www.googleapis.com/oauth2/v1/certs",oauth2FederatedSignonJwkCertsUrl:"https://www.googleapis.com/oauth2/v3/certs",oauth2IapPublicKeyUrl:"https://www.gstatic.com/iap/verify/public_key",...e.endpoints},this.clientAuthentication=e.clientAuthentication||Co.ClientSecretPost,this.issuers=e.issuers||["accounts.google.com","https://accounts.google.com",this.universeDomain]}static GOOGLE_TOKEN_INFO_URL="https://oauth2.googleapis.com/tokeninfo";static CLOCK_SKEW_SECS_=300;static DEFAULT_MAX_TOKEN_LIFETIME_SECS_=86400;generateAuthUrl(e={}){if(e.code_challenge_method&&!e.code_challenge)throw new Error("If a code_challenge_method is provided, code_challenge must be included.");return e.response_type=e.response_type||"code",e.client_id=e.client_id||this._clientId,e.redirect_uri=e.redirect_uri||this.redirectUri,Array.isArray(e.scope)&&(e.scope=e.scope.join(" ")),this.endpoints.oauth2AuthBaseUrl.toString()+"?"+_C.stringify(e)}generateCodeVerifier(){throw new Error("generateCodeVerifier is removed, please use generateCodeVerifierAsync instead.")}async generateCodeVerifierAsync(){let e=(0,qu.createCrypto)(),n=e.randomBytesBase64(96).replace(/\+/g,"~").replace(/=/g,"_").replace(/\//g,"-"),a=(await e.sha256DigestBase64(n)).split("=")[0].replace(/\+/g,"-").replace(/\//g,"_");return{codeVerifier:n,codeChallenge:a}}getToken(e,t){let n=typeof e=="string"?{code:e}:e;if(t)this.getTokenAsync(n).then(s=>t(null,s.tokens,s.res),s=>t(s,null,s.response));else return this.getTokenAsync(n)}async getTokenAsync(e){let t=this.endpoints.oauth2TokenUrl.toString(),n=new Headers,s={client_id:e.client_id||this._clientId,code_verifier:e.codeVerifier,code:e.code,grant_type:"authorization_code",redirect_uri:e.redirect_uri||this.redirectUri};if(this.clientAuthentication===Co.ClientSecretBasic){let l=Buffer.from(`${this._clientId}:${this._clientSecret}`);n.set("authorization",`Basic ${l.toString("base64")}`)}this.clientAuthentication===Co.ClientSecretPost&&(s.client_secret=this._clientSecret);let a={...r.RETRY_CONFIG,method:"POST",url:t,data:new URLSearchParams((0,sp.removeUndefinedValuesInObject)(s)),headers:n};On.AuthClient.setMethodName(a,"getTokenAsync");let c=await this.transporter.request(a),f=c.data;return c.data&&c.data.expires_in&&(f.expiry_date=new Date().getTime()+c.data.expires_in*1e3,delete f.expires_in),this.emit("tokens",f),{tokens:f,res:c}}async refreshToken(e){if(!e)return this.refreshTokenNoCache(e);if(this.refreshTokenPromises.has(e))return this.refreshTokenPromises.get(e);let t=this.refreshTokenNoCache(e).then(n=>(this.refreshTokenPromises.delete(e),n),n=>{throw this.refreshTokenPromises.delete(e),n});return this.refreshTokenPromises.set(e,t),t}async refreshTokenNoCache(e){if(!e)throw new Error("No refresh token is set.");let t=this.endpoints.oauth2TokenUrl.toString(),n={refresh_token:e,client_id:this._clientId,client_secret:this._clientSecret,grant_type:"refresh_token"},s;try{let c={...r.RETRY_CONFIG,method:"POST",url:t,data:new URLSearchParams((0,sp.removeUndefinedValuesInObject)(n))};On.AuthClient.setMethodName(c,"refreshTokenNoCache"),s=await this.transporter.request(c)}catch(c){throw c instanceof op.GaxiosError&&c.message==="invalid_grant"&&c.response?.data&&/ReAuth/i.test(c.response.data.error_description)&&(c.message=JSON.stringify(c.response.data)),c}let a=s.data;return s.data&&s.data.expires_in&&(a.expiry_date=new Date().getTime()+s.data.expires_in*1e3,delete a.expires_in),this.emit("tokens",a),{tokens:a,res:s}}refreshAccessToken(e){if(e)this.refreshAccessTokenAsync().then(t=>e(null,t.credentials,t.res),e);else return this.refreshAccessTokenAsync()}async refreshAccessTokenAsync(){let e=await this.refreshToken(this.credentials.refresh_token),t=e.tokens;return t.refresh_token=this.credentials.refresh_token,this.credentials=t,{credentials:this.credentials,res:e.res}}getAccessToken(e){if(e)this.getAccessTokenAsync().then(t=>e(null,t.token,t.res),e);else return this.getAccessTokenAsync()}async getAccessTokenAsync(){if(!this.credentials.access_token||this.isTokenExpiring()){if(!this.credentials.refresh_token)if(this.refreshHandler){let n=await this.processAndValidateRefreshHandler();if(n?.access_token)return this.setCredentials(n),{token:this.credentials.access_token}}else throw new Error("No refresh token or refresh handler callback is set.");let t=await this.refreshAccessTokenAsync();if(!t.credentials||t.credentials&&!t.credentials.access_token)throw new Error("Could not refresh access token.");return{token:t.credentials.access_token,res:t.res}}else return{token:this.credentials.access_token}}async getRequestHeaders(e){return(await this.getRequestMetadataAsync(e)).headers}async getRequestMetadataAsync(e){let t=this.credentials;if(!t.access_token&&!t.refresh_token&&!this.apiKey&&!this.refreshHandler)throw new Error("No access, refresh token, API key or refresh handler callback is set.");if(t.access_token&&!this.isTokenExpiring()){t.token_type=t.token_type||"Bearer";let f=new Headers({authorization:t.token_type+" "+t.access_token});return{headers:this.addSharedMetadataHeaders(f)}}if(this.refreshHandler){let f=await this.processAndValidateRefreshHandler();if(f?.access_token){this.setCredentials(f);let l=new Headers({authorization:"Bearer "+this.credentials.access_token});return{headers:this.addSharedMetadataHeaders(l)}}}if(this.apiKey)return{headers:new Headers({"X-Goog-Api-Key":this.apiKey})};let n=null,s=null;try{n=await this.refreshToken(t.refresh_token),s=n.tokens}catch(f){let l=f;throw l.response&&(l.response.status===403||l.response.status===404)&&(l.message=`Could not refresh access token: ${l.message}`),l}let a=this.credentials;a.token_type=a.token_type||"Bearer",s.refresh_token=a.refresh_token,this.credentials=s;let c=new Headers({authorization:a.token_type+" "+s.access_token});return{headers:this.addSharedMetadataHeaders(c),res:n.res}}static getRevokeTokenUrl(e){return new r().getRevokeTokenURL(e).toString()}getRevokeTokenURL(e){let t=new URL(this.endpoints.oauth2RevokeUrl);return t.searchParams.append("token",e),t}revokeToken(e,t){let n={...r.RETRY_CONFIG,url:this.getRevokeTokenURL(e).toString(),method:"POST"};if(On.AuthClient.setMethodName(n,"revokeToken"),t)this.transporter.request(n).then(s=>t(null,s),t);else return this.transporter.request(n)}revokeCredentials(e){if(e)this.revokeCredentialsAsync().then(t=>e(null,t),e);else return this.revokeCredentialsAsync()}async revokeCredentialsAsync(){let e=this.credentials.access_token;if(this.credentials={},e)return this.revokeToken(e);throw new Error("No access token to revoke.")}request(e,t){if(t)this.requestAsync(e).then(n=>t(null,n),n=>t(n,n.response));else return this.requestAsync(e)}async requestAsync(e,t=!1){try{let n=await this.getRequestMetadataAsync();return e.headers=op.Gaxios.mergeHeaders(e.headers),this.addUserProjectAndAuthHeaders(e.headers,n.headers),this.apiKey&&e.headers.set("X-Goog-Api-Key",this.apiKey),await this.transporter.request(e)}catch(n){let s=n.response;if(s){let a=s.status,c=this.credentials&&this.credentials.access_token&&this.credentials.refresh_token&&(!this.credentials.expiry_date||this.forceRefreshOnFailure),f=this.credentials&&this.credentials.access_token&&!this.credentials.refresh_token&&(!this.credentials.expiry_date||this.forceRefreshOnFailure)&&this.refreshHandler,l=s.config.data instanceof CC.Readable,d=a===401||a===403;if(!t&&d&&!l&&c)return await this.refreshAccessTokenAsync(),this.requestAsync(e,!0);if(!t&&d&&!l&&f){let h=await this.processAndValidateRefreshHandler();return h?.access_token&&this.setCredentials(h),this.requestAsync(e,!0)}}throw n}}verifyIdToken(e,t){if(t&&typeof t!="function")throw new Error("This method accepts an options object as the first parameter, which includes the idToken, audience, and maxExpiry.");if(t)this.verifyIdTokenAsync(e).then(n=>t(null,n),t);else return this.verifyIdTokenAsync(e)}async verifyIdTokenAsync(e){if(!e.idToken)throw new Error("The verifyIdToken method requires an ID Token");let t=await this.getFederatedSignonCertsAsync();return await this.verifySignedJwtWithCertsAsync(e.idToken,t.certs,e.audience,this.issuers,e.maxExpiry)}async getTokenInfo(e){let{data:t}=await this.transporter.request({...r.RETRY_CONFIG,method:"POST",headers:{"content-type":"application/x-www-form-urlencoded;charset=UTF-8",authorization:`Bearer ${e}`},url:this.endpoints.tokenInfoUrl.toString()}),n=Object.assign({expiry_date:new Date().getTime()+t.expires_in*1e3,scopes:t.scope.split(" ")},t);return delete n.expires_in,delete n.scope,n}getFederatedSignonCerts(e){if(e)this.getFederatedSignonCertsAsync().then(t=>e(null,t.certs,t.res),e);else return this.getFederatedSignonCertsAsync()}async getFederatedSignonCertsAsync(){let e=new Date().getTime(),t=(0,qu.hasBrowserCrypto)()?mr.JWK:mr.PEM;if(this.certificateExpiry&&e<this.certificateExpiry.getTime()&&this.certificateCacheFormat===t)return{certs:this.certificateCache,format:t};let n,s;switch(t){case mr.PEM:s=this.endpoints.oauth2FederatedSignonPemCertsUrl.toString();break;case mr.JWK:s=this.endpoints.oauth2FederatedSignonJwkCertsUrl.toString();break;default:throw new Error(`Unsupported certificate format ${t}`)}try{let d={...r.RETRY_CONFIG,url:s};On.AuthClient.setMethodName(d,"getFederatedSignonCertsAsync"),n=await this.transporter.request(d)}catch(d){throw d instanceof Error&&(d.message=`Failed to retrieve verification certificates: ${d.message}`),d}let a=n?.headers.get("cache-control"),c=-1;if(a){let d=/max-age=(?<maxAge>[0-9]+)/.exec(a)?.groups?.maxAge;d&&(c=Number(d)*1e3)}let f={};switch(t){case mr.PEM:f=n.data;break;case mr.JWK:for(let d of n.data.keys)f[d.kid]=d;break;default:throw new Error(`Unsupported certificate format ${t}`)}let l=new Date;return this.certificateExpiry=c===-1?null:new Date(l.getTime()+c),this.certificateCache=f,this.certificateCacheFormat=t,{certs:f,format:t,res:n}}getIapPublicKeys(e){if(e)this.getIapPublicKeysAsync().then(t=>e(null,t.pubkeys,t.res),e);else return this.getIapPublicKeysAsync()}async getIapPublicKeysAsync(){let e,t=this.endpoints.oauth2IapPublicKeyUrl.toString();try{let n={...r.RETRY_CONFIG,url:t};On.AuthClient.setMethodName(n,"getIapPublicKeysAsync"),e=await this.transporter.request(n)}catch(n){throw n instanceof Error&&(n.message=`Failed to retrieve verification certificates: ${n.message}`),n}return{pubkeys:e.data,res:e}}verifySignedJwtWithCerts(){throw new Error("verifySignedJwtWithCerts is removed, please use verifySignedJwtWithCertsAsync instead.")}async verifySignedJwtWithCertsAsync(e,t,n,s,a){let c=(0,qu.createCrypto)();a||(a=r.DEFAULT_MAX_TOKEN_LIFETIME_SECS_);let f=e.split(".");if(f.length!==3)throw new Error("Wrong number of segments in token: "+e);let l=f[0]+"."+f[1],d=f[2],h,b;try{h=JSON.parse(c.decodeBase64StringUtf8(f[0]))}catch(k){throw k instanceof Error&&(k.message=`Can't parse token envelope: ${f[0]}': ${k.message}`),k}if(!h)throw new Error("Can't parse token envelope: "+f[0]);try{b=JSON.parse(c.decodeBase64StringUtf8(f[1]))}catch(k){throw k instanceof Error&&(k.message=`Can't parse token payload '${f[0]}`),k}if(!b)throw new Error("Can't parse token payload: "+f[1]);if(!Object.prototype.hasOwnProperty.call(t,h.kid))throw new Error("No pem found for envelope: "+JSON.stringify(h));let A=t[h.kid];if(h.alg==="ES256"&&(d=bC.joseToDer(d,"ES256").toString("base64")),!await c.verify(A,l,d))throw new Error("Invalid token signature: "+e);if(!b.iat)throw new Error("No issue time in token: "+JSON.stringify(b));if(!b.exp)throw new Error("No expiration time in token: "+JSON.stringify(b));let S=Number(b.iat);if(isNaN(S))throw new Error("iat field using invalid format");let y=Number(b.exp);if(isNaN(y))throw new Error("exp field using invalid format");let C=new Date().getTime()/1e3;if(y>=C+a)throw new Error("Expiration time too far in future: "+JSON.stringify(b));let _=S-r.CLOCK_SKEW_SECS_,F=y+r.CLOCK_SKEW_SECS_;if(C<_)throw new Error("Token used too early, "+C+" < "+_+": "+JSON.stringify(b));if(C>F)throw new Error("Token used too late, "+C+" > "+F+": "+JSON.stringify(b));if(s&&s.indexOf(b.iss)<0)throw new Error("Invalid issuer, expected one of ["+s+"], but got "+b.iss);if(typeof n<"u"&&n!==null){let k=b.aud,U=!1;if(n.constructor===Array?U=n.indexOf(k)>-1:U=k===n,!U)throw new Error("Wrong recipient, payload audience != requiredAudience")}return new EC.LoginTicket(h,b)}async processAndValidateRefreshHandler(){if(this.refreshHandler){let e=await this.refreshHandler();if(!e.access_token)throw new Error("No access token is returned by the refreshHandler callback.");return e}}isTokenExpiring(){let e=this.credentials.expiry_date;return e?e<=new Date().getTime()+this.eagerRefreshThresholdMillis:!1}};Kt.OAuth2Client=ju});var Uu=W(ni=>{"use strict";Object.defineProperty(ni,"__esModule",{value:!0});ni.Compute=void 0;var AC=$e(),ap=yo(),wC=tn(),Lu=class extends wC.OAuth2Client{serviceAccountEmail;scopes;constructor(e={}){super(e),this.credentials={expiry_date:1,refresh_token:"compute-placeholder"},this.serviceAccountEmail=e.serviceAccountEmail||"default",this.scopes=Array.isArray(e.scopes)?e.scopes:e.scopes?[e.scopes]:[]}async refreshTokenNoCache(){let e=`service-accounts/${this.serviceAccountEmail}/token`,t;try{let s={property:e};this.scopes.length>0&&(s.params={scopes:this.scopes.join(",")}),t=await ap.instance(s)}catch(s){throw s instanceof AC.GaxiosError&&(s.message=`Could not refresh access token: ${s.message}`,this.wrapError(s)),s}let n=t;return t&&t.expires_in&&(n.expiry_date=new Date().getTime()+t.expires_in*1e3,delete n.expires_in),this.emit("tokens",n),{tokens:n,res:null}}async fetchIdToken(e){let t=`service-accounts/${this.serviceAccountEmail}/identity?format=full&audience=${e}`,n;try{let s={property:t};n=await ap.instance(s)}catch(s){throw s instanceof Error&&(s.message=`Could not fetch ID token: ${s.message}`),s}return n}wrapError(e){let t=e.response;t&&t.status&&(e.status=t.status,t.status===403?e.message="A Forbidden error was returned while attempting to retrieve an access token for the Compute Engine built-in service account. This may be because the Compute Engine instance does not have the correct permission scopes specified: "+e.message:t.status===404&&(e.message="A Not Found error was returned while attempting to retrieve an accesstoken for the Compute Engine built-in service account. This may be because the Compute Engine instance does not have any permission scopes specified: "+e.message))}};ni.Compute=Lu});var $u=W(oi=>{"use strict";Object.defineProperty(oi,"__esModule",{value:!0});oi.IdTokenClient=void 0;var DC=tn(),Mu=class extends DC.OAuth2Client{targetAudience;idTokenProvider;constructor(e){super(e),this.targetAudience=e.targetAudience,this.idTokenProvider=e.idTokenProvider}async getRequestMetadataAsync(){if(!this.credentials.id_token||!this.credentials.expiry_date||this.isTokenExpiring()){let t=await this.idTokenProvider.fetchIdToken(this.targetAudience);this.credentials={id_token:t,expiry_date:this.getIdTokenExpiryDate(t)}}return{headers:new Headers({authorization:"Bearer "+this.credentials.id_token})}}getIdTokenExpiryDate(e){let t=e.split(".")[1];if(t)return JSON.parse(Buffer.from(t,"base64").toString("ascii")).exp*1e3}};oi.IdTokenClient=Mu});var Hu=W(Pn=>{"use strict";Object.defineProperty(Pn,"__esModule",{value:!0});Pn.GCPEnv=void 0;Pn.clear=SC;Pn.getEnv=vC;var up=yo(),gr;(function(r){r.APP_ENGINE="APP_ENGINE",r.KUBERNETES_ENGINE="KUBERNETES_ENGINE",r.CLOUD_FUNCTIONS="CLOUD_FUNCTIONS",r.COMPUTE_ENGINE="COMPUTE_ENGINE",r.CLOUD_RUN="CLOUD_RUN",r.NONE="NONE"})(gr||(Pn.GCPEnv=gr={}));var bo;function SC(){bo=void 0}async function vC(){return bo||(bo=TC(),bo)}async function TC(){let r=gr.NONE;return RC()?r=gr.APP_ENGINE:FC()?r=gr.CLOUD_FUNCTIONS:await PC()?await OC()?r=gr.KUBERNETES_ENGINE:kC()?r=gr.CLOUD_RUN:r=gr.COMPUTE_ENGINE:r=gr.NONE,r}function RC(){return!!(process.env.GAE_SERVICE||process.env.GAE_MODULE_NAME)}function FC(){return!!(process.env.FUNCTION_NAME||process.env.FUNCTION_TARGET)}function kC(){return!!process.env.K_CONFIGURATION}async function OC(){try{return await up.instance("attributes/cluster-name"),!0}catch{return!1}}async function PC(){return up.isAvailable()}});var Gu=W((FD,cp)=>{var si=kn().Buffer,xC=require("stream"),BC=require("util");function ii(r){if(this.buffer=null,this.writable=!0,this.readable=!0,!r)return this.buffer=si.alloc(0),this;if(typeof r.pipe=="function")return this.buffer=si.alloc(0),r.pipe(this),this;if(r.length||typeof r=="object")return this.buffer=r,this.writable=!1,process.nextTick(function(){this.emit("end",r),this.readable=!1,this.emit("close")}.bind(this)),this;throw new TypeError("Unexpected data type ("+typeof r+")")}BC.inherits(ii,xC);ii.prototype.write=function(e){this.buffer=si.concat([this.buffer,si.from(e)]),this.emit("data",e)};ii.prototype.end=function(e){e&&this.write(e),this.emit("end",e),this.emit("close"),this.writable=!1,this.readable=!1};cp.exports=ii});var fp=W((kD,lp)=>{"use strict";var Eo=require("buffer").Buffer,Wu=require("buffer").SlowBuffer;lp.exports=ai;function ai(r,e){if(!Eo.isBuffer(r)||!Eo.isBuffer(e)||r.length!==e.length)return!1;for(var t=0,n=0;n<r.length;n++)t|=r[n]^e[n];return t===0}ai.install=function(){Eo.prototype.equal=Wu.prototype.equal=function(e){return ai(this,e)}};var IC=Eo.prototype.equal,NC=Wu.prototype.equal;ai.restore=function(){Eo.prototype.equal=IC,Wu.prototype.equal=NC}});var Ku=W((OD,bp)=>{var Bn=kn().Buffer,vt=require("crypto"),hp=Ru(),dp=require("util"),qC=`"%s" is not a valid algorithm.
  Supported algorithms are:
  "HS256", "HS384", "HS512", "RS256", "RS384", "RS512", "PS256", "PS384", "PS512", "ES256", "ES384", "ES512" and "none".`,Ao="secret must be a string or buffer",xn="key must be a string or a buffer",jC="key must be a string, a buffer or an object",Ju=typeof vt.createPublicKey=="function";Ju&&(xn+=" or a KeyObject",Ao+="or a KeyObject");function pp(r){if(!Bn.isBuffer(r)&&typeof r!="string"&&(!Ju||typeof r!="object"||typeof r.type!="string"||typeof r.asymmetricKeyType!="string"||typeof r.export!="function"))throw Ut(xn)}function mp(r){if(!Bn.isBuffer(r)&&typeof r!="string"&&typeof r!="object")throw Ut(jC)}function LC(r){if(!Bn.isBuffer(r)){if(typeof r=="string")return r;if(!Ju||typeof r!="object"||r.type!=="secret"||typeof r.export!="function")throw Ut(Ao)}}function Vu(r){return r.replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function gp(r){r=r.toString();var e=4-r.length%4;if(e!==4)for(var t=0;t<e;++t)r+="=";return r.replace(/\-/g,"+").replace(/_/g,"/")}function Ut(r){var e=[].slice.call(arguments,1),t=dp.format.bind(dp,r).apply(null,e);return new TypeError(t)}function UC(r){return Bn.isBuffer(r)||typeof r=="string"}function wo(r){return UC(r)||(r=JSON.stringify(r)),r}function yp(r){return function(t,n){LC(n),t=wo(t);var s=vt.createHmac("sha"+r,n),a=(s.update(t),s.digest("base64"));return Vu(a)}}var zu,MC="timingSafeEqual"in vt?function(e,t){return e.byteLength!==t.byteLength?!1:vt.timingSafeEqual(e,t)}:function(e,t){return zu||(zu=fp()),zu(e,t)};function $C(r){return function(t,n,s){var a=yp(r)(t,s);return MC(Bn.from(n),Bn.from(a))}}function _p(r){return function(t,n){mp(n),t=wo(t);var s=vt.createSign("RSA-SHA"+r),a=(s.update(t),s.sign(n,"base64"));return Vu(a)}}function Cp(r){return function(t,n,s){pp(s),t=wo(t),n=gp(n);var a=vt.createVerify("RSA-SHA"+r);return a.update(t),a.verify(s,n,"base64")}}function HC(r){return function(t,n){mp(n),t=wo(t);var s=vt.createSign("RSA-SHA"+r),a=(s.update(t),s.sign({key:n,padding:vt.constants.RSA_PKCS1_PSS_PADDING,saltLength:vt.constants.RSA_PSS_SALTLEN_DIGEST},"base64"));return Vu(a)}}function GC(r){return function(t,n,s){pp(s),t=wo(t),n=gp(n);var a=vt.createVerify("RSA-SHA"+r);return a.update(t),a.verify({key:s,padding:vt.constants.RSA_PKCS1_PSS_PADDING,saltLength:vt.constants.RSA_PSS_SALTLEN_DIGEST},n,"base64")}}function WC(r){var e=_p(r);return function(){var n=e.apply(null,arguments);return n=hp.derToJose(n,"ES"+r),n}}function zC(r){var e=Cp(r);return function(n,s,a){s=hp.joseToDer(s,"ES"+r).toString("base64");var c=e(n,s,a);return c}}function JC(){return function(){return""}}function VC(){return function(e,t){return t===""}}bp.exports=function(e){var t={hs:yp,rs:_p,ps:HC,es:WC,none:JC},n={hs:$C,rs:Cp,ps:GC,es:zC,none:VC},s=e.match(/^(RS|PS|ES|HS)(256|384|512)$|^(none)$/);if(!s)throw Ut(qC,e);var a=(s[1]||s[3]).toLowerCase(),c=s[2];return{sign:t[a](c),verify:n[a](c)}}});var Yu=W((PD,Ep)=>{var KC=require("buffer").Buffer;Ep.exports=function(e){return typeof e=="string"?e:typeof e=="number"||KC.isBuffer(e)?e.toString():JSON.stringify(e)}});var Tp=W((xD,vp)=>{var YC=kn().Buffer,Ap=Gu(),XC=Ku(),QC=require("stream"),wp=Yu(),Xu=require("util");function Dp(r,e){return YC.from(r,e).toString("base64").replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function ZC(r,e,t){t=t||"utf8";var n=Dp(wp(r),"binary"),s=Dp(wp(e),t);return Xu.format("%s.%s",n,s)}function Sp(r){var e=r.header,t=r.payload,n=r.secret||r.privateKey,s=r.encoding,a=XC(e.alg),c=ZC(e,t,s),f=a.sign(c,n);return Xu.format("%s.%s",c,f)}function ui(r){var e=r.secret||r.privateKey||r.key,t=new Ap(e);this.readable=!0,this.header=r.header,this.encoding=r.encoding,this.secret=this.privateKey=this.key=t,this.payload=new Ap(r.payload),this.secret.once("close",function(){!this.payload.writable&&this.readable&&this.sign()}.bind(this)),this.payload.once("close",function(){!this.secret.writable&&this.readable&&this.sign()}.bind(this))}Xu.inherits(ui,QC);ui.prototype.sign=function(){try{var e=Sp({header:this.header,payload:this.payload.buffer,secret:this.secret.buffer,encoding:this.encoding});return this.emit("done",e),this.emit("data",e),this.emit("end"),this.readable=!1,e}catch(t){this.readable=!1,this.emit("error",t),this.emit("close")}};ui.sign=Sp;vp.exports=ui});var qp=W((BD,Np)=>{var Fp=kn().Buffer,Rp=Gu(),eb=Ku(),tb=require("stream"),kp=Yu(),rb=require("util"),nb=/^[a-zA-Z0-9\-_]+?\.[a-zA-Z0-9\-_]+?\.([a-zA-Z0-9\-_]+)?$/;function ob(r){return Object.prototype.toString.call(r)==="[object Object]"}function sb(r){if(ob(r))return r;try{return JSON.parse(r)}catch{return}}function Op(r){var e=r.split(".",1)[0];return sb(Fp.from(e,"base64").toString("binary"))}function ib(r){return r.split(".",2).join(".")}function Pp(r){return r.split(".")[2]}function ab(r,e){e=e||"utf8";var t=r.split(".")[1];return Fp.from(t,"base64").toString(e)}function xp(r){return nb.test(r)&&!!Op(r)}function Bp(r,e,t){if(!e){var n=new Error("Missing algorithm parameter for jws.verify");throw n.code="MISSING_ALGORITHM",n}r=kp(r);var s=Pp(r),a=ib(r),c=eb(e);return c.verify(a,s,t)}function Ip(r,e){if(e=e||{},r=kp(r),!xp(r))return null;var t=Op(r);if(!t)return null;var n=ab(r);return(t.typ==="JWT"||e.json)&&(n=JSON.parse(n,e.encoding)),{header:t,payload:n,signature:Pp(r)}}function In(r){r=r||{};var e=r.secret||r.publicKey||r.key,t=new Rp(e);this.readable=!0,this.algorithm=r.algorithm,this.encoding=r.encoding,this.secret=this.publicKey=this.key=t,this.signature=new Rp(r.signature),this.secret.once("close",function(){!this.signature.writable&&this.readable&&this.verify()}.bind(this)),this.signature.once("close",function(){!this.secret.writable&&this.readable&&this.verify()}.bind(this))}rb.inherits(In,tb);In.prototype.verify=function(){try{var e=Bp(this.signature.buffer,this.algorithm,this.key.buffer),t=Ip(this.signature.buffer,this.encoding);return this.emit("done",e,t),this.emit("data",e),this.emit("end"),this.readable=!1,e}catch(n){this.readable=!1,this.emit("error",n),this.emit("close")}};In.decode=Ip;In.isValid=xp;In.verify=Bp;Np.exports=In});var Qu=W(Br=>{var jp=Tp(),ci=qp(),ub=["HS256","HS384","HS512","RS256","RS384","RS512","PS256","PS384","PS512","ES256","ES384","ES512"];Br.ALGORITHMS=ub;Br.sign=jp.sign;Br.verify=ci.verify;Br.decode=ci.decode;Br.isValid=ci.isValid;Br.createSign=function(e){return new jp(e)};Br.createVerify=function(e){return new ci(e)}});var Zp=W(fi=>{"use strict";Object.defineProperty(fi,"__esModule",{value:!0});fi.GoogleToken=void 0;var Lp=li(require("fs")),cb=$e(),lb=li(Qu()),fb=li(require("path")),db=require("util");function li(r,e){if(typeof WeakMap=="function")var t=new WeakMap,n=new WeakMap;return(li=function(a,c){if(!c&&a&&a.__esModule)return a;var f,l,d={__proto__:null,default:a};if(a===null||yr(a)!="object"&&typeof a!="function")return d;if(f=c?n:t){if(f.has(a))return f.get(a);f.set(a,d)}for(var h in a)h!=="default"&&{}.hasOwnProperty.call(a,h)&&((l=(f=Object.defineProperty)&&Object.getOwnPropertyDescriptor(a,h))&&(l.get||l.set)?f(d,h,l):d[h]=a[h]);return d})(r,e)}function yr(r){"@babel/helpers - typeof";return yr=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},yr(r)}function hb(r,e){Vp(r,e),e.add(r)}function pb(r,e,t){Vp(r,e),e.set(r,t)}function Vp(r,e){if(e.has(r))throw new TypeError("Cannot initialize the same private elements twice on an object")}function Up(r,e,t){return r.set(Mt(r,e),t),t}function Mp(r,e){return r.get(Mt(r,e))}function Mt(r,e,t){if(typeof r=="function"?r===e:r.has(e))return arguments.length<3?e:t;throw new TypeError("Private element is not present on this object")}function $p(r,e){for(var t=0;t<e.length;t++){var n=e[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(r,Xp(n.key),n)}}function Kp(r,e,t){return e&&$p(r.prototype,e),t&&$p(r,t),Object.defineProperty(r,"prototype",{writable:!1}),r}function Yp(r,e){if(!(r instanceof e))throw new TypeError("Cannot call a class as a function")}function mb(r,e,t){return e=To(e),gb(r,oc()?Reflect.construct(e,t||[],To(r).constructor):e.apply(r,t))}function gb(r,e){if(e&&(yr(e)=="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return yb(r)}function yb(r){if(r===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return r}function _b(r,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");r.prototype=Object.create(e&&e.prototype,{constructor:{value:r,writable:!0,configurable:!0}}),Object.defineProperty(r,"prototype",{writable:!1}),e&&vo(r,e)}function Zu(r){var e=typeof Map=="function"?new Map:void 0;return Zu=function(n){if(n===null||!bb(n))return n;if(typeof n!="function")throw new TypeError("Super expression must either be null or a function");if(e!==void 0){if(e.has(n))return e.get(n);e.set(n,s)}function s(){return Cb(n,arguments,To(this).constructor)}return s.prototype=Object.create(n.prototype,{constructor:{value:s,enumerable:!1,writable:!0,configurable:!0}}),vo(s,n)},Zu(r)}function Cb(r,e,t){if(oc())return Reflect.construct.apply(null,arguments);var n=[null];n.push.apply(n,e);var s=new(r.bind.apply(r,n));return t&&vo(s,t.prototype),s}function oc(){try{var r=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(oc=function(){return!!r})()}function bb(r){try{return Function.toString.call(r).indexOf("[native code]")!==-1}catch{return typeof r=="function"}}function vo(r,e){return vo=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,n){return t.__proto__=n,t},vo(r,e)}function To(r){return To=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},To(r)}function mt(r,e,t){return(e=Xp(e))in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}function Xp(r){var e=Eb(r,"string");return yr(e)=="symbol"?e:e+""}function Eb(r,e){if(yr(r)!="object"||!r)return r;var t=r[Symbol.toPrimitive];if(t!==void 0){var n=t.call(r,e||"default");if(yr(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(r)}function yt(){var r,e,t=typeof Symbol=="function"?Symbol:{},n=t.iterator||"@@iterator",s=t.toStringTag||"@@toStringTag";function a(O,S,y,C){var _=S&&S.prototype instanceof f?S:f,F=Object.create(_.prototype);return gt(F,"_invoke",function(k,U,B){var j,H,Z,z=0,_e=B||[],de=!1,re={p:0,n:0,v:r,a:se,f:se.bind(r,4),d:function(ie,le){return j=ie,H=0,Z=r,re.n=le,c}};function se(Q,ie){for(H=Q,Z=ie,e=0;!de&&z&&!le&&e<_e.length;e++){var le,De=_e[e],Se=re.p,Fe=De[2];Q>3?(le=Fe===ie)&&(Z=De[(H=De[4])?5:(H=3,3)],De[4]=De[5]=r):De[0]<=Se&&((le=Q<2&&Se<De[1])?(H=0,re.v=ie,re.n=De[1]):Se<Fe&&(le=Q<3||De[0]>ie||ie>Fe)&&(De[4]=Q,De[5]=ie,re.n=Fe,H=0))}if(le||Q>1)return c;throw de=!0,ie}return function(Q,ie,le){if(z>1)throw TypeError("Generator is already running");for(de&&ie===1&&se(ie,le),H=ie,Z=le;(e=H<2?r:Z)||!de;){j||(H?H<3?(H>1&&(re.n=-1),se(H,Z)):re.n=Z:re.v=Z);try{if(z=2,j){if(H||(Q="next"),e=j[Q]){if(!(e=e.call(j,Z)))throw TypeError("iterator result is not an object");if(!e.done)return e;Z=e.value,H<2&&(H=0)}else H===1&&(e=j.return)&&e.call(j),H<2&&(Z=TypeError("The iterator does not provide a '"+Q+"' method"),H=1);j=r}else if((e=(de=re.n<0)?Z:k.call(U,re))!==c)break}catch(De){j=r,H=1,Z=De}finally{z=1}}return{value:e,done:de}}}(O,y,C),!0),F}var c={};function f(){}function l(){}function d(){}e=Object.getPrototypeOf;var h=[][n]?e(e([][n]())):(gt(e={},n,function(){return this}),e),b=d.prototype=f.prototype=Object.create(h);function A(O){return Object.setPrototypeOf?Object.setPrototypeOf(O,d):(O.__proto__=d,gt(O,s,"GeneratorFunction")),O.prototype=Object.create(b),O}return l.prototype=d,gt(b,"constructor",d),gt(d,"constructor",l),l.displayName="GeneratorFunction",gt(d,s,"GeneratorFunction"),gt(b),gt(b,s,"Generator"),gt(b,n,function(){return this}),gt(b,"toString",function(){return"[object Generator]"}),(yt=function(){return{w:a,m:A}})()}function gt(r,e,t,n){var s=Object.defineProperty;try{s({},"",{})}catch{s=0}gt=function(c,f,l,d){if(f)s?s(c,f,{value:l,enumerable:!d,configurable:!d,writable:!d}):c[f]=l;else{var h=function(A,O){gt(c,A,function(S){return this._invoke(A,O,S)})};h("next",0),h("throw",1),h("return",2)}},gt(r,e,t,n)}function Hp(r,e,t,n,s,a,c){try{var f=r[a](c),l=f.value}catch(d){return void t(d)}f.done?e(l):Promise.resolve(l).then(n,s)}function Nn(r){return function(){var e=this,t=arguments;return new Promise(function(n,s){var a=r.apply(e,t);function c(l){Hp(a,n,s,c,f,"next",l)}function f(l){Hp(a,n,s,c,f,"throw",l)}c(void 0)})}}var Gp=Lp.readFile?(0,db.promisify)(Lp.readFile):Nn(yt().m(function r(){return yt().w(function(e){for(;;)switch(e.n){case 0:throw new So("use key rather than keyFile.","MISSING_CREDENTIALS");case 1:return e.a(2)}},r)})),Wp="https://oauth2.googleapis.com/token",Ab="https://oauth2.googleapis.com/revoke?token=",So=function(r){function e(t,n){var s;return Yp(this,e),s=mb(this,e,[t]),mt(s,"code",void 0),s.code=n,s}return _b(e,r),Kp(e)}(Zu(Error)),Do=new WeakMap,Yt=new WeakSet,ND=fi.GoogleToken=function(){function r(e){Yp(this,r),hb(this,Yt),mt(this,"expiresAt",void 0),mt(this,"key",void 0),mt(this,"keyFile",void 0),mt(this,"iss",void 0),mt(this,"sub",void 0),mt(this,"scope",void 0),mt(this,"rawToken",void 0),mt(this,"tokenExpires",void 0),mt(this,"email",void 0),mt(this,"additionalClaims",void 0),mt(this,"eagerRefreshThresholdMillis",void 0),mt(this,"transporter",{request:function(n){return(0,cb.request)(n)}}),pb(this,Do,void 0),Mt(Yt,this,Qp).call(this,e)}return Kp(r,[{key:"accessToken",get:function(){return this.rawToken?this.rawToken.access_token:void 0}},{key:"idToken",get:function(){return this.rawToken?this.rawToken.id_token:void 0}},{key:"tokenType",get:function(){return this.rawToken?this.rawToken.token_type:void 0}},{key:"refreshToken",get:function(){return this.rawToken?this.rawToken.refresh_token:void 0}},{key:"hasExpired",value:function(){var t=new Date().getTime();return this.rawToken&&this.expiresAt?t>=this.expiresAt:!0}},{key:"isTokenExpiring",value:function(){var t,n=new Date().getTime(),s=(t=this.eagerRefreshThresholdMillis)!==null&&t!==void 0?t:0;return this.rawToken&&this.expiresAt?this.expiresAt<=n+s:!0}},{key:"getToken",value:function(t){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(yr(t)==="object"&&(n=t,t=void 0),n=Object.assign({forceRefresh:!1},n),t){var s=t;Mt(Yt,this,zp).call(this,n).then(function(a){return s(null,a)},t);return}return Mt(Yt,this,zp).call(this,n)}},{key:"getCredentials",value:function(){var e=Nn(yt().m(function n(s){var a,c,f,l,d,h,b;return yt().w(function(A){for(;;)switch(A.n){case 0:a=fb.extname(s),b=a,A.n=b===".json"?1:b===".der"||b===".crt"||b===".pem"?4:b===".p12"||b===".pfx"?6:7;break;case 1:return A.n=2,Gp(s,"utf8");case 2:if(c=A.v,f=JSON.parse(c),l=f.private_key,d=f.client_email,!(!l||!d)){A.n=3;break}throw new So("private_key and client_email are required.","MISSING_CREDENTIALS");case 3:return A.a(2,{privateKey:l,clientEmail:d});case 4:return A.n=5,Gp(s,"utf8");case 5:return h=A.v,A.a(2,{privateKey:h});case 6:throw new So("*.p12 certificates are not supported after v6.1.2. Consider utilizing *.json format or converting *.p12 to *.pem using the OpenSSL CLI.","UNKNOWN_CERTIFICATE_TYPE");case 7:throw new So("Unknown certificate type. Type is determined based on file extension. Current supported extensions are *.json, and *.pem.","UNKNOWN_CERTIFICATE_TYPE");case 8:return A.a(2)}},n)}));function t(n){return e.apply(this,arguments)}return t}()},{key:"revokeToken",value:function(t){if(t){Mt(Yt,this,Jp).call(this).then(function(){return t()},t);return}return Mt(Yt,this,Jp).call(this)}}])}();function zp(r){return ec.apply(this,arguments)}function ec(){return ec=Nn(yt().m(function r(e){return yt().w(function(t){for(;;)switch(t.n){case 0:if(!(Mp(Do,this)&&!e.forceRefresh)){t.n=1;break}return t.a(2,Mp(Do,this));case 1:return t.p=1,t.n=2,Up(Do,this,Mt(Yt,this,wb).call(this,e));case 2:return t.a(2,t.v);case 3:return t.p=3,Up(Do,this,void 0),t.f(3);case 4:return t.a(2)}},r,this,[[1,,3,4]])})),ec.apply(this,arguments)}function wb(r){return tc.apply(this,arguments)}function tc(){return tc=Nn(yt().m(function r(e){var t;return yt().w(function(n){for(;;)switch(n.n){case 0:if(!(this.isTokenExpiring()===!1&&e.forceRefresh===!1)){n.n=1;break}return n.a(2,Promise.resolve(this.rawToken));case 1:if(!(!this.key&&!this.keyFile)){n.n=2;break}throw new Error("No key or keyFile set.");case 2:if(!(!this.key&&this.keyFile)){n.n=4;break}return n.n=3,this.getCredentials(this.keyFile);case 3:t=n.v,this.key=t.privateKey,this.iss=t.clientEmail||this.iss,t.clientEmail||Mt(Yt,this,Db).call(this);case 4:return n.a(2,Mt(Yt,this,Sb).call(this))}},r,this)})),tc.apply(this,arguments)}function Db(){if(!this.iss)throw new So("email is required.","MISSING_CREDENTIALS")}function Jp(){return rc.apply(this,arguments)}function rc(){return rc=Nn(yt().m(function r(){var e;return yt().w(function(t){for(;;)switch(t.n){case 0:if(this.accessToken){t.n=1;break}throw new Error("No token to revoke.");case 1:return e=Ab+this.accessToken,t.n=2,this.transporter.request({url:e,retry:!0});case 2:Mt(Yt,this,Qp).call(this,{email:this.iss,sub:this.sub,key:this.key,keyFile:this.keyFile,scope:this.scope,additionalClaims:this.additionalClaims});case 3:return t.a(2)}},r,this)})),rc.apply(this,arguments)}function Qp(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.keyFile=r.keyFile,this.key=r.key,this.rawToken=void 0,this.iss=r.email||r.iss,this.sub=r.sub,this.additionalClaims=r.additionalClaims,yr(r.scope)==="object"?this.scope=r.scope.join(" "):this.scope=r.scope,this.eagerRefreshThresholdMillis=r.eagerRefreshThresholdMillis,r.transporter&&(this.transporter=r.transporter)}function Sb(){return nc.apply(this,arguments)}function nc(){return nc=Nn(yt().m(function r(){var e,t,n,s,a,c,f,l,d,h;return yt().w(function(b){for(;;)switch(b.n){case 0:return e=Math.floor(new Date().getTime()/1e3),t=this.additionalClaims||{},n=Object.assign({iss:this.iss,scope:this.scope,aud:Wp,exp:e+3600,iat:e,sub:this.sub},t),s=lb.sign({header:{alg:"RS256"},payload:n,secret:this.key}),b.p=1,b.n=2,this.transporter.request({method:"POST",url:Wp,data:new URLSearchParams({grant_type:"urn:ietf:params:oauth:grant-type:jwt-bearer",assertion:s}),responseType:"json",retryConfig:{httpMethodsToRetry:["POST"]}});case 2:return a=b.v,this.rawToken=a.data,this.expiresAt=a.data.expires_in===null||a.data.expires_in===void 0?void 0:(e+a.data.expires_in)*1e3,b.a(2,this.rawToken);case 3:throw b.p=3,h=b.v,this.rawToken=void 0,this.tokenExpires=void 0,l=h.response&&(c=h.response)!==null&&c!==void 0&&c.data?(f=h.response)===null||f===void 0?void 0:f.data:{},l.error&&(d=l.error_description?": ".concat(l.error_description):"",h.message="".concat(l.error).concat(d)),h;case 4:return b.a(2)}},r,this,[[1,3]])})),nc.apply(this,arguments)}});var ic=W(di=>{"use strict";Object.defineProperty(di,"__esModule",{value:!0});di.JWTAccess=void 0;var vb=Qu(),Tb=jt(),em={alg:"RS256",typ:"JWT"},sc=class r{email;key;keyId;projectId;eagerRefreshThresholdMillis;cache=new Tb.LRUCache({capacity:500,maxAge:60*60*1e3});constructor(e,t,n,s){this.email=e,this.key=t,this.keyId=n,this.eagerRefreshThresholdMillis=s??5*60*1e3}getCachedKey(e,t){let n=e;if(t&&Array.isArray(t)&&t.length?n=e?`${e}_${t.join("_")}`:`${t.join("_")}`:typeof t=="string"&&(n=e?`${e}_${t}`:t),!n)throw Error("Scopes or url must be provided");return n}getRequestHeaders(e,t,n){let s=this.getCachedKey(e,n),a=this.cache.get(s),c=Date.now();if(a&&a.expiration-c>this.eagerRefreshThresholdMillis)return new Headers(a.headers);let f=Math.floor(Date.now()/1e3),l=r.getExpirationTime(f),d;if(Array.isArray(n)&&(n=n.join(" ")),n?d={iss:this.email,sub:this.email,scope:n,exp:l,iat:f}:d={iss:this.email,sub:this.email,aud:e,exp:l,iat:f},t){for(let S in d)if(t[S])throw new Error(`The '${S}' property is not allowed when passing additionalClaims. This claim is included in the JWT by default.`)}let h=this.keyId?{...em,kid:this.keyId}:em,b=Object.assign(d,t),A=vb.sign({header:h,payload:b,secret:this.key}),O=new Headers({authorization:`Bearer ${A}`});return this.cache.set(s,{expiration:l*1e3,headers:O}),O}static getExpirationTime(e){return e+3600}fromJSON(e){if(!e)throw new Error("Must pass in a JSON object containing the service account auth settings.");if(!e.client_email)throw new Error("The incoming JSON object does not contain a client_email field");if(!e.private_key)throw new Error("The incoming JSON object does not contain a private_key field");this.email=e.client_email,this.key=e.private_key,this.keyId=e.private_key_id,this.projectId=e.project_id}fromStream(e,t){if(t)this.fromStreamAsync(e).then(()=>t(),t);else return this.fromStreamAsync(e)}fromStreamAsync(e){return new Promise((t,n)=>{e||n(new Error("Must pass in a stream containing the service account auth settings."));let s="";e.setEncoding("utf8").on("data",a=>s+=a).on("error",n).on("end",()=>{try{let a=JSON.parse(s);this.fromJSON(a),t()}catch(a){n(a)}})})}};di.JWTAccess=sc});var uc=W(pi=>{"use strict";Object.defineProperty(pi,"__esModule",{value:!0});pi.JWT=void 0;var tm=Zp(),Rb=ic(),Fb=tn(),hi=pt(),ac=class r extends Fb.OAuth2Client{email;keyFile;key;keyId;defaultScopes;scopes;scope;subject;gtoken;additionalClaims;useJWTAccessWithScope;defaultServicePath;access;constructor(e={}){super(e),this.email=e.email,this.keyFile=e.keyFile,this.key=e.key,this.keyId=e.keyId,this.scopes=e.scopes,this.subject=e.subject,this.additionalClaims=e.additionalClaims,this.credentials={refresh_token:"jwt-placeholder",expiry_date:1}}createScoped(e){let t=new r(this);return t.scopes=e,t}async getRequestMetadataAsync(e){e=this.defaultServicePath?`https://${this.defaultServicePath}/`:e;let t=!this.hasUserScopes()&&e||this.useJWTAccessWithScope&&this.hasAnyScopes()||this.universeDomain!==hi.DEFAULT_UNIVERSE;if(this.subject&&this.universeDomain!==hi.DEFAULT_UNIVERSE)throw new RangeError(`Service Account user is configured for the credential. Domain-wide delegation is not supported in universes other than ${hi.DEFAULT_UNIVERSE}`);if(!this.apiKey&&t)if(this.additionalClaims&&this.additionalClaims.target_audience){let{tokens:n}=await this.refreshToken();return{headers:this.addSharedMetadataHeaders(new Headers({authorization:`Bearer ${n.id_token}`}))}}else{this.access||(this.access=new Rb.JWTAccess(this.email,this.key,this.keyId,this.eagerRefreshThresholdMillis));let n;this.hasUserScopes()?n=this.scopes:e||(n=this.defaultScopes);let s=this.useJWTAccessWithScope||this.universeDomain!==hi.DEFAULT_UNIVERSE,a=await this.access.getRequestHeaders(e??void 0,this.additionalClaims,s?n:void 0);return{headers:this.addSharedMetadataHeaders(a)}}else return this.hasAnyScopes()||this.apiKey?super.getRequestMetadataAsync(e):{headers:new Headers}}async fetchIdToken(e){let t=new tm.GoogleToken({iss:this.email,sub:this.subject,scope:this.scopes||this.defaultScopes,keyFile:this.keyFile,key:this.key,additionalClaims:{target_audience:e},transporter:this.transporter});if(await t.getToken({forceRefresh:!0}),!t.idToken)throw new Error("Unknown error: Failed to fetch ID token");return t.idToken}hasUserScopes(){return this.scopes?this.scopes.length>0:!1}hasAnyScopes(){return!!(this.scopes&&this.scopes.length>0||this.defaultScopes&&this.defaultScopes.length>0)}authorize(e){if(e)this.authorizeAsync().then(t=>e(null,t),e);else return this.authorizeAsync()}async authorizeAsync(){let e=await this.refreshToken();if(!e)throw new Error("No result returned");return this.credentials=e.tokens,this.credentials.refresh_token="jwt-placeholder",this.key=this.gtoken.key,this.email=this.gtoken.iss,e.tokens}async refreshTokenNoCache(){let e=this.createGToken(),n={access_token:(await e.getToken({forceRefresh:this.isTokenExpiring()})).access_token,token_type:"Bearer",expiry_date:e.expiresAt,id_token:e.idToken};return this.emit("tokens",n),{res:null,tokens:n}}createGToken(){return this.gtoken||(this.gtoken=new tm.GoogleToken({iss:this.email,sub:this.subject,scope:this.scopes||this.defaultScopes,keyFile:this.keyFile,key:this.key,additionalClaims:this.additionalClaims,transporter:this.transporter})),this.gtoken}fromJSON(e){if(!e)throw new Error("Must pass in a JSON object containing the service account auth settings.");if(!e.client_email)throw new Error("The incoming JSON object does not contain a client_email field");if(!e.private_key)throw new Error("The incoming JSON object does not contain a private_key field");this.email=e.client_email,this.key=e.private_key,this.keyId=e.private_key_id,this.projectId=e.project_id,this.quotaProjectId=e.quota_project_id,this.universeDomain=e.universe_domain||this.universeDomain}fromStream(e,t){if(t)this.fromStreamAsync(e).then(()=>t(),t);else return this.fromStreamAsync(e)}fromStreamAsync(e){return new Promise((t,n)=>{if(!e)throw new Error("Must pass in a stream containing the service account auth settings.");let s="";e.setEncoding("utf8").on("error",n).on("data",a=>s+=a).on("end",()=>{try{let a=JSON.parse(s);this.fromJSON(a),t()}catch(a){n(a)}})})}fromAPIKey(e){if(typeof e!="string")throw new Error("Must provide an API Key string.");this.apiKey=e}async getCredentials(){if(this.key)return{private_key:this.key,client_email:this.email};if(this.keyFile){let t=await this.createGToken().getCredentials(this.keyFile);return{private_key:t.privateKey,client_email:t.clientEmail}}throw new Error("A key or a keyFile must be provided to getCredentials.")}};pi.JWT=ac});var lc=W(qn=>{"use strict";Object.defineProperty(qn,"__esModule",{value:!0});qn.UserRefreshClient=qn.USER_REFRESH_ACCOUNT_TYPE=void 0;var kb=tn(),Ob=pt();qn.USER_REFRESH_ACCOUNT_TYPE="authorized_user";var cc=class r extends kb.OAuth2Client{_refreshToken;constructor(e,t,n,s,a){let c=e&&typeof e=="object"?e:{clientId:e,clientSecret:t,refreshToken:n,eagerRefreshThresholdMillis:s,forceRefreshOnFailure:a};super(c),this._refreshToken=c.refreshToken,this.credentials.refresh_token=c.refreshToken}async refreshTokenNoCache(){return super.refreshTokenNoCache(this._refreshToken)}async fetchIdToken(e){let t={...r.RETRY_CONFIG,url:this.endpoints.oauth2TokenUrl,method:"POST",data:new URLSearchParams({client_id:this._clientId,client_secret:this._clientSecret,grant_type:"refresh_token",refresh_token:this._refreshToken,target_audience:e})};return Ob.AuthClient.setMethodName(t,"fetchIdToken"),(await this.transporter.request(t)).data.id_token}fromJSON(e){if(!e)throw new Error("Must pass in a JSON object containing the user refresh token");if(e.type!=="authorized_user")throw new Error('The incoming JSON object does not have the "authorized_user" type');if(!e.client_id)throw new Error("The incoming JSON object does not contain a client_id field");if(!e.client_secret)throw new Error("The incoming JSON object does not contain a client_secret field");if(!e.refresh_token)throw new Error("The incoming JSON object does not contain a refresh_token field");this._clientId=e.client_id,this._clientSecret=e.client_secret,this._refreshToken=e.refresh_token,this.credentials.refresh_token=e.refresh_token,this.quotaProjectId=e.quota_project_id,this.universeDomain=e.universe_domain||this.universeDomain}fromStream(e,t){if(t)this.fromStreamAsync(e).then(()=>t(),t);else return this.fromStreamAsync(e)}async fromStreamAsync(e){return new Promise((t,n)=>{if(!e)return n(new Error("Must pass in a stream containing the user refresh token."));let s="";e.setEncoding("utf8").on("error",n).on("data",a=>s+=a).on("end",()=>{try{let a=JSON.parse(s);return this.fromJSON(a),t()}catch(a){return n(a)}})})}static fromJSON(e){let t=new r;return t.fromJSON(e),t}};qn.UserRefreshClient=cc});var dc=W(jn=>{"use strict";Object.defineProperty(jn,"__esModule",{value:!0});jn.Impersonated=jn.IMPERSONATED_ACCOUNT_TYPE=void 0;var rm=tn(),Pb=$e(),xb=jt();jn.IMPERSONATED_ACCOUNT_TYPE="impersonated_service_account";var fc=class r extends rm.OAuth2Client{sourceClient;targetPrincipal;targetScopes;delegates;lifetime;endpoint;constructor(e={}){if(super(e),this.credentials={expiry_date:1,refresh_token:"impersonated-placeholder"},this.sourceClient=e.sourceClient??new rm.OAuth2Client,this.targetPrincipal=e.targetPrincipal??"",this.delegates=e.delegates??[],this.targetScopes=e.targetScopes??[],this.lifetime=e.lifetime??3600,!!!(0,xb.originalOrCamelOptions)(e).get("universe_domain"))this.universeDomain=this.sourceClient.universeDomain;else if(this.sourceClient.universeDomain!==this.universeDomain)throw new RangeError(`Universe domain ${this.sourceClient.universeDomain} in source credentials does not match ${this.universeDomain} universe domain set for impersonated credentials.`);this.endpoint=e.endpoint??`https://iamcredentials.${this.universeDomain}`}async sign(e){await this.sourceClient.getAccessToken();let t=`projects/-/serviceAccounts/${this.targetPrincipal}`,n=`${this.endpoint}/v1/${t}:signBlob`,s={delegates:this.delegates,payload:Buffer.from(e).toString("base64")};return(await this.sourceClient.request({...r.RETRY_CONFIG,url:n,data:s,method:"POST"})).data}getTargetPrincipal(){return this.targetPrincipal}async refreshToken(){try{await this.sourceClient.getAccessToken();let e="projects/-/serviceAccounts/"+this.targetPrincipal,t=`${this.endpoint}/v1/${e}:generateAccessToken`,n={delegates:this.delegates,scope:this.targetScopes,lifetime:this.lifetime+"s"},s=await this.sourceClient.request({...r.RETRY_CONFIG,url:t,data:n,method:"POST"}),a=s.data;return this.credentials.access_token=a.accessToken,this.credentials.expiry_date=Date.parse(a.expireTime),{tokens:this.credentials,res:s}}catch(e){if(!(e instanceof Error))throw e;let t=0,n="";throw e instanceof Pb.GaxiosError&&(t=e?.response?.data?.error?.status,n=e?.response?.data?.error?.message),t&&n?(e.message=`${t}: unable to impersonate: ${n}`,e):(e.message=`unable to impersonate: ${e}`,e)}}async fetchIdToken(e,t){await this.sourceClient.getAccessToken();let n=`projects/-/serviceAccounts/${this.targetPrincipal}`,s=`${this.endpoint}/v1/${n}:generateIdToken`,a={delegates:this.delegates,audience:e,includeEmail:t?.includeEmail??!0,useEmailAzp:t?.includeEmail??!0};return(await this.sourceClient.request({...r.RETRY_CONFIG,url:s,data:a,method:"POST"})).data.token}};jn.Impersonated=fc});var pc=W(Ro=>{"use strict";Object.defineProperty(Ro,"__esModule",{value:!0});Ro.OAuthClientAuthHandler=void 0;Ro.getErrorFromOAuthErrorResponse=Nb;var Ln=$e(),Bb=_o(),Ib=["PUT","POST","PATCH"],hc=class{#e=(0,Bb.createCrypto)();#t;transporter;constructor(e){e&&"clientId"in e?(this.#t=e,this.transporter=new Ln.Gaxios):(this.#t=e?.clientAuthentication,this.transporter=e?.transporter||new Ln.Gaxios)}applyClientAuthenticationOptions(e,t){e.headers=Ln.Gaxios.mergeHeaders(e.headers),this.injectAuthenticatedHeaders(e,t),t||this.injectAuthenticatedRequestBody(e)}injectAuthenticatedHeaders(e,t){if(t)e.headers=Ln.Gaxios.mergeHeaders(e.headers,{authorization:`Bearer ${t}`});else if(this.#t?.confidentialClientType==="basic"){e.headers=Ln.Gaxios.mergeHeaders(e.headers);let n=this.#t.clientId,s=this.#t.clientSecret||"",a=this.#e.encodeBase64StringUtf8(`${n}:${s}`);Ln.Gaxios.mergeHeaders(e.headers,{authorization:`Basic ${a}`})}}injectAuthenticatedRequestBody(e){if(this.#t?.confidentialClientType==="request-body"){let t=(e.method||"GET").toUpperCase();if(!Ib.includes(t))throw new Error(`${t} HTTP method does not support ${this.#t.confidentialClientType} client authentication`);let s=new Headers(e.headers).get("content-type");if(s?.startsWith("application/x-www-form-urlencoded")||e.data instanceof URLSearchParams){let a=new URLSearchParams(e.data??"");a.append("client_id",this.#t.clientId),a.append("client_secret",this.#t.clientSecret||""),e.data=a}else if(s?.startsWith("application/json"))e.data=e.data||{},Object.assign(e.data,{client_id:this.#t.clientId,client_secret:this.#t.clientSecret||""});else throw new Error(`${s} content-types are not supported with ${this.#t.confidentialClientType} client authentication`)}}static get RETRY_CONFIG(){return{retry:!0,retryConfig:{httpMethodsToRetry:["GET","PUT","POST","HEAD","OPTIONS","DELETE"]}}}};Ro.OAuthClientAuthHandler=hc;function Nb(r,e){let t=r.error,n=r.error_description,s=r.error_uri,a=`Error code ${t}`;typeof n<"u"&&(a+=`: ${n}`),typeof s<"u"&&(a+=` - ${s}`);let c=new Error(a);if(e){let f=Object.keys(e);e.stack&&f.push("stack"),f.forEach(l=>{l!=="message"&&Object.defineProperty(c,l,{value:e[l],writable:!1,enumerable:!0})})}return c}});var gi=W(mi=>{"use strict";Object.defineProperty(mi,"__esModule",{value:!0});mi.StsCredentials=void 0;var qb=$e(),jb=pt(),nm=pc(),Lb=jt(),mc=class r extends nm.OAuthClientAuthHandler{#e;constructor(e={tokenExchangeEndpoint:""},t){(typeof e!="object"||e instanceof URL)&&(e={tokenExchangeEndpoint:e,clientAuthentication:t}),super(e),this.#e=e.tokenExchangeEndpoint}async exchangeToken(e,t,n){let s={grant_type:e.grantType,resource:e.resource,audience:e.audience,scope:e.scope?.join(" "),requested_token_type:e.requestedTokenType,subject_token:e.subjectToken,subject_token_type:e.subjectTokenType,actor_token:e.actingParty?.actorToken,actor_token_type:e.actingParty?.actorTokenType,options:n&&JSON.stringify(n)},a={...r.RETRY_CONFIG,url:this.#e.toString(),method:"POST",headers:t,data:new URLSearchParams((0,Lb.removeUndefinedValuesInObject)(s))};jb.AuthClient.setMethodName(a,"exchangeToken"),this.applyClientAuthenticationOptions(a);try{let c=await this.transporter.request(a),f=c.data;return f.res=c,f}catch(c){throw c instanceof qb.GaxiosError&&c.response?(0,nm.getErrorFromOAuthErrorResponse)(c.response.data,c):c}}};mi.StsCredentials=mc});var Ir=W(Tt=>{"use strict";Object.defineProperty(Tt,"__esModule",{value:!0});Tt.BaseExternalAccountClient=Tt.CLOUD_RESOURCE_MANAGER=Tt.EXTERNAL_ACCOUNT_TYPE=Tt.EXPIRATION_TIME_OFFSET=void 0;var Ub=$e(),Mb=require("stream"),gc=pt(),$b=gi(),om=jt(),Hb=Ou(),Gb="urn:ietf:params:oauth:grant-type:token-exchange",Wb="urn:ietf:params:oauth:token-type:access_token",yc="https://www.googleapis.com/auth/cloud-platform",zb=3600;Tt.EXPIRATION_TIME_OFFSET=5*60*1e3;Tt.EXTERNAL_ACCOUNT_TYPE="external_account";Tt.CLOUD_RESOURCE_MANAGER="https://cloudresourcemanager.googleapis.com/v1/projects/";var Jb="//iam\\.googleapis\\.com/locations/[^/]+/workforcePools/[^/]+/providers/.+",Vb="https://sts.{universeDomain}/v1/token",_c=class r extends gc.AuthClient{scopes;projectNumber;audience;subjectTokenType;stsCredential;clientAuth;credentialSourceType;cachedAccessToken;serviceAccountImpersonationUrl;serviceAccountImpersonationLifetime;workforcePoolUserProject;configLifetimeRequested;tokenUrl;cloudResourceManagerURL;supplierContext;#e=null;constructor(e){super(e);let t=(0,om.originalOrCamelOptions)(e),n=t.get("type");if(n&&n!==Tt.EXTERNAL_ACCOUNT_TYPE)throw new Error(`Expected "${Tt.EXTERNAL_ACCOUNT_TYPE}" type but received "${e.type}"`);let s=t.get("client_id"),a=t.get("client_secret");this.tokenUrl=t.get("token_url")??Vb.replace("{universeDomain}",this.universeDomain);let c=t.get("subject_token_type"),f=t.get("workforce_pool_user_project"),l=t.get("service_account_impersonation_url"),d=t.get("service_account_impersonation"),h=(0,om.originalOrCamelOptions)(d).get("token_lifetime_seconds");this.cloudResourceManagerURL=new URL(t.get("cloud_resource_manager_url")||`https://cloudresourcemanager.${this.universeDomain}/v1/projects/`),s&&(this.clientAuth={confidentialClientType:"basic",clientId:s,clientSecret:a}),this.stsCredential=new $b.StsCredentials({tokenExchangeEndpoint:this.tokenUrl,clientAuthentication:this.clientAuth}),this.scopes=t.get("scopes")||[yc],this.cachedAccessToken=null,this.audience=t.get("audience"),this.subjectTokenType=c,this.workforcePoolUserProject=f;let b=new RegExp(Jb);if(this.workforcePoolUserProject&&!this.audience.match(b))throw new Error("workforcePoolUserProject should not be set for non-workforce pool credentials.");this.serviceAccountImpersonationUrl=l,this.serviceAccountImpersonationLifetime=h,this.serviceAccountImpersonationLifetime?this.configLifetimeRequested=!0:(this.configLifetimeRequested=!1,this.serviceAccountImpersonationLifetime=zb),this.projectNumber=this.getProjectNumber(this.audience),this.supplierContext={audience:this.audience,subjectTokenType:this.subjectTokenType,transporter:this.transporter}}getServiceAccountEmail(){if(this.serviceAccountImpersonationUrl){if(this.serviceAccountImpersonationUrl.length>256)throw new RangeError(`URL is too long: ${this.serviceAccountImpersonationUrl}`);return/serviceAccounts\/(?<email>[^:]+):generateAccessToken$/.exec(this.serviceAccountImpersonationUrl)?.groups?.email||null}return null}setCredentials(e){super.setCredentials(e),this.cachedAccessToken=e}async getAccessToken(){return(!this.cachedAccessToken||this.isExpired(this.cachedAccessToken))&&await this.refreshAccessTokenAsync(),{token:this.cachedAccessToken.access_token,res:this.cachedAccessToken.res}}async getRequestHeaders(){let e=await this.getAccessToken(),t=new Headers({authorization:`Bearer ${e.token}`});return this.addSharedMetadataHeaders(t)}request(e,t){if(t)this.requestAsync(e).then(n=>t(null,n),n=>t(n,n.response));else return this.requestAsync(e)}async getProjectId(){let e=this.projectNumber||this.workforcePoolUserProject;if(this.projectId)return this.projectId;if(e){let t=await this.getRequestHeaders(),n={...r.RETRY_CONFIG,headers:t,url:`${this.cloudResourceManagerURL.toString()}${e}`};gc.AuthClient.setMethodName(n,"getProjectId");let s=await this.transporter.request(n);return this.projectId=s.data.projectId,this.projectId}return null}async requestAsync(e,t=!1){let n;try{let s=await this.getRequestHeaders();e.headers=Ub.Gaxios.mergeHeaders(e.headers),this.addUserProjectAndAuthHeaders(e.headers,s),n=await this.transporter.request(e)}catch(s){let a=s.response;if(a){let c=a.status,f=a.config.data instanceof Mb.Readable;if(!t&&(c===401||c===403)&&!f&&this.forceRefreshOnFailure)return await this.refreshAccessTokenAsync(),await this.requestAsync(e,!0)}throw s}return n}async refreshAccessTokenAsync(){this.#e=this.#e||this.#t();try{return await this.#e}finally{this.#e=null}}async#t(){let e=await this.retrieveSubjectToken(),t={grantType:Gb,audience:this.audience,requestedTokenType:Wb,subjectToken:e,subjectTokenType:this.subjectTokenType,scope:this.serviceAccountImpersonationUrl?[yc]:this.getScopesArray()},n=!this.clientAuth&&this.workforcePoolUserProject?{userProject:this.workforcePoolUserProject}:void 0,s=new Headers({"x-goog-api-client":this.getMetricsHeaderValue()}),a=await this.stsCredential.exchangeToken(t,s,n);return this.serviceAccountImpersonationUrl?this.cachedAccessToken=await this.getImpersonatedAccessToken(a.access_token):a.expires_in?this.cachedAccessToken={access_token:a.access_token,expiry_date:new Date().getTime()+a.expires_in*1e3,res:a.res}:this.cachedAccessToken={access_token:a.access_token,res:a.res},this.credentials={},Object.assign(this.credentials,this.cachedAccessToken),delete this.credentials.res,this.emit("tokens",{refresh_token:null,expiry_date:this.cachedAccessToken.expiry_date,access_token:this.cachedAccessToken.access_token,token_type:"Bearer",id_token:null}),this.cachedAccessToken}getProjectNumber(e){let t=e.match(/\/projects\/([^/]+)/);return t?t[1]:null}async getImpersonatedAccessToken(e){let t={...r.RETRY_CONFIG,url:this.serviceAccountImpersonationUrl,method:"POST",headers:{"content-type":"application/json",authorization:`Bearer ${e}`},data:{scope:this.getScopesArray(),lifetime:this.serviceAccountImpersonationLifetime+"s"}};gc.AuthClient.setMethodName(t,"getImpersonatedAccessToken");let n=await this.transporter.request(t),s=n.data;return{access_token:s.accessToken,expiry_date:new Date(s.expireTime).getTime(),res:n}}isExpired(e){let t=new Date().getTime();return e.expiry_date?t>=e.expiry_date-this.eagerRefreshThresholdMillis:!1}getScopesArray(){return typeof this.scopes=="string"?[this.scopes]:this.scopes||[yc]}getMetricsHeaderValue(){let e=process.version.replace(/^v/,""),t=this.serviceAccountImpersonationUrl!==void 0,n=this.credentialSourceType?this.credentialSourceType:"unknown";return`gl-node/${e} auth/${Hb.pkg.version} google-byoid-sdk source/${n} sa-impersonation/${t} config-lifetime/${this.configLifetimeRequested}`}getTokenUrl(){return this.tokenUrl}};Tt.BaseExternalAccountClient=_c});var sm=W(yi=>{"use strict";Object.defineProperty(yi,"__esModule",{value:!0});yi.FileSubjectTokenSupplier=void 0;var bc=require("util"),Ec=require("fs"),Kb=(0,bc.promisify)(Ec.readFile??(()=>{})),Yb=(0,bc.promisify)(Ec.realpath??(()=>{})),Xb=(0,bc.promisify)(Ec.lstat??(()=>{})),Cc=class{filePath;formatType;subjectTokenFieldName;constructor(e){this.filePath=e.filePath,this.formatType=e.formatType,this.subjectTokenFieldName=e.subjectTokenFieldName}async getSubjectToken(){let e=this.filePath;try{if(e=await Yb(e),!(await Xb(e)).isFile())throw new Error}catch(s){throw s instanceof Error&&(s.message=`The file at ${e} does not exist, or it is not a file. ${s.message}`),s}let t,n=await Kb(e,{encoding:"utf8"});if(this.formatType==="text"?t=n:this.formatType==="json"&&this.subjectTokenFieldName&&(t=JSON.parse(n)[this.subjectTokenFieldName]),!t)throw new Error("Unable to parse the subject_token from the credential_source file");return t}};yi.FileSubjectTokenSupplier=Cc});var im=W(_i=>{"use strict";Object.defineProperty(_i,"__esModule",{value:!0});_i.UrlSubjectTokenSupplier=void 0;var Qb=pt(),Ac=class{url;headers;formatType;subjectTokenFieldName;additionalGaxiosOptions;constructor(e){this.url=e.url,this.formatType=e.formatType,this.subjectTokenFieldName=e.subjectTokenFieldName,this.headers=e.headers,this.additionalGaxiosOptions=e.additionalGaxiosOptions}async getSubjectToken(e){let t={...this.additionalGaxiosOptions,url:this.url,method:"GET",headers:this.headers};Qb.AuthClient.setMethodName(t,"getSubjectToken");let n;if(this.formatType==="text"?n=(await e.transporter.request(t)).data:this.formatType==="json"&&this.subjectTokenFieldName&&(n=(await e.transporter.request(t)).data[this.subjectTokenFieldName]),!n)throw new Error("Unable to parse the subject_token from the credential_source URL");return n}};_i.UrlSubjectTokenSupplier=Ac});var am=W(_t=>{"use strict";Object.defineProperty(_t,"__esModule",{value:!0});_t.CertificateSubjectTokenSupplier=_t.InvalidConfigurationError=_t.CertificateSourceUnavailableError=_t.CERTIFICATE_CONFIGURATION_ENV_VARIABLE=void 0;var Ci=jt(),bi=require("fs"),Ei=require("crypto"),Zb=require("https");_t.CERTIFICATE_CONFIGURATION_ENV_VARIABLE="GOOGLE_API_CERTIFICATE_CONFIG";var Xt=class extends Error{constructor(e){super(e),this.name="CertificateSourceUnavailableError"}};_t.CertificateSourceUnavailableError=Xt;var Rt=class extends Error{constructor(e){super(e),this.name="InvalidConfigurationError"}};_t.InvalidConfigurationError=Rt;var wc=class{certificateConfigPath;trustChainPath;cert;key;constructor(e){if(!e.useDefaultCertificateConfig&&!e.certificateConfigLocation)throw new Rt("Either `useDefaultCertificateConfig` must be true or a `certificateConfigLocation` must be provided.");if(e.useDefaultCertificateConfig&&e.certificateConfigLocation)throw new Rt("Both `useDefaultCertificateConfig` and `certificateConfigLocation` cannot be provided.");this.trustChainPath=e.trustChainPath,this.certificateConfigPath=e.certificateConfigLocation??""}async createMtlsHttpsAgent(){if(!this.key||!this.cert)throw new Rt("Cannot create mTLS Agent with missing certificate or key");return new Zb.Agent({key:this.key,cert:this.cert})}async getSubjectToken(){this.certificateConfigPath=await this.#e();let{certPath:e,keyPath:t}=await this.#t();return{cert:this.cert,key:this.key}=await this.#r(e,t),await this.#n(this.cert)}async#e(){let e=this.certificateConfigPath;if(e){if(await(0,Ci.isValidFile)(e))return e;throw new Xt(`Provided certificate config path is invalid: ${e}`)}let t=process.env[_t.CERTIFICATE_CONFIGURATION_ENV_VARIABLE];if(t){if(await(0,Ci.isValidFile)(t))return t;throw new Xt(`Path from environment variable "${_t.CERTIFICATE_CONFIGURATION_ENV_VARIABLE}" is invalid: ${t}`)}let n=(0,Ci.getWellKnownCertificateConfigFileLocation)();if(await(0,Ci.isValidFile)(n))return n;throw new Xt(`Could not find certificate configuration file. Searched override path, the "${_t.CERTIFICATE_CONFIGURATION_ENV_VARIABLE}" env var, and the gcloud path (${n}).`)}async#t(){let e=this.certificateConfigPath,t;try{t=await bi.promises.readFile(e,"utf8")}catch{throw new Xt(`Failed to read certificate config file at: ${e}`)}try{let n=JSON.parse(t),s=n?.cert_configs?.workload?.cert_path,a=n?.cert_configs?.workload?.key_path;if(!s||!a)throw new Rt(`Certificate config file (${e}) is missing required "cert_path" or "key_path" in the workload config.`);return{certPath:s,keyPath:a}}catch(n){throw n instanceof Rt?n:new Rt(`Failed to parse certificate config from ${e}: ${n.message}`)}}async#r(e,t){let n,s;try{n=await bi.promises.readFile(e),new Ei.X509Certificate(n)}catch(a){let c=a instanceof Error?a.message:String(a);throw new Xt(`Failed to read certificate file at ${e}: ${c}`)}try{s=await bi.promises.readFile(t),(0,Ei.createPrivateKey)(s)}catch(a){let c=a instanceof Error?a.message:String(a);throw new Xt(`Failed to read private key file at ${t}: ${c}`)}return{cert:n,key:s}}async#n(e){let t=new Ei.X509Certificate(e);if(!this.trustChainPath)return JSON.stringify([t.raw.toString("base64")]);try{let a=((await bi.promises.readFile(this.trustChainPath,"utf8")).match(/-----BEGIN CERTIFICATE-----[^-]+-----END CERTIFICATE-----/g)??[]).map((l,d)=>{try{return new Ei.X509Certificate(l)}catch(h){let b=h instanceof Error?h.message:String(h);throw new Rt(`Failed to parse certificate at index ${d} in trust chain file ${this.trustChainPath}: ${b}`)}}),c=a.findIndex(l=>t.raw.equals(l.raw)),f;if(c===-1)f=[t,...a];else if(c===0)f=a;else throw new Rt(`Leaf certificate exists in the trust chain but is not the first entry (found at index ${c}).`);return JSON.stringify(f.map(l=>l.raw.toString("base64")))}catch(n){if(n instanceof Rt)throw n;let s=n instanceof Error?n.message:String(n);throw new Xt(`Failed to process certificate chain from ${this.trustChainPath}: ${s}`)}}};_t.CertificateSubjectTokenSupplier=wc});var vc=W(Ai=>{"use strict";Object.defineProperty(Ai,"__esModule",{value:!0});Ai.IdentityPoolClient=void 0;var eE=Ir(),Dc=jt(),tE=sm(),rE=im(),um=am(),nE=gi(),cm=$e(),Sc=class r extends eE.BaseExternalAccountClient{subjectTokenSupplier;constructor(e){super(e);let t=(0,Dc.originalOrCamelOptions)(e),n=t.get("credential_source"),s=t.get("subject_token_supplier");if(!n&&!s)throw new Error("A credential source or subject token supplier must be specified.");if(n&&s)throw new Error("Only one of credential source or subject token supplier can be specified.");if(s)this.subjectTokenSupplier=s,this.credentialSourceType="programmatic";else{let a=(0,Dc.originalOrCamelOptions)(n),c=(0,Dc.originalOrCamelOptions)(a.get("format")),f=c.get("type")||"text",l=c.get("subject_token_field_name");if(f!=="json"&&f!=="text")throw new Error(`Invalid credential_source format "${f}"`);if(f==="json"&&!l)throw new Error("Missing subject_token_field_name for JSON credential_source format");let d=a.get("file"),h=a.get("url"),b=a.get("certificate"),A=a.get("headers");if(d&&h||h&&b||d&&b)throw new Error('No valid Identity Pool "credential_source" provided, must be either file, url, or certificate.');if(d)this.credentialSourceType="file",this.subjectTokenSupplier=new tE.FileSubjectTokenSupplier({filePath:d,formatType:f,subjectTokenFieldName:l});else if(h)this.credentialSourceType="url",this.subjectTokenSupplier=new rE.UrlSubjectTokenSupplier({url:h,formatType:f,subjectTokenFieldName:l,headers:A,additionalGaxiosOptions:r.RETRY_CONFIG});else if(b){this.credentialSourceType="certificate";let O=new um.CertificateSubjectTokenSupplier({useDefaultCertificateConfig:b.use_default_certificate_config,certificateConfigLocation:b.certificate_config_location,trustChainPath:b.trust_chain_path});this.subjectTokenSupplier=O}else throw new Error('No valid Identity Pool "credential_source" provided, must be either file, url, or certificate.')}}async retrieveSubjectToken(){let e=await this.subjectTokenSupplier.getSubjectToken(this.supplierContext);if(this.subjectTokenSupplier instanceof um.CertificateSubjectTokenSupplier){let t=await this.subjectTokenSupplier.createMtlsHttpsAgent();this.stsCredential=new nE.StsCredentials({tokenExchangeEndpoint:this.getTokenUrl(),clientAuthentication:this.clientAuth,transporter:new cm.Gaxios({agent:t})}),this.transporter=new cm.Gaxios({...this.transporter.defaults||{},agent:t})}return e}};Ai.IdentityPoolClient=Sc});var Rc=W(Di=>{"use strict";Object.defineProperty(Di,"__esModule",{value:!0});Di.AwsRequestSigner=void 0;var wi=$e(),fm=_o(),lm="AWS4-HMAC-SHA256",oE="aws4_request",Tc=class{getCredentials;region;crypto;constructor(e,t){this.getCredentials=e,this.region=t,this.crypto=(0,fm.createCrypto)()}async getRequestOptions(e){if(!e.url)throw new RangeError('"url" is required in "amzOptions"');let t=typeof e.data=="object"?JSON.stringify(e.data):e.data,n=e.url,s=e.method||"GET",a=e.body||t,c=e.headers,f=await this.getCredentials(),l=new URL(n);if(typeof a!="string"&&a!==void 0)throw new TypeError(`'requestPayload' is expected to be a string if provided. Got: ${a}`);let d=await iE({crypto:this.crypto,host:l.host,canonicalUri:l.pathname,canonicalQuerystring:l.search.slice(1),method:s,region:this.region,securityCredentials:f,requestPayload:a,additionalAmzHeaders:c}),h=wi.Gaxios.mergeHeaders(d.amzDate?{"x-amz-date":d.amzDate}:{},{authorization:d.authorizationHeader,host:l.host},c||{});f.token&&wi.Gaxios.mergeHeaders(h,{"x-amz-security-token":f.token});let b={url:n,method:s,headers:h};return a!==void 0&&(b.body=a),b}};Di.AwsRequestSigner=Tc;async function Fo(r,e,t){return await r.signWithHmacSha256(e,t)}async function sE(r,e,t,n,s){let a=await Fo(r,`AWS4${e}`,t),c=await Fo(r,a,n),f=await Fo(r,c,s);return await Fo(r,f,"aws4_request")}async function iE(r){let e=wi.Gaxios.mergeHeaders(r.additionalAmzHeaders),t=r.requestPayload||"",n=r.host.split(".")[0],s=new Date,a=s.toISOString().replace(/[-:]/g,"").replace(/\.[0-9]+/,""),c=s.toISOString().replace(/[-]/g,"").replace(/T.*/,"");r.securityCredentials.token&&e.set("x-amz-security-token",r.securityCredentials.token);let f=wi.Gaxios.mergeHeaders({host:r.host},e.has("date")?{}:{"x-amz-date":a},e),l="",d=[...f.keys()].sort();d.forEach(F=>{l+=`${F}:${f.get(F)}
`});let h=d.join(";"),b=await r.crypto.sha256DigestHex(t),A=`${r.method.toUpperCase()}
${r.canonicalUri}
${r.canonicalQuerystring}
${l}
${h}
${b}`,O=`${c}/${r.region}/${n}/${oE}`,S=`${lm}
${a}
${O}
`+await r.crypto.sha256DigestHex(A),y=await sE(r.crypto,r.securityCredentials.secretAccessKey,c,r.region,n),C=await Fo(r.crypto,y,S),_=`${lm} Credential=${r.securityCredentials.accessKeyId}/${O}, SignedHeaders=${h}, Signature=${(0,fm.fromArrayBufferToHex)(C)}`;return{amzDate:e.has("date")?void 0:a,authorizationHeader:_,canonicalQuerystring:r.canonicalQuerystring}}});var dm=W(vi=>{"use strict";Object.defineProperty(vi,"__esModule",{value:!0});vi.DefaultAwsSecurityCredentialsSupplier=void 0;var Si=pt(),Fc=class{regionUrl;securityCredentialsUrl;imdsV2SessionTokenUrl;additionalGaxiosOptions;constructor(e){this.regionUrl=e.regionUrl,this.securityCredentialsUrl=e.securityCredentialsUrl,this.imdsV2SessionTokenUrl=e.imdsV2SessionTokenUrl,this.additionalGaxiosOptions=e.additionalGaxiosOptions}async getAwsRegion(e){if(this.#n)return this.#n;let t=new Headers;if(!this.#n&&this.imdsV2SessionTokenUrl&&t.set("x-aws-ec2-metadata-token",await this.#e(e.transporter)),!this.regionUrl)throw new RangeError('Unable to determine AWS region due to missing "options.credential_source.region_url"');let n={...this.additionalGaxiosOptions,url:this.regionUrl,method:"GET",headers:t};Si.AuthClient.setMethodName(n,"getAwsRegion");let s=await e.transporter.request(n);return s.data.substr(0,s.data.length-1)}async getAwsSecurityCredentials(e){if(this.#o)return this.#o;let t=new Headers;this.imdsV2SessionTokenUrl&&t.set("x-aws-ec2-metadata-token",await this.#e(e.transporter));let n=await this.#t(t,e.transporter),s=await this.#r(n,t,e.transporter);return{accessKeyId:s.AccessKeyId,secretAccessKey:s.SecretAccessKey,token:s.Token}}async#e(e){let t={...this.additionalGaxiosOptions,url:this.imdsV2SessionTokenUrl,method:"PUT",headers:{"x-aws-ec2-metadata-token-ttl-seconds":"300"}};return Si.AuthClient.setMethodName(t,"#getImdsV2SessionToken"),(await e.request(t)).data}async#t(e,t){if(!this.securityCredentialsUrl)throw new Error('Unable to determine AWS role name due to missing "options.credential_source.url"');let n={...this.additionalGaxiosOptions,url:this.securityCredentialsUrl,method:"GET",headers:e};return Si.AuthClient.setMethodName(n,"#getAwsRoleName"),(await t.request(n)).data}async#r(e,t,n){let s={...this.additionalGaxiosOptions,url:`${this.securityCredentialsUrl}/${e}`,headers:t};return Si.AuthClient.setMethodName(s,"#retrieveAwsSecurityCredentials"),(await n.request(s)).data}get#n(){return process.env.AWS_REGION||process.env.AWS_DEFAULT_REGION||null}get#o(){return process.env.AWS_ACCESS_KEY_ID&&process.env.AWS_SECRET_ACCESS_KEY?{accessKeyId:process.env.AWS_ACCESS_KEY_ID,secretAccessKey:process.env.AWS_SECRET_ACCESS_KEY,token:process.env.AWS_SESSION_TOKEN}:null}};vi.DefaultAwsSecurityCredentialsSupplier=Fc});var Oc=W(Ti=>{"use strict";Object.defineProperty(Ti,"__esModule",{value:!0});Ti.AwsClient=void 0;var aE=Rc(),uE=Ir(),cE=dm(),hm=jt(),lE=$e(),kc=class r extends uE.BaseExternalAccountClient{environmentId;awsSecurityCredentialsSupplier;regionalCredVerificationUrl;awsRequestSigner;region;static#e="https://sts.{region}.amazonaws.com?Action=GetCallerIdentity&Version=2011-06-15";static AWS_EC2_METADATA_IPV4_ADDRESS="169.254.169.254";static AWS_EC2_METADATA_IPV6_ADDRESS="fd00:ec2::254";constructor(e){super(e);let t=(0,hm.originalOrCamelOptions)(e),n=t.get("credential_source"),s=t.get("aws_security_credentials_supplier");if(!n&&!s)throw new Error("A credential source or AWS security credentials supplier must be specified.");if(n&&s)throw new Error("Only one of credential source or AWS security credentials supplier can be specified.");if(s)this.awsSecurityCredentialsSupplier=s,this.regionalCredVerificationUrl=r.#e,this.credentialSourceType="programmatic";else{let a=(0,hm.originalOrCamelOptions)(n);this.environmentId=a.get("environment_id");let c=a.get("region_url"),f=a.get("url"),l=a.get("imdsv2_session_token_url");this.awsSecurityCredentialsSupplier=new cE.DefaultAwsSecurityCredentialsSupplier({regionUrl:c,securityCredentialsUrl:f,imdsV2SessionTokenUrl:l}),this.regionalCredVerificationUrl=a.get("regional_cred_verification_url"),this.credentialSourceType="aws",this.validateEnvironmentId()}this.awsRequestSigner=null,this.region=""}validateEnvironmentId(){let e=this.environmentId?.match(/^(aws)(\d+)$/);if(!e||!this.regionalCredVerificationUrl)throw new Error('No valid AWS "credential_source" provided');if(parseInt(e[2],10)!==1)throw new Error(`aws version "${e[2]}" is not supported in the current build.`)}async retrieveSubjectToken(){this.awsRequestSigner||(this.region=await this.awsSecurityCredentialsSupplier.getAwsRegion(this.supplierContext),this.awsRequestSigner=new aE.AwsRequestSigner(async()=>this.awsSecurityCredentialsSupplier.getAwsSecurityCredentials(this.supplierContext),this.region));let e=await this.awsRequestSigner.getRequestOptions({...r.RETRY_CONFIG,url:this.regionalCredVerificationUrl.replace("{region}",this.region),method:"POST"}),t=[];return lE.Gaxios.mergeHeaders({"x-goog-cloud-target-resource":this.audience},e.headers).forEach((s,a)=>t.push({key:a,value:s})),encodeURIComponent(JSON.stringify({url:e.url,method:e.method,headers:t}))}};Ti.AwsClient=kc});var Nc=W(Oe=>{"use strict";Object.defineProperty(Oe,"__esModule",{value:!0});Oe.InvalidSubjectTokenError=Oe.InvalidMessageFieldError=Oe.InvalidCodeFieldError=Oe.InvalidTokenTypeFieldError=Oe.InvalidExpirationTimeFieldError=Oe.InvalidSuccessFieldError=Oe.InvalidVersionFieldError=Oe.ExecutableResponseError=Oe.ExecutableResponse=void 0;var Ri="urn:ietf:params:oauth:token-type:saml2",Pc="urn:ietf:params:oauth:token-type:id_token",xc="urn:ietf:params:oauth:token-type:jwt",Bc=class{version;success;expirationTime;tokenType;errorCode;errorMessage;subjectToken;constructor(e){if(!e.version)throw new Fi("Executable response must contain a 'version' field.");if(e.success===void 0)throw new ki("Executable response must contain a 'success' field.");if(this.version=e.version,this.success=e.success,this.success){if(this.expirationTime=e.expiration_time,this.tokenType=e.token_type,this.tokenType!==Ri&&this.tokenType!==Pc&&this.tokenType!==xc)throw new Oi(`Executable response must contain a 'token_type' field when successful and it must be one of ${Pc}, ${xc}, or ${Ri}.`);if(this.tokenType===Ri){if(!e.saml_response)throw new ko(`Executable response must contain a 'saml_response' field when token_type=${Ri}.`);this.subjectToken=e.saml_response}else{if(!e.id_token)throw new ko(`Executable response must contain a 'id_token' field when token_type=${Pc} or ${xc}.`);this.subjectToken=e.id_token}}else{if(!e.code)throw new Pi("Executable response must contain a 'code' field when unsuccessful.");if(!e.message)throw new xi("Executable response must contain a 'message' field when unsuccessful.");this.errorCode=e.code,this.errorMessage=e.message}}isValid(){return!this.isExpired()&&this.success}isExpired(){return this.expirationTime!==void 0&&this.expirationTime<Math.round(Date.now()/1e3)}};Oe.ExecutableResponse=Bc;var Qt=class extends Error{constructor(e){super(e),Object.setPrototypeOf(this,new.target.prototype)}};Oe.ExecutableResponseError=Qt;var Fi=class extends Qt{};Oe.InvalidVersionFieldError=Fi;var ki=class extends Qt{};Oe.InvalidSuccessFieldError=ki;var Ic=class extends Qt{};Oe.InvalidExpirationTimeFieldError=Ic;var Oi=class extends Qt{};Oe.InvalidTokenTypeFieldError=Oi;var Pi=class extends Qt{};Oe.InvalidCodeFieldError=Pi;var xi=class extends Qt{};Oe.InvalidMessageFieldError=xi;var ko=class extends Qt{};Oe.InvalidSubjectTokenError=ko});var Lc=W(Un=>{"use strict";Object.defineProperty(Un,"__esModule",{value:!0});Un.PluggableAuthHandler=Un.ExecutableError=void 0;var rn=Nc(),fE=require("child_process"),qc=require("fs"),Bi=class extends Error{code;constructor(e,t){super(`The executable failed with exit code: ${t} and error message: ${e}.`),this.code=t,Object.setPrototypeOf(this,new.target.prototype)}};Un.ExecutableError=Bi;var jc=class r{commandComponents;timeoutMillis;outputFile;constructor(e){if(!e.command)throw new Error("No command provided.");if(this.commandComponents=r.parseCommand(e.command),this.timeoutMillis=e.timeoutMillis,!this.timeoutMillis)throw new Error("No timeoutMillis provided.");this.outputFile=e.outputFile}retrieveResponseFromExecutable(e){return new Promise((t,n)=>{let s=fE.spawn(this.commandComponents[0],this.commandComponents.slice(1),{env:{...process.env,...Object.fromEntries(e)}}),a="";s.stdout.on("data",f=>{a+=f}),s.stderr.on("data",f=>{a+=f});let c=setTimeout(()=>(s.removeAllListeners(),s.kill(),n(new Error("The executable failed to finish within the timeout specified."))),this.timeoutMillis);s.on("close",f=>{if(clearTimeout(c),f===0)try{let l=JSON.parse(a),d=new rn.ExecutableResponse(l);return t(d)}catch(l){return l instanceof rn.ExecutableResponseError?n(l):n(new rn.ExecutableResponseError(`The executable returned an invalid response: ${a}`))}else return n(new Bi(a,f.toString()))})})}async retrieveCachedResponse(){if(!this.outputFile||this.outputFile.length===0)return;let e;try{e=await qc.promises.realpath(this.outputFile)}catch{return}if(!(await qc.promises.lstat(e)).isFile())return;let t=await qc.promises.readFile(e,{encoding:"utf8"});if(t!=="")try{let n=JSON.parse(t);return new rn.ExecutableResponse(n).isValid()?new rn.ExecutableResponse(n):void 0}catch(n){throw n instanceof rn.ExecutableResponseError?n:new rn.ExecutableResponseError(`The output file contained an invalid response: ${t}`)}}static parseCommand(e){let t=e.match(/(?:[^\s"]+|"[^"]*")+/g);if(!t)throw new Error(`Provided command: "${e}" could not be parsed.`);for(let n=0;n<t.length;n++)t[n][0]==='"'&&t[n].slice(-1)==='"'&&(t[n]=t[n].slice(1,-1));return t}};Un.PluggableAuthHandler=jc});var Mc=W(Mn=>{"use strict";Object.defineProperty(Mn,"__esModule",{value:!0});Mn.PluggableAuthClient=Mn.ExecutableError=void 0;var dE=Ir(),hE=Nc(),pm=Lc(),pE=Lc();Object.defineProperty(Mn,"ExecutableError",{enumerable:!0,get:function(){return pE.ExecutableError}});var mE=30*1e3,mm=5*1e3,gm=120*1e3,gE="GOOGLE_EXTERNAL_ACCOUNT_ALLOW_EXECUTABLES",ym=1,Uc=class extends dE.BaseExternalAccountClient{command;timeoutMillis;outputFile;handler;constructor(e){if(super(e),!e.credential_source.executable)throw new Error('No valid Pluggable Auth "credential_source" provided.');if(this.command=e.credential_source.executable.command,!this.command)throw new Error('No valid Pluggable Auth "credential_source" provided.');if(e.credential_source.executable.timeout_millis===void 0)this.timeoutMillis=mE;else if(this.timeoutMillis=e.credential_source.executable.timeout_millis,this.timeoutMillis<mm||this.timeoutMillis>gm)throw new Error(`Timeout must be between ${mm} and ${gm} milliseconds.`);this.outputFile=e.credential_source.executable.output_file,this.handler=new pm.PluggableAuthHandler({command:this.command,timeoutMillis:this.timeoutMillis,outputFile:this.outputFile}),this.credentialSourceType="executable"}async retrieveSubjectToken(){if(process.env[gE]!=="1")throw new Error("Pluggable Auth executables need to be explicitly allowed to run by setting the GOOGLE_EXTERNAL_ACCOUNT_ALLOW_EXECUTABLES environment Variable to 1.");let e;if(this.outputFile&&(e=await this.handler.retrieveCachedResponse()),!e){let t=new Map;t.set("GOOGLE_EXTERNAL_ACCOUNT_AUDIENCE",this.audience),t.set("GOOGLE_EXTERNAL_ACCOUNT_TOKEN_TYPE",this.subjectTokenType),t.set("GOOGLE_EXTERNAL_ACCOUNT_INTERACTIVE","0"),this.outputFile&&t.set("GOOGLE_EXTERNAL_ACCOUNT_OUTPUT_FILE",this.outputFile);let n=this.getServiceAccountEmail();n&&t.set("GOOGLE_EXTERNAL_ACCOUNT_IMPERSONATED_EMAIL",n),e=await this.handler.retrieveResponseFromExecutable(t)}if(e.version>ym)throw new Error(`Version of executable is not currently supported, maximum supported version is ${ym}.`);if(!e.success)throw new pm.ExecutableError(e.errorMessage,e.errorCode);if(this.outputFile&&!e.expirationTime)throw new hE.InvalidExpirationTimeFieldError("The executable response must contain the `expiration_time` field for successful responses when an output_file has been specified in the configuration.");if(e.isExpired())throw new Error("Executable response is expired.");return e.subjectToken}};Mn.PluggableAuthClient=Uc});var Hc=W(Ii=>{"use strict";Object.defineProperty(Ii,"__esModule",{value:!0});Ii.ExternalAccountClient=void 0;var yE=Ir(),_E=vc(),CE=Oc(),bE=Mc(),$c=class{constructor(){throw new Error("ExternalAccountClients should be initialized via: ExternalAccountClient.fromJSON(), directly via explicit constructors, eg. new AwsClient(options), new IdentityPoolClient(options), newPluggableAuthClientOptions, or via new GoogleAuth(options).getClient()")}static fromJSON(e){return e&&e.type===yE.EXTERNAL_ACCOUNT_TYPE?e.credential_source?.environment_id?new CE.AwsClient(e):e.credential_source?.executable?new bE.PluggableAuthClient(e):new _E.IdentityPoolClient(e):null}};Ii.ExternalAccountClient=$c});var Em=W($n=>{"use strict";Object.defineProperty($n,"__esModule",{value:!0});$n.ExternalAccountAuthorizedUserClient=$n.EXTERNAL_ACCOUNT_AUTHORIZED_USER_TYPE=void 0;var Cm=pt(),_m=pc(),bm=$e(),EE=require("stream"),AE=Ir();$n.EXTERNAL_ACCOUNT_AUTHORIZED_USER_TYPE="external_account_authorized_user";var wE="https://sts.{universeDomain}/v1/oauthtoken",Gc=class r extends _m.OAuthClientAuthHandler{#e;constructor(e){super(e),this.#e=e.tokenRefreshEndpoint}async refreshToken(e,t){let n={...r.RETRY_CONFIG,url:this.#e,method:"POST",headers:t,data:new URLSearchParams({grant_type:"refresh_token",refresh_token:e})};Cm.AuthClient.setMethodName(n,"refreshToken"),this.applyClientAuthenticationOptions(n);try{let s=await this.transporter.request(n),a=s.data;return a.res=s,a}catch(s){throw s instanceof bm.GaxiosError&&s.response?(0,_m.getErrorFromOAuthErrorResponse)(s.response.data,s):s}}},Wc=class extends Cm.AuthClient{cachedAccessToken;externalAccountAuthorizedUserHandler;refreshToken;constructor(e){super(e),e.universe_domain&&(this.universeDomain=e.universe_domain),this.refreshToken=e.refresh_token;let t={confidentialClientType:"basic",clientId:e.client_id,clientSecret:e.client_secret};this.externalAccountAuthorizedUserHandler=new Gc({tokenRefreshEndpoint:e.token_url??wE.replace("{universeDomain}",this.universeDomain),transporter:this.transporter,clientAuthentication:t}),this.cachedAccessToken=null,this.quotaProjectId=e.quota_project_id,typeof e?.eagerRefreshThresholdMillis!="number"?this.eagerRefreshThresholdMillis=AE.EXPIRATION_TIME_OFFSET:this.eagerRefreshThresholdMillis=e.eagerRefreshThresholdMillis,this.forceRefreshOnFailure=!!e?.forceRefreshOnFailure}async getAccessToken(){return(!this.cachedAccessToken||this.isExpired(this.cachedAccessToken))&&await this.refreshAccessTokenAsync(),{token:this.cachedAccessToken.access_token,res:this.cachedAccessToken.res}}async getRequestHeaders(){let e=await this.getAccessToken(),t=new Headers({authorization:`Bearer ${e.token}`});return this.addSharedMetadataHeaders(t)}request(e,t){if(t)this.requestAsync(e).then(n=>t(null,n),n=>t(n,n.response));else return this.requestAsync(e)}async requestAsync(e,t=!1){let n;try{let s=await this.getRequestHeaders();e.headers=bm.Gaxios.mergeHeaders(e.headers),this.addUserProjectAndAuthHeaders(e.headers,s),n=await this.transporter.request(e)}catch(s){let a=s.response;if(a){let c=a.status,f=a.config.data instanceof EE.Readable;if(!t&&(c===401||c===403)&&!f&&this.forceRefreshOnFailure)return await this.refreshAccessTokenAsync(),await this.requestAsync(e,!0)}throw s}return n}async refreshAccessTokenAsync(){let e=await this.externalAccountAuthorizedUserHandler.refreshToken(this.refreshToken);return this.cachedAccessToken={access_token:e.access_token,expiry_date:new Date().getTime()+e.expires_in*1e3,res:e.res},e.refresh_token!==void 0&&(this.refreshToken=e.refresh_token),this.cachedAccessToken}isExpired(e){let t=new Date().getTime();return e.expiry_date?t>=e.expiry_date-this.eagerRefreshThresholdMillis:!1}};$n.ExternalAccountAuthorizedUserClient=Wc});var Sm=W($t=>{"use strict";Object.defineProperty($t,"__esModule",{value:!0});$t.GoogleAuth=$t.GoogleAuthExceptionMessages=void 0;var DE=require("child_process"),Oo=require("fs"),SE=$e(),Po=yo(),vE=require("os"),zc=require("path"),TE=_o(),RE=Uu(),FE=$u(),kE=Hu(),Hn=uc(),Am=lc(),Gn=dc(),OE=Hc(),xo=Ir(),Jc=pt(),wm=Em(),Dm=jt();$t.GoogleAuthExceptionMessages={API_KEY_WITH_CREDENTIALS:"API Keys and Credentials are mutually exclusive authentication methods and cannot be used together.",NO_PROJECT_ID_FOUND:`Unable to detect a Project Id in the current environment. 
To learn more about authentication and Google APIs, visit: 
https://cloud.google.com/docs/authentication/getting-started`,NO_CREDENTIALS_FOUND:`Unable to find credentials in current environment. 
To learn more about authentication and Google APIs, visit: 
https://cloud.google.com/docs/authentication/getting-started`,NO_ADC_FOUND:"Could not load the default credentials. Browse to https://cloud.google.com/docs/authentication/getting-started for more information.",NO_UNIVERSE_DOMAIN_FOUND:`Unable to detect a Universe Domain in the current environment.
To learn more about Universe Domain retrieval, visit: 
https://cloud.google.com/compute/docs/metadata/predefined-metadata-keys`};var Vc=class{checkIsGCE=void 0;useJWTAccessWithScope;defaultServicePath;get isGCE(){return this.checkIsGCE}_findProjectIdPromise;_cachedProjectId;jsonContent=null;apiKey;cachedCredential=null;#e=null;defaultScopes;keyFilename;scopes;clientOptions={};constructor(e={}){if(this._cachedProjectId=e.projectId||null,this.cachedCredential=e.authClient||null,this.keyFilename=e.keyFilename||e.keyFile,this.scopes=e.scopes,this.clientOptions=e.clientOptions||{},this.jsonContent=e.credentials||null,this.apiKey=e.apiKey||this.clientOptions.apiKey||null,this.apiKey&&(this.jsonContent||this.clientOptions.credentials))throw new RangeError($t.GoogleAuthExceptionMessages.API_KEY_WITH_CREDENTIALS);e.universeDomain&&(this.clientOptions.universeDomain=e.universeDomain)}setGapicJWTValues(e){e.defaultServicePath=this.defaultServicePath,e.useJWTAccessWithScope=this.useJWTAccessWithScope,e.defaultScopes=this.defaultScopes}getProjectId(e){if(e)this.getProjectIdAsync().then(t=>e(null,t),e);else return this.getProjectIdAsync()}async getProjectIdOptional(){try{return await this.getProjectId()}catch(e){if(e instanceof Error&&e.message===$t.GoogleAuthExceptionMessages.NO_PROJECT_ID_FOUND)return null;throw e}}async findAndCacheProjectId(){let e=null;if(e||=await this.getProductionProjectId(),e||=await this.getFileProjectId(),e||=await this.getDefaultServiceProjectId(),e||=await this.getGCEProjectId(),e||=await this.getExternalAccountClientProjectId(),e)return this._cachedProjectId=e,e;throw new Error($t.GoogleAuthExceptionMessages.NO_PROJECT_ID_FOUND)}async getProjectIdAsync(){return this._cachedProjectId?this._cachedProjectId:(this._findProjectIdPromise||(this._findProjectIdPromise=this.findAndCacheProjectId()),this._findProjectIdPromise)}async getUniverseDomainFromMetadataServer(){let e;try{e=await Po.universe("universe-domain"),e||=Jc.DEFAULT_UNIVERSE}catch(t){if(t&&t?.response?.status===404)e=Jc.DEFAULT_UNIVERSE;else throw t}return e}async getUniverseDomain(){let e=(0,Dm.originalOrCamelOptions)(this.clientOptions).get("universe_domain");try{e??=(await this.getClient()).universeDomain}catch{e??=Jc.DEFAULT_UNIVERSE}return e}getAnyScopes(){return this.scopes||this.defaultScopes}getApplicationDefault(e={},t){let n;if(typeof e=="function"?t=e:n=e,t)this.getApplicationDefaultAsync(n).then(s=>t(null,s.credential,s.projectId),t);else return this.getApplicationDefaultAsync(n)}async getApplicationDefaultAsync(e={}){if(this.cachedCredential)return await this.#t(this.cachedCredential,null);let t;if(t=await this._tryGetApplicationCredentialsFromEnvironmentVariable(e),t)return t instanceof Hn.JWT?t.scopes=this.scopes:t instanceof xo.BaseExternalAccountClient&&(t.scopes=this.getAnyScopes()),await this.#t(t);if(t=await this._tryGetApplicationCredentialsFromWellKnownFile(e),t)return t instanceof Hn.JWT?t.scopes=this.scopes:t instanceof xo.BaseExternalAccountClient&&(t.scopes=this.getAnyScopes()),await this.#t(t);if(await this._checkIsGCE())return e.scopes=this.getAnyScopes(),await this.#t(new RE.Compute(e));throw new Error($t.GoogleAuthExceptionMessages.NO_ADC_FOUND)}async#t(e,t=process.env.GOOGLE_CLOUD_QUOTA_PROJECT||null){let n=await this.getProjectIdOptional();return t&&(e.quotaProjectId=t),this.cachedCredential=e,{credential:e,projectId:n}}async _checkIsGCE(){return this.checkIsGCE===void 0&&(this.checkIsGCE=Po.getGCPResidency()||await Po.isAvailable()),this.checkIsGCE}async _tryGetApplicationCredentialsFromEnvironmentVariable(e){let t=process.env.GOOGLE_APPLICATION_CREDENTIALS||process.env.google_application_credentials;if(!t||t.length===0)return null;try{return this._getApplicationCredentialsFromFilePath(t,e)}catch(n){throw n instanceof Error&&(n.message=`Unable to read the credential file specified by the GOOGLE_APPLICATION_CREDENTIALS environment variable: ${n.message}`),n}}async _tryGetApplicationCredentialsFromWellKnownFile(e){let t=null;if(this._isWindows())t=process.env.APPDATA;else{let s=process.env.HOME;s&&(t=zc.join(s,".config"))}return t&&(t=zc.join(t,"gcloud","application_default_credentials.json"),Oo.existsSync(t)||(t=null)),t?await this._getApplicationCredentialsFromFilePath(t,e):null}async _getApplicationCredentialsFromFilePath(e,t={}){if(!e||e.length===0)throw new Error("The file path is invalid.");try{if(e=Oo.realpathSync(e),!Oo.lstatSync(e).isFile())throw new Error}catch(s){throw s instanceof Error&&(s.message=`The file at ${e} does not exist, or it is not a file. ${s.message}`),s}let n=Oo.createReadStream(e);return this.fromStream(n,t)}fromImpersonatedJSON(e){if(!e)throw new Error("Must pass in a JSON object containing an  impersonated refresh token");if(e.type!==Gn.IMPERSONATED_ACCOUNT_TYPE)throw new Error(`The incoming JSON object does not have the "${Gn.IMPERSONATED_ACCOUNT_TYPE}" type`);if(!e.source_credentials)throw new Error("The incoming JSON object does not contain a source_credentials field");if(!e.service_account_impersonation_url)throw new Error("The incoming JSON object does not contain a service_account_impersonation_url field");let t=this.fromJSON(e.source_credentials);if(e.service_account_impersonation_url?.length>256)throw new RangeError(`Target principal is too long: ${e.service_account_impersonation_url}`);let n=/(?<target>[^/]+):(generateAccessToken|generateIdToken)$/.exec(e.service_account_impersonation_url)?.groups?.target;if(!n)throw new RangeError(`Cannot extract target principal from ${e.service_account_impersonation_url}`);let s=this.getAnyScopes()??[];return new Gn.Impersonated({...e,sourceClient:t,targetPrincipal:n,targetScopes:Array.isArray(s)?s:[s]})}fromJSON(e,t={}){let n,s=(0,Dm.originalOrCamelOptions)(t).get("universe_domain");return e.type===Am.USER_REFRESH_ACCOUNT_TYPE?(n=new Am.UserRefreshClient(t),n.fromJSON(e)):e.type===Gn.IMPERSONATED_ACCOUNT_TYPE?n=this.fromImpersonatedJSON(e):e.type===xo.EXTERNAL_ACCOUNT_TYPE?(n=OE.ExternalAccountClient.fromJSON({...e,...t}),n.scopes=this.getAnyScopes()):e.type===wm.EXTERNAL_ACCOUNT_AUTHORIZED_USER_TYPE?n=new wm.ExternalAccountAuthorizedUserClient({...e,...t}):(t.scopes=this.scopes,n=new Hn.JWT(t),this.setGapicJWTValues(n),n.fromJSON(e)),s&&(n.universeDomain=s),n}_cacheClientFromJSON(e,t){let n=this.fromJSON(e,t);return this.jsonContent=e,this.cachedCredential=n,n}fromStream(e,t={},n){let s={};if(typeof t=="function"?n=t:s=t,n)this.fromStreamAsync(e,s).then(a=>n(null,a),n);else return this.fromStreamAsync(e,s)}fromStreamAsync(e,t){return new Promise((n,s)=>{if(!e)throw new Error("Must pass in a stream containing the Google auth settings.");let a=[];e.setEncoding("utf8").on("error",s).on("data",c=>a.push(c)).on("end",()=>{try{try{let c=JSON.parse(a.join("")),f=this._cacheClientFromJSON(c,t);return n(f)}catch(c){if(!this.keyFilename)throw c;let f=new Hn.JWT({...this.clientOptions,keyFile:this.keyFilename});return this.cachedCredential=f,this.setGapicJWTValues(f),n(f)}}catch(c){return s(c)}})})}fromAPIKey(e,t={}){return new Hn.JWT({...t,apiKey:e})}_isWindows(){let e=vE.platform();return!!(e&&e.length>=3&&e.substring(0,3).toLowerCase()==="win")}async getDefaultServiceProjectId(){return new Promise(e=>{(0,DE.exec)("gcloud config config-helper --format json",(t,n)=>{if(!t&&n)try{let s=JSON.parse(n).configuration.properties.core.project;e(s);return}catch{}e(null)})})}getProductionProjectId(){return process.env.GCLOUD_PROJECT||process.env.GOOGLE_CLOUD_PROJECT||process.env.gcloud_project||process.env.google_cloud_project}async getFileProjectId(){if(this.cachedCredential)return this.cachedCredential.projectId;if(this.keyFilename){let t=await this.getClient();if(t&&t.projectId)return t.projectId}let e=await this._tryGetApplicationCredentialsFromEnvironmentVariable();return e?e.projectId:null}async getExternalAccountClientProjectId(){return!this.jsonContent||this.jsonContent.type!==xo.EXTERNAL_ACCOUNT_TYPE?null:await(await this.getClient()).getProjectId()}async getGCEProjectId(){try{return await Po.project("project-id")}catch{return null}}getCredentials(e){if(e)this.getCredentialsAsync().then(t=>e(null,t),e);else return this.getCredentialsAsync()}async getCredentialsAsync(){let e=await this.getClient();if(e instanceof Gn.Impersonated)return{client_email:e.getTargetPrincipal()};if(e instanceof xo.BaseExternalAccountClient){let t=e.getServiceAccountEmail();if(t)return{client_email:t,universe_domain:e.universeDomain}}if(this.jsonContent)return{client_email:this.jsonContent.client_email,private_key:this.jsonContent.private_key,universe_domain:this.jsonContent.universe_domain};if(await this._checkIsGCE()){let[t,n]=await Promise.all([Po.instance("service-accounts/default/email"),this.getUniverseDomain()]);return{client_email:t,universe_domain:n}}throw new Error($t.GoogleAuthExceptionMessages.NO_CREDENTIALS_FOUND)}async getClient(){if(this.cachedCredential)return this.cachedCredential;this.#e=this.#e||this.#r();try{return await this.#e}finally{this.#e=null}}async#r(){if(this.jsonContent)return this._cacheClientFromJSON(this.jsonContent,this.clientOptions);if(this.keyFilename){let e=zc.resolve(this.keyFilename),t=Oo.createReadStream(e);return await this.fromStreamAsync(t,this.clientOptions)}else if(this.apiKey){let e=await this.fromAPIKey(this.apiKey,this.clientOptions);e.scopes=this.scopes;let{credential:t}=await this.#t(e);return t}else{let{credential:e}=await this.getApplicationDefaultAsync(this.clientOptions);return e}}async getIdTokenClient(e){let t=await this.getClient();if(!("fetchIdToken"in t))throw new Error("Cannot fetch ID token in this environment, use GCE or set the GOOGLE_APPLICATION_CREDENTIALS environment variable to a service account credentials JSON file.");return new FE.IdTokenClient({targetAudience:e,idTokenProvider:t})}async getAccessToken(){return(await(await this.getClient()).getAccessToken()).token}async getRequestHeaders(e){return(await this.getClient()).getRequestHeaders(e)}async authorizeRequest(e={}){let t=e.url,s=await(await this.getClient()).getRequestHeaders(t);return e.headers=SE.Gaxios.mergeHeaders(e.headers,s),e}async fetch(...e){return(await this.getClient()).fetch(...e)}async request(e){return(await this.getClient()).request(e)}getEnv(){return(0,kE.getEnv)()}async sign(e,t){let n=await this.getClient(),s=await this.getUniverseDomain();if(t=t||`https://iamcredentials.${s}/v1/projects/-/serviceAccounts/`,n instanceof Gn.Impersonated)return(await n.sign(e)).signedBlob;let a=(0,TE.createCrypto)();if(n instanceof Hn.JWT&&n.key)return await a.sign(n.key,e);let c=await this.getCredentials();if(!c.client_email)throw new Error("Cannot sign data without `client_email`.");return this.signBlob(a,c.client_email,e,t)}async signBlob(e,t,n,s){let a=new URL(s+`${t}:signBlob`);return(await this.request({method:"POST",url:a.href,data:{payload:e.encodeBase64StringUtf8(n)},retry:!0,retryConfig:{httpMethodsToRetry:["POST"]}})).data.signedBlob}};$t.GoogleAuth=Vc});var vm=W(Ni=>{"use strict";Object.defineProperty(Ni,"__esModule",{value:!0});Ni.IAMAuth=void 0;var Kc=class{selector;token;constructor(e,t){this.selector=e,this.token=t,this.selector=e,this.token=t}getRequestHeaders(){return{"x-goog-iam-authority-selector":this.selector,"x-goog-iam-authorization-token":this.token}}};Ni.IAMAuth=Kc});var Tm=W(Zt=>{"use strict";Object.defineProperty(Zt,"__esModule",{value:!0});Zt.DownscopedClient=Zt.EXPIRATION_TIME_OFFSET=Zt.MAX_ACCESS_BOUNDARY_RULES_COUNT=void 0;var PE=$e(),xE=require("stream"),Yc=pt(),BE=gi(),IE="urn:ietf:params:oauth:grant-type:token-exchange",NE="urn:ietf:params:oauth:token-type:access_token",qE="urn:ietf:params:oauth:token-type:access_token";Zt.MAX_ACCESS_BOUNDARY_RULES_COUNT=10;Zt.EXPIRATION_TIME_OFFSET=5*60*1e3;var Xc=class extends Yc.AuthClient{authClient;credentialAccessBoundary;cachedDownscopedAccessToken;stsCredential;constructor(e,t={accessBoundary:{accessBoundaryRules:[]}}){if(super(e instanceof Yc.AuthClient?{}:e),e instanceof Yc.AuthClient?(this.authClient=e,this.credentialAccessBoundary=t):(this.authClient=e.authClient,this.credentialAccessBoundary=e.credentialAccessBoundary),this.credentialAccessBoundary.accessBoundary.accessBoundaryRules.length===0)throw new Error("At least one access boundary rule needs to be defined.");if(this.credentialAccessBoundary.accessBoundary.accessBoundaryRules.length>Zt.MAX_ACCESS_BOUNDARY_RULES_COUNT)throw new Error(`The provided access boundary has more than ${Zt.MAX_ACCESS_BOUNDARY_RULES_COUNT} access boundary rules.`);for(let n of this.credentialAccessBoundary.accessBoundary.accessBoundaryRules)if(n.availablePermissions.length===0)throw new Error("At least one permission should be defined in access boundary rules.");this.stsCredential=new BE.StsCredentials({tokenExchangeEndpoint:`https://sts.${this.universeDomain}/v1/token`}),this.cachedDownscopedAccessToken=null}setCredentials(e){if(!e.expiry_date)throw new Error("The access token expiry_date field is missing in the provided credentials.");super.setCredentials(e),this.cachedDownscopedAccessToken=e}async getAccessToken(){return(!this.cachedDownscopedAccessToken||this.isExpired(this.cachedDownscopedAccessToken))&&await this.refreshAccessTokenAsync(),{token:this.cachedDownscopedAccessToken.access_token,expirationTime:this.cachedDownscopedAccessToken.expiry_date,res:this.cachedDownscopedAccessToken.res}}async getRequestHeaders(){let e=await this.getAccessToken(),t=new Headers({authorization:`Bearer ${e.token}`});return this.addSharedMetadataHeaders(t)}request(e,t){if(t)this.requestAsync(e).then(n=>t(null,n),n=>t(n,n.response));else return this.requestAsync(e)}async requestAsync(e,t=!1){let n;try{let s=await this.getRequestHeaders();e.headers=PE.Gaxios.mergeHeaders(e.headers),this.addUserProjectAndAuthHeaders(e.headers,s),n=await this.transporter.request(e)}catch(s){let a=s.response;if(a){let c=a.status,f=a.config.data instanceof xE.Readable;if(!t&&(c===401||c===403)&&!f&&this.forceRefreshOnFailure)return await this.refreshAccessTokenAsync(),await this.requestAsync(e,!0)}throw s}return n}async refreshAccessTokenAsync(){let e=(await this.authClient.getAccessToken()).token,t={grantType:IE,requestedTokenType:NE,subjectToken:e,subjectTokenType:qE},n=await this.stsCredential.exchangeToken(t,void 0,this.credentialAccessBoundary),s=this.authClient.credentials?.expiry_date||null,a=n.expires_in?new Date().getTime()+n.expires_in*1e3:s;return this.cachedDownscopedAccessToken={access_token:n.access_token,expiry_date:a,res:n.res},this.credentials={},Object.assign(this.credentials,this.cachedDownscopedAccessToken),delete this.credentials.res,this.emit("tokens",{refresh_token:null,expiry_date:this.cachedDownscopedAccessToken.expiry_date,access_token:this.cachedDownscopedAccessToken.access_token,token_type:"Bearer",id_token:null}),this.cachedDownscopedAccessToken}isExpired(e){let t=new Date().getTime();return e.expiry_date?t>=e.expiry_date-this.eagerRefreshThresholdMillis:!1}};Zt.DownscopedClient=Xc});var Rm=W(qi=>{"use strict";Object.defineProperty(qi,"__esModule",{value:!0});qi.PassThroughClient=void 0;var jE=pt(),Qc=class extends jE.AuthClient{async request(e){return this.transporter.request(e)}async getAccessToken(){return{}}async getRequestHeaders(){return new Headers}};qi.PassThroughClient=Qc});var Pm=W(Y=>{"use strict";Object.defineProperty(Y,"__esModule",{value:!0});Y.GoogleAuth=Y.auth=Y.PassThroughClient=Y.ExecutableError=Y.PluggableAuthClient=Y.DownscopedClient=Y.BaseExternalAccountClient=Y.ExternalAccountClient=Y.IdentityPoolClient=Y.AwsRequestSigner=Y.AwsClient=Y.UserRefreshClient=Y.LoginTicket=Y.ClientAuthentication=Y.OAuth2Client=Y.CodeChallengeMethod=Y.Impersonated=Y.JWT=Y.JWTAccess=Y.IdTokenClient=Y.IAMAuth=Y.GCPEnv=Y.Compute=Y.DEFAULT_UNIVERSE=Y.AuthClient=Y.gaxios=Y.gcpMetadata=void 0;var Fm=Sm();Object.defineProperty(Y,"GoogleAuth",{enumerable:!0,get:function(){return Fm.GoogleAuth}});Y.gcpMetadata=yo();Y.gaxios=$e();var km=pt();Object.defineProperty(Y,"AuthClient",{enumerable:!0,get:function(){return km.AuthClient}});Object.defineProperty(Y,"DEFAULT_UNIVERSE",{enumerable:!0,get:function(){return km.DEFAULT_UNIVERSE}});var LE=Uu();Object.defineProperty(Y,"Compute",{enumerable:!0,get:function(){return LE.Compute}});var UE=Hu();Object.defineProperty(Y,"GCPEnv",{enumerable:!0,get:function(){return UE.GCPEnv}});var ME=vm();Object.defineProperty(Y,"IAMAuth",{enumerable:!0,get:function(){return ME.IAMAuth}});var $E=$u();Object.defineProperty(Y,"IdTokenClient",{enumerable:!0,get:function(){return $E.IdTokenClient}});var HE=ic();Object.defineProperty(Y,"JWTAccess",{enumerable:!0,get:function(){return HE.JWTAccess}});var GE=uc();Object.defineProperty(Y,"JWT",{enumerable:!0,get:function(){return GE.JWT}});var WE=dc();Object.defineProperty(Y,"Impersonated",{enumerable:!0,get:function(){return WE.Impersonated}});var Zc=tn();Object.defineProperty(Y,"CodeChallengeMethod",{enumerable:!0,get:function(){return Zc.CodeChallengeMethod}});Object.defineProperty(Y,"OAuth2Client",{enumerable:!0,get:function(){return Zc.OAuth2Client}});Object.defineProperty(Y,"ClientAuthentication",{enumerable:!0,get:function(){return Zc.ClientAuthentication}});var zE=Nu();Object.defineProperty(Y,"LoginTicket",{enumerable:!0,get:function(){return zE.LoginTicket}});var JE=lc();Object.defineProperty(Y,"UserRefreshClient",{enumerable:!0,get:function(){return JE.UserRefreshClient}});var VE=Oc();Object.defineProperty(Y,"AwsClient",{enumerable:!0,get:function(){return VE.AwsClient}});var KE=Rc();Object.defineProperty(Y,"AwsRequestSigner",{enumerable:!0,get:function(){return KE.AwsRequestSigner}});var YE=vc();Object.defineProperty(Y,"IdentityPoolClient",{enumerable:!0,get:function(){return YE.IdentityPoolClient}});var XE=Hc();Object.defineProperty(Y,"ExternalAccountClient",{enumerable:!0,get:function(){return XE.ExternalAccountClient}});var QE=Ir();Object.defineProperty(Y,"BaseExternalAccountClient",{enumerable:!0,get:function(){return QE.BaseExternalAccountClient}});var ZE=Tm();Object.defineProperty(Y,"DownscopedClient",{enumerable:!0,get:function(){return ZE.DownscopedClient}});var Om=Mc();Object.defineProperty(Y,"PluggableAuthClient",{enumerable:!0,get:function(){return Om.PluggableAuthClient}});Object.defineProperty(Y,"ExecutableError",{enumerable:!0,get:function(){return Om.ExecutableError}});var eA=Rm();Object.defineProperty(Y,"PassThroughClient",{enumerable:!0,get:function(){return eA.PassThroughClient}});var tA=new Fm.GoogleAuth;Y.auth=tA});var sA={};wa(sA,{default:()=>oA});module.exports=wy(sA);var Im=Ie(require("fastify"),1),Nm=Ie(require("@fastify/cors"),1);var ro=require("fs"),xa=require("path"),yf=require("dotenv"),_f=Ie(Pa(),1),ds=class{config={};options;constructor(e={jsonPath:"./config.json"}){this.options={envPath:e.envPath||".env",jsonPath:e.jsonPath,useEnvFile:!1,useJsonFile:e.useJsonFile!==!1,useEnvironmentVariables:e.useEnvironmentVariables!==!1,...e},this.loadConfig()}loadConfig(){this.options.useJsonFile&&this.options.jsonPath&&this.loadJsonConfig(),this.options.initialConfig&&(this.config={...this.config,...this.options.initialConfig}),this.options.useEnvFile&&this.loadEnvConfig(),this.config.LOG_FILE&&(process.env.LOG_FILE=this.config.LOG_FILE),this.config.LOG&&(process.env.LOG=this.config.LOG)}loadJsonConfig(){if(!this.options.jsonPath)return;let e=this.isAbsolutePath(this.options.jsonPath)?this.options.jsonPath:(0,xa.join)(process.cwd(),this.options.jsonPath);if((0,ro.existsSync)(e))try{let t=(0,ro.readFileSync)(e,"utf-8"),n=_f.default.parse(t);this.config={...this.config,...n},console.log(`Loaded JSON config from: ${e}`)}catch(t){console.warn(`Failed to load JSON config from ${e}:`,t)}else console.warn(`JSON config file not found: ${e}`)}loadEnvConfig(){let e=this.isAbsolutePath(this.options.envPath)?this.options.envPath:(0,xa.join)(process.cwd(),this.options.envPath);if((0,ro.existsSync)(e))try{let t=(0,yf.config)({path:e});t.parsed&&(this.config={...this.config,...this.parseEnvConfig(t.parsed)})}catch(t){console.warn(`Failed to load .env config from ${e}:`,t)}}loadEnvironmentVariables(){let e=this.parseEnvConfig(process.env);this.config={...this.config,...e}}parseEnvConfig(e){let t={};return Object.assign(t,e),t}isAbsolutePath(e){return e.startsWith("/")||e.includes(":")}get(e,t){let n=this.config[e];return n!==void 0?n:t}getAll(){return{...this.config}}getHttpsProxy(){return this.get("HTTPS_PROXY")||this.get("https_proxy")||this.get("httpsProxy")||this.get("PROXY_URL")}has(e){return this.config[e]!==void 0}set(e,t){this.config[e]=t}reload(){this.config={},this.loadConfig()}getConfigSummary(){let e=[];return this.options.initialConfig&&e.push("Initial Config"),this.options.useJsonFile&&this.options.jsonPath&&e.push(`JSON: ${this.options.jsonPath}`),this.options.useEnvFile&&e.push(`ENV: ${this.options.envPath}`),this.options.useEnvironmentVariables&&e.push("Environment Variables"),`Config sources: ${e.join(", ")}`}};var Cf=Ie(require("node:fs"),1);function oe(...r){if(console.log(...r),!(process.env.LOG==="true"))return;let n=`[${new Date().toISOString()}] ${Array.isArray(r)?r.map(a=>typeof a=="object"?JSON.stringify(a):String(a)).join(" "):""}
`,s=process.env.LOG_FILE||"app.log";Cf.default.appendFileSync(s,n,"utf8")}function Tr(r,e=500,t="internal_error",n="api_error"){let s=new Error(r);return s.statusCode=e,s.code=t,s.type=n,s}async function bf(r,e,t){e.log.error(r);let n=r.statusCode||500,s={error:{message:r.message||"Internal Server Error",type:r.type||"api_error",code:r.code||"internal_error"}};return t.code(n).send(s)}var Ef=require("undici");function Af(r,e,t){let n=new Headers({"Content-Type":"application/json"});t.headers&&Object.entries(t.headers).forEach(([f,l])=>{n.set(f,l)});let s,a=AbortSignal.timeout(t.TIMEOUT??60*1e3*60);if(t.signal){let f=new AbortController,l=()=>f.abort();t.signal.addEventListener("abort",l),a.addEventListener("abort",l),s=f.signal}else s=a;let c={method:"POST",headers:n,body:JSON.stringify(e),signal:s};return t.httpsProxy&&(c.dispatcher=new Ef.ProxyAgent(new URL(t.httpsProxy).toString())),oe("final request:",typeof r=="string"?r:r.toString(),t.httpsProxy,c),fetch(typeof r=="string"?r:r.toString(),c)}var wf=async r=>{r.get("/",async(t,n)=>({message:"LLMs API",version:"1.0.0"})),r.get("/health",async(t,n)=>({status:"ok",timestamp:new Date().toISOString()}));let e=r._server.transformerService.getTransformersWithEndpoint();for(let{name:t,transformer:n}of e)n.endPoint&&r.post(n.endPoint,async(s,a)=>{let c=s.body,f=s.provider,l=r._server.providerService.getProvider(f);if(!l)throw Tr(`Provider '${f}' not found`,404,"provider_not_found");let d=c,h={};if(typeof n.transformRequestOut=="function"){let y=await n.transformRequestOut(c);y.body?(d=y.body,h=y.config||{}):d=y}if(oe("use transformers:",l.transformer?.use),l.transformer?.use?.length)for(let y of l.transformer.use){if(!y||typeof y.transformRequestIn!="function")continue;let C=await y.transformRequestIn(d,l);C.body?(d=C.body,h={...h,...C.config}):d=C}if(l.transformer?.[s.body.model]?.use?.length)for(let y of l.transformer[s.body.model].use)!y||typeof y.transformRequestIn!="function"||(d=await y.transformRequestIn(d,l));let b=h.url||new URL(l.baseUrl),A=await Af(b,d,{httpsProxy:r._server.configService.getHttpsProxy(),...h,headers:{Authorization:`Bearer ${l.apiKey}`,...h?.headers||{}}});if(!A.ok){let y=await A.text();throw oe(`Error response from ${b}: ${y}`),Tr(`Error from provider: ${y}`,A.status,"provider_response_error")}let O=A;if(l.transformer?.use?.length)for(let y of l.transformer.use)!y||typeof y.transformResponseOut!="function"||(O=await y.transformResponseOut(O));if(l.transformer?.[s.body.model]?.use?.length)for(let y of l.transformer[s.body.model].use)!y||typeof y.transformResponseOut!="function"||(O=await y.transformResponseOut(O));return n.transformResponseIn&&(O=await n.transformResponseIn(O)),O.ok||a.code(O.status),c?.stream===!0?(a.header("Content-Type","text/event-stream"),a.header("Cache-Control","no-cache"),a.header("Connection","keep-alive"),a.send(O.body)):O.json()});r.post("/providers",{schema:{body:{type:"object",properties:{id:{type:"string"},name:{type:"string"},type:{type:"string",enum:["openai","anthropic"]},baseUrl:{type:"string"},apiKey:{type:"string"},models:{type:"array",items:{type:"string"}}},required:["id","name","type","baseUrl","apiKey","models"]}}},async(t,n)=>{let{name:s,type:a,baseUrl:c,apiKey:f,models:l}=t.body;if(!s?.trim())throw Tr("Provider name is required",400,"invalid_request");if(!c||!Py(c))throw Tr("Valid base URL is required",400,"invalid_request");if(!f?.trim())throw Tr("API key is required",400,"invalid_request");if(!l||!Array.isArray(l)||l.length===0)throw Tr("At least one model is required",400,"invalid_request");if(r._server.providerService.getProvider(id))throw Tr(`Provider with ID '${id}' already exists`,400,"provider_exists");return r._server.providerService.registerProvider(t.body)}),r.get("/providers",async(t,n)=>r._server.providerService.getProviders()),r.get("/providers/:id",{schema:{params:{type:"object",properties:{id:{type:"string"}},required:["id"]}}},async(t,n)=>{let s=r._server.providerService.getProvider(t.params.id);return s||n.code(404).send({error:"Provider not found"})}),r.put("/providers/:id",{schema:{params:{type:"object",properties:{id:{type:"string"}},required:["id"]},body:{type:"object",properties:{name:{type:"string"},type:{type:"string",enum:["openai","anthropic"]},baseUrl:{type:"string"},apiKey:{type:"string"},models:{type:"array",items:{type:"string"}},enabled:{type:"boolean"}}}}},async(t,n)=>{let s=r._server.providerService.updateProvider(t.params.id,t.body);return s||n.code(404).send({error:"Provider not found"})}),r.delete("/providers/:id",{schema:{params:{type:"object",properties:{id:{type:"string"}},required:["id"]}}},async(t,n)=>r._server.providerService.deleteProvider(t.params.id)?{message:"Provider deleted successfully"}:n.code(404).send({error:"Provider not found"})),r.patch("/providers/:id/toggle",{schema:{params:{type:"object",properties:{id:{type:"string"}},required:["id"]},body:{type:"object",properties:{enabled:{type:"boolean"}},required:["enabled"]}}},async(t,n)=>r._server.providerService.toggleProvider(t.params.id,t.body.enabled)?{message:`Provider ${t.body.enabled?"enabled":"disabled"} successfully`}:n.code(404).send({error:"Provider not found"}))};function Py(r){try{return new URL(r),!0}catch{return!1}}var hs=class{constructor(e){this.providerService=e}registerProvider(e){return this.providerService.registerProvider(e)}getProviders(){return this.providerService.getProviders()}getProvider(e){return this.providerService.getProvider(e)}updateProvider(e,t){return this.providerService.updateProvider(e,t)}deleteProvider(e){return this.providerService.deleteProvider(e)}toggleProvider(e,t){return this.providerService.toggleProvider(e,t)}resolveRoute(e){let t=this.providerService.resolveModelRoute(e);if(!t)throw new Error(`Model ${e} not found. Available models: ${this.getAvailableModelNames().join(", ")}`);return t}async getAvailableModels(){return{object:"list",data:this.providerService.getAvailableModels().flatMap(t=>t.models.map(n=>({id:n,object:"model",provider:t.provider,created:Math.floor(Date.now()/1e3),owned_by:t.provider})))}}getAvailableModelNames(){return this.providerService.getModelRoutes().map(e=>e.fullModel)}getModelRoutes(){return this.providerService.getModelRoutes()}};var ps=class{constructor(e,t){this.configService=e;this.transformerService=t;this.initializeCustomProviders()}providers=new Map;modelRoutes=new Map;initializeCustomProviders(){let e=this.configService.get("providers");if(e&&Array.isArray(e)){this.initializeFromProvidersArray(e);return}}initializeFromProvidersArray(e){e.forEach(t=>{try{if(!t.name||!t.api_base_url||!t.api_key)return;let n={};t.transformer&&Object.keys(t.transformer).forEach(s=>{s==="use"?Array.isArray(t.transformer.use)&&(n.use=t.transformer.use.map(a=>{if(Array.isArray(a)&&typeof a[0]=="string"){let c=this.transformerService.getTransformer(a[0]);if(c)return new c(a[1])}if(typeof a=="string")return this.transformerService.getTransformer(a)}).filter(a=>typeof a<"u")):Array.isArray(t.transformer[s]?.use)&&(n[s]={use:t.transformer[s].use.map(a=>{if(Array.isArray(a)&&typeof a[0]=="string"){let c=this.transformerService.getTransformer(a[0]);if(c)return new c(a[1])}if(typeof a=="string")return this.transformerService.getTransformer(a)}).filter(a=>typeof a<"u")})}),this.registerProvider({name:t.name,baseUrl:t.api_base_url,apiKey:t.api_key,models:t.models||[],transformer:t.transformer?n:void 0}),oe(`${t.name} provider registered`)}catch(n){oe(`${t.name} provider registered error: ${n}`)}})}registerProvider(e){let t={...e};return this.providers.set(t.name,t),e.models.forEach(n=>{let s=`${t.name},${n}`,a={provider:t.name,model:n,fullModel:s};this.modelRoutes.set(s,a),this.modelRoutes.has(n)||this.modelRoutes.set(n,a)}),t}getProviders(){return Array.from(this.providers.values())}getProvider(e){return this.providers.get(e)}updateProvider(e,t){let n=this.providers.get(e);if(!n)return null;let s={...n,...t,updatedAt:new Date};return this.providers.set(e,s),t.models&&(n.models.forEach(a=>{let c=`${n.id},${a}`;this.modelRoutes.delete(c),this.modelRoutes.delete(a)}),t.models.forEach(a=>{let c=`${n.name},${a}`,f={provider:n.name,model:a,fullModel:c};this.modelRoutes.set(c,f),this.modelRoutes.has(a)||this.modelRoutes.set(a,f)})),s}deleteProvider(e){let t=this.providers.get(e);return t?(t.models.forEach(n=>{let s=`${t.name},${n}`;this.modelRoutes.delete(s),this.modelRoutes.delete(n)}),this.providers.delete(e),!0):!1}toggleProvider(e,t){return!!this.providers.get(e)}resolveModelRoute(e){let t=this.modelRoutes.get(e);if(!t)return null;let n=this.providers.get(t.provider);return n?{provider:n,originalModel:e,targetModel:t.model}:null}getAvailableModelNames(){let e=[];return this.providers.forEach(t=>{t.models.forEach(n=>{e.push(n),e.push(`${t.name},${n}`)})}),e}getModelRoutes(){return Array.from(this.modelRoutes.values())}parseTransformerConfig(e){return e?Array.isArray(e)?e.reduce((t,n)=>{if(Array.isArray(n)){let[s,a={}]=n;t[s]=a}else t[n]={};return t},{}):e:{}}async getAvailableModels(){let e=[];return this.providers.forEach(t=>{t.models.forEach(n=>{e.push({id:n,object:"model",owned_by:t.name,provider:t.name}),e.push({id:`${t.name},${n}`,object:"model",owned_by:t.name,provider:t.name})})}),{object:"list",data:e}}};var Me=[];for(let r=0;r<256;++r)Me.push((r+256).toString(16).slice(1));function Df(r,e=0){return(Me[r[e+0]]+Me[r[e+1]]+Me[r[e+2]]+Me[r[e+3]]+"-"+Me[r[e+4]]+Me[r[e+5]]+"-"+Me[r[e+6]]+Me[r[e+7]]+"-"+Me[r[e+8]]+Me[r[e+9]]+"-"+Me[r[e+10]]+Me[r[e+11]]+Me[r[e+12]]+Me[r[e+13]]+Me[r[e+14]]+Me[r[e+15]]).toLowerCase()}var Sf=require("crypto"),gs=new Uint8Array(256),ms=gs.length;function Ba(){return ms>gs.length-16&&((0,Sf.randomFillSync)(gs),ms=0),gs.slice(ms,ms+=16)}var vf=require("crypto"),Ia={randomUUID:vf.randomUUID};function xy(r,e,t){if(Ia.randomUUID&&!e&&!r)return Ia.randomUUID();r=r||{};let n=r.random??r.rng?.()??Ba();if(n.length<16)throw new Error("Random bytes length must be >= 16");if(n[6]=n[6]&15|64,n[8]=n[8]&63|128,e){if(t=t||0,t<0||t+16>e.length)throw new RangeError(`UUID byte range ${t}:${t+15} is out of buffer bounds`);for(let s=0;s<16;++s)e[t+s]=n[s];return e}return Df(n)}var Rr=xy;var ys=class{name="Anthropic";endPoint="/v1/messages";async transformRequestOut(e){oe("Anthropic Request:",JSON.stringify(e,null,2));let t=[];if(e.system){if(typeof e.system=="string")t.push({role:"system",content:e.system});else if(Array.isArray(e.system)&&e.system.length){let a=e.system.filter(c=>c.type==="text"&&c.text).map(c=>({type:"text",text:c.text,cache_control:c.cache_control}));t.push({role:"system",content:a})}}return JSON.parse(JSON.stringify(e.messages||[]))?.forEach((a,c)=>{if(a.role==="user"||a.role==="assistant"){if(typeof a.content=="string"){t.push({role:a.role,content:a.content});return}if(Array.isArray(a.content)){if(a.role==="user"){let f=a.content.filter(d=>d.type==="tool_result"&&d.tool_use_id);f.length&&f.forEach((d,h)=>{let b={role:"tool",content:typeof d.content=="string"?d.content:JSON.stringify(d.content),tool_call_id:d.tool_use_id,cache_control:d.cache_control};t.push(b)});let l=a.content.filter(d=>d.type==="text"&&d.text||d.type==="image"&&d.source);l.length&&t.push({role:"user",content:l.map(d=>d?.type==="image"?{type:"image_url",image_url:{url:d.source?.type==="base64"?d.source.data:d.source.url},media_type:d.source.media_type}:d)})}else if(a.role==="assistant"){let f={role:"assistant",content:null},l=a.content.filter(h=>h.type==="text"&&h.text);l.length&&(f.content=l.map(h=>h.text).join(`
`));let d=a.content.filter(h=>h.type==="tool_use"&&h.id);d.length&&(f.tool_calls=d.map(h=>({id:h.id,type:"function",function:{name:h.name,arguments:JSON.stringify(h.input||{})}}))),t.push(f)}return}}}),{messages:t,model:e.model,max_tokens:e.max_tokens,temperature:e.temperature,stream:e.stream,tools:e.tools?this.convertAnthropicToolsToUnified(e.tools):void 0,tool_choice:e.tool_choice}}async transformResponseIn(e){if(e.headers.get("Content-Type")?.includes("text/event-stream")){if(!e.body)throw new Error("Stream response body is null");let n=await this.convertOpenAIStreamToAnthropic(e.body);return new Response(n,{headers:{"Content-Type":"text/event-stream","Cache-Control":"no-cache",Connection:"keep-alive"}})}else{let n=await e.json(),s=this.convertOpenAIResponseToAnthropic(n);return new Response(JSON.stringify(s),{headers:{"Content-Type":"application/json"}})}}convertAnthropicToolsToUnified(e){return e.map(t=>({type:"function",function:{name:t.name,description:t.description||"",parameters:t.input_schema}}))}async convertOpenAIStreamToAnthropic(e){return new ReadableStream({async start(n){let s=new TextEncoder,a=`msg_${Date.now()}`,c="unknown",f=!1,l=!1,d=!1,h=new Map,b=new Map,A=0,O=0,S=0,y=!1,C=!1,_=0,F=B=>{if(!y)try{n.enqueue(B);let j=new TextDecoder().decode(B);oe("send data:",j.trim())}catch(j){if(j instanceof TypeError&&j.message.includes("Controller is already closed"))y=!0;else throw oe(`send data error: ${j.message}`),j}},k=()=>{if(!y)try{n.close(),y=!0}catch(B){if(B instanceof TypeError&&B.message.includes("Controller is already closed"))y=!0;else throw B}},U=null;try{U=e.getReader();let B=new TextDecoder,j="";for(;!y;){let{done:H,value:Z}=await U.read();if(H)break;j+=B.decode(Z,{stream:!0});let z=j.split(`
`);j=z.pop()||"";for(let _e of z){if(y||d)break;if(!_e.startsWith("data: "))continue;let de=_e.slice(6);if(de!=="[DONE]")try{let re=JSON.parse(de);if(A++,oe("Original Response:",JSON.stringify(re,null,2)),re.error){let Q={type:"error",message:{type:"api_error",message:JSON.stringify(re.error)}};F(s.encode(`event: error
data: ${JSON.stringify(Q)}

`));continue}if(c=re.model||c,!f&&!y&&!d){f=!0;let Q={type:"message_start",message:{id:a,type:"message",role:"assistant",content:[],model:c,stop_reason:null,stop_sequence:null,usage:{input_tokens:1,output_tokens:1}}};F(s.encode(`event: message_start
data: ${JSON.stringify(Q)}

`))}let se=re.choices?.[0];if(!se)continue;if(se?.delta?.thinking&&!y&&!d){if(!C){let Q={type:"content_block_start",index:_,content_block:{type:"thinking",thinking:""}};F(s.encode(`event: content_block_start
data: ${JSON.stringify(Q)}

`)),C=!0}if(se.delta.thinking.signature){let Q={type:"content_block_delta",index:_,delta:{type:"signature_delta",signature:se.delta.thinking.signature}};F(s.encode(`event: content_block_delta
data: ${JSON.stringify(Q)}

`));let ie={type:"content_block_stop",index:_};F(s.encode(`event: content_block_stop
data: ${JSON.stringify(ie)}

`)),_++}else if(se.delta.thinking.content){let Q={type:"content_block_delta",index:_,delta:{type:"thinking_delta",thinking:se.delta.thinking.content||""}};F(s.encode(`event: content_block_delta
data: ${JSON.stringify(Q)}

`))}}if(se?.delta?.content&&!y&&!d){if(O++,!l&&!d){l=!0;let Q={type:"content_block_start",index:_,content_block:{type:"text",text:""}};F(s.encode(`event: content_block_start
data: ${JSON.stringify(Q)}

`))}if(!y&&!d){let Q={type:"content_block_delta",index:_,delta:{type:"text_delta",text:se.delta.content}};F(s.encode(`event: content_block_delta
data: ${JSON.stringify(Q)}

`))}}if(se?.delta?.annotations?.length&&!y&&!d){let Q={type:"content_block_stop",index:_};F(s.encode(`event: content_block_stop
data: ${JSON.stringify(Q)}

`)),l=!1,se?.delta?.annotations.forEach((ie,le,De)=>{_++;let Se={type:"content_block_start",index:_,content_block:{type:"web_search_tool_result",tool_use_id:`srvtoolu_${Rr()}`,content:[{type:"web_search_result",title:ie.url_citation.title,url:ie.url_citation.url}]}};F(s.encode(`event: content_block_start
data: ${JSON.stringify(Se)}

`));let Fe={type:"content_block_stop",index:_};F(s.encode(`event: content_block_stop
data: ${JSON.stringify(Fe)}

`))})}if(se?.delta?.tool_calls&&!y&&!d){S++;let Q=new Set;for(let ie of se.delta.tool_calls){if(y)break;let le=ie.index??0;if(Q.has(le))continue;if(Q.add(le),!b.has(le)){let Se=l?b.size+1:b.size;if(Se!==0){oe("content_block_stop2");let G={type:"content_block_stop",index:_};F(s.encode(`event: content_block_stop
data: ${JSON.stringify(G)}

`)),_++}b.set(le,Se);let Fe=ie.id||`call_${Date.now()}_${le}`,Ct=ie.function?.name||`tool_${le}`,He={type:"content_block_start",index:_,content_block:{type:"tool_use",id:Fe,name:Ct,input:{}}};F(s.encode(`event: content_block_start
data: ${JSON.stringify(He)}

`));let er={id:Fe,name:Ct,arguments:"",contentBlockIndex:Se};h.set(le,er)}else if(ie.id&&ie.function?.name){let Se=h.get(le);Se.id.startsWith("call_")&&Se.name.startsWith("tool_")&&(Se.id=ie.id,Se.name=ie.function.name)}if(ie.function?.arguments&&!y&&!d){if(b.get(le)===void 0)continue;let Fe=h.get(le);Fe&&(Fe.arguments+=ie.function.arguments);try{let Ct={type:"content_block_delta",index:_,delta:{type:"input_json_delta",partial_json:ie.function.arguments}};F(s.encode(`event: content_block_delta
data: ${JSON.stringify(Ct)}

`))}catch{try{let He=ie.function.arguments.replace(/[\x00-\x1F\x7F-\x9F]/g,"").replace(/\\/g,"\\\\").replace(/"/g,'\\"'),er={type:"content_block_delta",index:_,delta:{type:"input_json_delta",partial_json:He}};F(s.encode(`event: content_block_delta
data: ${JSON.stringify(er)}

`))}catch(He){console.error(He)}}}}}if(se?.finish_reason&&!y&&!d){if(d=!0,O===0&&S===0&&console.error("Warning: No content in the stream response!"),(l||S>0)&&!y){oe("content_block_stop hasTextContentStarted");let Q={type:"content_block_stop",index:_};F(s.encode(`event: content_block_stop
data: ${JSON.stringify(Q)}

`))}if(!y){let le={type:"message_delta",delta:{stop_reason:{stop:"end_turn",length:"max_tokens",tool_calls:"tool_use",content_filter:"stop_sequence"}[se.finish_reason]||"end_turn",stop_sequence:null},usage:{input_tokens:re.usage?.prompt_tokens||0,output_tokens:re.usage?.completion_tokens||0}};F(s.encode(`event: message_delta
data: ${JSON.stringify(le)}

`))}if(!y){let Q={type:"message_stop"};F(s.encode(`event: message_stop
data: ${JSON.stringify(Q)}

`))}break}}catch(re){oe(`parseError: ${re.name} message: ${re.message} stack: ${re.stack} data: ${de}`)}}}k()}catch(B){if(!y)try{n.error(B)}catch(j){console.error(j)}}finally{if(U)try{U.releaseLock()}catch(B){console.error(B)}}},cancel(n){oe("cancle stream:",n)}})}convertOpenAIResponseToAnthropic(e){oe("Original OpenAI response:",JSON.stringify(e,null,2));let t=e.choices[0];if(!t)throw new Error("No choices found in OpenAI response");let n=[];if(t.message.annotations){let a=`srvtoolu_${Rr()}`;n.push({type:"server_tool_use",id:a,name:"web_search",input:{query:""}}),n.push({type:"web_search_tool_result",tool_use_id:a,content:t.message.annotations.map(c=>({type:"web_search_result",url:c.url_citation.url,title:c.url_citation.title}))})}t.message.content&&n.push({type:"text",text:t.message.content}),t.message.tool_calls&&t.message.tool_calls.length>0&&t.message.tool_calls.forEach((a,c)=>{let f={};try{let l=a.function.arguments||"{}";typeof l=="object"?f=l:typeof l=="string"&&(f=JSON.parse(l))}catch{f={text:a.function.arguments||""}}n.push({type:"tool_use",id:a.id,name:a.function.name,input:f})});let s={id:e.id,type:"message",role:"assistant",model:e.model,content:n,stop_reason:t.finish_reason==="stop"?"end_turn":t.finish_reason==="length"?"max_tokens":t.finish_reason==="tool_calls"?"tool_use":t.finish_reason==="content_filter"?"stop_sequence":"end_turn",stop_sequence:null,usage:{input_tokens:e.usage?.prompt_tokens||0,output_tokens:e.usage?.completion_tokens||0}};return oe("Conversion complete, final Anthropic response:",JSON.stringify(s,null,2)),s}};function Na(r){if(!(!r||typeof r!="object")){if(Array.isArray(r)){r.forEach(Na);return}delete r.$schema,delete r.additionalProperties,r.type==="string"&&r.format&&!["enum","date-time"].includes(r.format)&&delete r.format,Object.keys(r).forEach(e=>{Na(r[e])})}}function _s(r){let e=[],t=r.tools?.filter(a=>a.function.name!=="web_search")?.map(a=>(a.function.parameters&&Na(a.function.parameters),{name:a.function.name,description:a.function.description,parameters:a.function.parameters}));return t?.length&&e.push({functionDeclarations:t}),r.tools?.find(a=>a.function.name==="web_search")&&e.push({googleSearch:{}}),{contents:r.messages.map(a=>{let c;a.role==="assistant"?c="model":(["user","system","tool"].includes(a.role),c="user");let f=[];return typeof a.content=="string"?f.push({text:a.content}):Array.isArray(a.content)&&f.push(...a.content.map(l=>{if(l.type==="text")return{text:l.text||""};if(l.type==="image_url")return l.image_url.url.startsWith("http")?{file_data:{mime_type:l.media_type,file_uri:l.image_url.url}}:{inlineData:{mime_type:l.media_type,data:l.image_url.url}}})),Array.isArray(a.tool_calls)&&f.push(...a.tool_calls.map(l=>({functionCall:{id:l.id||`tool_${Math.random().toString(36).substring(2,15)}`,name:l.function.name,args:JSON.parse(l.function.arguments||"{}")}}))),{role:c,parts:f}}),tools:e.length?e:void 0}}function Cs(r){let e=r.contents,t=r.tools,n=r.model,s=r.max_tokens,a=r.temperature,c=r.stream,f=r.tool_choice,l={messages:[],model:n,max_tokens:s,temperature:a,stream:c,tool_choice:f};return Array.isArray(e)&&e.forEach(d=>{typeof d=="string"?l.messages.push({role:"user",content:d}):typeof d.text=="string"?l.messages.push({role:"user",content:d.text||null}):d.role==="user"?l.messages.push({role:"user",content:d?.parts?.map(h=>({type:"text",text:h.text||""}))||[]}):d.role==="model"&&l.messages.push({role:"assistant",content:d?.parts?.map(h=>({type:"text",text:h.text||""}))||[]})}),Array.isArray(t)&&(l.tools=[],t.forEach(d=>{Array.isArray(d.functionDeclarations)&&d.functionDeclarations.forEach(h=>{l.tools.push({type:"function",function:{name:h.name,description:h.description,parameters:h.parameters}})})})),l}async function bs(r,e){if(r.headers.get("Content-Type")?.includes("application/json")){let t=await r.json(),n=t.candidates[0].content?.parts?.filter(a=>a.functionCall)?.map(a=>({id:a.functionCall?.id||`tool_${Math.random().toString(36).substring(2,15)}`,type:"function",function:{name:a.functionCall?.name,arguments:JSON.stringify(a.functionCall?.args||{})}}))||[],s={id:t.responseId,choices:[{finish_reason:t.candidates[0].finishReason?.toLowerCase()||null,index:0,message:{content:t.candidates[0].content?.parts?.filter(a=>a.text)?.map(a=>a.text)?.join(`
`),role:"assistant",tool_calls:n.length>0?n:void 0}}],created:parseInt(new Date().getTime()/1e3+"",10),model:t.modelVersion,object:"chat.completion",usage:{completion_tokens:t.usageMetadata.candidatesTokenCount,prompt_tokens:t.usageMetadata.promptTokenCount,total_tokens:t.usageMetadata.totalTokenCount}};return new Response(JSON.stringify(s),{status:r.status,statusText:r.statusText,headers:r.headers})}else if(r.headers.get("Content-Type")?.includes("stream")){if(!r.body)return r;let t=new TextDecoder,n=new TextEncoder,s=(c,f)=>{if(c.startsWith("data: ")){let l=c.slice(6).trim();if(l){oe(`${e} chunk:`,l);try{let d=JSON.parse(l),h=d.candidates[0].content?.parts?.filter(A=>A.functionCall)?.map(A=>({id:A.functionCall?.id||`tool_${Math.random().toString(36).substring(2,15)}`,type:"function",function:{name:A.functionCall?.name,arguments:JSON.stringify(A.functionCall?.args||{})}})),b={choices:[{delta:{role:"assistant",content:d.candidates[0].content?.parts?.filter(A=>A.text)?.map(A=>A.text)?.join(`
`),tool_calls:h.length>0?h:void 0},finish_reason:d.candidates[0].finishReason?.toLowerCase()||null,index:d.candidates[0].index||h.length>0?1:0,logprobs:null}],created:parseInt(new Date().getTime()/1e3+"",10),id:d.responseId||"",model:d.modelVersion||"",object:"chat.completion.chunk",system_fingerprint:"fp_a49d71b8a1",usage:{completion_tokens:d.usageMetadata.candidatesTokenCount,prompt_tokens:d.usageMetadata.promptTokenCount,total_tokens:d.usageMetadata.totalTokenCount}};d.candidates[0]?.groundingMetadata?.groundingChunks?.length&&(b.choices[0].delta.annotations=d.candidates[0].groundingMetadata.groundingChunks.map((A,O)=>{let S=d.candidates[0]?.groundingMetadata?.groundingSupports?.filter(y=>y.groundingChunkIndices.includes(O));return{type:"url_citation",url_citation:{url:A.web.uri,title:A.web.title,content:S?.[0].segment.text,start_index:S?.[0].segment.startIndex,end_index:S?.[0].segment.endIndex}}})),f.enqueue(n.encode(`data: ${JSON.stringify(b)}

`))}catch(d){oe(`Error parsing ${e} stream chunk`,l,d.message)}}}},a=new ReadableStream({async start(c){let f=r.body.getReader(),l="";try{for(;;){let{done:d,value:h}=await f.read();if(d){l&&s(l,c);break}l+=t.decode(h,{stream:!0});let b=l.split(`
`);l=b.pop()||"";for(let A of b)s(A,c)}}catch(d){c.error(d)}finally{c.close()}}});return new Response(a,{status:r.status,statusText:r.statusText,headers:r.headers})}return r}var Es=class{name="gemini";endPoint="/v1beta/models/:modelAndAction";async transformRequestIn(e,t){return{body:_s(e),config:{url:new URL(`./${e.model}:${e.stream?"streamGenerateContent?alt=sse":"generateContent"}`,t.baseUrl),headers:{"x-goog-api-key":t.apiKey,Authorization:void 0}}}}transformRequestOut=Cs;async transformResponseOut(e){return bs(e,this.name)}};async function rA(){try{let{GoogleAuth:r}=await Promise.resolve().then(()=>Ie(Pm(),1));return(await(await new r({scopes:["https://www.googleapis.com/auth/cloud-platform"]}).getClient()).getAccessToken()).token||""}catch(r){throw oe("Error getting access token:",r),new Error(`Failed to get access token for Vertex AI. Please ensure you have set up authentication using one of these methods:
1. Set GOOGLE_APPLICATION_CREDENTIALS to point to service account key file
2. Run "gcloud auth application-default login"
3. Use Google Cloud environment with default service account`)}}var ji=class{name="vertex-gemini";endPoint="/v1/projects/:projectId/locations/:location/publishers/google/models/:modelAndAction";async transformRequestIn(e,t){let n=process.env.GOOGLE_CLOUD_PROJECT,s=process.env.GOOGLE_CLOUD_LOCATION||"us-central1";if(!n&&process.env.GOOGLE_APPLICATION_CREDENTIALS)try{let f=(await import("fs")).readFileSync(process.env.GOOGLE_APPLICATION_CREDENTIALS,"utf8"),l=JSON.parse(f);l&&l.project_id&&(n=l.project_id)}catch(c){oe("Error extracting project_id from GOOGLE_APPLICATION_CREDENTIALS:",c)}if(!n)throw new Error("Project ID is required for Vertex AI. Set GOOGLE_CLOUD_PROJECT environment variable or ensure project_id is in GOOGLE_APPLICATION_CREDENTIALS file.");let a=await rA();return{body:_s(e),config:{url:new URL(`./v1beta1/projects/${n}/locations/${s}/publishers/google/models/${e.model}:${e.stream?"streamGenerateContent":"generateContent"}`,t.baseUrl.endsWith("/")?t.baseUrl:t.baseUrl+"/"||`https://${s}-aiplatform.googleapis.com`),headers:{Authorization:`Bearer ${a}`,"x-goog-api-key":void 0}}}}transformRequestOut=Cs;async transformResponseOut(e){return bs(e,this.name)}};var Li=class{name="deepseek";async transformRequestIn(e){return e.max_tokens&&e.max_tokens>8192&&(e.max_tokens=8192),e}async transformResponseOut(e){if(e.headers.get("Content-Type")?.includes("application/json")){let t=await e.json();return new Response(JSON.stringify(t),{status:e.status,statusText:e.statusText,headers:e.headers})}else if(e.headers.get("Content-Type")?.includes("stream")){if(!e.body)return e;let t=new TextDecoder,n=new TextEncoder,s="",a=!1,c="",f=new ReadableStream({async start(l){let d=e.body.getReader(),h=(A,O,S)=>{let y=A.split(`
`);for(let C of y)C.trim()&&O.enqueue(S.encode(C+`
`))},b=(A,O)=>{let{controller:S,encoder:y}=O;if(A.startsWith("data: ")&&A.trim()!=="data: [DONE]")try{let C=JSON.parse(A.slice(6));if(C.choices?.[0]?.delta?.reasoning_content){O.appendReasoningContent(C.choices[0].delta.reasoning_content);let _={...C,choices:[{...C.choices[0],delta:{...C.choices[0].delta,thinking:{content:C.choices[0].delta.reasoning_content}}}]};delete _.choices[0].delta.reasoning_content;let F=`data: ${JSON.stringify(_)}

`;S.enqueue(y.encode(F));return}if(C.choices?.[0]?.delta?.content&&O.reasoningContent()&&!O.isReasoningComplete()){O.setReasoningComplete(!0);let _=Date.now().toString(),F={...C,choices:[{...C.choices[0],delta:{...C.choices[0].delta,content:null,thinking:{content:O.reasoningContent(),signature:_}}}]};delete F.choices[0].delta.reasoning_content;let k=`data: ${JSON.stringify(F)}

`;S.enqueue(y.encode(k))}if(C.choices[0]?.delta?.reasoning_content&&delete C.choices[0].delta.reasoning_content,C.choices?.[0]?.delta&&Object.keys(C.choices[0].delta).length>0){O.isReasoningComplete()&&C.choices[0].index++;let _=`data: ${JSON.stringify(C)}

`;S.enqueue(y.encode(_))}}catch{S.enqueue(y.encode(A+`
`))}else S.enqueue(y.encode(A+`
`))};try{for(;;){let{done:A,value:O}=await d.read();if(A){c.trim()&&h(c,l,n);break}let S=t.decode(O,{stream:!0});c+=S;let y=c.split(`
`);c=y.pop()||"";for(let C of y)if(C.trim())try{b(C,{controller:l,encoder:n,reasoningContent:()=>s,appendReasoningContent:_=>s+=_,isReasoningComplete:()=>a,setReasoningComplete:_=>a=_})}catch(_){console.error("Error processing line:",C,_),l.enqueue(n.encode(C+`
`))}}}catch(A){console.error("Stream error:",A),l.error(A)}finally{try{d.releaseLock()}catch(A){console.error("Error releasing reader lock:",A)}l.close()}}});return new Response(f,{status:e.status,statusText:e.statusText,headers:{"Content-Type":e.headers.get("Content-Type")||"text/plain","Cache-Control":"no-cache",Connection:"keep-alive"}})}return e}};var Ui=class{name="tooluse";transformRequestIn(e){return e.messages.push({role:"system",content:"<system-reminder>Tool mode is active. The user expects you to proactively execute the most suitable tool to help complete the task. \nBefore invoking a tool, you must carefully evaluate whether it matches the current task. If no available tool is appropriate for the task, you MUST call the `ExitTool` to exit tool mode \u2014 this is the only valid way to terminate tool mode.\nAlways prioritize completing the user's task effectively and efficiently by using tools whenever appropriate.</system-reminder>"}),e.tools?.length&&(e.tool_choice="required",e.tools.unshift({type:"function",function:{name:"ExitTool",description:`Use this tool when you are in tool mode and have completed the task. This is the only valid way to exit tool mode.
IMPORTANT: Before using this tool, ensure that none of the available tools are applicable to the current task. You must evaluate all available options \u2014 only if no suitable tool can help you complete the task should you use ExitTool to terminate tool mode.
Examples:
1. Task: "Use a tool to summarize this document" \u2014 Do not use ExitTool if a summarization tool is available.
2. Task: "What\u2019s the weather today?" \u2014 If no tool is available to answer, use ExitTool after reasoning that none can fulfill the task.`,parameters:{type:"object",properties:{response:{type:"string",description:"Your response will be forwarded to the user exactly as returned \u2014 the tool will not modify or post-process it in any way."}},required:["response"]}}})),e}async transformResponseOut(e){if(e.headers.get("Content-Type")?.includes("application/json")){let t=await e.json();if(t?.choices[0]?.message.tool_calls?.length&&t?.choices[0]?.message.tool_calls[0]?.function?.name==="ExitTool"){let n=t?.choices[0]?.message.tool_calls[0],s=JSON.parse(n.function.arguments||"{}");t.choices[0].message.content=s.response||"",delete t.choices[0].message.tool_calls}return new Response(JSON.stringify(t),{status:e.status,statusText:e.statusText,headers:e.headers})}else if(e.headers.get("Content-Type")?.includes("stream")){if(!e.body)return e;let t=new TextDecoder,n=new TextEncoder,s=-1,a="",c="",f=new ReadableStream({async start(l){let d=e.body.getReader(),h=(A,O,S)=>{let y=A.split(`
`);for(let C of y)C.trim()&&O.enqueue(S.encode(C+`
`))},b=(A,O)=>{let{controller:S,encoder:y,exitToolIndex:C,setExitToolIndex:_,appendExitToolResponse:F}=O;if(A.startsWith("data: ")&&A.trim()!=="data: [DONE]")try{let k=JSON.parse(A.slice(6));if(k.choices[0]?.delta?.tool_calls?.length){let U=k.choices[0].delta.tool_calls[0];if(U.function?.name==="ExitTool"){_(U.index);return}else if(C()>-1&&U.index===C()&&U.function.arguments){F(U.function.arguments);try{let B=JSON.parse(O.exitToolResponse());k.choices=[{delta:{role:"assistant",content:B.response||""}}];let j=`data: ${JSON.stringify(k)}

`;S.enqueue(y.encode(j))}catch{}return}}if(k.choices?.[0]?.delta&&Object.keys(k.choices[0].delta).length>0){let U=`data: ${JSON.stringify(k)}

`;S.enqueue(y.encode(U))}}catch{S.enqueue(y.encode(A+`
`))}else S.enqueue(y.encode(A+`
`))};try{for(;;){let{done:A,value:O}=await d.read();if(A){c.trim()&&h(c,l,n);break}let S=t.decode(O,{stream:!0});c+=S;let y=c.split(`
`);c=y.pop()||"";for(let C of y)if(C.trim())try{b(C,{controller:l,encoder:n,exitToolIndex:()=>s,setExitToolIndex:_=>s=_,exitToolResponse:()=>a,appendExitToolResponse:_=>a+=_})}catch(_){console.error("Error processing line:",C,_),l.enqueue(n.encode(C+`
`))}}}catch(A){console.error("Stream error:",A),l.error(A)}finally{try{d.releaseLock()}catch(A){console.error("Error releasing reader lock:",A)}l.close()}}});return new Response(f,{status:e.status,statusText:e.statusText,headers:{"Content-Type":e.headers.get("Content-Type")||"text/plain","Cache-Control":"no-cache",Connection:"keep-alive"}})}return e}};var Mi=class{name="openrouter";async transformRequestIn(e){return e.model.includes("claude")||e.messages.forEach(t=>{Array.isArray(t.content)?t.content.forEach(n=>{n.cache_control&&delete n.cache_control,n.type==="image_url"&&(n.image_url.url.startsWith("http")||(n.image_url.url=`data:${n.media_type};base64,${n.image_url.url}`),delete n.media_type)}):t.cache_control&&delete t.cache_control}),e}async transformResponseOut(e){if(e.headers.get("Content-Type")?.includes("application/json")){let t=await e.json();return new Response(JSON.stringify(t),{status:e.status,statusText:e.statusText,headers:e.headers})}else if(e.headers.get("Content-Type")?.includes("stream")){if(!e.body)return e;let t=new TextDecoder,n=new TextEncoder,s=!1,a="",c=!1,f=!1,l="",d=new ReadableStream({async start(h){let b=e.body.getReader(),A=(S,y,C)=>{let _=S.split(`
`);for(let F of _)F.trim()&&y.enqueue(C.encode(F+`
`))},O=(S,y)=>{let{controller:C,encoder:_}=y;if(S.startsWith("data: ")&&S.trim()!=="data: [DONE]"){let F=S.slice(6);try{let k=JSON.parse(F);if(k.usage&&(oe("usage",k.usage,f),k.choices[0].finish_reason=f?"tool_calls":"stop"),k.choices?.[0]?.finish_reason==="error"&&C.enqueue(_.encode(`data: ${JSON.stringify({error:k.choices?.[0].error})}

`)),k.choices?.[0]?.delta?.content&&!y.hasTextContent()&&y.setHasTextContent(!0),k.choices?.[0]?.delta?.reasoning){y.appendReasoningContent(k.choices[0].delta.reasoning);let B={...k,choices:[{...k.choices?.[0],delta:{...k.choices[0].delta,thinking:{content:k.choices[0].delta.reasoning}}}]};B.choices?.[0]?.delta&&delete B.choices[0].delta.reasoning;let j=`data: ${JSON.stringify(B)}

`;C.enqueue(_.encode(j));return}if(k.choices?.[0]?.delta?.content&&y.reasoningContent()&&!y.isReasoningComplete()){y.setReasoningComplete(!0);let B=Date.now().toString(),j={...k,choices:[{...k.choices?.[0],delta:{...k.choices[0].delta,content:null,thinking:{content:y.reasoningContent(),signature:B}}}]};j.choices?.[0]?.delta&&delete j.choices[0].delta.reasoning;let H=`data: ${JSON.stringify(j)}

`;C.enqueue(_.encode(H))}k.choices?.[0]?.delta?.reasoning&&delete k.choices[0].delta.reasoning,k.choices?.[0]?.delta?.tool_calls?.length&&!Number.isNaN(parseInt(k.choices?.[0]?.delta?.tool_calls[0].id,10))&&k.choices?.[0]?.delta?.tool_calls.forEach(B=>{B.id=`call_${Rr()}`}),k.choices?.[0]?.delta?.tool_calls?.length&&!f&&(oe("hasToolCall",!0),f=!0),k.choices?.[0]?.delta?.tool_calls?.length&&y.hasTextContent()&&(typeof k.choices[0].index=="number"?k.choices[0].index+=1:k.choices[0].index=1);let U=`data: ${JSON.stringify(k)}

`;C.enqueue(_.encode(U))}catch{C.enqueue(_.encode(S+`
`))}}else C.enqueue(_.encode(S+`
`))};try{for(;;){let{done:S,value:y}=await b.read();if(S){l.trim()&&A(l,h,n);break}if(!y||y.length===0)continue;let C;try{C=t.decode(y,{stream:!0})}catch(F){console.warn("Failed to decode chunk",F);continue}if(C.length===0)continue;if(l+=C,l.length>1e6){console.warn("Buffer size exceeds limit, processing partial data");let F=l.split(`
`);l=F.pop()||"";for(let k of F)if(k.trim())try{O(k,{controller:h,encoder:n,hasTextContent:()=>s,setHasTextContent:U=>s=U,reasoningContent:()=>a,appendReasoningContent:U=>a+=U,isReasoningComplete:()=>c,setReasoningComplete:U=>c=U})}catch(U){console.error("Error processing line:",k,U),h.enqueue(n.encode(k+`
`))}continue}let _=l.split(`
`);l=_.pop()||"";for(let F of _)if(F.trim())try{O(F,{controller:h,encoder:n,hasTextContent:()=>s,setHasTextContent:k=>s=k,reasoningContent:()=>a,appendReasoningContent:k=>a+=k,isReasoningComplete:()=>c,setReasoningComplete:k=>c=k})}catch(k){console.error("Error processing line:",F,k),h.enqueue(n.encode(F+`
`))}}}catch(S){console.error("Stream error:",S),h.error(S)}finally{try{b.releaseLock()}catch(S){console.error("Error releasing reader lock:",S)}h.close()}}});return new Response(d,{status:e.status,statusText:e.statusText,headers:{"Content-Type":e.headers.get("Content-Type")||"text/plain","Cache-Control":"no-cache",Connection:"keep-alive"}})}return e}};var $i=class{constructor(e){this.options=e;this.max_tokens=this.options?.max_tokens}static TransformerName="maxtoken";max_tokens;async transformRequestIn(e){return e.max_tokens&&e.max_tokens>this.max_tokens&&(e.max_tokens=this.max_tokens),e}};var Hi=class{name="groq";async transformRequestIn(e){return e.messages.forEach(t=>{Array.isArray(t.content)?t.content.forEach(n=>{n.cache_control&&delete n.cache_control}):t.cache_control&&delete t.cache_control}),Array.isArray(e.tools)&&e.tools.forEach(t=>{delete t.function.parameters.$schema}),e}async transformResponseOut(e){if(e.headers.get("Content-Type")?.includes("application/json")){let t=await e.json();return new Response(JSON.stringify(t),{status:e.status,statusText:e.statusText,headers:e.headers})}else if(e.headers.get("Content-Type")?.includes("stream")){if(!e.body)return e;let t=new TextDecoder,n=new TextEncoder,s=!1,a="",c=!1,f="",l=new ReadableStream({async start(d){let h=e.body.getReader(),b=(O,S,y)=>{let C=O.split(`
`);for(let _ of C)_.trim()&&S.enqueue(y.encode(_+`
`))},A=(O,S)=>{let{controller:y,encoder:C}=S;if(O.startsWith("data: ")&&O.trim()!=="data: [DONE]"){let _=O.slice(6);try{let F=JSON.parse(_);if(F.error)throw new Error(JSON.stringify(F));F.choices?.[0]?.delta?.content&&!S.hasTextContent()&&S.setHasTextContent(!0),F.choices?.[0]?.delta?.tool_calls?.length&&F.choices?.[0]?.delta?.tool_calls.forEach(U=>{U.id=`call_${Rr()}`}),F.choices?.[0]?.delta?.tool_calls?.length&&S.hasTextContent()&&(typeof F.choices[0].index=="number"?F.choices[0].index+=1:F.choices[0].index=1);let k=`data: ${JSON.stringify(F)}

`;y.enqueue(C.encode(k))}catch{y.enqueue(C.encode(O+`
`))}}else y.enqueue(C.encode(O+`
`))};try{for(;;){let{done:O,value:S}=await h.read();if(O){f.trim()&&b(f,d,n);break}if(!S||S.length===0)continue;let y;try{y=t.decode(S,{stream:!0})}catch(_){console.warn("Failed to decode chunk",_);continue}if(y.length===0)continue;if(f+=y,f.length>1e6){console.warn("Buffer size exceeds limit, processing partial data");let _=f.split(`
`);f=_.pop()||"";for(let F of _)if(F.trim())try{A(F,{controller:d,encoder:n,hasTextContent:()=>s,setHasTextContent:k=>s=k,reasoningContent:()=>a,appendReasoningContent:k=>a+=k,isReasoningComplete:()=>c,setReasoningComplete:k=>c=k})}catch(k){console.error("Error processing line:",F,k),d.enqueue(n.encode(F+`
`))}continue}let C=f.split(`
`);f=C.pop()||"";for(let _ of C)if(_.trim())try{A(_,{controller:d,encoder:n,hasTextContent:()=>s,setHasTextContent:F=>s=F,reasoningContent:()=>a,appendReasoningContent:F=>a+=F,isReasoningComplete:()=>c,setReasoningComplete:F=>c=F})}catch(F){console.error("Error processing line:",_,F),d.enqueue(n.encode(_+`
`))}}}catch(O){console.error("Stream error:",O),d.error(O)}finally{try{h.releaseLock()}catch(O){console.error("Error releasing reader lock:",O)}d.close()}}});return new Response(l,{status:e.status,statusText:e.statusText,headers:{"Content-Type":e.headers.get("Content-Type")||"text/plain","Cache-Control":"no-cache",Connection:"keep-alive"}})}return e}};var Gi=class{name="cleancache";async transformRequestIn(e){return Array.isArray(e.messages)&&e.messages.forEach(t=>{Array.isArray(t.content)?t.content.forEach(n=>{n.cache_control&&delete n.cache_control}):t.cache_control&&delete t.cache_control}),e}};var xm=Ie(Pa(),1),el=Ie(require("vm"),1);function tl(r){try{let e=xm.default.parse(r);return oe("\u5DE5\u5177\u8C03\u7528\u53C2\u6570JSON5\u89E3\u6790\u6210\u529F"),JSON.stringify(e)}catch(e){try{let t={data:null};return el.default.createContext(t),el.default.runInContext(`data = ${r}`,t),oe("\u5DE5\u5177\u8C03\u7528\u53C2\u6570\u515C\u5E95\u89E3\u6790\u6210\u529F"),JSON.stringify(t.data)}catch(t){return oe(`${e.message} ${e.stack}  \u5DE5\u5177\u8C03\u7528\u53C2\u6570JSON5\u89E3\u6790\u5931\u8D25: ${JSON.stringify(r)}`),oe(`${t.message} ${t.stack}  \u5DE5\u5177\u8C03\u7528\u53C2\u6570\u515C\u5E95\u89E3\u6790\u4E5F\u5931\u8D25\u4E86\uFF0C\u8FD4\u56DE\u539F\u6570\u636E`),r}}}var Wi=class{name="enhancetool";async transformResponseOut(e){if(e.headers.get("Content-Type")?.includes("application/json")){let t=await e.json();if(t?.choices?.[0]?.message?.tool_calls?.length)for(let n of t.choices[0].message.tool_calls)n.function?.arguments&&(n.function.arguments=tl(n.function.arguments));return new Response(JSON.stringify(t),{status:e.status,statusText:e.statusText,headers:e.headers})}else if(e.headers.get("Content-Type")?.includes("stream")){if(!e.body)return e;let t=new TextDecoder,n=new TextEncoder,s={},a=!1,c="",f=!1,l=!1,d="",h=new ReadableStream({async start(b){let A=e.body.getReader(),O=(C,_,F)=>{let k=C.split(`
`);for(let U of k)U.trim()&&_.enqueue(F.encode(U+`
`))},S=(C,_,F)=>{let k="";try{k=tl(s.arguments||"")}catch(H){oe(`${H.message} ${H.stack}  \u5DE5\u5177\u8C03\u7528\u53C2\u6570\u89E3\u6790\u5931\u8D25: ${JSON.stringify(s)}`),k=s.arguments||""}let U={role:"assistant",tool_calls:[{function:{name:s.name,arguments:k},id:s.id,index:s.index,type:"function"}]},B={...C,choices:[{...C.choices[0],delta:U}]};B.choices[0].delta.content!==void 0&&delete B.choices[0].delta.content;let j=`data: ${JSON.stringify(B)}

`;_.enqueue(F.encode(j))},y=(C,_)=>{let{controller:F,encoder:k}=_;if(C.startsWith("data: ")&&C.trim()!=="data: [DONE]"){let U=C.slice(6);try{let B=JSON.parse(U);if(B.choices?.[0]?.delta?.tool_calls?.length){let H=B.choices[0].delta.tool_calls[0];if(typeof s.index>"u"){s={index:H.index,name:H.function?.name||"",id:H.id||"",arguments:H.function?.arguments||""},H.function?.arguments&&(H.function.arguments="");let Z=`data: ${JSON.stringify(B)}

`;F.enqueue(k.encode(Z));return}else if(s.index===H.index){H.function?.arguments&&(s.arguments+=H.function.arguments);return}else{S(B,F,k),s={index:H.index,name:H.function?.name||"",id:H.id||"",arguments:H.function?.arguments||""};return}}if(B.choices?.[0]?.finish_reason==="tool_calls"&&s.index!==void 0){S(B,F,k),s={};return}B.choices?.[0]?.delta?.tool_calls?.length&&_.hasTextContent()&&(typeof B.choices[0].index=="number"?B.choices[0].index+=1:B.choices[0].index=1);let j=`data: ${JSON.stringify(B)}

`;F.enqueue(k.encode(j))}catch{F.enqueue(k.encode(C+`
`))}}else F.enqueue(k.encode(C+`
`))};try{for(;;){let{done:C,value:_}=await A.read();if(C){d.trim()&&O(d,b,n);break}if(!_||_.length===0)continue;let F;try{F=t.decode(_,{stream:!0})}catch(U){console.warn("Failed to decode chunk",U);continue}if(F.length===0)continue;if(d+=F,d.length>1e6){console.warn("Buffer size exceeds limit, processing partial data");let U=d.split(`
`);d=U.pop()||"";for(let B of U)if(B.trim())try{y(B,{controller:b,encoder:n,hasTextContent:()=>a,setHasTextContent:j=>a=j,reasoningContent:()=>c,appendReasoningContent:j=>c+=j,isReasoningComplete:()=>f,setReasoningComplete:j=>f=j})}catch(j){console.error("Error processing line:",B,j),b.enqueue(n.encode(B+`
`))}continue}let k=d.split(`
`);d=k.pop()||"";for(let U of k)if(U.trim())try{y(U,{controller:b,encoder:n,hasTextContent:()=>a,setHasTextContent:B=>a=B,reasoningContent:()=>c,appendReasoningContent:B=>c+=B,isReasoningComplete:()=>f,setReasoningComplete:B=>f=B})}catch(B){console.error("Error processing line:",U,B),b.enqueue(n.encode(U+`
`))}}}catch(C){console.error("Stream error:",C),b.error(C)}finally{try{A.releaseLock()}catch(C){console.error("Error releasing reader lock:",C)}b.close()}}});return new Response(h,{status:e.status,statusText:e.statusText,headers:{"Content-Type":e.headers.get("Content-Type")||"text/plain","Cache-Control":"no-cache",Connection:"keep-alive"}})}return e}};var zi=class{name="reasoning";async transformResponseOut(e){if(e.headers.get("Content-Type")?.includes("application/json")){let t=await e.json();return new Response(JSON.stringify(t),{status:e.status,statusText:e.statusText,headers:e.headers})}else if(e.headers.get("Content-Type")?.includes("stream")){if(!e.body)return e;let t=new TextDecoder,n=new TextEncoder,s="",a=!1,c="",f=new ReadableStream({async start(l){let d=e.body.getReader(),h=(A,O,S)=>{let y=A.split(`
`);for(let C of y)C.trim()&&O.enqueue(S.encode(C+`
`))},b=(A,O)=>{let{controller:S,encoder:y}=O;if(A.startsWith("data: ")&&A.trim()!=="data: [DONE]")try{let C=JSON.parse(A.slice(6));if(C.choices?.[0]?.delta?.reasoning_content){O.appendReasoningContent(C.choices[0].delta.reasoning_content);let _={...C,choices:[{...C.choices[0],delta:{...C.choices[0].delta,thinking:{content:C.choices[0].delta.reasoning_content}}}]};delete _.choices[0].delta.reasoning_content;let F=`data: ${JSON.stringify(_)}

`;S.enqueue(y.encode(F));return}if((C.choices?.[0]?.delta?.content||C.choices?.[0]?.delta?.tool_calls)&&O.reasoningContent()&&!O.isReasoningComplete()){O.setReasoningComplete(!0);let _=Date.now().toString(),F={...C,choices:[{...C.choices[0],delta:{...C.choices[0].delta,content:null,thinking:{content:O.reasoningContent(),signature:_}}}]};delete F.choices[0].delta.reasoning_content;let k=`data: ${JSON.stringify(F)}

`;S.enqueue(y.encode(k))}if(C.choices?.[0]?.delta?.reasoning_content&&delete C.choices[0].delta.reasoning_content,C.choices?.[0]?.delta&&Object.keys(C.choices[0].delta).length>0){O.isReasoningComplete()&&C.choices[0].index++;let _=`data: ${JSON.stringify(C)}

`;S.enqueue(y.encode(_))}}catch{S.enqueue(y.encode(A+`
`))}else S.enqueue(y.encode(A+`
`))};try{for(;;){let{done:A,value:O}=await d.read();if(A){c.trim()&&h(c,l,n);break}let S=t.decode(O,{stream:!0});c+=S;let y=c.split(`
`);c=y.pop()||"";for(let C of y)if(C.trim())try{b(C,{controller:l,encoder:n,reasoningContent:()=>s,appendReasoningContent:_=>s+=_,isReasoningComplete:()=>a,setReasoningComplete:_=>a=_})}catch(_){console.error("Error processing line:",C,_),l.enqueue(n.encode(C+`
`))}}}catch(A){console.error("Stream error:",A),l.error(A)}finally{try{d.releaseLock()}catch(A){console.error("Error releasing reader lock:",A)}l.close()}}});return new Response(f,{status:e.status,statusText:e.statusText,headers:{"Content-Type":e.headers.get("Content-Type")||"text/plain","Cache-Control":"no-cache",Connection:"keep-alive"}})}return e}};var Ji=class{constructor(e){this.options=e;this.max_tokens=this.options?.max_tokens,this.temperature=this.options?.temperature,this.top_p=this.options?.top_p,this.top_k=this.options?.top_k,this.repetition_penalty=this.options?.repetition_penalty}name="sampling";max_tokens;temperature;top_p;top_k;repetition_penalty;async transformRequestIn(e){return e.max_tokens&&e.max_tokens>this.max_tokens&&(e.max_tokens=this.max_tokens),typeof this.temperature<"u"&&(e.temperature=this.temperature),typeof this.top_p<"u"&&(e.top_p=this.top_p),typeof this.top_k<"u"&&(e.top_k=this.top_k),typeof this.repetition_penalty<"u"&&(e.repetition_penalty=this.repetition_penalty),e}};var Bm={AnthropicTransformer:ys,GeminiTransformer:Es,VertexGeminiTransformer:ji,DeepseekTransformer:Li,TooluseTransformer:Ui,OpenrouterTransformer:Mi,MaxTokenTransformer:$i,GroqTransformer:Hi,CleancacheTransformer:Gi,EnhanceToolTransformer:Wi,ReasoningTransformer:zi,SamplingTransformer:Ji};var Vi=Ie(require("node:module"),1),Ki=class{constructor(e){this.configService=e}transformers=new Map;registerTransformer(e,t){this.transformers.set(e,t),oe(`register transformer: ${e}${t.endPoint?` (endpoint: ${t.endPoint})`:" (no endpoint)"}`)}getTransformer(e){return this.transformers.get(e)}getAllTransformers(){return new Map(this.transformers)}getTransformersWithEndpoint(){let e=[];return this.transformers.forEach((t,n)=>{t.endPoint&&e.push({name:n,transformer:t})}),e}getTransformersWithoutEndpoint(){let e=[];return this.transformers.forEach((t,n)=>{t.endPoint||e.push({name:n,transformer:t})}),e}removeTransformer(e){return this.transformers.delete(e)}hasTransformer(e){return this.transformers.has(e)}async registerTransformerFromConfig(e){try{let t=Vi.default._load;if(Vi.default._load=function(n,s,a){return n==="claude-code-router"?{log:oe}:t.apply(Vi.default,arguments)},e.path){let n=require(require.resolve(e.path));if(n){let s=new n(e.options);if(!s.name)throw new Error(`Transformer instance from ${e.path} does not have a name property.`);return this.registerTransformer(s.name,s),!0}}return!1}catch(t){return oe(`load transformer (${e.path}) error:`,t.message,t.stack),!1}}async initialize(){try{await this.registerDefaultTransformersInternal(),await this.loadFromConfig()}catch(e){oe("TransformerService init error:",e)}}async registerDefaultTransformersInternal(){try{Object.values(Bm).forEach(e=>{if("TransformerName"in e&&typeof e.TransformerName=="string")this.registerTransformer(e.TransformerName,e);else{let t=new e;this.registerTransformer(t.name,t)}})}catch(e){oe("transformer regist error:",e)}}async loadFromConfig(){let e=this.configService.get("transformers",[]);for(let t of e)await this.registerTransformerFromConfig(t)}};function nA(){let r=(0,Im.default)({bodyLimit:52428800});return r.setErrorHandler(bf),r.register(Nm.default),r}var rl=class{app;configService;llmService;providerService;transformerService;constructor(e={}){this.configService=new ds(e),this.transformerService=new Ki(this.configService),this.transformerService.initialize().finally(()=>{this.providerService=new ps(this.configService,this.transformerService),this.llmService=new hs(this.providerService)}),this.app=nA()}async register(e,t){await this.app.register(e,t)}addHook(e,t){this.app.addHook(e,t)}async start(){try{this.app._server=this,this.app.addHook("preHandler",async(n,s)=>{try{let a=n.body;if(!a||!a.model)return s.code(400).send({error:"Missing model in request body"});let[c,f]=a.model.split(",");a.model=f,n.provider=c;return}catch(a){return n.log.error("Error in modelProviderMiddleware:",a),s.code(500).send({error:"Internal server error"})}}),this.app.register(wf);let e=await this.app.listen({port:parseInt(this.configService.get("PORT")||"3000",10),host:this.configService.get("HOST")||"127.0.0.1"});oe(`\u{1F680} LLMs API server listening on ${e}`);let t=async n=>{oe(`Received ${n}, shutting down gracefully...`),await this.app.close(),process.exit(0)};process.on("SIGINT",()=>t("SIGINT")),process.on("SIGTERM",()=>t("SIGTERM"))}catch(e){oe(`Error starting server: ${e}`),process.exit(1)}}},oA=rl;
/*! Bundled license information:

web-streams-polyfill/dist/ponyfill.es2018.js:
  (**
   * @license
   * web-streams-polyfill v3.3.3
   * Copyright 2024 Mattias Buelens, Diwank Singh Tomer and other contributors.
   * This code is released under the MIT license.
   * SPDX-License-Identifier: MIT
   *)

fetch-blob/index.js:
  (*! fetch-blob. MIT License. Jimmy Wrting <https://jimmy.warting.se/opensource> *)

formdata-polyfill/esm.min.js:
  (*! formdata-polyfill. MIT License. Jimmy Wrting <https://jimmy.warting.se/opensource> *)

node-domexception/index.js:
  (*! node-domexception. MIT License. Jimmy Wrting <https://jimmy.warting.se/opensource> *)

safe-buffer/index.js:
  (*! safe-buffer. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> *)

gtoken/build/cjs/src/index.cjs:
  (*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/babel/babel/blob/main/packages/babel-helpers/LICENSE *)
*/
//# sourceMappingURL=server.cjs.map
